{"version":3,"sources":["webpack://imagej/webpack/universalModuleDefinition","webpack://imagej/webpack/bootstrap","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.js","webpack://imagej/./node_modules/imjoy-rpc/dist/imjoy-rpc.js","webpack://imagej/./node_modules/imjoy-rpc/index.js","webpack://imagej/./node_modules/a11y-dialog/a11y-dialog.js","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.css?8f64","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.css","webpack://imagej/./node_modules/css-loader/lib/css-base.js","webpack://imagej/./node_modules/style-loader/lib/addStyles.js","webpack://imagej/./node_modules/style-loader/lib/urls.js","webpack://imagej/(webpack)/buildin/global.js","webpack://imagej/./src/index.js","webpack://imagej/./src/imjoyAPI.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Snackbar","$defaults","text","textColor","width","showAction","actionText","actionTextAria","alertScreenReader","actionTextColor","showSecondButton","secondButtonText","secondButtonAria","secondButtonTextColor","backgroundColor","pos","duration","customClass","onActionClick","element","style","opacity","onSecondButtonClick","onClose","show","$options","options","Extend","current","setTimeout","$parent","this","parentElement","removeChild","snackbar","document","createElement","className","$p","margin","padding","color","fontSize","fontWeight","lineHeight","innerHTML","appendChild","background","secondButton","setAttribute","addEventListener","actionButton","top","bottom","event","elapsed","propertyName","body","getComputedStyle","close","extended","deep","length","arguments","toString","merge","obj","prop","URL","webkitURL","content","url","blob","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","append","getBlob","e","Blob","Worker","createObjectURL","encodeURIComponent","Error","JSON","parse","__webpack_exports__","waitForInitialization","setupRPC","_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__","_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default","_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__","_pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__","_utils_js__WEBPACK_IMPORTED_MODULE_3__","_rpc_js__WEBPACK_IMPORTED_MODULE_4__","_package_json__WEBPACK_IMPORTED_MODULE_5__","_inIframe","self","config","targetOrigin","target_origin","credential_required","verify_credential","peer_id","handleEvent","type","origin","data","removeEventListener","console","warn","cfg","credential","then","result","auth","error","log","parent","postMessage","version","description","id","allow_execution","enable_service_worker","base_url","cache_requirements","keys","reduce","Promise","resolve","reject","worker","a","fallbackTimeout","terminate","transferables","undefined","clearTimeout","assign","location","dispatchEvent","CustomEvent","detail","requirements","__transferables__","debug","setupWebWorker","includes","api","expose_api_globally","connectRPC","_rpc_js__WEBPACK_IMPORTED_MODULE_0__","connection","codecs","rpc","on","launchConnected","getRemote","export","onload","dispose","registerCodec","k","disposeObject","_interface","setInterface","onLoad","handler","checkHandler","connected","connectedHandlers","push","disconnect","WorkerGlobalScope","pop","Connection","setupIframe","_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__","_rpc_js__WEBPACK_IMPORTED_MODULE_1__","_utils_js__WEBPACK_IMPORTED_MODULE_2__","_htmlToElement","html","template","trim","firstChild","_importScript","scriptTag","src","onreadystatechange","readyState","onerror","head","async","importScripts","args","Array","slice","len","super","emit","_fire","code","isArray","link_node","toLowerCase","endsWith","startsWith","rel","href","script_node","attrs","node","createTextNode","eval","style_node","link_node_","stack","String","dedicated_thread","lang","api_version","conn","connect","setupWebPython","_pluginIframe__WEBPACK_IMPORTED_MODULE_2__","startup_script","_export_plugin_api","execute_python_code","_api","getattr","pyodide","pyimport","hasattr","getOwnPropertyNames","func","runPython","setupPyodide","languagePluginUrl","iodide","output","div","getElementById","languagePluginLoader","catch","python_packages","loadPackage","message","API_VERSION","RPC","_utils_js__WEBPACK_IMPORTED_MODULE_0__","ArrayBufferView","getPrototypeOf","Uint8Array","constructor","_appendBuffer","buffer1","buffer2","tmp","byteLength","set","buffer","indexObject","is","split","_connection","_codecs","_object_store","_method_weakmap","WeakMap","_object_weakmap","_local_api","execute","_store","ReferenceStore","_method_refs","onReady","onBusy","_setupMessageHanlders","getStack","_remote_interface","forwarding_functions","func_name","_remote","Function","_encode","objectId","has","once","object_id","init","method","method_this","promise","_unwrap","join","apply","err","fetch","_disposeObject","_setRemoteInterface","sendInterface","typedArray","shape","dtype","_dtype","_rtype","_rvalue","_rshape","_rdtype","_decode","intf","_reportRemoteSet","targetId","me","remoteMethod","put","wrapped_resolve","wrapped_reject","encodedPromise","_wrap","__promise_pair","target_id","__remote_method","aObject","asInterface","aType","ArrayBuffer","bObject","_rtarget_id","_rintf","cid","_rname","temp","_transfer","isarray","tp","codec","encoder","encodedObj","tf","Tensor","v_buffer","dataSync","nj","NdArray","selection","File","_rpath","_path","webkitRelativePath","Boolean","Date","RegExp","ImageData","FileList","_rmime","DataView","Set","from","Map","concat","withPromise","decoder","_genRemoteCallback","_genRemoteMethod","array","Uint8","reshape","arraytype","tensor","v","remoteCallback","_indices","_readyHandler","_busyHandler","readyHandler","busyHandler","shift","splice","_genId","_releaseId","randId","Math","random","substr","getTime","dtypeToTypedArray","typedArrayToDtype","cacheRequirements","setupServiceWorker","urlJoin","MessageEmitter","int8","int16","int32","uint8","uint16","uint32","float32","float64","Int8Array","Int16Array","Int32Array","Uint16Array","Uint32Array","Float32Array","Float64Array","cacheUrlInServiceWorker","command","navigator","serviceWorker","register","messageChannel","MessageChannel","port1","onmessage","controller","port2","requirementsm","req","baseUrl","cacheCallback","registration","scope","replace","_event_handlers","_once_handlers","_debug","___event_run_once","idx","indexOf","global","focusedBeforeDialog","FOCUSABLE_ELEMENTS","A11yDialog","targets","_show","_hide","hide","_maintainFocus","_bindKeypress","container","dialog","querySelector","role","getAttribute","useDialog","nodeName","_listeners","toArray","collection","$$","selector","context","querySelectorAll","setFocusToFirstItem","focusableChildren","getFocusableChildren","focused","focus","filter","child","offsetWidth","offsetHeight","getClientRects","siblings","_targets","target","NodeList","isPrototypeOf","Element","collect","parentNode","childNodes","nodeType","shown","hasAttribute","removeAttribute","_openers","forEach","opener","_closers","closer","activeElement","showModal","Event","destroy","off","index","listener","which","preventDefault","focusedItemIndex","shiftKey","trapTabKey","contains","transform","locals","useSourceMap","list","map","item","cssMapping","btoa","sourceMapping","sourceMap","unescape","stringify","sourceURLs","sources","source","sourceRoot","cssWithMappingToString","mediaQuery","alreadyImportedModules","fn","memo","stylesInDom","isOldIE","all","atob","getElement","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","addStylesToDom","styles","domStyle","refs","j","parts","addStyle","listToStyles","newStyles","base","part","css","media","insertStyleElement","insertInto","lastStyleElementInsertedAtTop","insertAt","nextSibling","insertBefore","removeStyleElement","createStyleElement","addAttrs","el","update","remove","styleIndex","applyToSingletonTag","revokeObjectURL","link","createLinkElement","updateLink","applyToTag","newObj","DEBUG","newList","mayRemove","textStore","replaceText","replacement","styleSheet","cssText","cssNode","autoFixUrls","convertToAbsoluteUrls","oldSrc","protocol","host","currentDir","pathname","fullMatch","origUrl","newUrl","unquotedOrigUrl","$1","test","g","_createElement","touchClick","ev","click","tagName","stopPropagation","elm","fileDialog","openFileDialogJS","title","initPath","selectionMode","closed","dialogEl","cjCall","onclick","fileInput","onchange","mountFile","files","filepath","saveFileDialogJS","savePath","prompt","downloadQueue","openURL","open","getBytesFromUrl","originalUrl","arrayBuffer","cjTypedArrayToJava","file","bytes","readFile","cheerpjAddStringFile","getImageData","imagej","imp","getImage","cjStringJavaToJs","height","slices","channels","frames","javaBytesToArrayBuffer","saveAsBytes","value0","0","1","2","3","4","saveImage","filename","format","ext","original_name","getString","downloadBytesFile","fileByteArray","msSaveOrOpenBlob","msSaveBlob","elem","download","openImage","path","saveFileToFS","saveBytes","listDir","listFiles","reader","FileReader","readAsArrayBuffer","addMenuItem","pluginMenu","newMenu","classList","add","button","label","callback","resetHeight","innerHeight","fixHeight","cheerpjInit","enableInputMethods","clipboardMode","appContainer","cheerpjCreateDisplay","cheerpjRunStaticMethod","threads","cjSystemSetProperty","cheerpjRunMain","tryIJ","ij","_cheerpjCloseAsync","cheerpjCloseAsync","fds","fd","fdObj","fileData","chunks","removeFile","imagej_api","run","cjResolveCall","showStatus","showMessage","runPlugIn","runMacro","installPlugin","getPlugins","getPlugInsPath","save","openAsBytes","startImageJ","dragOverlay","dataTransfer","types","display","setupDragAndDrop","removes","items","it","fixMenu","service_api","setup","ctx","images","img","viewImage","macro","number","setupImJoyAPI"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"imagej\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"imagej\"] = factory();\n\telse\n\t\troot[\"imagej\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n","/*!\r\n * Snackbar v0.1.14\r\n * http://polonel.com/Snackbar\r\n *\r\n * Copyright 2018 Chris Brame and other contributors\r\n * Released under the MIT license\r\n * https://github.com/polonel/Snackbar/blob/master/LICENSE\r\n */\r\n\r\n(function(root, factory) {\r\n    'use strict';\r\n\r\n    if (typeof define === 'function' && define.amd) {\r\n        define([], function() {\r\n            return (root.Snackbar = factory());\r\n        });\r\n    } else if (typeof module === 'object' && module.exports) {\r\n        module.exports = root.Snackbar = factory();\r\n    } else {\r\n        root.Snackbar = factory();\r\n    }\r\n})(this, function() {\r\n    var Snackbar = {};\r\n\r\n    Snackbar.current = null;\r\n    var $defaults = {\r\n        text: 'Default Text',\r\n        textColor: '#FFFFFF',\r\n        width: 'auto',\r\n        showAction: true,\r\n        actionText: 'Dismiss',\r\n        actionTextAria: 'Dismiss, Description for Screen Readers',\r\n        alertScreenReader: false,\r\n        actionTextColor: '#4CAF50',\r\n        showSecondButton: false,\r\n        secondButtonText: '',\r\n        secondButtonAria: 'Description for Screen Readers',\r\n        secondButtonTextColor: '#4CAF50',\r\n        backgroundColor: '#323232',\r\n        pos: 'bottom-left',\r\n        duration: 5000,\r\n        customClass: '',\r\n        onActionClick: function(element) {\r\n            element.style.opacity = 0;\r\n        },\r\n        onSecondButtonClick: function(element) {},\r\n        onClose: function(element) {}\r\n    };\r\n\r\n    Snackbar.show = function($options) {\r\n        var options = Extend(true, $defaults, $options);\r\n\r\n        if (Snackbar.current) {\r\n            Snackbar.current.style.opacity = 0;\r\n            setTimeout(\r\n                function() {\r\n                    var $parent = this.parentElement;\r\n                    if ($parent)\r\n                    // possible null if too many/fast Snackbars\r\n                        $parent.removeChild(this);\r\n                }.bind(Snackbar.current),\r\n                500\r\n            );\r\n        }\r\n\r\n        Snackbar.snackbar = document.createElement('div');\r\n        Snackbar.snackbar.className = 'snackbar-container ' + options.customClass;\r\n        Snackbar.snackbar.style.width = options.width;\r\n        var $p = document.createElement('p');\r\n        $p.style.margin = 0;\r\n        $p.style.padding = 0;\r\n        $p.style.color = options.textColor;\r\n        $p.style.fontSize = '14px';\r\n        $p.style.fontWeight = 300;\r\n        $p.style.lineHeight = '1em';\r\n        $p.innerHTML = options.text;\r\n        Snackbar.snackbar.appendChild($p);\r\n        Snackbar.snackbar.style.background = options.backgroundColor;\r\n\r\n        if (options.showSecondButton) {\r\n            var secondButton = document.createElement('button');\r\n            secondButton.className = 'action';\r\n            secondButton.innerHTML = options.secondButtonText;\r\n            secondButton.setAttribute('aria-label', options.secondButtonAria);\r\n            secondButton.style.color = options.secondButtonTextColor;\r\n            secondButton.addEventListener('click', function() {\r\n                options.onSecondButtonClick(Snackbar.snackbar);\r\n            });\r\n            Snackbar.snackbar.appendChild(secondButton);\r\n        }\r\n\r\n        if (options.showAction) {\r\n            var actionButton = document.createElement('button');\r\n            actionButton.className = 'action';\r\n            actionButton.innerHTML = options.actionText;\r\n            actionButton.setAttribute('aria-label', options.actionTextAria);\r\n            actionButton.style.color = options.actionTextColor;\r\n            actionButton.addEventListener('click', function() {\r\n                options.onActionClick(Snackbar.snackbar);\r\n            });\r\n            Snackbar.snackbar.appendChild(actionButton);\r\n        }\r\n\r\n        if (options.duration) {\r\n            setTimeout(\r\n                function() {\r\n                    if (Snackbar.current === this) {\r\n                        Snackbar.current.style.opacity = 0;\r\n                        // When natural remove event occurs let's move the snackbar to its origins\r\n                        Snackbar.current.style.top = '-100px';\r\n                        Snackbar.current.style.bottom = '-100px';\r\n                    }\r\n                }.bind(Snackbar.snackbar),\r\n                options.duration\r\n            );\r\n        }\r\n\r\n        if (options.alertScreenReader) {\r\n           Snackbar.snackbar.setAttribute('role', 'alert');\r\n        }\r\n\r\n        Snackbar.snackbar.addEventListener(\r\n            'transitionend',\r\n            function(event, elapsed) {\r\n                if (event.propertyName === 'opacity' && this.style.opacity === '0') {\r\n                    if (typeof(options.onClose) === 'function')\r\n                        options.onClose(this);\r\n\r\n                    this.parentElement.removeChild(this);\r\n                    if (Snackbar.current === this) {\r\n                        Snackbar.current = null;\r\n                    }\r\n                }\r\n            }.bind(Snackbar.snackbar)\r\n        );\r\n\r\n        Snackbar.current = Snackbar.snackbar;\r\n\r\n        document.body.appendChild(Snackbar.snackbar);\r\n        var $bottom = getComputedStyle(Snackbar.snackbar).bottom;\r\n        var $top = getComputedStyle(Snackbar.snackbar).top;\r\n        Snackbar.snackbar.style.opacity = 1;\r\n        Snackbar.snackbar.className =\r\n            'snackbar-container ' + options.customClass + ' snackbar-pos ' + options.pos;\r\n    };\r\n\r\n    Snackbar.close = function() {\r\n        if (Snackbar.current) {\r\n            Snackbar.current.style.opacity = 0;\r\n        }\r\n    };\r\n\r\n    // Pure JS Extend\r\n    // http://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n    var Extend = function() {\r\n        var extended = {};\r\n        var deep = false;\r\n        var i = 0;\r\n        var length = arguments.length;\r\n\r\n        if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n            deep = arguments[0];\r\n            i++;\r\n        }\r\n\r\n        var merge = function(obj) {\r\n            for (var prop in obj) {\r\n                if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n                    if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n                        extended[prop] = Extend(true, extended[prop], obj[prop]);\r\n                    } else {\r\n                        extended[prop] = obj[prop];\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        for (; i < length; i++) {\r\n            var obj = arguments[i];\r\n            merge(obj);\r\n        }\r\n\r\n        return extended;\r\n    };\r\n\r\n    return Snackbar;\r\n});\r\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"imjoyRPC\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"imjoyRPC\"] = factory();\n\telse\n\t\troot[\"imjoyRPC\"] = factory();\n})(window, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/main.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./node_modules/worker-loader/dist/workers/InlineWorker.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/worker-loader/dist/workers/InlineWorker.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\nvar URL = window.URL || window.webkitURL;\n\nmodule.exports = function (content, url) {\n  try {\n    try {\n      var blob;\n\n      try {\n        // BlobBuilder = Deprecated, but widely implemented\n        var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n\n        blob = new BlobBuilder();\n\n        blob.append(content);\n\n        blob = blob.getBlob();\n      } catch (e) {\n        // The proposed API\n        blob = new Blob([content]);\n      }\n\n      return new Worker(URL.createObjectURL(blob));\n    } catch (e) {\n      return new Worker('data:application/javascript,' + encodeURIComponent(content));\n    }\n  } catch (e) {\n    if (!url) {\n      throw Error('Inline worker is not supported');\n    }\n\n    return new Worker(url);\n  }\n};\n\n/***/ }),\n\n/***/ \"./package.json\":\n/*!**********************!*\\\n  !*** ./package.json ***!\n  \\**********************/\n/*! exports provided: name, version, description, module, scripts, repository, keywords, author, license, bugs, homepage, dependencies, devDependencies, eslintConfig, default */\n/***/ (function(module) {\n\nmodule.exports = JSON.parse(\"{\\\"name\\\":\\\"imjoy-rpc\\\",\\\"version\\\":\\\"0.2.22\\\",\\\"description\\\":\\\"Remote procedure calls for ImJoy.\\\",\\\"module\\\":\\\"index.js\\\",\\\"scripts\\\":{\\\"build\\\":\\\"rm -rf dist && npm run build-umd\\\",\\\"build-umd\\\":\\\"webpack --config webpack.config.js --mode development && NODE_ENV=production webpack --config webpack.config.js --mode production --devtool source-map \\\",\\\"watch\\\":\\\"NODE_ENV=production webpack --watch --progress --config webpack.config.js --mode production --devtool source-map\\\",\\\"publish-npm\\\":\\\"npm install && npm run build && npm publish\\\",\\\"serve\\\":\\\"webpack-dev-server\\\",\\\"stats\\\":\\\"webpack --profile --json > stats.json\\\",\\\"stats-prod\\\":\\\"webpack --profile --json --mode production > stats-prod.json\\\",\\\"analyze\\\":\\\"webpack-bundle-analyzer -p 9999 stats.json\\\",\\\"analyze-prod\\\":\\\"webpack-bundle-analyzer -p 9999 stats-prod.json\\\",\\\"clean\\\":\\\"rimraf dist/*\\\",\\\"deploy\\\":\\\"npm run build && node deploy-site.js\\\",\\\"format\\\":\\\"prettier --write \\\\\\\"{src,tests}/**/**\\\\\\\"\\\",\\\"check-format\\\":\\\"prettier --check \\\\\\\"{src,tests}/**/**\\\\\\\"\\\",\\\"test\\\":\\\"karma start --single-run --browsers ChromeHeadless,FirefoxHeadless karma.conf.js\\\",\\\"test-watch\\\":\\\"karma start --auto-watch --browsers Chrome,FirefoxHeadless karma.conf.js --debug\\\"},\\\"repository\\\":{\\\"type\\\":\\\"git\\\",\\\"url\\\":\\\"git+https://github.com/imjoy-team/imjoy-rpc.git\\\"},\\\"keywords\\\":[\\\"imjoy\\\",\\\"rpc\\\"],\\\"author\\\":\\\"imjoy-team <imjoy.team@gmail.com>\\\",\\\"license\\\":\\\"MIT\\\",\\\"bugs\\\":{\\\"url\\\":\\\"https://github.com/imjoy-team/imjoy-rpc/issues\\\"},\\\"homepage\\\":\\\"https://github.com/imjoy-team/imjoy-rpc\\\",\\\"dependencies\\\":{},\\\"devDependencies\\\":{\\\"@babel/core\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/plugin-syntax-dynamic-import\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/polyfill\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/preset-env\\\":\\\"^7.0.0-beta.39\\\",\\\"@types/requirejs\\\":\\\"^2.1.28\\\",\\\"babel-core\\\":\\\"^6.26.0\\\",\\\"babel-eslint\\\":\\\"^10.1.0\\\",\\\"babel-loader\\\":\\\"^8.1.0\\\",\\\"babel-runtime\\\":\\\"^6.26.0\\\",\\\"chai\\\":\\\"^4.2.0\\\",\\\"clean-webpack-plugin\\\":\\\"^0.1.19\\\",\\\"copy-webpack-plugin\\\":\\\"^5.0.5\\\",\\\"eslint\\\":\\\"^6.8.0\\\",\\\"eslint-config-prettier\\\":\\\"^4.2.0\\\",\\\"eslint-loader\\\":\\\"^4.0.2\\\",\\\"file-loader\\\":\\\"^0.11.2\\\",\\\"fs-extra\\\":\\\"^0.30.0\\\",\\\"gh-pages\\\":\\\"^2.0.1\\\",\\\"html-loader\\\":\\\"^0.5.5\\\",\\\"html-webpack-plugin\\\":\\\"^3.2.0\\\",\\\"json-loader\\\":\\\"^0.5.4\\\",\\\"karma\\\":\\\"^4.4.1\\\",\\\"karma-chrome-launcher\\\":\\\"^3.1.0\\\",\\\"karma-firefox-launcher\\\":\\\"^1.3.0\\\",\\\"karma-mocha\\\":\\\"^1.3.0\\\",\\\"karma-spec-reporter\\\":\\\"0.0.32\\\",\\\"karma-webpack\\\":\\\"^4.0.2\\\",\\\"lerna\\\":\\\"^3.8.0\\\",\\\"lodash.debounce\\\":\\\"^4.0.8\\\",\\\"mocha\\\":\\\"^7.1.2\\\",\\\"postcss\\\":\\\"^6.0.2\\\",\\\"prettier\\\":\\\"^1.6.1\\\",\\\"rimraf\\\":\\\"^2.6.2\\\",\\\"schema-utils\\\":\\\"^0.4.3\\\",\\\"socket.io-client\\\":\\\"^2.3.0\\\",\\\"style-loader\\\":\\\"^0.18.1\\\",\\\"url-loader\\\":\\\"^0.5.9\\\",\\\"webpack\\\":\\\"^4.0.0\\\",\\\"webpack-bundle-analyzer\\\":\\\"^3.3.2\\\",\\\"webpack-cli\\\":\\\"^3.1.2\\\",\\\"webpack-dev-server\\\":\\\"^3.1.1\\\",\\\"webpack-merge\\\":\\\"^4.1.1\\\",\\\"workbox-webpack-plugin\\\":\\\"^4.3.1\\\",\\\"worker-loader\\\":\\\"^2.0.0\\\",\\\"write-file-webpack-plugin\\\":\\\"^4.5.1\\\"},\\\"eslintConfig\\\":{\\\"globals\\\":{\\\"document\\\":true,\\\"window\\\":true}}}\");\n\n/***/ }),\n\n/***/ \"./src/main.js\":\n/*!*********************!*\\\n  !*** ./src/main.js ***!\n  \\*********************/\n/*! exports provided: RPC, API_VERSION, VERSION, waitForInitialization, setupRPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"waitForInitialization\", function() { return waitForInitialization; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setupRPC\", function() { return setupRPC; });\n/* harmony import */ var _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./plugin.webworker.js */ \"./src/plugin.webworker.js\");\n/* harmony import */ var _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pluginIframe.js */ \"./src/pluginIframe.js\");\n/* harmony import */ var _pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pluginWebPython.js */ \"./src/pluginWebPython.js\");\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"RPC\", function() { return _rpc_js__WEBPACK_IMPORTED_MODULE_4__[\"RPC\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"API_VERSION\", function() { return _rpc_js__WEBPACK_IMPORTED_MODULE_4__[\"API_VERSION\"]; });\n\n/* harmony import */ var _package_json__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../package.json */ \"./package.json\");\nvar _package_json__WEBPACK_IMPORTED_MODULE_5___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../package.json */ \"./package.json\", 1);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"VERSION\", function() { return _package_json__WEBPACK_IMPORTED_MODULE_5__[\"version\"]; });\n\n/**\n * Contains the code executed in the sandboxed frame under web-browser\n *\n * Tries to create a Web-Worker inside the frame and set up the\n * communication between the worker and the parent window. Some\n * browsers restrict creating a worker inside a sandboxed iframe - if\n * this happens, the plugin initialized right inside the frame (in the\n * same thread)\n */\n\n\n\n\n\n\n\nfunction _inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n/**\n * Initializes the plugin inside a web worker. May throw an exception\n * in case this was not permitted by the browser.\n */\n\n\nfunction setupWebWorker(config) {\n  if (!config.allow_execution) throw new Error(\"web-worker plugin can only work with allow_execution=true\");\n  const worker = new _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default.a(); // mixed content warning in Chrome silently skips worker\n  // initialization without exception, handling this with timeout\n\n  const fallbackTimeout = setTimeout(function () {\n    worker.terminate();\n    console.warn(`Plugin failed to start as a web-worker, running in an iframe instead.`);\n    Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n  }, 2000);\n  const peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])(); // forwarding messages between the worker and parent window\n\n  worker.addEventListener(\"message\", function (e) {\n    let transferables = undefined;\n    const m = e.data;\n\n    if (m.type === \"worker-ready\") {\n      // send config to the worker\n      worker.postMessage({\n        type: \"connectRPC\",\n        config: config\n      });\n      clearTimeout(fallbackTimeout);\n      return;\n    } else if (m.type === \"initialized\") {\n      // complete the missing fields\n      m.config = Object.assign({}, config, m.config);\n      m.origin = window.location.origin;\n      m.peer_id = peer_id;\n    } else if (m.type === \"imjoy_remote_api_ready\") {\n      // if it's a webworker, there will be no api object returned\n      window.dispatchEvent(new CustomEvent(\"imjoy_remote_api_ready\", {\n        detail: null\n      }));\n    } else if (m.type === \"cacheRequirements\" && typeof cache_requirements === \"function\") {\n      cache_requirements(m.requirements);\n    } else if (m.type === \"disconnect\") {\n      worker.terminate();\n    } else {\n      if (m.__transferables__) {\n        transferables = m.__transferables__;\n        delete m.__transferables__;\n      }\n    }\n\n    parent.postMessage(m, config.target_origin || \"*\", transferables);\n  });\n  window.addEventListener(\"message\", function (e) {\n    let transferables = undefined;\n    const m = e.data;\n\n    if (m.__transferables__) {\n      transferables = m.__transferables__;\n      delete m.__transferables__;\n    }\n\n    if (m.peer_id === peer_id) {\n      worker.postMessage(m, transferables);\n    } else if (config.debug) {\n      console.log(`connection peer id mismatch ${m.peer_id} !== ${peer_id}`);\n    }\n  });\n}\n\nfunction waitForInitialization(config) {\n  if (!_inIframe()) {\n    throw new Error(\"waitForInitialization (imjoy-rpc) should only run inside an iframe.\");\n  }\n\n  config = config || {};\n  const targetOrigin = config.target_origin || \"*\";\n\n  if (config.credential_required && typeof config.verify_credential !== \"function\") {\n    throw new Error(\"Please also provide the `verify_credential` function with `credential_required`.\");\n  }\n\n  if (config.credential_required && targetOrigin === \"*\") {\n    throw new Error(\"`target_origin` was set to `*` with `credential_required=true`, there is a security risk that you may leak the credential to website from other origin. Please specify the `target_origin` explicitly.\");\n  }\n\n  const done = () => {\n    window.removeEventListener(\"message\", handleEvent);\n  };\n\n  const peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])();\n\n  const handleEvent = e => {\n    if (e.type === \"message\" && (targetOrigin === \"*\" || e.origin === targetOrigin)) {\n      if (e.data.type === \"initialize\") {\n        done();\n\n        if (e.data.peer_id !== peer_id) {\n          // TODO: throw an error when we are sure all the peers will send the peer_id\n          console.warn(`${e.data.config && e.data.config.name}: connection peer id mismatch ${e.data.peer_id} !== ${peer_id}`);\n        }\n\n        const cfg = e.data.config; // override the target_origin setting if it's configured by the rpc client\n        // otherwise take the setting from the core\n\n        if (targetOrigin !== \"*\") {\n          cfg.target_origin = targetOrigin;\n        }\n\n        if (config.credential_required) {\n          config.verify_credential(cfg.credential).then(result => {\n            if (result && result.auth && !result.error) {\n              // pass the authentication information with tokens\n              cfg.auth = result.auth;\n              setupRPC(cfg).then(() => {\n                console.log(\"ImJoy RPC loaded successfully!\");\n              });\n            } else {\n              throw new Error(\"Failed to verify the credentail:\" + (result && result.error));\n            }\n          });\n        } else {\n          setupRPC(cfg).then(() => {\n            console.log(\"ImJoy RPC loaded successfully!\");\n          });\n        }\n      } else {\n        throw new Error(`unrecognized message: ${e.data}`);\n      }\n    }\n  };\n\n  window.addEventListener(\"message\", handleEvent);\n  parent.postMessage({\n    type: \"imjoyRPCReady\",\n    config: config,\n    peer_id: peer_id\n  }, \"*\");\n}\nfunction setupRPC(config) {\n  config = config || {};\n  if (!config.name) throw new Error(\"Please specify a name for your app.\");\n  config.version = config.version || \"0.1.0\";\n  config.description = config.description || `[TODO: add description for ${config.name} ]`;\n  config.type = config.type || \"rpc-window\";\n  config.id = config.id || Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])();\n  config.allow_execution = config.allow_execution || false;\n\n  if (config.enable_service_worker) {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"setupServiceWorker\"])(config.base_url, config.target_origin, config.cache_requirements);\n  }\n\n  if (config.cache_requirements) {\n    delete config.cache_requirements;\n  } // remove functions\n\n\n  config = Object.keys(config).reduce((p, c) => {\n    if (typeof config[c] !== \"function\") p[c] = config[c];\n    return p;\n  }, {});\n  return new Promise((resolve, reject) => {\n    if (_inIframe()) {\n      if (config.type === \"web-worker\") {\n        try {\n          setupWebWorker(config);\n        } catch (e) {\n          // fallback to iframe\n          Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n        }\n      } else if (config.type === \"web-python\" || config.type === \"web-python-window\") {\n        Object(_pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(config);\n      } else if ([\"rpc-window\", \"rpc-worker\", \"iframe\", \"window\"].includes(config.type)) {\n        Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n      } else {\n        console.error(\"Unsupported plugin type: \" + config.type);\n        reject(\"Unsupported plugin type: \" + config.type);\n      }\n\n      try {\n        const handleEvent = e => {\n          const api = e.detail;\n\n          if (config.expose_api_globally) {\n            window.api = api;\n          } // imjoy plugin api\n\n\n          resolve(api);\n          window.removeEventListener(\"imjoy_remote_api_ready\", handleEvent);\n        };\n\n        window.addEventListener(\"imjoy_remote_api_ready\", handleEvent);\n      } catch (e) {\n        reject(e);\n      }\n    } else {\n      reject(new Error(\"imjoy-rpc should only run inside an iframe.\"));\n    }\n  });\n}\n\n/***/ }),\n\n/***/ \"./src/plugin.webworker.js\":\n/*!*********************************!*\\\n  !*** ./src/plugin.webworker.js ***!\n  \\*********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = function() {\n  return __webpack_require__(/*! !./node_modules/worker-loader/dist/workers/InlineWorker.js */ \"./node_modules/worker-loader/dist/workers/InlineWorker.js\")(\"/******/ (function(modules) { // webpackBootstrap\\n/******/ \\t// The module cache\\n/******/ \\tvar installedModules = {};\\n/******/\\n/******/ \\t// The require function\\n/******/ \\tfunction __webpack_require__(moduleId) {\\n/******/\\n/******/ \\t\\t// Check if module is in cache\\n/******/ \\t\\tif(installedModules[moduleId]) {\\n/******/ \\t\\t\\treturn installedModules[moduleId].exports;\\n/******/ \\t\\t}\\n/******/ \\t\\t// Create a new module (and put it into the cache)\\n/******/ \\t\\tvar module = installedModules[moduleId] = {\\n/******/ \\t\\t\\ti: moduleId,\\n/******/ \\t\\t\\tl: false,\\n/******/ \\t\\t\\texports: {}\\n/******/ \\t\\t};\\n/******/\\n/******/ \\t\\t// Execute the module function\\n/******/ \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n/******/\\n/******/ \\t\\t// Flag the module as loaded\\n/******/ \\t\\tmodule.l = true;\\n/******/\\n/******/ \\t\\t// Return the exports of the module\\n/******/ \\t\\treturn module.exports;\\n/******/ \\t}\\n/******/\\n/******/\\n/******/ \\t// expose the modules object (__webpack_modules__)\\n/******/ \\t__webpack_require__.m = modules;\\n/******/\\n/******/ \\t// expose the module cache\\n/******/ \\t__webpack_require__.c = installedModules;\\n/******/\\n/******/ \\t// define getter function for harmony exports\\n/******/ \\t__webpack_require__.d = function(exports, name, getter) {\\n/******/ \\t\\tif(!__webpack_require__.o(exports, name)) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n/******/ \\t\\t}\\n/******/ \\t};\\n/******/\\n/******/ \\t// define __esModule on exports\\n/******/ \\t__webpack_require__.r = function(exports) {\\n/******/ \\t\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n/******/ \\t\\t}\\n/******/ \\t\\tObject.defineProperty(exports, '__esModule', { value: true });\\n/******/ \\t};\\n/******/\\n/******/ \\t// create a fake namespace object\\n/******/ \\t// mode & 1: value is a module id, require it\\n/******/ \\t// mode & 2: merge all properties of value into the ns\\n/******/ \\t// mode & 4: return value when already ns object\\n/******/ \\t// mode & 8|1: behave like require\\n/******/ \\t__webpack_require__.t = function(value, mode) {\\n/******/ \\t\\tif(mode & 1) value = __webpack_require__(value);\\n/******/ \\t\\tif(mode & 8) return value;\\n/******/ \\t\\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\\n/******/ \\t\\tvar ns = Object.create(null);\\n/******/ \\t\\t__webpack_require__.r(ns);\\n/******/ \\t\\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\\n/******/ \\t\\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n/******/ \\t\\treturn ns;\\n/******/ \\t};\\n/******/\\n/******/ \\t// getDefaultExport function for compatibility with non-harmony modules\\n/******/ \\t__webpack_require__.n = function(module) {\\n/******/ \\t\\tvar getter = module && module.__esModule ?\\n/******/ \\t\\t\\tfunction getDefault() { return module['default']; } :\\n/******/ \\t\\t\\tfunction getModuleExports() { return module; };\\n/******/ \\t\\t__webpack_require__.d(getter, 'a', getter);\\n/******/ \\t\\treturn getter;\\n/******/ \\t};\\n/******/\\n/******/ \\t// Object.prototype.hasOwnProperty.call\\n/******/ \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n/******/\\n/******/ \\t// __webpack_public_path__\\n/******/ \\t__webpack_require__.p = \\\"\\\";\\n/******/\\n/******/\\n/******/ \\t// Load entry module and return exports\\n/******/ \\treturn __webpack_require__(__webpack_require__.s = \\\"./src/plugin.webworker.js\\\");\\n/******/ })\\n/************************************************************************/\\n/******/ ({\\n\\n/***/ \\\"./src/plugin.webworker.js\\\":\\n/*!*********************************!*\\\\\\n  !*** ./src/plugin.webworker.js ***!\\n  \\\\*********************************/\\n/*! no exports provided */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \\\"./src/pluginCore.js\\\");\\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \\\"./src/rpc.js\\\");\\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils.js */ \\\"./src/utils.js\\\");\\n/**\\n * Contains the routines loaded by the plugin Worker under web-browser.\\n *\\n * Initializes the web environment version of the platform-dependent\\n * connection object for the plugin site\\n */\\n\\n\\n\\n\\n(function() {\\n  // make sure this runs inside a webworker\\n  if (\\n    typeof WorkerGlobalScope === \\\"undefined\\\" ||\\n    !self ||\\n    !(self instanceof WorkerGlobalScope)\\n  ) {\\n    throw new Error(\\\"This script can only loaded in a webworker\\\");\\n  }\\n  /**\\n   * Connection object provided to the RPC constructor,\\n   * plugin site implementation for the web-based environment.\\n   * Global will be then cleared to prevent exposure into the\\n   * Worker, so we put this local connection object into a closure\\n   */\\n  class Connection extends _utils_js__WEBPACK_IMPORTED_MODULE_2__[\\\"MessageEmitter\\\"] {\\n    constructor(config) {\\n      super(config && config.debug);\\n      this.config = config || {};\\n    }\\n    connect() {\\n      self.addEventListener(\\\"message\\\", e => {\\n        this._fire(e.data.type, e.data);\\n      });\\n      this.emit({\\n        type: \\\"initialized\\\",\\n        config: this.config\\n      });\\n    }\\n    disconnect() {\\n      this._fire(\\\"beforeDisconnect\\\");\\n      self.close();\\n      this._fire(\\\"disconnected\\\");\\n    }\\n    emit(data) {\\n      let transferables = undefined;\\n      if (data.__transferables__) {\\n        transferables = data.__transferables__;\\n        delete data.__transferables__;\\n      }\\n      self.postMessage(data, transferables);\\n    }\\n    async execute(code) {\\n      if (code.type === \\\"requirements\\\") {\\n        try {\\n          if (\\n            code.requirements &&\\n            (Array.isArray(code.requirements) ||\\n              typeof code.requirements === \\\"string\\\")\\n          ) {\\n            try {\\n              if (!Array.isArray(code.requirements)) {\\n                code.requirements = [code.requirements];\\n              }\\n              for (var i = 0; i < code.requirements.length; i++) {\\n                if (\\n                  code.requirements[i].toLowerCase().endsWith(\\\".css\\\") ||\\n                  code.requirements[i].startsWith(\\\"css:\\\")\\n                ) {\\n                  throw \\\"unable to import css in a webworker\\\";\\n                } else if (\\n                  code.requirements[i].toLowerCase().endsWith(\\\".js\\\") ||\\n                  code.requirements[i].startsWith(\\\"js:\\\")\\n                ) {\\n                  if (code.requirements[i].startsWith(\\\"js:\\\")) {\\n                    code.requirements[i] = code.requirements[i].slice(3);\\n                  }\\n                  importScripts(code.requirements[i]);\\n                } else if (code.requirements[i].startsWith(\\\"http\\\")) {\\n                  importScripts(code.requirements[i]);\\n                } else if (code.requirements[i].startsWith(\\\"cache:\\\")) {\\n                  //ignore cache\\n                } else {\\n                  console.log(\\n                    \\\"Unprocessed requirements url: \\\" + code.requirements[i]\\n                  );\\n                }\\n              }\\n            } catch (e) {\\n              throw \\\"failed to import required scripts: \\\" +\\n                code.requirements.toString();\\n            }\\n          }\\n        } catch (e) {\\n          throw e;\\n        }\\n      } else if (code.type === \\\"script\\\") {\\n        try {\\n          if (\\n            code.requirements &&\\n            (Array.isArray(code.requirements) ||\\n              typeof code.requirements === \\\"string\\\")\\n          ) {\\n            try {\\n              if (Array.isArray(code.requirements)) {\\n                for (let i = 0; i < code.requirements.length; i++) {\\n                  importScripts(code.requirements[i]);\\n                }\\n              } else {\\n                importScripts(code.requirements);\\n              }\\n            } catch (e) {\\n              throw \\\"failed to import required scripts: \\\" +\\n                code.requirements.toString();\\n            }\\n          }\\n          eval(code.content);\\n        } catch (e) {\\n          console.error(e.message, e.stack);\\n          throw e;\\n        }\\n      } else {\\n        throw \\\"unsupported code type.\\\";\\n      }\\n      if (code.type === \\\"requirements\\\") {\\n        self.postMessage({\\n          type: \\\"cacheRequirements\\\",\\n          requirements: code.requirements\\n        });\\n      }\\n    }\\n  }\\n  const config = {\\n    type: \\\"web-worker\\\",\\n    dedicated_thread: true,\\n    allow_execution: true,\\n    lang: \\\"javascript\\\",\\n    api_version: _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\\\"API_VERSION\\\"]\\n  };\\n  const conn = new Connection(config);\\n  conn.on(\\\"connectRPC\\\", data => {\\n    Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\\\"connectRPC\\\"])(conn, Object.assign(data.config, config));\\n  });\\n  conn.connect();\\n  self.postMessage({\\n    type: \\\"worker-ready\\\"\\n  });\\n})();\\n\\n\\n/***/ }),\\n\\n/***/ \\\"./src/pluginCore.js\\\":\\n/*!***************************!*\\\\\\n  !*** ./src/pluginCore.js ***!\\n  \\\\***************************/\\n/*! exports provided: connectRPC */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"connectRPC\\\", function() { return connectRPC; });\\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rpc.js */ \\\"./src/rpc.js\\\");\\n/**\\n * Core plugin script loaded into the plugin process/thread.\\n *\\n * Initializes the plugin-site API global methods.\\n */\\n\\nfunction connectRPC(connection, config) {\\n  config = config || {};\\n  const codecs = {};\\n  const rpc = new _rpc_js__WEBPACK_IMPORTED_MODULE_0__[\\\"RPC\\\"](connection, config, codecs);\\n  rpc.on(\\\"getInterface\\\", function () {\\n    launchConnected();\\n  });\\n  rpc.on(\\\"remoteReady\\\", function () {\\n    const api = rpc.getRemote() || {};\\n\\n    if (api.export) {\\n      throw new Error(\\\"`export` is a reserved function name\\\");\\n    }\\n\\n    if (api.onload) {\\n      throw new Error(\\\"`onload` is a reserved function name\\\");\\n    }\\n\\n    if (api.dispose) {\\n      throw new Error(\\\"`dispose` is a reserved function name\\\");\\n    }\\n\\n    api.registerCodec = function (config) {\\n      if (!config[\\\"name\\\"] || !config[\\\"encoder\\\"] && !config[\\\"decoder\\\"]) {\\n        throw new Error(\\\"Invalid codec format, please make sure you provide a name, type, encoder and decoder.\\\");\\n      } else {\\n        if (config.type) {\\n          for (let k of Object.keys(codecs)) {\\n            if (codecs[k].type === config.type || k === config.name) {\\n              delete codecs[k];\\n              console.warn(\\\"Remove duplicated codec: \\\" + k);\\n            }\\n          }\\n        }\\n\\n        codecs[config[\\\"name\\\"]] = config;\\n      }\\n    };\\n\\n    api.disposeObject = function (obj) {\\n      rpc.disposeObject(obj);\\n    };\\n\\n    api.export = function (_interface, config) {\\n      rpc.setInterface(_interface, config);\\n    };\\n\\n    api.onLoad = function (handler) {\\n      handler = checkHandler(handler);\\n\\n      if (connected) {\\n        handler();\\n      } else {\\n        connectedHandlers.push(handler);\\n      }\\n    };\\n\\n    api.dispose = function (_interface) {\\n      rpc.disconnect();\\n    };\\n\\n    if (typeof WorkerGlobalScope !== \\\"undefined\\\" && self instanceof WorkerGlobalScope) {\\n      self.api = api;\\n      self.postMessage({\\n        type: \\\"imjoy_remote_api_ready\\\"\\n      });\\n    } else if (typeof window) {\\n      window.dispatchEvent(new CustomEvent(\\\"imjoy_remote_api_ready\\\", {\\n        detail: api\\n      }));\\n    }\\n  });\\n  let connected = false;\\n  const connectedHandlers = [];\\n\\n  const launchConnected = function () {\\n    if (!connected) {\\n      connected = true;\\n      let handler;\\n\\n      while (handler = connectedHandlers.pop()) {\\n        handler();\\n      }\\n    }\\n  };\\n\\n  const checkHandler = function (handler) {\\n    const type = typeof handler;\\n\\n    if (type !== \\\"function\\\") {\\n      const msg = \\\"A function may only be subsribed to the event, \\\" + type + \\\" was provided instead\\\";\\n      throw new Error(msg);\\n    }\\n\\n    return handler;\\n  };\\n\\n  return rpc;\\n}\\n\\n/***/ }),\\n\\n/***/ \\\"./src/rpc.js\\\":\\n/*!********************!*\\\\\\n  !*** ./src/rpc.js ***!\\n  \\\\********************/\\n/*! exports provided: API_VERSION, RPC */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"API_VERSION\\\", function() { return API_VERSION; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"RPC\\\", function() { return RPC; });\\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \\\"./src/utils.js\\\");\\n/**\\n * Contains the RPC object used both by the application\\n * site, and by each plugin\\n */\\n\\nconst API_VERSION = \\\"0.2.3\\\";\\nconst ArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor;\\n\\nfunction _appendBuffer(buffer1, buffer2) {\\n  const tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\\n  tmp.set(new Uint8Array(buffer1), 0);\\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\\n  return tmp.buffer;\\n}\\n\\nfunction indexObject(obj, is) {\\n  if (!is) throw new Error(\\\"undefined index\\\");\\n  if (typeof is === \\\"string\\\") return indexObject(obj, is.split(\\\".\\\"));else if (is.length === 0) return obj;else return indexObject(obj[is[0]], is.slice(1));\\n}\\n/**\\n * RPC object represents a single site in the\\n * communication protocol between the application and the plugin\\n *\\n * @param {Object} connection a special object allowing to send\\n * and receive messages from the opposite site (basically it\\n * should only provide send() and onMessage() methods)\\n */\\n\\n\\nclass RPC extends _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"MessageEmitter\\\"] {\\n  constructor(connection, config, codecs) {\\n    super(config && config.debug);\\n    this._connection = connection;\\n    this.config = config || {};\\n    this._codecs = codecs || {};\\n    this._object_store = {};\\n    this._method_weakmap = new WeakMap();\\n    this._object_weakmap = new WeakMap();\\n    this._local_api = null; // make sure there is an execute function\\n\\n    const name = this.config.name;\\n\\n    this._connection.execute = this._connection.execute || function () {\\n      throw new Error(`connection.execute not implemented (in \\\"${name}\\\")`);\\n    };\\n\\n    this._store = new ReferenceStore();\\n    this._method_refs = new ReferenceStore();\\n\\n    this._method_refs.onReady(() => {\\n      this._fire(\\\"remoteIdle\\\");\\n    });\\n\\n    this._method_refs.onBusy(() => {\\n      this._fire(\\\"remoteBusy\\\");\\n    });\\n\\n    this._setupMessageHanlders();\\n  }\\n\\n  init() {\\n    this._connection.emit({\\n      type: \\\"initialized\\\",\\n      config: this.config,\\n      peer_id: this._connection.peer_id\\n    });\\n  }\\n  /**\\n   * Set a handler to be called when received a responce from the\\n   * remote site reporting that the previously provided interface\\n   * has been successfully set as remote for that site\\n   *\\n   * @param {Function} handler\\n   */\\n\\n\\n  getRemoteCallStack() {\\n    return this._method_refs.getStack();\\n  }\\n  /**\\n   * @returns {Object} set of remote interface methods\\n   */\\n\\n\\n  getRemote() {\\n    return this._remote_interface;\\n  }\\n  /**\\n   * Sets the interface of this site making it available to the\\n   * remote site by sending a message with a set of methods names\\n   *\\n   * @param {Object} _interface to set\\n   */\\n\\n\\n  setInterface(_interface, config) {\\n    config = config || {};\\n    this.config.name = config.name || this.config.name;\\n    this.config.description = config.description || this.config.description;\\n\\n    if (this.config.forwarding_functions) {\\n      for (let func_name of this.config.forwarding_functions) {\\n        const _remote = this._remote_interface;\\n\\n        if (_remote[func_name]) {\\n          if (_interface.constructor === Object) {\\n            if (!_interface[func_name]) {\\n              _interface[func_name] = (...args) => {\\n                _remote[func_name](...args);\\n              };\\n            }\\n          } else if (_interface.constructor.constructor === Function) {\\n            if (!_interface.constructor.prototype[func_name]) {\\n              _interface.constructor.prototype[func_name] = (...args) => {\\n                _remote[func_name](...args);\\n              };\\n            }\\n          }\\n        }\\n      }\\n    }\\n\\n    this._local_api = _interface;\\n\\n    this._fire(\\\"interfaceAvailable\\\");\\n  }\\n  /**\\n   * Sends the actual interface to the remote site upon it was\\n   * updated or by a special request of the remote site\\n   */\\n\\n\\n  sendInterface() {\\n    if (!this._local_api) {\\n      throw new Error(\\\"interface is not set.\\\");\\n    }\\n\\n    this._encode(this._local_api, true).then(api => {\\n      this._connection.emit({\\n        type: \\\"setInterface\\\",\\n        api: api\\n      });\\n    });\\n  }\\n\\n  _disposeObject(objectId) {\\n    if (this._object_store[objectId]) {\\n      delete this._object_store[objectId];\\n    } else {\\n      throw new Error(`Object (id=${objectId}) not found.`);\\n    }\\n  }\\n\\n  disposeObject(obj) {\\n    return new Promise((resolve, reject) => {\\n      if (this._object_weakmap.has(obj)) {\\n        const objectId = this._object_weakmap.get(obj);\\n\\n        this._connection.once(\\\"disposed\\\", data => {\\n          if (data.error) reject(new Error(data.error));else resolve();\\n        });\\n\\n        this._connection.emit({\\n          type: \\\"disposeObject\\\",\\n          object_id: objectId\\n        });\\n      } else {\\n        throw new Error(\\\"Invalid object\\\");\\n      }\\n    });\\n  }\\n  /**\\n   * Handles a message from the remote site\\n   */\\n\\n\\n  _setupMessageHanlders() {\\n    this._connection.on(\\\"init\\\", this.init);\\n\\n    this._connection.on(\\\"execute\\\", data => {\\n      Promise.resolve(this._connection.execute(data.code)).then(() => {\\n        this._connection.emit({\\n          type: \\\"executed\\\"\\n        });\\n      }).catch(e => {\\n        console.error(e);\\n\\n        this._connection.emit({\\n          type: \\\"executed\\\",\\n          error: String(e)\\n        });\\n      });\\n    });\\n\\n    this._connection.on(\\\"method\\\", async data => {\\n      let resolve, reject, method, method_this, args, result;\\n\\n      try {\\n        if (data.promise) {\\n          [resolve, reject] = await this._unwrap(data.promise, false);\\n        }\\n\\n        const _interface = this._object_store[data.object_id];\\n        method = indexObject(_interface, data.name);\\n\\n        if (data.name.includes(\\\".\\\")) {\\n          const tmp = data.name.split(\\\".\\\");\\n          const intf_index = tmp.slice(0, tmp.length - 1).join(\\\".\\\");\\n          method_this = indexObject(_interface, intf_index);\\n        } else {\\n          method_this = _interface;\\n        }\\n\\n        args = await this._unwrap(data.args, true);\\n\\n        if (data.promise) {\\n          result = method.apply(method_this, args);\\n\\n          if (result instanceof Promise || method.constructor && method.constructor.name === \\\"AsyncFunction\\\") {\\n            result.then(resolve).catch(reject);\\n          } else {\\n            resolve(result);\\n          }\\n        } else {\\n          method.apply(method_this, args);\\n        }\\n      } catch (err) {\\n        console.error(this.config.name, err);\\n\\n        if (reject) {\\n          reject(err);\\n        }\\n      }\\n    });\\n\\n    this._connection.on(\\\"callback\\\", async data => {\\n      let resolve, reject, method, args, result;\\n\\n      try {\\n        if (data.promise) {\\n          [resolve, reject] = await this._unwrap(data.promise, false);\\n        }\\n\\n        if (data.promise) {\\n          method = this._store.fetch(data.id);\\n          args = await this._unwrap(data.args, true);\\n\\n          if (!method) {\\n            throw new Error(\\\"Callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\\\");\\n          }\\n\\n          result = method.apply(null, args);\\n\\n          if (result instanceof Promise || method.constructor && method.constructor.name === \\\"AsyncFunction\\\") {\\n            result.then(resolve).catch(reject);\\n          } else {\\n            resolve(result);\\n          }\\n        } else {\\n          method = this._store.fetch(data.id);\\n          args = await this._unwrap(data.args, true);\\n\\n          if (!method) {\\n            throw new Error(\\\"Please notice that callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\\\");\\n          }\\n\\n          method.apply(null, args);\\n        }\\n      } catch (err) {\\n        console.error(this.config.name, err);\\n\\n        if (reject) {\\n          reject(err);\\n        }\\n      }\\n    });\\n\\n    this._connection.on(\\\"disposeObject\\\", data => {\\n      try {\\n        this._disposeObject(data.object_id);\\n\\n        this._connection.emit({\\n          type: \\\"disposed\\\"\\n        });\\n      } catch (e) {\\n        console.error(e);\\n\\n        this._connection.emit({\\n          type: \\\"disposed\\\",\\n          error: String(e)\\n        });\\n      }\\n    });\\n\\n    this._connection.on(\\\"setInterface\\\", data => {\\n      this._setRemoteInterface(data.api);\\n    });\\n\\n    this._connection.on(\\\"getInterface\\\", () => {\\n      this._fire(\\\"getInterface\\\");\\n\\n      if (this._local_api) {\\n        this.sendInterface();\\n      } else {\\n        this.once(\\\"interfaceAvailable\\\", () => {\\n          this.sendInterface();\\n        });\\n      }\\n    });\\n\\n    this._connection.on(\\\"interfaceSetAsRemote\\\", () => {\\n      this._fire(\\\"interfaceSetAsRemote\\\");\\n    });\\n\\n    this._connection.on(\\\"disconnect\\\", () => {\\n      this._fire(\\\"beforeDisconnect\\\");\\n\\n      this._connection.disconnect();\\n\\n      this._fire(\\\"disconnected\\\");\\n    });\\n  }\\n  /**\\n   * Sends a requests to the remote site asking it to provide its\\n   * current interface\\n   */\\n\\n\\n  requestRemote() {\\n    this._connection.emit({\\n      type: \\\"getInterface\\\"\\n    });\\n  }\\n\\n  _ndarray(typedArray, shape, dtype) {\\n    const _dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][typedArray.constructor.name];\\n\\n    if (dtype && dtype !== _dtype) {\\n      throw \\\"dtype doesn't match the type of the array: \\\" + _dtype + \\\" != \\\" + dtype;\\n    }\\n\\n    shape = shape || [typedArray.length];\\n    return {\\n      _rtype: \\\"ndarray\\\",\\n      _rvalue: typedArray.buffer,\\n      _rshape: shape,\\n      _rdtype: _dtype\\n    };\\n  }\\n  /**\\n   * Sets the new remote interface provided by the other site\\n   *\\n   * @param {Array} names list of function names\\n   */\\n\\n\\n  _setRemoteInterface(api) {\\n    this._decode(api).then(intf => {\\n      this._remote_interface = intf;\\n\\n      this._fire(\\\"remoteReady\\\");\\n\\n      this._reportRemoteSet();\\n    });\\n  }\\n  /**\\n   * Generates the wrapped function corresponding to a single remote\\n   * method. When the generated function is called, it will send the\\n   * corresponding message to the remote site asking it to execute\\n   * the particular method of its interface\\n   *\\n   * @param {String} name of the remote method\\n   *\\n   * @returns {Function} wrapped remote method\\n   */\\n\\n\\n  _genRemoteMethod(targetId, name, objectId) {\\n    const me = this;\\n\\n    const remoteMethod = function () {\\n      return new Promise(async (resolve, reject) => {\\n        let id = null;\\n\\n        try {\\n          id = me._method_refs.put(objectId ? objectId + \\\"/\\\" + name : name);\\n\\n          const wrapped_resolve = function () {\\n            if (id !== null) me._method_refs.fetch(id);\\n            return resolve.apply(this, arguments);\\n          };\\n\\n          const wrapped_reject = function () {\\n            if (id !== null) me._method_refs.fetch(id);\\n            return reject.apply(this, arguments);\\n          };\\n\\n          const encodedPromise = await me._wrap([wrapped_resolve, wrapped_reject]); // store the key id for removing them from the reference store together\\n\\n          wrapped_resolve.__promise_pair = encodedPromise[1]._rvalue;\\n          wrapped_reject.__promise_pair = encodedPromise[0]._rvalue;\\n          let args = Array.prototype.slice.call(arguments);\\n\\n          if (name === \\\"register\\\" || name === \\\"export\\\" || name === \\\"on\\\") {\\n            args = await me._wrap(args, true);\\n          } else {\\n            args = await me._wrap(args);\\n          }\\n\\n          const transferables = args.__transferables__;\\n          if (transferables) delete args.__transferables__;\\n\\n          me._connection.emit({\\n            type: \\\"method\\\",\\n            target_id: targetId,\\n            name: name,\\n            object_id: objectId,\\n            args: args,\\n            promise: encodedPromise\\n          }, transferables);\\n        } catch (e) {\\n          if (id) me._method_refs.fetch(id);\\n          reject(`Failed to exectue remote method (interface: ${objectId || me.id}, method: ${name}), error: ${e}`);\\n        }\\n      });\\n    };\\n\\n    remoteMethod.__remote_method = true;\\n    return remoteMethod;\\n  }\\n  /**\\n   * Sends a responce reporting that interface just provided by the\\n   * remote site was successfully set by this site as remote\\n   */\\n\\n\\n  _reportRemoteSet() {\\n    this._connection.emit({\\n      type: \\\"interfaceSetAsRemote\\\"\\n    });\\n  }\\n  /**\\n   * Prepares the provided set of remote method arguments for\\n   * sending to the remote site, replaces all the callbacks with\\n   * identifiers\\n   *\\n   * @param {Array} args to wrap\\n   *\\n   * @returns {Array} wrapped arguments\\n   */\\n\\n\\n  async _encode(aObject, asInterface, objectId) {\\n    const aType = typeof aObject;\\n\\n    if (aType === \\\"number\\\" || aType === \\\"string\\\" || aType === \\\"boolean\\\" || aObject === null || aObject === undefined || aObject instanceof ArrayBuffer) {\\n      return aObject;\\n    }\\n\\n    let bObject;\\n\\n    if (typeof aObject === \\\"function\\\") {\\n      if (asInterface) {\\n        if (!objectId) throw new Error(\\\"objectId is not specified.\\\");\\n        bObject = {\\n          _rtype: \\\"interface\\\",\\n          _rtarget_id: this._connection.peer_id,\\n          _rintf: objectId,\\n          _rvalue: asInterface\\n        };\\n\\n        this._method_weakmap.set(aObject, bObject);\\n      } else if (this._method_weakmap.has(aObject)) {\\n        bObject = this._method_weakmap.get(aObject);\\n      } else {\\n        const cid = this._store.put(aObject);\\n\\n        bObject = {\\n          _rtype: \\\"callback\\\",\\n          _rtarget_id: this._connection.peer_id,\\n          _rname: aObject.constructor && aObject.constructor.name || cid,\\n          _rvalue: cid\\n        };\\n      }\\n\\n      return bObject;\\n    } // skip if already encoded\\n\\n\\n    if (aObject.constructor instanceof Object && aObject._rtype) {\\n      // make sure the interface functions are encoded\\n      if (aObject._rintf) {\\n        const temp = aObject._rtype;\\n        delete aObject._rtype;\\n        bObject = await this._encode(aObject, asInterface, objectId);\\n        bObject._rtype = temp;\\n      } else {\\n        bObject = aObject;\\n      }\\n\\n      return bObject;\\n    }\\n\\n    const transferables = [];\\n    const _transfer = aObject._transfer;\\n    const isarray = Array.isArray(aObject);\\n\\n    for (let tp of Object.keys(this._codecs)) {\\n      const codec = this._codecs[tp];\\n\\n      if (codec.encoder && aObject instanceof codec.type) {\\n        // TODO: what if multiple encoders found\\n        let encodedObj = await Promise.resolve(codec.encoder(aObject));\\n        if (encodedObj && !encodedObj._rtype) encodedObj._rtype = codec.name; // encode the functions in the interface object\\n\\n        if (encodedObj && encodedObj._rintf) {\\n          const temp = encodedObj._rtype;\\n          delete encodedObj._rtype;\\n          encodedObj = await this._encode(encodedObj, asInterface, objectId);\\n          encodedObj._rtype = temp;\\n        }\\n\\n        bObject = encodedObj;\\n        return bObject;\\n      }\\n    }\\n\\n    if (\\n    /*global tf*/\\n    typeof tf !== \\\"undefined\\\" && tf.Tensor && aObject instanceof tf.Tensor) {\\n      const v_buffer = aObject.dataSync();\\n\\n      if (aObject._transfer || _transfer) {\\n        transferables.push(v_buffer.buffer);\\n        delete aObject._transfer;\\n      }\\n\\n      bObject = {\\n        _rtype: \\\"ndarray\\\",\\n        _rvalue: v_buffer.buffer,\\n        _rshape: aObject.shape,\\n        _rdtype: aObject.dtype\\n      };\\n    } else if (\\n    /*global nj*/\\n    typeof nj !== \\\"undefined\\\" && nj.NdArray && aObject instanceof nj.NdArray) {\\n      const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][aObject.selection.data.constructor.name];\\n\\n      if (aObject._transfer || _transfer) {\\n        transferables.push(aObject.selection.data.buffer);\\n        delete aObject._transfer;\\n      }\\n\\n      bObject = {\\n        _rtype: \\\"ndarray\\\",\\n        _rvalue: aObject.selection.data.buffer,\\n        _rshape: aObject.shape,\\n        _rdtype: dtype\\n      };\\n    } else if (aObject instanceof Error) {\\n      console.error(aObject);\\n      bObject = {\\n        _rtype: \\\"error\\\",\\n        _rvalue: aObject.toString()\\n      };\\n    } else if (typeof File !== \\\"undefined\\\" && aObject instanceof File) {\\n      bObject = {\\n        _rtype: \\\"file\\\",\\n        _rvalue: aObject,\\n        _rpath: aObject._path || aObject.webkitRelativePath\\n      };\\n    } // send objects supported by structure clone algorithm\\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\\n    else if (aObject !== Object(aObject) || aObject instanceof Boolean || aObject instanceof String || aObject instanceof Date || aObject instanceof RegExp || aObject instanceof ImageData || typeof FileList !== \\\"undefined\\\" && aObject instanceof FileList) {\\n        bObject = aObject; // TODO: avoid object such as DynamicPlugin instance.\\n      } else if (typeof File !== \\\"undefined\\\" && aObject instanceof File) {\\n        bObject = {\\n          _rtype: \\\"file\\\",\\n          _rname: aObject.name,\\n          _rmime: aObject.type,\\n          _rvalue: aObject,\\n          _rpath: aObject._path || aObject.webkitRelativePath\\n        };\\n      } else if (aObject instanceof Blob) {\\n        bObject = {\\n          _rtype: \\\"blob\\\",\\n          _rvalue: aObject\\n        };\\n      } else if (aObject instanceof ArrayBufferView) {\\n        if (aObject._transfer || _transfer) {\\n          transferables.push(aObject.buffer);\\n          delete aObject._transfer;\\n        }\\n\\n        const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][aObject.constructor.name];\\n        bObject = {\\n          _rtype: \\\"typedarray\\\",\\n          _rvalue: aObject.buffer,\\n          _rdtype: dtype\\n        };\\n      } else if (aObject instanceof DataView) {\\n        if (aObject._transfer || _transfer) {\\n          transferables.push(aObject.buffer);\\n          delete aObject._transfer;\\n        }\\n\\n        bObject = {\\n          _rtype: \\\"memoryview\\\",\\n          _rvalue: aObject.buffer\\n        };\\n      } else if (aObject instanceof Set) {\\n        bObject = {\\n          _rtype: \\\"set\\\",\\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\\n        };\\n      } else if (aObject instanceof Map) {\\n        bObject = {\\n          _rtype: \\\"orderedmap\\\",\\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\\n        };\\n      } else if (aObject.constructor instanceof Object || Array.isArray(aObject)) {\\n        bObject = isarray ? [] : {};\\n        let keys; // an object/array\\n\\n        if (aObject.constructor === Object || Array.isArray(aObject)) {\\n          keys = Object.keys(aObject);\\n        } // a class\\n        else if (aObject.constructor === Function) {\\n            throw new Error(\\\"Please instantiate the class before exportting it.\\\");\\n          } // instance of a class\\n          else if (aObject.constructor.constructor === Function) {\\n              keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject)); // TODO: use a proxy object to represent the actual object\\n              // always encode class instance as interface\\n\\n              asInterface = true;\\n            } else {\\n              throw Error(\\\"Unsupported interface type\\\");\\n            } // encode interfaces\\n\\n\\n        if (aObject._rintf || asInterface) {\\n          if (!objectId) {\\n            objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"randId\\\"])();\\n            this._object_store[objectId] = aObject;\\n          }\\n\\n          for (let k of keys) {\\n            if (k === \\\"constructor\\\") continue;\\n\\n            if (k.startsWith(\\\"_\\\")) {\\n              continue;\\n            }\\n\\n            bObject[k] = await this._encode(aObject[k], typeof asInterface === \\\"string\\\" ? asInterface + \\\".\\\" + k : k, objectId);\\n          } // object id for dispose the object remotely\\n\\n\\n          bObject._rintf = objectId; // remove interface when closed\\n\\n          if (aObject.on && typeof aObject.on === \\\"function\\\") {\\n            aObject.on(\\\"close\\\", () => {\\n              delete this._object_store[objectId];\\n            });\\n          }\\n        } else {\\n          for (let k of keys) {\\n            if ([\\\"hasOwnProperty\\\", \\\"constructor\\\"].includes(k)) continue;\\n            bObject[k] = await this._encode(aObject[k]);\\n          }\\n        } // for example, browserFS object\\n\\n      } else if (typeof aObject === \\\"object\\\") {\\n        const keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject));\\n        const objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"randId\\\"])();\\n\\n        for (let k of keys) {\\n          if ([\\\"hasOwnProperty\\\", \\\"constructor\\\"].includes(k)) continue; // encode as interface\\n\\n          bObject[k] = await this._encode(aObject[k], k, bObject);\\n        } // object id, used for dispose the object\\n\\n\\n        bObject._rintf = objectId;\\n      } else {\\n        throw \\\"imjoy-rpc: Unsupported data type:\\\" + aObject;\\n      }\\n\\n    if (transferables.length > 0) {\\n      bObject.__transferables__ = transferables;\\n    }\\n\\n    if (!bObject) {\\n      throw new Error(\\\"Failed to encode object\\\");\\n    }\\n\\n    return bObject;\\n  }\\n\\n  async _decode(aObject, withPromise) {\\n    if (!aObject) {\\n      return aObject;\\n    }\\n\\n    let bObject;\\n\\n    if (aObject[\\\"_rtype\\\"]) {\\n      if (this._codecs[aObject._rtype] && this._codecs[aObject._rtype].decoder) {\\n        if (aObject._rintf) {\\n          const temp = aObject._rtype;\\n          delete aObject._rtype;\\n          aObject = await this._decode(aObject, withPromise);\\n          aObject._rtype = temp;\\n        }\\n\\n        bObject = await Promise.resolve(this._codecs[aObject._rtype].decoder(aObject));\\n      } else if (aObject._rtype === \\\"callback\\\") {\\n        bObject = this._genRemoteCallback(aObject._rtarget_id, aObject._rvalue, withPromise);\\n      } else if (aObject._rtype === \\\"interface\\\") {\\n        bObject = this._genRemoteMethod(aObject._rtarget_id, aObject._rvalue, aObject._rintf);\\n      } else if (aObject._rtype === \\\"ndarray\\\") {\\n        /*global nj tf*/\\n        //create build array/tensor if used in the plugin\\n        if (typeof nj !== \\\"undefined\\\" && nj.array) {\\n          if (Array.isArray(aObject._rvalue)) {\\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\\n          }\\n\\n          bObject = nj.array(new Uint8(aObject._rvalue), aObject._rdtype).reshape(aObject._rshape);\\n        } else if (typeof tf !== \\\"undefined\\\" && tf.Tensor) {\\n          if (Array.isArray(aObject._rvalue)) {\\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\\n          }\\n\\n          const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"dtypeToTypedArray\\\"][aObject._rdtype]);\\n          bObject = tf.tensor(new arraytype(aObject._rvalue), aObject._rshape, aObject._rdtype);\\n        } else {\\n          //keep it as regular if transfered to the main app\\n          bObject = aObject;\\n        }\\n      } else if (aObject._rtype === \\\"error\\\") {\\n        bObject = new Error(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"file\\\") {\\n        if (aObject._rvalue instanceof File) {\\n          bObject = aObject._rvalue; //patch _path\\n\\n          bObject._path = aObject._rpath;\\n        } else {\\n          bObject = new File([aObject._rvalue], aObject._rname, {\\n            type: aObject._rmime\\n          });\\n          bObject._path = aObject._rpath;\\n        }\\n      } else if (aObject._rtype === \\\"typedarray\\\") {\\n        const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"dtypeToTypedArray\\\"][aObject._rdtype]);\\n        if (!arraytype) throw new Error(\\\"unsupported dtype: \\\" + aObject._rdtype);\\n        bObject = new arraytype(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"memoryview\\\") {\\n        bObject = new DataView(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"blob\\\") {\\n        if (aObject._rvalue instanceof Blob) {\\n          bObject = aObject._rvalue;\\n        } else {\\n          bObject = new Blob([aObject._rvalue], {\\n            type: aObject._rmime\\n          });\\n        }\\n      } else if (aObject._rtype === \\\"orderedmap\\\") {\\n        bObject = new Map((await this._decode(aObject._rvalue, withPromise)));\\n      } else if (aObject._rtype === \\\"set\\\") {\\n        bObject = new Set((await this._decode(aObject._rvalue, withPromise)));\\n      } else {\\n        // make sure all the interface functions are decoded\\n        if (aObject._rintf) {\\n          const temp = aObject._rtype;\\n          delete aObject._rtype;\\n          aObject = await this._decode(aObject, withPromise);\\n          aObject._rtype = temp;\\n        }\\n\\n        bObject = aObject;\\n      }\\n    } else if (aObject.constructor === Object || Array.isArray(aObject)) {\\n      const isarray = Array.isArray(aObject);\\n      bObject = isarray ? [] : {};\\n\\n      for (let k of Object.keys(aObject)) {\\n        if (isarray || aObject.hasOwnProperty(k)) {\\n          const v = aObject[k];\\n          bObject[k] = await this._decode(v, withPromise);\\n        }\\n      }\\n    } else {\\n      bObject = aObject;\\n    }\\n\\n    if (bObject === undefined) {\\n      throw new Error(\\\"Failed to decode object\\\");\\n    } // store the object id for dispose\\n\\n\\n    if (aObject._rintf) {\\n      this._object_weakmap.set(bObject, aObject._rintf);\\n    }\\n\\n    return bObject;\\n  }\\n\\n  async _wrap(args, asInterface) {\\n    return await this._encode(args, asInterface);\\n  }\\n  /**\\n   * Unwraps the set of arguments delivered from the remote site,\\n   * replaces all callback identifiers with a function which will\\n   * initiate sending that callback identifier back to other site\\n   *\\n   * @param {Object} args to unwrap\\n   *\\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\\n   *\\n   * @returns {Array} unwrapped args\\n   */\\n\\n\\n  async _unwrap(args, withPromise) {\\n    return await this._decode(args, withPromise);\\n  }\\n  /**\\n   * Generates the wrapped function corresponding to a single remote\\n   * callback. When the generated function is called, it will send\\n   * the corresponding message to the remote site asking it to\\n   * execute the particular callback previously saved during a call\\n   * by the remote site a method from the interface of this site\\n   *\\n   * @param {Number} id of the remote callback to execute\\n   * @param {Number} argNum argument index of the callback\\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\\n   *\\n   * @returns {Function} wrapped remote callback\\n   */\\n\\n\\n  _genRemoteCallback(targetId, cid, withPromise) {\\n    const me = this;\\n    let remoteCallback;\\n\\n    if (withPromise) {\\n      remoteCallback = function () {\\n        return new Promise(async (resolve, reject) => {\\n          const args = await me._wrap(Array.prototype.slice.call(arguments));\\n          const transferables = args.__transferables__;\\n          if (transferables) delete args.__transferables__;\\n          const encodedPromise = await me._wrap([resolve, reject]); // store the key id for removing them from the reference store together\\n\\n          resolve.__promise_pair = encodedPromise[1]._rvalue;\\n          reject.__promise_pair = encodedPromise[0]._rvalue;\\n\\n          try {\\n            me._connection.emit({\\n              type: \\\"callback\\\",\\n              target_id: targetId,\\n              id: cid,\\n              args: args,\\n              promise: encodedPromise\\n            }, transferables);\\n          } catch (e) {\\n            reject(`Failed to exectue remote callback ( id: ${cid}).`);\\n          }\\n        });\\n      };\\n\\n      return remoteCallback;\\n    } else {\\n      remoteCallback = async function () {\\n        const args = await me._wrap(Array.prototype.slice.call(arguments));\\n        const transferables = args.__transferables__;\\n        if (transferables) delete args.__transferables__;\\n        return me._connection.emit({\\n          type: \\\"callback\\\",\\n          target_id: targetId,\\n          id: cid,\\n          args: args\\n        }, transferables);\\n      };\\n\\n      return remoteCallback;\\n    }\\n  }\\n  /**\\n   * Sends the notification message and breaks the connection\\n   */\\n\\n\\n  disconnect() {\\n    this._connection.emit({\\n      type: \\\"disconnect\\\"\\n    });\\n\\n    setTimeout(() => {\\n      this._connection.disconnect();\\n    }, 2000);\\n  }\\n\\n}\\n/**\\n * ReferenceStore is a special object which stores other objects\\n * and provides the references (number) instead. This reference\\n * may then be sent over a json-based communication channel (IPC\\n * to another Node.js process or a message to the Worker). Other\\n * site may then provide the reference in the responce message\\n * implying the given object should be activated.\\n *\\n * Primary usage for the ReferenceStore is a storage for the\\n * callbacks, which therefore makes it possible to initiate a\\n * callback execution by the opposite site (which normally cannot\\n * directly execute functions over the communication channel).\\n *\\n * Each stored object can only be fetched once and is not\\n * available for the second time. Each stored object must be\\n * fetched, since otherwise it will remain stored forever and\\n * consume memory.\\n *\\n * Stored object indeces are simply the numbers, which are however\\n * released along with the objects, and are later reused again (in\\n * order to postpone the overflow, which should not likely happen,\\n * but anyway).\\n */\\n\\nclass ReferenceStore {\\n  constructor() {\\n    this._store = {}; // stored object\\n\\n    this._indices = [0]; // smallest available indices\\n\\n    this._readyHandler = function () {};\\n\\n    this._busyHandler = function () {};\\n\\n    this._readyHandler();\\n  }\\n  /**\\n   * call handler when the store is empty\\n   *\\n   * @param {FUNCTION} id of a handler\\n   */\\n\\n\\n  onReady(readyHandler) {\\n    this._readyHandler = readyHandler || function () {};\\n  }\\n  /**\\n   * call handler when the store is not empty\\n   *\\n   * @param {FUNCTION} id of a handler\\n   */\\n\\n\\n  onBusy(busyHandler) {\\n    this._busyHandler = busyHandler || function () {};\\n  }\\n  /**\\n   * get the length of the store\\n   *\\n   */\\n\\n\\n  getStack() {\\n    return Object.keys(this._store).length;\\n  }\\n  /**\\n   * @function _genId() generates the new reference id\\n   *\\n   * @returns {Number} smallest available id and reserves it\\n   */\\n\\n\\n  _genId() {\\n    let id;\\n\\n    if (this._indices.length === 1) {\\n      id = this._indices[0]++;\\n    } else {\\n      id = this._indices.shift();\\n    }\\n\\n    return id;\\n  }\\n  /**\\n   * Releases the given reference id so that it will be available by\\n   * another object stored\\n   *\\n   * @param {Number} id to release\\n   */\\n\\n\\n  _releaseId(id) {\\n    for (let i = 0; i < this._indices.length; i++) {\\n      if (id < this._indices[i]) {\\n        this._indices.splice(i, 0, id);\\n\\n        break;\\n      }\\n    } // cleaning-up the sequence tail\\n\\n\\n    for (let i = this._indices.length - 1; i >= 0; i--) {\\n      if (this._indices[i] - 1 === this._indices[i - 1]) {\\n        this._indices.pop();\\n      } else {\\n        break;\\n      }\\n    }\\n  }\\n  /**\\n   * Stores the given object and returns the refernce id instead\\n   *\\n   * @param {Object} obj to store\\n   *\\n   * @returns {Number} reference id of the stored object\\n   */\\n\\n\\n  put(obj) {\\n    if (this._busyHandler && Object.keys(this._store).length === 0) {\\n      this._busyHandler();\\n    }\\n\\n    const id = this._genId();\\n\\n    this._store[id] = obj;\\n    return id;\\n  }\\n  /**\\n   * Retrieves previously stored object and releases its reference\\n   *\\n   * @param {Number} id of an object to retrieve\\n   */\\n\\n\\n  fetch(id) {\\n    const obj = this._store[id];\\n\\n    if (obj && !obj.__remote_method) {\\n      delete this._store[id];\\n\\n      this._releaseId(id);\\n\\n      if (this._readyHandler && Object.keys(this._store).length === 0) {\\n        this._readyHandler();\\n      }\\n    }\\n\\n    if (obj && obj.__promise_pair) {\\n      this.fetch(obj.__promise_pair);\\n    }\\n\\n    return obj;\\n  }\\n\\n}\\n\\n/***/ }),\\n\\n/***/ \\\"./src/utils.js\\\":\\n/*!**********************!*\\\\\\n  !*** ./src/utils.js ***!\\n  \\\\**********************/\\n/*! exports provided: randId, dtypeToTypedArray, typedArrayToDtype, cacheRequirements, setupServiceWorker, urlJoin, MessageEmitter */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"randId\\\", function() { return randId; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"dtypeToTypedArray\\\", function() { return dtypeToTypedArray; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"typedArrayToDtype\\\", function() { return typedArrayToDtype; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"cacheRequirements\\\", function() { return cacheRequirements; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"setupServiceWorker\\\", function() { return setupServiceWorker; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"urlJoin\\\", function() { return urlJoin; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"MessageEmitter\\\", function() { return MessageEmitter; });\\nfunction randId() {\\n  return Math.random().toString(36).substr(2, 10) + new Date().getTime();\\n}\\nconst dtypeToTypedArray = {\\n  int8: \\\"Int8Array\\\",\\n  int16: \\\"Int16Array\\\",\\n  int32: \\\"Int32Array\\\",\\n  uint8: \\\"Uint8Array\\\",\\n  uint16: \\\"Uint16Array\\\",\\n  uint32: \\\"Uint32Array\\\",\\n  float32: \\\"Float32Array\\\",\\n  float64: \\\"Float64Array\\\",\\n  array: \\\"Array\\\"\\n};\\nconst typedArrayToDtype = {\\n  Int8Array: \\\"int8\\\",\\n  Int16Array: \\\"int16\\\",\\n  Int32Array: \\\"int32\\\",\\n  Uint8Array: \\\"uint8\\\",\\n  Uint16Array: \\\"uint16\\\",\\n  Uint32Array: \\\"uint32\\\",\\n  Float32Array: \\\"float32\\\",\\n  Float64Array: \\\"float64\\\",\\n  Array: \\\"array\\\"\\n};\\n\\nfunction cacheUrlInServiceWorker(url) {\\n  return new Promise(function (resolve, reject) {\\n    const message = {\\n      command: \\\"add\\\",\\n      url: url\\n    };\\n\\n    if (!navigator.serviceWorker || !navigator.serviceWorker.register) {\\n      reject(\\\"Service worker is not supported.\\\");\\n      return;\\n    }\\n\\n    const messageChannel = new MessageChannel();\\n\\n    messageChannel.port1.onmessage = function (event) {\\n      if (event.data && event.data.error) {\\n        reject(event.data.error);\\n      } else {\\n        resolve(event.data && event.data.result);\\n      }\\n    };\\n\\n    if (navigator.serviceWorker && navigator.serviceWorker.controller) {\\n      navigator.serviceWorker.controller.postMessage(message, [messageChannel.port2]);\\n    } else {\\n      reject(\\\"Service worker controller is not available\\\");\\n    }\\n  });\\n}\\n\\nasync function cacheRequirements(requirements) {\\n  if (!Array.isArray(requirements)) {\\n    requirementsm.code.requirements = [requirements];\\n  }\\n\\n  if (requirements && requirements.length > 0) {\\n    for (let req of requirements) {\\n      //remove prefix\\n      if (req.startsWith(\\\"js:\\\")) req = req.slice(3);\\n      if (req.startsWith(\\\"css:\\\")) req = req.slice(4);\\n      if (req.startsWith(\\\"cache:\\\")) req = req.slice(6);\\n      if (!req.startsWith(\\\"http\\\")) continue;\\n      await cacheUrlInServiceWorker(req).catch(e => {\\n        console.error(e);\\n      });\\n    }\\n  }\\n}\\nfunction setupServiceWorker(baseUrl, targetOrigin, cacheCallback) {\\n  // register service worker for offline access\\n  if (\\\"serviceWorker\\\" in navigator) {\\n    baseUrl = baseUrl || \\\"/\\\";\\n    navigator.serviceWorker.register(baseUrl + \\\"plugin-service-worker.js\\\").then(function (registration) {\\n      // Registration was successful\\n      console.log(\\\"ServiceWorker registration successful with scope: \\\", registration.scope);\\n    }, function (err) {\\n      // registration failed :(\\n      console.log(\\\"ServiceWorker registration failed: \\\", err);\\n    });\\n    targetOrigin = targetOrigin || \\\"*\\\";\\n    cacheCallback = cacheCallback || cacheRequirements;\\n\\n    if (cacheCallback && typeof cacheCallback !== \\\"function\\\") {\\n      throw new Error(\\\"config.cache_requirements must be a function\\\");\\n    }\\n\\n    window.addEventListener(\\\"message\\\", function (e) {\\n      if (targetOrigin === \\\"*\\\" || e.origin === targetOrigin) {\\n        const m = e.data;\\n\\n        if (m.type === \\\"cacheRequirements\\\") {\\n          cacheCallback(m.requirements);\\n        }\\n      }\\n    });\\n  }\\n} //#Source https://bit.ly/2neWfJ2\\n\\nfunction urlJoin(...args) {\\n  return args.join(\\\"/\\\").replace(/[\\\\/]+/g, \\\"/\\\").replace(/^(.+):\\\\//, \\\"$1://\\\").replace(/^file:/, \\\"file:/\\\").replace(/\\\\/(\\\\?|&|#[^!])/g, \\\"$1\\\").replace(/\\\\?/g, \\\"&\\\").replace(\\\"&\\\", \\\"?\\\");\\n}\\nclass MessageEmitter {\\n  constructor(debug) {\\n    this._event_handlers = {};\\n    this._once_handlers = {};\\n    this._debug = debug;\\n  }\\n\\n  emit() {\\n    throw new Error(\\\"emit is not implemented\\\");\\n  }\\n\\n  on(event, handler) {\\n    if (!this._event_handlers[event]) {\\n      this._event_handlers[event] = [];\\n    }\\n\\n    this._event_handlers[event].push(handler);\\n  }\\n\\n  once(event, handler) {\\n    handler.___event_run_once = true;\\n    this.on(event, handler);\\n  }\\n\\n  off(event, handler) {\\n    if (!event && !handler) {\\n      // remove all events handlers\\n      this._event_handlers = {};\\n    } else if (event && !handler) {\\n      // remove all hanlders for the event\\n      if (this._event_handlers[event]) this._event_handlers[event] = [];\\n    } else {\\n      // remove a specific handler\\n      if (this._event_handlers[event]) {\\n        const idx = this._event_handlers[event].indexOf(handler);\\n\\n        if (idx >= 0) {\\n          this._event_handlers[event].splice(idx, 1);\\n        }\\n      }\\n    }\\n  }\\n\\n  _fire(event, data) {\\n    if (this._event_handlers[event]) {\\n      var i = this._event_handlers[event].length;\\n\\n      while (i--) {\\n        const handler = this._event_handlers[event][i];\\n\\n        try {\\n          handler(data);\\n        } catch (e) {\\n          console.error(e);\\n        } finally {\\n          if (handler.___event_run_once) {\\n            this._event_handlers[event].splice(i, 1);\\n          }\\n        }\\n      }\\n    } else {\\n      if (this._debug) {\\n        console.warn(\\\"unhandled event\\\", event, data);\\n      }\\n    }\\n  }\\n\\n}\\n\\n/***/ })\\n\\n/******/ });\\n//# sourceMappingURL=plugin.webworker.js.map\", null);\n};\n\n/***/ }),\n\n/***/ \"./src/pluginCore.js\":\n/*!***************************!*\\\n  !*** ./src/pluginCore.js ***!\n  \\***************************/\n/*! exports provided: connectRPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"connectRPC\", function() { return connectRPC; });\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/**\n * Core plugin script loaded into the plugin process/thread.\n *\n * Initializes the plugin-site API global methods.\n */\n\nfunction connectRPC(connection, config) {\n  config = config || {};\n  const codecs = {};\n  const rpc = new _rpc_js__WEBPACK_IMPORTED_MODULE_0__[\"RPC\"](connection, config, codecs);\n  rpc.on(\"getInterface\", function () {\n    launchConnected();\n  });\n  rpc.on(\"remoteReady\", function () {\n    const api = rpc.getRemote() || {};\n\n    if (api.export) {\n      throw new Error(\"`export` is a reserved function name\");\n    }\n\n    if (api.onload) {\n      throw new Error(\"`onload` is a reserved function name\");\n    }\n\n    if (api.dispose) {\n      throw new Error(\"`dispose` is a reserved function name\");\n    }\n\n    api.registerCodec = function (config) {\n      if (!config[\"name\"] || !config[\"encoder\"] && !config[\"decoder\"]) {\n        throw new Error(\"Invalid codec format, please make sure you provide a name, type, encoder and decoder.\");\n      } else {\n        if (config.type) {\n          for (let k of Object.keys(codecs)) {\n            if (codecs[k].type === config.type || k === config.name) {\n              delete codecs[k];\n              console.warn(\"Remove duplicated codec: \" + k);\n            }\n          }\n        }\n\n        codecs[config[\"name\"]] = config;\n      }\n    };\n\n    api.disposeObject = function (obj) {\n      rpc.disposeObject(obj);\n    };\n\n    api.export = function (_interface, config) {\n      rpc.setInterface(_interface, config);\n    };\n\n    api.onLoad = function (handler) {\n      handler = checkHandler(handler);\n\n      if (connected) {\n        handler();\n      } else {\n        connectedHandlers.push(handler);\n      }\n    };\n\n    api.dispose = function (_interface) {\n      rpc.disconnect();\n    };\n\n    if (typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope) {\n      self.api = api;\n      self.postMessage({\n        type: \"imjoy_remote_api_ready\"\n      });\n    } else if (typeof window) {\n      window.dispatchEvent(new CustomEvent(\"imjoy_remote_api_ready\", {\n        detail: api\n      }));\n    }\n  });\n  let connected = false;\n  const connectedHandlers = [];\n\n  const launchConnected = function () {\n    if (!connected) {\n      connected = true;\n      let handler;\n\n      while (handler = connectedHandlers.pop()) {\n        handler();\n      }\n    }\n  };\n\n  const checkHandler = function (handler) {\n    const type = typeof handler;\n\n    if (type !== \"function\") {\n      const msg = \"A function may only be subsribed to the event, \" + type + \" was provided instead\";\n      throw new Error(msg);\n    }\n\n    return handler;\n  };\n\n  return rpc;\n}\n\n/***/ }),\n\n/***/ \"./src/pluginIframe.js\":\n/*!*****************************!*\\\n  !*** ./src/pluginIframe.js ***!\n  \\*****************************/\n/*! exports provided: Connection, default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Connection\", function() { return Connection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return setupIframe; });\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \"./src/pluginCore.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/**\n * Contains the routines loaded by the plugin iframe under web-browser\n * in case when worker failed to initialize\n *\n * Initializes the web environment version of the platform-dependent\n * connection object for the plugin site\n */\n\n\n // Create a new, plain <span> element\n\nfunction _htmlToElement(html) {\n  var template = document.createElement(\"template\");\n  html = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = html;\n  return template.content.firstChild;\n}\n\nvar _importScript = function (url) {\n  //url is URL of external file, implementationCode is the code\n  //to be called from the file, location is the location to\n  //insert the <script> element\n  return new Promise((resolve, reject) => {\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n    scriptTag.type = \"text/javascript\";\n    scriptTag.onload = resolve;\n\n    scriptTag.onreadystatechange = function () {\n      if (this.readyState === \"loaded\" || this.readyState === \"complete\") {\n        resolve();\n      }\n    };\n\n    scriptTag.onerror = reject;\n    document.head.appendChild(scriptTag);\n  });\n}; // support importScripts outside web worker\n\n\nasync function importScripts() {\n  var args = Array.prototype.slice.call(arguments),\n      len = args.length,\n      i = 0;\n\n  for (; i < len; i++) {\n    await _importScript(args[i]);\n  }\n}\n\nclass Connection extends _utils_js__WEBPACK_IMPORTED_MODULE_2__[\"MessageEmitter\"] {\n  constructor(config) {\n    super(config && config.debug);\n    this.config = config || {};\n    this.peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_2__[\"randId\"])();\n  }\n\n  connect() {\n    this.config.target_origin = this.config.target_origin || \"*\"; // this will call handleEvent function\n\n    window.addEventListener(\"message\", this);\n    this.emit({\n      type: \"initialized\",\n      config: this.config,\n      origin: window.location.origin,\n      peer_id: this.peer_id\n    });\n\n    this._fire(\"connected\");\n  }\n\n  handleEvent(e) {\n    if (e.type === \"message\" && (this.config.target_origin === \"*\" || e.origin === this.config.target_origin)) {\n      if (e.data.peer_id === this.peer_id) {\n        this._fire(e.data.type, e.data);\n      } else if (this.config.debug) {\n        console.log(`connection peer id mismatch ${e.data.peer_id} !== ${this.peer_id}`);\n      }\n    }\n  }\n\n  disconnect() {\n    this._fire(\"beforeDisconnect\");\n\n    window.removeEventListener(\"message\", this);\n\n    this._fire(\"disconnected\");\n  }\n\n  emit(data) {\n    let transferables;\n\n    if (data.__transferables__) {\n      transferables = data.__transferables__;\n      delete data.__transferables__;\n    }\n\n    parent.postMessage(data, this.config.target_origin, transferables);\n  }\n\n  async execute(code) {\n    try {\n      if (code.type === \"requirements\") {\n        if (code.requirements && (Array.isArray(code.requirements) || typeof code.requirements === \"string\")) {\n          try {\n            var link_node;\n            code.requirements = typeof code.requirements === \"string\" ? [code.requirements] : code.requirements;\n\n            if (Array.isArray(code.requirements)) {\n              for (var i = 0; i < code.requirements.length; i++) {\n                if (code.requirements[i].toLowerCase().endsWith(\".css\") || code.requirements[i].startsWith(\"css:\")) {\n                  if (code.requirements[i].startsWith(\"css:\")) {\n                    code.requirements[i] = code.requirements[i].slice(4);\n                  }\n\n                  link_node = document.createElement(\"link\");\n                  link_node.rel = \"stylesheet\";\n                  link_node.href = code.requirements[i];\n                  document.head.appendChild(link_node);\n                } else if (code.requirements[i].toLowerCase().endsWith(\".js\") || code.requirements[i].startsWith(\"js:\")) {\n                  if (code.requirements[i].startsWith(\"js:\")) {\n                    code.requirements[i] = code.requirements[i].slice(3);\n                  }\n\n                  await importScripts(code.requirements[i]);\n                } else if (code.requirements[i].startsWith(\"http\")) {\n                  await importScripts(code.requirements[i]);\n                } else if (code.requirements[i].startsWith(\"cache:\")) {//ignore cache\n                } else {\n                  console.log(\"Unprocessed requirements url: \" + code.requirements[i]);\n                }\n              }\n            } else {\n              throw \"unsupported requirements definition\";\n            }\n          } catch (e) {\n            throw \"failed to import required scripts: \" + code.requirements.toString();\n          }\n        }\n      } else if (code.type === \"script\") {\n        if (code.src) {\n          var script_node = document.createElement(\"script\");\n          script_node.setAttribute(\"type\", code.attrs.type);\n          script_node.setAttribute(\"src\", code.src);\n          document.head.appendChild(script_node);\n        } else {\n          if (code.content && (!code.attrs.type || code.attrs.type === \"text/javascript\")) {\n            // document.addEventListener(\"DOMContentLoaded\", function(){\n            eval(code.content); // });\n          } else {\n            var node = document.createElement(\"script\");\n            node.setAttribute(\"type\", code.attrs.type);\n            node.appendChild(document.createTextNode(code.content));\n            document.body.appendChild(node);\n          }\n        }\n      } else if (code.type === \"style\") {\n        const style_node = document.createElement(\"style\");\n\n        if (code.src) {\n          style_node.src = code.src;\n        }\n\n        style_node.innerHTML = code.content;\n        document.head.appendChild(style_node);\n      } else if (code.type === \"link\") {\n        const link_node_ = document.createElement(\"link\");\n\n        if (code.rel) {\n          link_node_.rel = code.rel;\n        }\n\n        if (code.href) {\n          link_node_.href = code.href;\n        }\n\n        if (code.attrs && code.attrs.type) {\n          link_node_.type = code.attrs.type;\n        }\n\n        document.head.appendChild(link_node_);\n      } else if (code.type === \"html\") {\n        document.body.appendChild(_htmlToElement(code.content));\n      } else {\n        throw \"unsupported code type.\";\n      }\n\n      parent.postMessage({\n        type: \"executed\"\n      }, this.config.target_origin);\n    } catch (e) {\n      console.error(\"failed to execute scripts: \", code, e);\n      parent.postMessage({\n        type: \"executed\",\n        error: e.stack || String(e)\n      }, this.config.target_origin);\n    }\n  }\n\n}\nfunction setupIframe(config) {\n  config = config || {};\n  config.dedicated_thread = false;\n  config.lang = \"javascript\";\n  config.api_version = _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\"API_VERSION\"];\n  const conn = new Connection(config);\n  Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\"connectRPC\"])(conn, config);\n  conn.connect();\n}\n\n/***/ }),\n\n/***/ \"./src/pluginWebPython.js\":\n/*!********************************!*\\\n  !*** ./src/pluginWebPython.js ***!\n  \\********************************/\n/*! exports provided: default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return setupWebPython; });\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \"./src/pluginCore.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony import */ var _pluginIframe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pluginIframe */ \"./src/pluginIframe.js\");\n/**\n * Contains the routines loaded by the plugin iframe under web-browser\n * in case when worker failed to initialize\n *\n * Initializes the web environment version of the platform-dependent\n * connection object for the plugin site\n */\n\n\n // Create a new, plain <span> element\n\nfunction _htmlToElement(html) {\n  var template = document.createElement(\"template\");\n  html = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = html;\n  return template.content.firstChild;\n}\n\nconst _importScript = function (url) {\n  //url is URL of external file, implementationCode is the code\n  //to be called from the file, location is the location to\n  //insert the <script> element\n  return new Promise((resolve, reject) => {\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n    scriptTag.onload = resolve;\n\n    scriptTag.onreadystatechange = function () {\n      if (this.readyState === \"loaded\" || this.readyState === \"complete\") {\n        resolve();\n      }\n    };\n\n    scriptTag.onerror = reject;\n    document.head.appendChild(scriptTag);\n  });\n}; // support importScripts outside web worker\n\n\nasync function importScripts() {\n  var args = Array.prototype.slice.call(arguments),\n      len = args.length,\n      i = 0;\n\n  for (; i < len; i++) {\n    await _importScript(args[i]);\n  }\n}\n\nconst startup_script = `\nfrom js import api\nimport sys\nfrom types import ModuleType\nm = ModuleType(\"imjoy\")\nsys.modules[m.__name__] = m\nm.__file__ = m.__name__ + \".py\"\nm.api = api\n`;\nlet _export_plugin_api = null;\n\nconst execute_python_code = function (code) {\n  try {\n    if (!_export_plugin_api) {\n      _export_plugin_api = window.api.export;\n\n      window.api.export = function (p) {\n        if (typeof p === \"object\") {\n          const _api = {};\n\n          for (let k in p) {\n            if (!k.startsWith(\"_\")) {\n              _api[k] = p[k];\n            }\n          }\n\n          _export_plugin_api(_api);\n        } else if (typeof p === \"function\") {\n          const _api = {};\n          const getattr = window.pyodide.pyimport(\"getattr\");\n          const hasattr = window.pyodide.pyimport(\"hasattr\");\n\n          for (let k of Object.getOwnPropertyNames(p)) {\n            if (!k.startsWith(\"_\") && hasattr(p, k)) {\n              const func = getattr(p, k);\n\n              _api[k] = function () {\n                return func(...Array.prototype.slice.call(arguments));\n              };\n            }\n          }\n\n          _export_plugin_api(_api);\n        } else {\n          throw \"unsupported api export\";\n        }\n      };\n    }\n\n    window.pyodide.runPython(startup_script);\n    window.pyodide.runPython(code.content);\n  } catch (e) {\n    throw e;\n  }\n};\n\nfunction setupPyodide() {\n  return new Promise((resolve, reject) => {\n    window.languagePluginUrl = \"https://static.imjoy.io/pyodide/\";\n    importScripts(\"https://static.imjoy.io/pyodide/pyodide.js\").then(() => {\n      // hack for matplotlib etc.\n      window.iodide = {\n        output: {\n          element: function element(type) {\n            const div = document.createElement(type);\n            const output = document.getElementById(\"output\") || document.body;\n            output.appendChild(div);\n            return div;\n          }\n        }\n      };\n      window.languagePluginLoader.then(() => {\n        // pyodide is now ready to use...\n        console.log(window.pyodide.runPython(\"import sys\\nsys.version\"));\n        resolve();\n      }).catch(reject);\n    });\n  });\n} // connection object for the RPC constructor\n\n\nclass Connection extends _pluginIframe__WEBPACK_IMPORTED_MODULE_2__[\"Connection\"] {\n  constructor(config) {\n    super(config);\n  }\n\n  async execute(code) {\n    if (code.type === \"requirements\") {\n      if (code.requirements) {\n        code.requirements = typeof code.requirements === \"string\" ? [code.requirements] : code.requirements;\n\n        if (Array.isArray(code.requirements)) {\n          const python_packages = [];\n\n          for (var i = 0; i < code.requirements.length; i++) {\n            if (code.requirements[i].toLowerCase().endsWith(\".css\") || code.requirements[i].startsWith(\"css:\")) {\n              if (code.requirements[i].startsWith(\"css:\")) {\n                code.requirements[i] = code.requirements[i].slice(4);\n              }\n\n              link_node = document.createElement(\"link\");\n              link_node.rel = \"stylesheet\";\n              link_node.href = code.requirements[i];\n              document.head.appendChild(link_node);\n            } else if ( // code.requirements[i].toLowerCase().endsWith(\".js\") ||\n            code.requirements[i].startsWith(\"js:\")) {\n              if (code.requirements[i].startsWith(\"js:\")) {\n                code.requirements[i] = code.requirements[i].slice(3);\n              }\n\n              await importScripts(code.requirements[i]);\n            } else if (code.requirements[i].startsWith(\"cache:\")) {//ignore cache\n            } else if (code.requirements[i].toLowerCase().endsWith(\".js\") || code.requirements[i].startsWith(\"package:\")) {\n              if (code.requirements[i].startsWith(\"package:\")) {\n                code.requirements[i] = code.requirements[i].slice(8);\n              }\n\n              python_packages.push(code.requirements[i]);\n            } else if (code.requirements[i].startsWith(\"http:\") || code.requirements[i].startsWith(\"https:\")) {\n              console.log(\"Unprocessed requirements url: \" + code.requirements[i]);\n            } else {\n              python_packages.push(code.requirements[i]);\n            }\n          }\n\n          await window.pyodide.loadPackage(python_packages);\n        } else {\n          throw \"unsupported requirements definition\";\n        }\n      }\n    } else if (code.type === \"script\") {\n      if (code.src) {\n        var script_node = document.createElement(\"script\");\n        script_node.setAttribute(\"type\", code.attrs.type);\n        script_node.setAttribute(\"src\", code.src);\n        document.head.appendChild(script_node);\n      } else {\n        if (code.content && code.lang === \"python\") {\n          execute_python_code(code);\n        } else if (code.content && code.lang === \"javascript\") {\n          try {\n            eval(code.content);\n          } catch (e) {\n            console.error(e.message, e.stack);\n            throw e;\n          }\n        } else {\n          const node = document.createElement(\"script\");\n          node.setAttribute(\"type\", code.attrs.type);\n          node.appendChild(document.createTextNode(code.content));\n          document.body.appendChild(node);\n        }\n      }\n    } else if (code.type === \"style\") {\n      const style_node = document.createElement(\"style\");\n\n      if (code.src) {\n        style_node.src = code.src;\n      }\n\n      style_node.innerHTML = code.content;\n      document.head.appendChild(style_node);\n    } else if (code.type === \"link\") {\n      const link_node = document.createElement(\"link\");\n\n      if (code.rel) {\n        link_node.rel = code.rel;\n      }\n\n      if (code.href) {\n        link_node.href = code.href;\n      }\n\n      if (code.attrs && code.attrs.type) {\n        link_node.type = code.attrs.type;\n      }\n\n      document.head.appendChild(link_node);\n    } else if (code.type === \"html\") {\n      document.body.appendChild(_htmlToElement(code.content));\n    } else {\n      throw \"unsupported code type.\";\n    }\n  }\n\n}\n\nfunction setupWebPython(config) {\n  config = config || {};\n  config.debug = true;\n  config.dedicated_thread = false;\n  config.lang = \"python\";\n  config.api_version = _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\"API_VERSION\"];\n  const conn = new Connection(config);\n  setupPyodide().then(() => {\n    Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\"connectRPC\"])(conn, config);\n    conn.connect();\n  });\n}\n\n/***/ }),\n\n/***/ \"./src/rpc.js\":\n/*!********************!*\\\n  !*** ./src/rpc.js ***!\n  \\********************/\n/*! exports provided: API_VERSION, RPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"API_VERSION\", function() { return API_VERSION; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RPC\", function() { return RPC; });\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/**\n * Contains the RPC object used both by the application\n * site, and by each plugin\n */\n\nconst API_VERSION = \"0.2.3\";\nconst ArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor;\n\nfunction _appendBuffer(buffer1, buffer2) {\n  const tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n  tmp.set(new Uint8Array(buffer1), 0);\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n  return tmp.buffer;\n}\n\nfunction indexObject(obj, is) {\n  if (!is) throw new Error(\"undefined index\");\n  if (typeof is === \"string\") return indexObject(obj, is.split(\".\"));else if (is.length === 0) return obj;else return indexObject(obj[is[0]], is.slice(1));\n}\n/**\n * RPC object represents a single site in the\n * communication protocol between the application and the plugin\n *\n * @param {Object} connection a special object allowing to send\n * and receive messages from the opposite site (basically it\n * should only provide send() and onMessage() methods)\n */\n\n\nclass RPC extends _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"MessageEmitter\"] {\n  constructor(connection, config, codecs) {\n    super(config && config.debug);\n    this._connection = connection;\n    this.config = config || {};\n    this._codecs = codecs || {};\n    this._object_store = {};\n    this._method_weakmap = new WeakMap();\n    this._object_weakmap = new WeakMap();\n    this._local_api = null; // make sure there is an execute function\n\n    const name = this.config.name;\n\n    this._connection.execute = this._connection.execute || function () {\n      throw new Error(`connection.execute not implemented (in \"${name}\")`);\n    };\n\n    this._store = new ReferenceStore();\n    this._method_refs = new ReferenceStore();\n\n    this._method_refs.onReady(() => {\n      this._fire(\"remoteIdle\");\n    });\n\n    this._method_refs.onBusy(() => {\n      this._fire(\"remoteBusy\");\n    });\n\n    this._setupMessageHanlders();\n  }\n\n  init() {\n    this._connection.emit({\n      type: \"initialized\",\n      config: this.config,\n      peer_id: this._connection.peer_id\n    });\n  }\n  /**\n   * Set a handler to be called when received a responce from the\n   * remote site reporting that the previously provided interface\n   * has been successfully set as remote for that site\n   *\n   * @param {Function} handler\n   */\n\n\n  getRemoteCallStack() {\n    return this._method_refs.getStack();\n  }\n  /**\n   * @returns {Object} set of remote interface methods\n   */\n\n\n  getRemote() {\n    return this._remote_interface;\n  }\n  /**\n   * Sets the interface of this site making it available to the\n   * remote site by sending a message with a set of methods names\n   *\n   * @param {Object} _interface to set\n   */\n\n\n  setInterface(_interface, config) {\n    config = config || {};\n    this.config.name = config.name || this.config.name;\n    this.config.description = config.description || this.config.description;\n\n    if (this.config.forwarding_functions) {\n      for (let func_name of this.config.forwarding_functions) {\n        const _remote = this._remote_interface;\n\n        if (_remote[func_name]) {\n          if (_interface.constructor === Object) {\n            if (!_interface[func_name]) {\n              _interface[func_name] = (...args) => {\n                _remote[func_name](...args);\n              };\n            }\n          } else if (_interface.constructor.constructor === Function) {\n            if (!_interface.constructor.prototype[func_name]) {\n              _interface.constructor.prototype[func_name] = (...args) => {\n                _remote[func_name](...args);\n              };\n            }\n          }\n        }\n      }\n    }\n\n    this._local_api = _interface;\n\n    this._fire(\"interfaceAvailable\");\n  }\n  /**\n   * Sends the actual interface to the remote site upon it was\n   * updated or by a special request of the remote site\n   */\n\n\n  sendInterface() {\n    if (!this._local_api) {\n      throw new Error(\"interface is not set.\");\n    }\n\n    this._encode(this._local_api, true).then(api => {\n      this._connection.emit({\n        type: \"setInterface\",\n        api: api\n      });\n    });\n  }\n\n  _disposeObject(objectId) {\n    if (this._object_store[objectId]) {\n      delete this._object_store[objectId];\n    } else {\n      throw new Error(`Object (id=${objectId}) not found.`);\n    }\n  }\n\n  disposeObject(obj) {\n    return new Promise((resolve, reject) => {\n      if (this._object_weakmap.has(obj)) {\n        const objectId = this._object_weakmap.get(obj);\n\n        this._connection.once(\"disposed\", data => {\n          if (data.error) reject(new Error(data.error));else resolve();\n        });\n\n        this._connection.emit({\n          type: \"disposeObject\",\n          object_id: objectId\n        });\n      } else {\n        throw new Error(\"Invalid object\");\n      }\n    });\n  }\n  /**\n   * Handles a message from the remote site\n   */\n\n\n  _setupMessageHanlders() {\n    this._connection.on(\"init\", this.init);\n\n    this._connection.on(\"execute\", data => {\n      Promise.resolve(this._connection.execute(data.code)).then(() => {\n        this._connection.emit({\n          type: \"executed\"\n        });\n      }).catch(e => {\n        console.error(e);\n\n        this._connection.emit({\n          type: \"executed\",\n          error: String(e)\n        });\n      });\n    });\n\n    this._connection.on(\"method\", async data => {\n      let resolve, reject, method, method_this, args, result;\n\n      try {\n        if (data.promise) {\n          [resolve, reject] = await this._unwrap(data.promise, false);\n        }\n\n        const _interface = this._object_store[data.object_id];\n        method = indexObject(_interface, data.name);\n\n        if (data.name.includes(\".\")) {\n          const tmp = data.name.split(\".\");\n          const intf_index = tmp.slice(0, tmp.length - 1).join(\".\");\n          method_this = indexObject(_interface, intf_index);\n        } else {\n          method_this = _interface;\n        }\n\n        args = await this._unwrap(data.args, true);\n\n        if (data.promise) {\n          result = method.apply(method_this, args);\n\n          if (result instanceof Promise || method.constructor && method.constructor.name === \"AsyncFunction\") {\n            result.then(resolve).catch(reject);\n          } else {\n            resolve(result);\n          }\n        } else {\n          method.apply(method_this, args);\n        }\n      } catch (err) {\n        console.error(this.config.name, err);\n\n        if (reject) {\n          reject(err);\n        }\n      }\n    });\n\n    this._connection.on(\"callback\", async data => {\n      let resolve, reject, method, args, result;\n\n      try {\n        if (data.promise) {\n          [resolve, reject] = await this._unwrap(data.promise, false);\n        }\n\n        if (data.promise) {\n          method = this._store.fetch(data.id);\n          args = await this._unwrap(data.args, true);\n\n          if (!method) {\n            throw new Error(\"Callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\");\n          }\n\n          result = method.apply(null, args);\n\n          if (result instanceof Promise || method.constructor && method.constructor.name === \"AsyncFunction\") {\n            result.then(resolve).catch(reject);\n          } else {\n            resolve(result);\n          }\n        } else {\n          method = this._store.fetch(data.id);\n          args = await this._unwrap(data.args, true);\n\n          if (!method) {\n            throw new Error(\"Please notice that callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\");\n          }\n\n          method.apply(null, args);\n        }\n      } catch (err) {\n        console.error(this.config.name, err);\n\n        if (reject) {\n          reject(err);\n        }\n      }\n    });\n\n    this._connection.on(\"disposeObject\", data => {\n      try {\n        this._disposeObject(data.object_id);\n\n        this._connection.emit({\n          type: \"disposed\"\n        });\n      } catch (e) {\n        console.error(e);\n\n        this._connection.emit({\n          type: \"disposed\",\n          error: String(e)\n        });\n      }\n    });\n\n    this._connection.on(\"setInterface\", data => {\n      this._setRemoteInterface(data.api);\n    });\n\n    this._connection.on(\"getInterface\", () => {\n      this._fire(\"getInterface\");\n\n      if (this._local_api) {\n        this.sendInterface();\n      } else {\n        this.once(\"interfaceAvailable\", () => {\n          this.sendInterface();\n        });\n      }\n    });\n\n    this._connection.on(\"interfaceSetAsRemote\", () => {\n      this._fire(\"interfaceSetAsRemote\");\n    });\n\n    this._connection.on(\"disconnect\", () => {\n      this._fire(\"beforeDisconnect\");\n\n      this._connection.disconnect();\n\n      this._fire(\"disconnected\");\n    });\n  }\n  /**\n   * Sends a requests to the remote site asking it to provide its\n   * current interface\n   */\n\n\n  requestRemote() {\n    this._connection.emit({\n      type: \"getInterface\"\n    });\n  }\n\n  _ndarray(typedArray, shape, dtype) {\n    const _dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][typedArray.constructor.name];\n\n    if (dtype && dtype !== _dtype) {\n      throw \"dtype doesn't match the type of the array: \" + _dtype + \" != \" + dtype;\n    }\n\n    shape = shape || [typedArray.length];\n    return {\n      _rtype: \"ndarray\",\n      _rvalue: typedArray.buffer,\n      _rshape: shape,\n      _rdtype: _dtype\n    };\n  }\n  /**\n   * Sets the new remote interface provided by the other site\n   *\n   * @param {Array} names list of function names\n   */\n\n\n  _setRemoteInterface(api) {\n    this._decode(api).then(intf => {\n      this._remote_interface = intf;\n\n      this._fire(\"remoteReady\");\n\n      this._reportRemoteSet();\n    });\n  }\n  /**\n   * Generates the wrapped function corresponding to a single remote\n   * method. When the generated function is called, it will send the\n   * corresponding message to the remote site asking it to execute\n   * the particular method of its interface\n   *\n   * @param {String} name of the remote method\n   *\n   * @returns {Function} wrapped remote method\n   */\n\n\n  _genRemoteMethod(targetId, name, objectId) {\n    const me = this;\n\n    const remoteMethod = function () {\n      return new Promise(async (resolve, reject) => {\n        let id = null;\n\n        try {\n          id = me._method_refs.put(objectId ? objectId + \"/\" + name : name);\n\n          const wrapped_resolve = function () {\n            if (id !== null) me._method_refs.fetch(id);\n            return resolve.apply(this, arguments);\n          };\n\n          const wrapped_reject = function () {\n            if (id !== null) me._method_refs.fetch(id);\n            return reject.apply(this, arguments);\n          };\n\n          const encodedPromise = await me._wrap([wrapped_resolve, wrapped_reject]); // store the key id for removing them from the reference store together\n\n          wrapped_resolve.__promise_pair = encodedPromise[1]._rvalue;\n          wrapped_reject.__promise_pair = encodedPromise[0]._rvalue;\n          let args = Array.prototype.slice.call(arguments);\n\n          if (name === \"register\" || name === \"export\" || name === \"on\") {\n            args = await me._wrap(args, true);\n          } else {\n            args = await me._wrap(args);\n          }\n\n          const transferables = args.__transferables__;\n          if (transferables) delete args.__transferables__;\n\n          me._connection.emit({\n            type: \"method\",\n            target_id: targetId,\n            name: name,\n            object_id: objectId,\n            args: args,\n            promise: encodedPromise\n          }, transferables);\n        } catch (e) {\n          if (id) me._method_refs.fetch(id);\n          reject(`Failed to exectue remote method (interface: ${objectId || me.id}, method: ${name}), error: ${e}`);\n        }\n      });\n    };\n\n    remoteMethod.__remote_method = true;\n    return remoteMethod;\n  }\n  /**\n   * Sends a responce reporting that interface just provided by the\n   * remote site was successfully set by this site as remote\n   */\n\n\n  _reportRemoteSet() {\n    this._connection.emit({\n      type: \"interfaceSetAsRemote\"\n    });\n  }\n  /**\n   * Prepares the provided set of remote method arguments for\n   * sending to the remote site, replaces all the callbacks with\n   * identifiers\n   *\n   * @param {Array} args to wrap\n   *\n   * @returns {Array} wrapped arguments\n   */\n\n\n  async _encode(aObject, asInterface, objectId) {\n    const aType = typeof aObject;\n\n    if (aType === \"number\" || aType === \"string\" || aType === \"boolean\" || aObject === null || aObject === undefined || aObject instanceof ArrayBuffer) {\n      return aObject;\n    }\n\n    let bObject;\n\n    if (typeof aObject === \"function\") {\n      if (asInterface) {\n        if (!objectId) throw new Error(\"objectId is not specified.\");\n        bObject = {\n          _rtype: \"interface\",\n          _rtarget_id: this._connection.peer_id,\n          _rintf: objectId,\n          _rvalue: asInterface\n        };\n\n        this._method_weakmap.set(aObject, bObject);\n      } else if (this._method_weakmap.has(aObject)) {\n        bObject = this._method_weakmap.get(aObject);\n      } else {\n        const cid = this._store.put(aObject);\n\n        bObject = {\n          _rtype: \"callback\",\n          _rtarget_id: this._connection.peer_id,\n          _rname: aObject.constructor && aObject.constructor.name || cid,\n          _rvalue: cid\n        };\n      }\n\n      return bObject;\n    } // skip if already encoded\n\n\n    if (aObject.constructor instanceof Object && aObject._rtype) {\n      // make sure the interface functions are encoded\n      if (aObject._rintf) {\n        const temp = aObject._rtype;\n        delete aObject._rtype;\n        bObject = await this._encode(aObject, asInterface, objectId);\n        bObject._rtype = temp;\n      } else {\n        bObject = aObject;\n      }\n\n      return bObject;\n    }\n\n    const transferables = [];\n    const _transfer = aObject._transfer;\n    const isarray = Array.isArray(aObject);\n\n    for (let tp of Object.keys(this._codecs)) {\n      const codec = this._codecs[tp];\n\n      if (codec.encoder && aObject instanceof codec.type) {\n        // TODO: what if multiple encoders found\n        let encodedObj = await Promise.resolve(codec.encoder(aObject));\n        if (encodedObj && !encodedObj._rtype) encodedObj._rtype = codec.name; // encode the functions in the interface object\n\n        if (encodedObj && encodedObj._rintf) {\n          const temp = encodedObj._rtype;\n          delete encodedObj._rtype;\n          encodedObj = await this._encode(encodedObj, asInterface, objectId);\n          encodedObj._rtype = temp;\n        }\n\n        bObject = encodedObj;\n        return bObject;\n      }\n    }\n\n    if (\n    /*global tf*/\n    typeof tf !== \"undefined\" && tf.Tensor && aObject instanceof tf.Tensor) {\n      const v_buffer = aObject.dataSync();\n\n      if (aObject._transfer || _transfer) {\n        transferables.push(v_buffer.buffer);\n        delete aObject._transfer;\n      }\n\n      bObject = {\n        _rtype: \"ndarray\",\n        _rvalue: v_buffer.buffer,\n        _rshape: aObject.shape,\n        _rdtype: aObject.dtype\n      };\n    } else if (\n    /*global nj*/\n    typeof nj !== \"undefined\" && nj.NdArray && aObject instanceof nj.NdArray) {\n      const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][aObject.selection.data.constructor.name];\n\n      if (aObject._transfer || _transfer) {\n        transferables.push(aObject.selection.data.buffer);\n        delete aObject._transfer;\n      }\n\n      bObject = {\n        _rtype: \"ndarray\",\n        _rvalue: aObject.selection.data.buffer,\n        _rshape: aObject.shape,\n        _rdtype: dtype\n      };\n    } else if (aObject instanceof Error) {\n      console.error(aObject);\n      bObject = {\n        _rtype: \"error\",\n        _rvalue: aObject.toString()\n      };\n    } else if (typeof File !== \"undefined\" && aObject instanceof File) {\n      bObject = {\n        _rtype: \"file\",\n        _rvalue: aObject,\n        _rpath: aObject._path || aObject.webkitRelativePath\n      };\n    } // send objects supported by structure clone algorithm\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\n    else if (aObject !== Object(aObject) || aObject instanceof Boolean || aObject instanceof String || aObject instanceof Date || aObject instanceof RegExp || aObject instanceof ImageData || typeof FileList !== \"undefined\" && aObject instanceof FileList) {\n        bObject = aObject; // TODO: avoid object such as DynamicPlugin instance.\n      } else if (typeof File !== \"undefined\" && aObject instanceof File) {\n        bObject = {\n          _rtype: \"file\",\n          _rname: aObject.name,\n          _rmime: aObject.type,\n          _rvalue: aObject,\n          _rpath: aObject._path || aObject.webkitRelativePath\n        };\n      } else if (aObject instanceof Blob) {\n        bObject = {\n          _rtype: \"blob\",\n          _rvalue: aObject\n        };\n      } else if (aObject instanceof ArrayBufferView) {\n        if (aObject._transfer || _transfer) {\n          transferables.push(aObject.buffer);\n          delete aObject._transfer;\n        }\n\n        const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][aObject.constructor.name];\n        bObject = {\n          _rtype: \"typedarray\",\n          _rvalue: aObject.buffer,\n          _rdtype: dtype\n        };\n      } else if (aObject instanceof DataView) {\n        if (aObject._transfer || _transfer) {\n          transferables.push(aObject.buffer);\n          delete aObject._transfer;\n        }\n\n        bObject = {\n          _rtype: \"memoryview\",\n          _rvalue: aObject.buffer\n        };\n      } else if (aObject instanceof Set) {\n        bObject = {\n          _rtype: \"set\",\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\n        };\n      } else if (aObject instanceof Map) {\n        bObject = {\n          _rtype: \"orderedmap\",\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\n        };\n      } else if (aObject.constructor instanceof Object || Array.isArray(aObject)) {\n        bObject = isarray ? [] : {};\n        let keys; // an object/array\n\n        if (aObject.constructor === Object || Array.isArray(aObject)) {\n          keys = Object.keys(aObject);\n        } // a class\n        else if (aObject.constructor === Function) {\n            throw new Error(\"Please instantiate the class before exportting it.\");\n          } // instance of a class\n          else if (aObject.constructor.constructor === Function) {\n              keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject)); // TODO: use a proxy object to represent the actual object\n              // always encode class instance as interface\n\n              asInterface = true;\n            } else {\n              throw Error(\"Unsupported interface type\");\n            } // encode interfaces\n\n\n        if (aObject._rintf || asInterface) {\n          if (!objectId) {\n            objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"randId\"])();\n            this._object_store[objectId] = aObject;\n          }\n\n          for (let k of keys) {\n            if (k === \"constructor\") continue;\n\n            if (k.startsWith(\"_\")) {\n              continue;\n            }\n\n            bObject[k] = await this._encode(aObject[k], typeof asInterface === \"string\" ? asInterface + \".\" + k : k, objectId);\n          } // object id for dispose the object remotely\n\n\n          bObject._rintf = objectId; // remove interface when closed\n\n          if (aObject.on && typeof aObject.on === \"function\") {\n            aObject.on(\"close\", () => {\n              delete this._object_store[objectId];\n            });\n          }\n        } else {\n          for (let k of keys) {\n            if ([\"hasOwnProperty\", \"constructor\"].includes(k)) continue;\n            bObject[k] = await this._encode(aObject[k]);\n          }\n        } // for example, browserFS object\n\n      } else if (typeof aObject === \"object\") {\n        const keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject));\n        const objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"randId\"])();\n\n        for (let k of keys) {\n          if ([\"hasOwnProperty\", \"constructor\"].includes(k)) continue; // encode as interface\n\n          bObject[k] = await this._encode(aObject[k], k, bObject);\n        } // object id, used for dispose the object\n\n\n        bObject._rintf = objectId;\n      } else {\n        throw \"imjoy-rpc: Unsupported data type:\" + aObject;\n      }\n\n    if (transferables.length > 0) {\n      bObject.__transferables__ = transferables;\n    }\n\n    if (!bObject) {\n      throw new Error(\"Failed to encode object\");\n    }\n\n    return bObject;\n  }\n\n  async _decode(aObject, withPromise) {\n    if (!aObject) {\n      return aObject;\n    }\n\n    let bObject;\n\n    if (aObject[\"_rtype\"]) {\n      if (this._codecs[aObject._rtype] && this._codecs[aObject._rtype].decoder) {\n        if (aObject._rintf) {\n          const temp = aObject._rtype;\n          delete aObject._rtype;\n          aObject = await this._decode(aObject, withPromise);\n          aObject._rtype = temp;\n        }\n\n        bObject = await Promise.resolve(this._codecs[aObject._rtype].decoder(aObject));\n      } else if (aObject._rtype === \"callback\") {\n        bObject = this._genRemoteCallback(aObject._rtarget_id, aObject._rvalue, withPromise);\n      } else if (aObject._rtype === \"interface\") {\n        bObject = this._genRemoteMethod(aObject._rtarget_id, aObject._rvalue, aObject._rintf);\n      } else if (aObject._rtype === \"ndarray\") {\n        /*global nj tf*/\n        //create build array/tensor if used in the plugin\n        if (typeof nj !== \"undefined\" && nj.array) {\n          if (Array.isArray(aObject._rvalue)) {\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\n          }\n\n          bObject = nj.array(new Uint8(aObject._rvalue), aObject._rdtype).reshape(aObject._rshape);\n        } else if (typeof tf !== \"undefined\" && tf.Tensor) {\n          if (Array.isArray(aObject._rvalue)) {\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\n          }\n\n          const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"dtypeToTypedArray\"][aObject._rdtype]);\n          bObject = tf.tensor(new arraytype(aObject._rvalue), aObject._rshape, aObject._rdtype);\n        } else {\n          //keep it as regular if transfered to the main app\n          bObject = aObject;\n        }\n      } else if (aObject._rtype === \"error\") {\n        bObject = new Error(aObject._rvalue);\n      } else if (aObject._rtype === \"file\") {\n        if (aObject._rvalue instanceof File) {\n          bObject = aObject._rvalue; //patch _path\n\n          bObject._path = aObject._rpath;\n        } else {\n          bObject = new File([aObject._rvalue], aObject._rname, {\n            type: aObject._rmime\n          });\n          bObject._path = aObject._rpath;\n        }\n      } else if (aObject._rtype === \"typedarray\") {\n        const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"dtypeToTypedArray\"][aObject._rdtype]);\n        if (!arraytype) throw new Error(\"unsupported dtype: \" + aObject._rdtype);\n        bObject = new arraytype(aObject._rvalue);\n      } else if (aObject._rtype === \"memoryview\") {\n        bObject = new DataView(aObject._rvalue);\n      } else if (aObject._rtype === \"blob\") {\n        if (aObject._rvalue instanceof Blob) {\n          bObject = aObject._rvalue;\n        } else {\n          bObject = new Blob([aObject._rvalue], {\n            type: aObject._rmime\n          });\n        }\n      } else if (aObject._rtype === \"orderedmap\") {\n        bObject = new Map((await this._decode(aObject._rvalue, withPromise)));\n      } else if (aObject._rtype === \"set\") {\n        bObject = new Set((await this._decode(aObject._rvalue, withPromise)));\n      } else {\n        // make sure all the interface functions are decoded\n        if (aObject._rintf) {\n          const temp = aObject._rtype;\n          delete aObject._rtype;\n          aObject = await this._decode(aObject, withPromise);\n          aObject._rtype = temp;\n        }\n\n        bObject = aObject;\n      }\n    } else if (aObject.constructor === Object || Array.isArray(aObject)) {\n      const isarray = Array.isArray(aObject);\n      bObject = isarray ? [] : {};\n\n      for (let k of Object.keys(aObject)) {\n        if (isarray || aObject.hasOwnProperty(k)) {\n          const v = aObject[k];\n          bObject[k] = await this._decode(v, withPromise);\n        }\n      }\n    } else {\n      bObject = aObject;\n    }\n\n    if (bObject === undefined) {\n      throw new Error(\"Failed to decode object\");\n    } // store the object id for dispose\n\n\n    if (aObject._rintf) {\n      this._object_weakmap.set(bObject, aObject._rintf);\n    }\n\n    return bObject;\n  }\n\n  async _wrap(args, asInterface) {\n    return await this._encode(args, asInterface);\n  }\n  /**\n   * Unwraps the set of arguments delivered from the remote site,\n   * replaces all callback identifiers with a function which will\n   * initiate sending that callback identifier back to other site\n   *\n   * @param {Object} args to unwrap\n   *\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\n   *\n   * @returns {Array} unwrapped args\n   */\n\n\n  async _unwrap(args, withPromise) {\n    return await this._decode(args, withPromise);\n  }\n  /**\n   * Generates the wrapped function corresponding to a single remote\n   * callback. When the generated function is called, it will send\n   * the corresponding message to the remote site asking it to\n   * execute the particular callback previously saved during a call\n   * by the remote site a method from the interface of this site\n   *\n   * @param {Number} id of the remote callback to execute\n   * @param {Number} argNum argument index of the callback\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\n   *\n   * @returns {Function} wrapped remote callback\n   */\n\n\n  _genRemoteCallback(targetId, cid, withPromise) {\n    const me = this;\n    let remoteCallback;\n\n    if (withPromise) {\n      remoteCallback = function () {\n        return new Promise(async (resolve, reject) => {\n          const args = await me._wrap(Array.prototype.slice.call(arguments));\n          const transferables = args.__transferables__;\n          if (transferables) delete args.__transferables__;\n          const encodedPromise = await me._wrap([resolve, reject]); // store the key id for removing them from the reference store together\n\n          resolve.__promise_pair = encodedPromise[1]._rvalue;\n          reject.__promise_pair = encodedPromise[0]._rvalue;\n\n          try {\n            me._connection.emit({\n              type: \"callback\",\n              target_id: targetId,\n              id: cid,\n              args: args,\n              promise: encodedPromise\n            }, transferables);\n          } catch (e) {\n            reject(`Failed to exectue remote callback ( id: ${cid}).`);\n          }\n        });\n      };\n\n      return remoteCallback;\n    } else {\n      remoteCallback = async function () {\n        const args = await me._wrap(Array.prototype.slice.call(arguments));\n        const transferables = args.__transferables__;\n        if (transferables) delete args.__transferables__;\n        return me._connection.emit({\n          type: \"callback\",\n          target_id: targetId,\n          id: cid,\n          args: args\n        }, transferables);\n      };\n\n      return remoteCallback;\n    }\n  }\n  /**\n   * Sends the notification message and breaks the connection\n   */\n\n\n  disconnect() {\n    this._connection.emit({\n      type: \"disconnect\"\n    });\n\n    setTimeout(() => {\n      this._connection.disconnect();\n    }, 2000);\n  }\n\n}\n/**\n * ReferenceStore is a special object which stores other objects\n * and provides the references (number) instead. This reference\n * may then be sent over a json-based communication channel (IPC\n * to another Node.js process or a message to the Worker). Other\n * site may then provide the reference in the responce message\n * implying the given object should be activated.\n *\n * Primary usage for the ReferenceStore is a storage for the\n * callbacks, which therefore makes it possible to initiate a\n * callback execution by the opposite site (which normally cannot\n * directly execute functions over the communication channel).\n *\n * Each stored object can only be fetched once and is not\n * available for the second time. Each stored object must be\n * fetched, since otherwise it will remain stored forever and\n * consume memory.\n *\n * Stored object indeces are simply the numbers, which are however\n * released along with the objects, and are later reused again (in\n * order to postpone the overflow, which should not likely happen,\n * but anyway).\n */\n\nclass ReferenceStore {\n  constructor() {\n    this._store = {}; // stored object\n\n    this._indices = [0]; // smallest available indices\n\n    this._readyHandler = function () {};\n\n    this._busyHandler = function () {};\n\n    this._readyHandler();\n  }\n  /**\n   * call handler when the store is empty\n   *\n   * @param {FUNCTION} id of a handler\n   */\n\n\n  onReady(readyHandler) {\n    this._readyHandler = readyHandler || function () {};\n  }\n  /**\n   * call handler when the store is not empty\n   *\n   * @param {FUNCTION} id of a handler\n   */\n\n\n  onBusy(busyHandler) {\n    this._busyHandler = busyHandler || function () {};\n  }\n  /**\n   * get the length of the store\n   *\n   */\n\n\n  getStack() {\n    return Object.keys(this._store).length;\n  }\n  /**\n   * @function _genId() generates the new reference id\n   *\n   * @returns {Number} smallest available id and reserves it\n   */\n\n\n  _genId() {\n    let id;\n\n    if (this._indices.length === 1) {\n      id = this._indices[0]++;\n    } else {\n      id = this._indices.shift();\n    }\n\n    return id;\n  }\n  /**\n   * Releases the given reference id so that it will be available by\n   * another object stored\n   *\n   * @param {Number} id to release\n   */\n\n\n  _releaseId(id) {\n    for (let i = 0; i < this._indices.length; i++) {\n      if (id < this._indices[i]) {\n        this._indices.splice(i, 0, id);\n\n        break;\n      }\n    } // cleaning-up the sequence tail\n\n\n    for (let i = this._indices.length - 1; i >= 0; i--) {\n      if (this._indices[i] - 1 === this._indices[i - 1]) {\n        this._indices.pop();\n      } else {\n        break;\n      }\n    }\n  }\n  /**\n   * Stores the given object and returns the refernce id instead\n   *\n   * @param {Object} obj to store\n   *\n   * @returns {Number} reference id of the stored object\n   */\n\n\n  put(obj) {\n    if (this._busyHandler && Object.keys(this._store).length === 0) {\n      this._busyHandler();\n    }\n\n    const id = this._genId();\n\n    this._store[id] = obj;\n    return id;\n  }\n  /**\n   * Retrieves previously stored object and releases its reference\n   *\n   * @param {Number} id of an object to retrieve\n   */\n\n\n  fetch(id) {\n    const obj = this._store[id];\n\n    if (obj && !obj.__remote_method) {\n      delete this._store[id];\n\n      this._releaseId(id);\n\n      if (this._readyHandler && Object.keys(this._store).length === 0) {\n        this._readyHandler();\n      }\n    }\n\n    if (obj && obj.__promise_pair) {\n      this.fetch(obj.__promise_pair);\n    }\n\n    return obj;\n  }\n\n}\n\n/***/ }),\n\n/***/ \"./src/utils.js\":\n/*!**********************!*\\\n  !*** ./src/utils.js ***!\n  \\**********************/\n/*! exports provided: randId, dtypeToTypedArray, typedArrayToDtype, cacheRequirements, setupServiceWorker, urlJoin, MessageEmitter */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"randId\", function() { return randId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"dtypeToTypedArray\", function() { return dtypeToTypedArray; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"typedArrayToDtype\", function() { return typedArrayToDtype; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"cacheRequirements\", function() { return cacheRequirements; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setupServiceWorker\", function() { return setupServiceWorker; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"urlJoin\", function() { return urlJoin; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MessageEmitter\", function() { return MessageEmitter; });\nfunction randId() {\n  return Math.random().toString(36).substr(2, 10) + new Date().getTime();\n}\nconst dtypeToTypedArray = {\n  int8: \"Int8Array\",\n  int16: \"Int16Array\",\n  int32: \"Int32Array\",\n  uint8: \"Uint8Array\",\n  uint16: \"Uint16Array\",\n  uint32: \"Uint32Array\",\n  float32: \"Float32Array\",\n  float64: \"Float64Array\",\n  array: \"Array\"\n};\nconst typedArrayToDtype = {\n  Int8Array: \"int8\",\n  Int16Array: \"int16\",\n  Int32Array: \"int32\",\n  Uint8Array: \"uint8\",\n  Uint16Array: \"uint16\",\n  Uint32Array: \"uint32\",\n  Float32Array: \"float32\",\n  Float64Array: \"float64\",\n  Array: \"array\"\n};\n\nfunction cacheUrlInServiceWorker(url) {\n  return new Promise(function (resolve, reject) {\n    const message = {\n      command: \"add\",\n      url: url\n    };\n\n    if (!navigator.serviceWorker || !navigator.serviceWorker.register) {\n      reject(\"Service worker is not supported.\");\n      return;\n    }\n\n    const messageChannel = new MessageChannel();\n\n    messageChannel.port1.onmessage = function (event) {\n      if (event.data && event.data.error) {\n        reject(event.data.error);\n      } else {\n        resolve(event.data && event.data.result);\n      }\n    };\n\n    if (navigator.serviceWorker && navigator.serviceWorker.controller) {\n      navigator.serviceWorker.controller.postMessage(message, [messageChannel.port2]);\n    } else {\n      reject(\"Service worker controller is not available\");\n    }\n  });\n}\n\nasync function cacheRequirements(requirements) {\n  if (!Array.isArray(requirements)) {\n    requirementsm.code.requirements = [requirements];\n  }\n\n  if (requirements && requirements.length > 0) {\n    for (let req of requirements) {\n      //remove prefix\n      if (req.startsWith(\"js:\")) req = req.slice(3);\n      if (req.startsWith(\"css:\")) req = req.slice(4);\n      if (req.startsWith(\"cache:\")) req = req.slice(6);\n      if (!req.startsWith(\"http\")) continue;\n      await cacheUrlInServiceWorker(req).catch(e => {\n        console.error(e);\n      });\n    }\n  }\n}\nfunction setupServiceWorker(baseUrl, targetOrigin, cacheCallback) {\n  // register service worker for offline access\n  if (\"serviceWorker\" in navigator) {\n    baseUrl = baseUrl || \"/\";\n    navigator.serviceWorker.register(baseUrl + \"plugin-service-worker.js\").then(function (registration) {\n      // Registration was successful\n      console.log(\"ServiceWorker registration successful with scope: \", registration.scope);\n    }, function (err) {\n      // registration failed :(\n      console.log(\"ServiceWorker registration failed: \", err);\n    });\n    targetOrigin = targetOrigin || \"*\";\n    cacheCallback = cacheCallback || cacheRequirements;\n\n    if (cacheCallback && typeof cacheCallback !== \"function\") {\n      throw new Error(\"config.cache_requirements must be a function\");\n    }\n\n    window.addEventListener(\"message\", function (e) {\n      if (targetOrigin === \"*\" || e.origin === targetOrigin) {\n        const m = e.data;\n\n        if (m.type === \"cacheRequirements\") {\n          cacheCallback(m.requirements);\n        }\n      }\n    });\n  }\n} //#Source https://bit.ly/2neWfJ2\n\nfunction urlJoin(...args) {\n  return args.join(\"/\").replace(/[\\/]+/g, \"/\").replace(/^(.+):\\//, \"$1://\").replace(/^file:/, \"file:/\").replace(/\\/(\\?|&|#[^!])/g, \"$1\").replace(/\\?/g, \"&\").replace(\"&\", \"?\");\n}\nclass MessageEmitter {\n  constructor(debug) {\n    this._event_handlers = {};\n    this._once_handlers = {};\n    this._debug = debug;\n  }\n\n  emit() {\n    throw new Error(\"emit is not implemented\");\n  }\n\n  on(event, handler) {\n    if (!this._event_handlers[event]) {\n      this._event_handlers[event] = [];\n    }\n\n    this._event_handlers[event].push(handler);\n  }\n\n  once(event, handler) {\n    handler.___event_run_once = true;\n    this.on(event, handler);\n  }\n\n  off(event, handler) {\n    if (!event && !handler) {\n      // remove all events handlers\n      this._event_handlers = {};\n    } else if (event && !handler) {\n      // remove all hanlders for the event\n      if (this._event_handlers[event]) this._event_handlers[event] = [];\n    } else {\n      // remove a specific handler\n      if (this._event_handlers[event]) {\n        const idx = this._event_handlers[event].indexOf(handler);\n\n        if (idx >= 0) {\n          this._event_handlers[event].splice(idx, 1);\n        }\n      }\n    }\n  }\n\n  _fire(event, data) {\n    if (this._event_handlers[event]) {\n      var i = this._event_handlers[event].length;\n\n      while (i--) {\n        const handler = this._event_handlers[event][i];\n\n        try {\n          handler(data);\n        } catch (e) {\n          console.error(e);\n        } finally {\n          if (handler.___event_run_once) {\n            this._event_handlers[event].splice(i, 1);\n          }\n        }\n      }\n    } else {\n      if (this._debug) {\n        console.warn(\"unhandled event\", event, data);\n      }\n    }\n  }\n\n}\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=imjoy-rpc.js.map","module.exports = require('./dist/imjoy-rpc.js');","/* global NodeList, Element, Event, define */\n\n(function(global) {\n  'use strict';\n\n  var FOCUSABLE_ELEMENTS = [\n    'a[href]:not([tabindex^=\"-\"]):not([inert])',\n    'area[href]:not([tabindex^=\"-\"]):not([inert])',\n    'input:not([disabled]):not([inert])',\n    'select:not([disabled]):not([inert])',\n    'textarea:not([disabled]):not([inert])',\n    'button:not([disabled]):not([inert])',\n    'iframe:not([tabindex^=\"-\"]):not([inert])',\n    'audio:not([tabindex^=\"-\"]):not([inert])',\n    'video:not([tabindex^=\"-\"]):not([inert])',\n    '[contenteditable]:not([tabindex^=\"-\"]):not([inert])',\n    '[tabindex]:not([tabindex^=\"-\"]):not([inert])'\n  ];\n  var TAB_KEY = 9;\n  var ESCAPE_KEY = 27;\n  var focusedBeforeDialog;\n\n  /**\n   * Define the constructor to instantiate a dialog\n   *\n   * @constructor\n   * @param {Element} node\n   * @param {(NodeList | Element | string)} targets\n   */\n  function A11yDialog(node, targets) {\n    // Prebind the functions that will be bound in addEventListener and\n    // removeEventListener to avoid losing references\n    this._show = this.show.bind(this);\n    this._hide = this.hide.bind(this);\n    this._maintainFocus = this._maintainFocus.bind(this);\n    this._bindKeypress = this._bindKeypress.bind(this);\n\n    // Keep a reference of the node and the actual dialog on the instance\n    this.container = node;\n    this.dialog = node.querySelector('dialog, [role=\"dialog\"], [role=\"alertdialog\"]');\n    this.role = this.dialog.getAttribute('role') || 'dialog';\n    this.useDialog = (\n      'show' in document.createElement('dialog') &&\n      this.dialog.nodeName === 'DIALOG'\n    );\n\n    // Keep an object of listener types mapped to callback functions\n    this._listeners = {};\n\n    // Initialise everything needed for the dialog to work properly\n    this.create(targets);\n  }\n\n  /**\n   * Set up everything necessary for the dialog to be functioning\n   *\n   * @param {(NodeList | Element | string)} targets\n   * @return {this}\n   */\n  A11yDialog.prototype.create = function(targets) {\n    // Keep a collection of nodes to disable/enable when toggling the dialog\n    this._targets =\n      this._targets || collect(targets) || getSiblings(this.container);\n\n    // Set the `shown` property to match the status from the DOM\n    this.shown = this.dialog.hasAttribute('open');\n\n    // Despite using a `<dialog>` element, `role=\"dialog\"` is not necessarily\n    // implied by all screen-readers (yet)\n    // See: https://github.com/edenspiekermann/a11y-dialog/commit/6ba711a777aed0dbda0719a18a02f742098c64d9#commitcomment-28694166\n    this.dialog.setAttribute('role', this.role);\n\n    if (!this.useDialog) {\n      if (this.shown) {\n        this.container.removeAttribute('aria-hidden');\n      } else {\n        this.container.setAttribute('aria-hidden', true);\n      }\n    } else {\n      this.container.setAttribute('data-a11y-dialog-native', '');\n    }\n\n    // Keep a collection of dialog openers, each of which will be bound a click\n    // event listener to open the dialog\n    this._openers = $$('[data-a11y-dialog-show=\"' + this.container.id + '\"]');\n    this._openers.forEach(\n      function(opener) {\n        opener.addEventListener('click', this._show);\n      }.bind(this)\n    );\n\n    // Keep a collection of dialog closers, each of which will be bound a click\n    // event listener to close the dialog\n    this._closers = $$('[data-a11y-dialog-hide]', this.container).concat(\n      $$('[data-a11y-dialog-hide=\"' + this.container.id + '\"]')\n    );\n    this._closers.forEach(\n      function(closer) {\n        closer.addEventListener('click', this._hide);\n      }.bind(this)\n    );\n\n    // Execute all callbacks registered for the `create` event\n    this._fire('create');\n\n    return this;\n  };\n\n  /**\n   * Show the dialog element, disable all the targets (siblings), trap the\n   * current focus within it, listen for some specific key presses and fire all\n   * registered callbacks for `show` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\n  A11yDialog.prototype.show = function(event) {\n    // If the dialog is already open, abort\n    if (this.shown) {\n      return this;\n    }\n\n    this.shown = true;\n\n    // Keep a reference to the currently focused element to be able to restore\n    // it later\n    focusedBeforeDialog = document.activeElement;\n\n    if (this.useDialog) {\n      this.dialog.showModal(event instanceof Event ? void 0 : event);\n    } else {\n      this.dialog.setAttribute('open', '');\n      this.container.removeAttribute('aria-hidden');\n\n      // Iterate over the targets to disable them by setting their `aria-hidden`\n      // attribute to `true`\n      this._targets.forEach(function(target) {\n        target.setAttribute('aria-hidden', 'true');\n      });\n    }\n\n    // Set the focus to the first focusable child of the dialog element\n    setFocusToFirstItem(this.dialog);\n\n    // Bind a focus event listener to the body element to make sure the focus\n    // stays trapped inside the dialog while open, and start listening for some\n    // specific key presses (TAB and ESC)\n    document.body.addEventListener('focus', this._maintainFocus, true);\n    document.addEventListener('keydown', this._bindKeypress);\n\n    // Execute all callbacks registered for the `show` event\n    this._fire('show', event);\n\n    return this;\n  };\n\n  /**\n   * Hide the dialog element, enable all the targets (siblings), restore the\n   * focus to the previously active element, stop listening for some specific\n   * key presses and fire all registered callbacks for `hide` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\n  A11yDialog.prototype.hide = function(event) {\n    // If the dialog is already closed, abort\n    if (!this.shown) {\n      return this;\n    }\n\n    this.shown = false;\n\n    if (this.useDialog) {\n      this.dialog.close(event instanceof Event ? void 0 : event);\n    } else {\n      this.dialog.removeAttribute('open');\n      this.container.setAttribute('aria-hidden', 'true');\n\n      // Iterate over the targets to enable them by removing their `aria-hidden`\n      // attribute\n      this._targets.forEach(function(target) {\n        target.removeAttribute('aria-hidden');\n      });\n    }\n\n    // If there was a focused element before the dialog was opened (and it has a\n    // `focus` method), restore the focus back to it\n    // See: https://github.com/edenspiekermann/a11y-dialog/issues/108\n    if (focusedBeforeDialog && focusedBeforeDialog.focus) {\n      focusedBeforeDialog.focus();\n    }\n\n    // Remove the focus event listener to the body element and stop listening\n    // for specific key presses\n    document.body.removeEventListener('focus', this._maintainFocus, true);\n    document.removeEventListener('keydown', this._bindKeypress);\n\n    // Execute all callbacks registered for the `hide` event\n    this._fire('hide', event);\n\n    return this;\n  };\n\n  /**\n   * Destroy the current instance (after making sure the dialog has been hidden)\n   * and remove all associated listeners from dialog openers and closers\n   *\n   * @return {this}\n   */\n  A11yDialog.prototype.destroy = function() {\n    // Hide the dialog to avoid destroying an open instance\n    this.hide();\n\n    // Remove the click event listener from all dialog openers\n    this._openers.forEach(\n      function(opener) {\n        opener.removeEventListener('click', this._show);\n      }.bind(this)\n    );\n\n    // Remove the click event listener from all dialog closers\n    this._closers.forEach(\n      function(closer) {\n        closer.removeEventListener('click', this._hide);\n      }.bind(this)\n    );\n\n    // Execute all callbacks registered for the `destroy` event\n    this._fire('destroy');\n\n    // Keep an object of listener types mapped to callback functions\n    this._listeners = {};\n\n    return this;\n  };\n\n  /**\n   * Register a new callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\n  A11yDialog.prototype.on = function(type, handler) {\n    if (typeof this._listeners[type] === 'undefined') {\n      this._listeners[type] = [];\n    }\n\n    this._listeners[type].push(handler);\n\n    return this;\n  };\n\n  /**\n   * Unregister an existing callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\n  A11yDialog.prototype.off = function(type, handler) {\n    var index = this._listeners[type].indexOf(handler);\n\n    if (index > -1) {\n      this._listeners[type].splice(index, 1);\n    }\n\n    return this;\n  };\n\n  /**\n   * Iterate over all registered handlers for given type and call them all with\n   * the dialog element as first argument, event as second argument (if any).\n   *\n   * @access private\n   * @param {string} type\n   * @param {Event} event\n   */\n  A11yDialog.prototype._fire = function(type, event) {\n    var listeners = this._listeners[type] || [];\n\n    listeners.forEach(\n      function(listener) {\n        listener(this.container, event);\n      }.bind(this)\n    );\n  };\n\n  /**\n   * Private event handler used when listening to some specific key presses\n   * (namely ESCAPE and TAB)\n   *\n   * @access private\n   * @param {Event} event\n   */\n  A11yDialog.prototype._bindKeypress = function(event) {\n    // If the dialog is shown and the ESCAPE key is being pressed, prevent any\n    // further effects from the ESCAPE key and hide the dialog, unless its role\n    // is 'alertdialog', which should be modal\n    if (this.shown && event.which === ESCAPE_KEY && this.role !== 'alertdialog') {\n      event.preventDefault();\n      this.hide(event);\n    }\n\n    // If the dialog is shown and the TAB key is being pressed, make sure the\n    // focus stays trapped within the dialog element\n    if (this.shown && event.which === TAB_KEY) {\n      trapTabKey(this.dialog, event);\n    }\n  };\n\n  /**\n   * Private event handler used when making sure the focus stays within the\n   * currently open dialog\n   *\n   * @access private\n   * @param {Event} event\n   */\n  A11yDialog.prototype._maintainFocus = function(event) {\n    // If the dialog is shown and the focus is not within the dialog element,\n    // move it back to its first focusable child\n    if (this.shown && !this.container.contains(event.target)) {\n      setFocusToFirstItem(this.dialog);\n    }\n  };\n\n  /**\n   * Convert a NodeList into an array\n   *\n   * @param {NodeList} collection\n   * @return {Array<Element>}\n   */\n  function toArray(collection) {\n    return Array.prototype.slice.call(collection);\n  }\n\n  /**\n   * Query the DOM for nodes matching the given selector, scoped to context (or\n   * the whole document)\n   *\n   * @param {String} selector\n   * @param {Element} [context = document]\n   * @return {Array<Element>}\n   */\n  function $$(selector, context) {\n    return toArray((context || document).querySelectorAll(selector));\n  }\n\n  /**\n   * Return an array of Element based on given argument (NodeList, Element or\n   * string representing a selector)\n   *\n   * @param {(NodeList | Element | string)} target\n   * @return {Array<Element>}\n   */\n  function collect(target) {\n    if (NodeList.prototype.isPrototypeOf(target)) {\n      return toArray(target);\n    }\n\n    if (Element.prototype.isPrototypeOf(target)) {\n      return [target];\n    }\n\n    if (typeof target === 'string') {\n      return $$(target);\n    }\n  }\n\n  /**\n   * Set the focus to the first element with `autofocus` or the first focusable\n   * child of the given element\n   *\n   * @param {Element} node\n   */\n  function setFocusToFirstItem(node) {\n    var focusableChildren = getFocusableChildren(node);\n    var focused = node.querySelector('[autofocus]') || focusableChildren[0];\n\n    if (focused) {\n      focused.focus();\n    }\n  }\n\n  /**\n   * Get the focusable children of the given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\n  function getFocusableChildren(node) {\n    return $$(FOCUSABLE_ELEMENTS.join(','), node).filter(function(child) {\n      return !!(\n        child.offsetWidth ||\n        child.offsetHeight ||\n        child.getClientRects().length\n      );\n    });\n  }\n\n  /**\n   * Trap the focus inside the given element\n   *\n   * @param {Element} node\n   * @param {Event} event\n   */\n  function trapTabKey(node, event) {\n    var focusableChildren = getFocusableChildren(node);\n    var focusedItemIndex = focusableChildren.indexOf(document.activeElement);\n\n    // If the SHIFT key is being pressed while tabbing (moving backwards) and\n    // the currently focused item is the first one, move the focus to the last\n    // focusable item from the dialog element\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableChildren[focusableChildren.length - 1].focus();\n      event.preventDefault();\n      // If the SHIFT key is not being pressed (moving forwards) and the currently\n      // focused item is the last one, move the focus to the first focusable item\n      // from the dialog element\n    } else if (\n      !event.shiftKey &&\n      focusedItemIndex === focusableChildren.length - 1\n    ) {\n      focusableChildren[0].focus();\n      event.preventDefault();\n    }\n  }\n\n  /**\n   * Retrieve siblings from given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\n  function getSiblings(node) {\n    var nodes = toArray(node.parentNode.childNodes);\n    var siblings = nodes.filter(function(node) {\n      return node.nodeType === 1;\n    });\n\n    siblings.splice(siblings.indexOf(node), 1);\n\n    return siblings;\n  }\n\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = A11yDialog;\n  } else if (typeof define === 'function' && define.amd) {\n    define('A11yDialog', [], function() {\n      return A11yDialog;\n    });\n  } else if (typeof global === 'object') {\n    global.A11yDialog = A11yDialog;\n  }\n})(typeof global !== 'undefined' ? global : window);\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../css-loader/index.js!./snackbar.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../css-loader/index.js!./snackbar.css\", function() {\n\t\t\tvar newContent = require(\"!!../../css-loader/index.js!./snackbar.css\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".snackbar-container {\\n  transition: all 500ms ease;\\n  transition-property: top, right, bottom, left, opacity;\\n  font-family: Roboto, sans-serif;\\n  font-size: 14px;\\n  min-height: 14px;\\n  background-color: #070b0e;\\n  position: fixed;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  color: white;\\n  line-height: 22px;\\n  padding: 18px 24px;\\n  bottom: -100px;\\n  top: -100px;\\n  opacity: 0;\\n  z-index: 9999; }\\n  .snackbar-container .action {\\n    background: inherit;\\n    display: inline-block;\\n    border: none;\\n    font-size: inherit;\\n    text-transform: uppercase;\\n    color: #4caf50;\\n    margin: 0 0 0 24px;\\n    padding: 0;\\n    min-width: min-content;\\n    cursor: pointer; }\\n\\n@media (min-width: 640px) {\\n  .snackbar-container {\\n    min-width: 288px;\\n    max-width: 568px;\\n    display: inline-flex;\\n    border-radius: 2px;\\n    margin: 24px; } }\\n\\n@media (max-width: 640px) {\\n  .snackbar-container {\\n    left: 0;\\n    right: 0;\\n    width: 100%; } }\\n\\n.snackbar-pos.bottom-center {\\n  top: auto !important;\\n  bottom: 0;\\n  left: 50%;\\n  transform: translate(-50%, 0); }\\n\\n.snackbar-pos.bottom-left {\\n  top: auto !important;\\n  bottom: 0;\\n  left: 0; }\\n\\n.snackbar-pos.bottom-right {\\n  top: auto !important;\\n  bottom: 0;\\n  right: 0; }\\n\\n.snackbar-pos.top-left {\\n  bottom: auto !important;\\n  top: 0;\\n  left: 0; }\\n\\n.snackbar-pos.top-center {\\n  bottom: auto !important;\\n  top: 0;\\n  left: 50%;\\n  transform: translate(-50%, 0); }\\n\\n.snackbar-pos.top-right {\\n  bottom: auto !important;\\n  top: 0;\\n  right: 0; }\\n\\n@media (max-width: 640px) {\\n  .snackbar-pos.bottom-center, .snackbar-pos.top-center {\\n    left: 0;\\n    transform: none; } }\\n\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(selector) {\n\t\tif (typeof memo[selector] === \"undefined\") {\n\t\t\tmemo[selector] = fn.call(this, selector);\n\t\t}\n\n\t\treturn memo[selector]\n\t};\n})(function (target) {\n\treturn document.querySelector(target)\n});\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton) options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n\tif (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else {\n\t\tthrow new Error(\"Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\toptions.attrs.type = \"text/css\";\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\toptions.attrs.type = \"text/css\";\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = options.transform(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","import {\n  setupImJoyAPI\n} from \"./imjoyAPI.js\";\nimport Snackbar from \"node-snackbar/dist/snackbar\";\nimport \"node-snackbar/dist/snackbar.css\";\nimport A11yDialog from \"a11y-dialog\";\n\n// setup a hook for fixing mobile touch event\nconst _createElement = document.createElement;\n\nfunction touchClick(ev) {\n  ev.target.click();\n  ev.preventDefault();\n  if ([\"UL\", 'LI', \"BUTTON\", \"INPUT\", \"A\"].includes(ev.target.tagName))\n    ev.stopPropagation();\n}\ndocument.createElement = function (type) {\n  const elm = _createElement.call(document, type);\n  elm.addEventListener(\"touchstart\", touchClick, false);\n  return elm\n}\n\nwindow.debug = async (message) => {\n  console.log(message);\n  debugger;\n}\n\n\n// Get the dialog element (with the accessor method you want)\nconst el = document.getElementById('open-file-dialog');\n\n// Instantiate a new A11yDialog module\nconst fileDialog = new A11yDialog(el);\n\nwindow.openFileDialogJS = async (title, initPath, selectionMode, promise) => {\n  document.getElementById(\"dialogTitle\").innerHTML = title || \"Open File\";\n  fileDialog.show();\n  let closed = false;\n  fileDialog.on('hide', function (dialogEl, event) {\n    if (!closed) {\n      closed = true;\n      cjCall(promise, \"reject\", \"cancelled\");\n    }\n  });\n  document.getElementById(\"open-file-modal-select\").onclick = () => {\n    if (!closed) {\n      closed = true;\n      const fileInput = document.getElementById(\"open-file\");\n      fileInput.onchange = () => {\n        const files = fileInput.files;\n        mountFile(files[0]).then(filepath => {\n          cjCall(promise, \"resolve\", filepath);\n        }).catch((e) => {\n          cjCall(promise, \"reject\", String(e));\n        })\n        fileInput.value = \"\";\n      };\n      fileInput.click();\n    }\n    fileDialog.hide();\n  }\n  document.getElementById(\"open-file-modal-internal\").onclick = () => {\n    if (!closed) {\n      closed = true;\n      cjCall(promise, \"resolve\", \"\");\n    }\n    fileDialog.hide();\n  }\n}\n\nwindow.saveFileDialogJS = async (title, initPath, selectionMode, promise) => {\n  // by pass the selection\n  const savePath = prompt(\n    title || \"Saving file as \",\n    initPath\n  )\n  downloadQueue[savePath] = 1;\n  await cjCall(promise, \"resolve\", \"/files/\" + savePath);\n}\n\nwindow.openURL = async (url) => {\n  window.open(url);\n}\n\nwindow.getBytesFromUrl = async (originalUrl, promise)=>{\n  try{\n    const url = \"https://cors-anywhere.herokuapp.com/\" + originalUrl.replace(\"http://\", \"https://\");\n    Snackbar.show({text:\"Fetching data from: \" + originalUrl, pos: 'bottom-left'}); \n    const blob = await fetch(url).then(r => r.blob());\n    const buffer = await blob.arrayBuffer();\n    await cjCall(promise, \"resolve\", cjTypedArrayToJava(new Uint8Array(buffer)));\n  }\n  catch(e){\n    console.error(\"Failed to get data from \" + originalUrl, e);\n    Snackbar.show({text:\"Failed to fetch data from: \" + originalUrl, pos: 'bottom-left'}); \n    await cjCall(promise, \"reject\", e.toString());\n  }\n}\n\nconst downloadQueue = {};\n\nasync function startImageJ() {\n  cheerpjInit({\n    enableInputMethods: true,\n    clipboardMode: \"system\"\n  });\n\n  const appContainer = document.getElementById(\"imagej-container\");\n  cheerpjCreateDisplay(-1, -1, appContainer);\n  cheerpjRunStaticMethod(\n    threads[0],\n    \"java/lang/System\",\n    cjSystemSetProperty,\n    \"user.dir\",\n    \"/files\"\n  );\n  cheerpjRunStaticMethod(\n    threads[0],\n    \"java/lang/System\",\n    cjSystemSetProperty,\n    \"plugins.dir\",\n    \"/app/ij153/plugins\"\n  );\n  cheerpjRunMain(\n    \"ij.ImageJ\",\n    \"/app/ij153/ij.jar:/app/ij153/plugins/Thunder_STORM.jar\",\n  );\n\n  const ij = await getImageJInstance();\n  // turn on debug mode\n  // cjCall(\"ij.IJ\", \"setDebugMode\", true)\n  // setup file saving hook\n  // Snackbar.show({text:\"ImageJS is ready.\", pos: 'bottom-left'}); \n  // const _cheerpjWriteAsync = window.cheerpjWriteAsync\n  // window.cheerpjWriteAsync = function (fds, fd, buf, off, len, p){\n  //     downloadQueue[fd] = 1;\n  //     return _cheerpjWriteAsync.apply(null, arguments);\n  // }\n  const _cheerpjCloseAsync = window.cheerpjCloseAsync;\n  window.cheerpjCloseAsync = function (fds, fd, p) {\n    const fdObj = fds[fd];\n    const fileData = fdObj.fileData;\n    const tmp = fileData.path.split('/');\n    const filename = tmp[tmp.length - 1];\n    if (downloadQueue[filename]) {\n      delete downloadQueue[fileData.path];\n\n      downloadBytesFile(fileData.chunks, filename)\n      _cheerpjCloseAsync.apply(null, arguments);\n      // remove the file after downloading\n      window.ij.removeFile(\"/files/\" + filename);\n    } else {\n      _cheerpjCloseAsync.apply(null, arguments);\n    }\n  }\n  const imagej_api = {\n    run: await cjResolveCall(\"ij.IJ\", \"run\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    showStatus: await cjResolveCall(\"ij.IJ\", \"showStatus\", [\n      \"java.lang.String\"\n    ]),\n    showMessage: await cjResolveCall(\"ij.IJ\", \"showMessage\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    runPlugIn: await cjResolveCall(\"ij.IJ\", \"runPlugIn\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    runMacro: await cjResolveCall(\"ij.IJ\", \"runMacro\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    open: await cjResolveCall(\"ij.IJ\", \"open\", [\"java.lang.String\"]),\n    installPlugin: await cjResolveCall(\"ij.Menus\", \"installPlugin\", null),\n    getPlugins: await cjResolveCall(\"ij.Menus\", \"getPlugins\", []),\n    getPlugInsPath: await cjResolveCall(\"ij.Menus\", \"getPlugInsPath\", []),\n    getImage: await cjResolveCall(\"ij.IJ\", \"getImage\", []),\n    save: await cjResolveCall(\"ij.IJ\", \"save\", [\n      \"ij.ImagePlus\",\n      \"java.lang.String\"\n    ]),\n    saveAsBytes: await cjResolveCall(\"ij.IJ\", \"saveAsBytes\", [\n      \"ij.ImagePlus\",\n      \"java.lang.String\"\n    ]),\n    getString: await cjResolveCall(\"ij.IJ\", \"getString\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    listDir: await cjResolveCall(\"ij.IJ\", \"listDir\", [\n      \"java.lang.String\"\n    ]),\n    removeFile: await cjResolveCall(\"ij.IJ\", \"removeFile\", [\n      \"java.lang.String\"\n    ]),\n    openAsBytes: await cjResolveCall(\"ij.IJ\", \"openAsBytes\", [\n      \"java.lang.String\"\n    ]),\n    saveBytes: await cjResolveCall(\"ij.IJ\", \"saveBytes\", null),\n    // updateImageJMenus: await cjResolveCall(\"ij.Menus\", \"updateImageJMenus\", null),\n    // getPrefsDir: await cjResolveCall(\"ij.Prefs\", \"getPrefsDir\", null),\n  };\n  window.ij = imagej_api;\n  return imagej_api;\n}\n\n\nasync function listFiles(imagej, path) {\n  const files = await imagej.listDir(path)\n  return files.map(cjStringJavaToJs);\n}\n\nasync function mountFile(file) {\n  const filepath = \"/str/\" + file.name;\n  const bytes = await readFile(file);\n  cheerpjAddStringFile(filepath, bytes);\n  return filepath;\n}\n\nasync function getImageData(imagej) {\n  const imp = await imagej.getImage();\n  const name = cjStringJavaToJs(await cjCall(imp, \"getTitle\"));\n  const width = await cjCall(imp, \"getWidth\");\n  const height = await cjCall(imp, \"getHeight\");\n  const slices = await cjCall(imp, \"getNSlices\");\n  const channels = await cjCall(imp, \"getNChannels\");\n  const frames = await cjCall(imp, \"getNFrames\");\n  const type = await cjCall(imp, \"getType\");\n  const bytes = javaBytesToArrayBuffer(await imagej.saveAsBytes(imp, \"raw\"));\n  const shape = [height.value0, width.value0, channels.value0];\n  if (slices.value0 && slices.value0 !== 1) {\n    shape.push(slices.value0);\n  }\n  if (frames.value0 && frames.value0 !== 1) {\n    shape.push(frames.value0);\n  }\n  const typeMapping = {\n    0: \"uint8\", //GRAY8 8-bit grayscale (unsigned)\n    1: \"uint16\", //GRAY16 16-bit grayscale (unsigned)\n    2: \"float32\", //\tGRAY32 32-bit floating-point grayscale\n    3: \"uint8\", // COLOR_256 8-bit indexed color\n    4: \"uint8\" // COLOR_RGB 32-bit RGB color\n  };\n\n  // calculate the actual channel number, e.g. for RGB image\n  shape[2] = bytes.byteLength / (shape[0] * shape[1] * (shape[3] || 1) * (shape[4] || 1));\n\n  return {\n    type: typeMapping[type.value0],\n    shape: shape,\n    bytes\n  };\n}\n\n\nasync function saveImage(imagej, filename, format, ext) {\n  format = format || \"tiff\";\n\n  const imp = await imagej.getImage();\n  const original_name = cjStringJavaToJs(await cjCall(imp, \"getTitle\"));\n  filename =\n    filename ||\n    cjStringJavaToJs(\n      await imagej.getString(\n        \"Saving file as \",\n        original_name.split(\".\")[0] + (ext || \".\" + format)\n      )\n    );\n  if (filename) {\n    const fileBytes = javaBytesToArrayBuffer(await imagej.saveAsBytes(imp, format));\n    downloadBytesFile([fileBytes.buffer], filename)\n  }\n}\n\nfunction downloadBytesFile(fileByteArray, filename) {\n  const blob = new Blob(fileByteArray, {\n    type: \"application/octet-stream\"\n  });\n\n  if (window.navigator.msSaveOrOpenBlob) {\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    const elem = window.document.createElement(\"a\");\n    elem.href = window.URL.createObjectURL(blob);\n    elem.download = filename;\n    document.body.appendChild(elem);\n    elem.click();\n    document.body.removeChild(elem);\n  }\n}\n\nfunction openImage(imagej, path) {\n  if (path) {\n    return imagej.open(filepath);\n  }\n  const fileInput = document.getElementById(\"open-file\");\n  fileInput.onchange = () => {\n    const files = fileInput.files;\n    for (let i = 0, len = files.length; i < len; i++) {\n      if (files[i].name.endsWith('.jar') || files[i].name.endsWith('.jar.js')) {\n        saveFileToFS(imagej, files[i]);\n      } else {\n        mountFile(files[i]).then(filepath => {\n          imagej.open(filepath);\n        });\n      }\n\n    }\n    fileInput.value = \"\";\n  };\n  fileInput.click();\n}\n\nfunction javaBytesToArrayBuffer(bytes) {\n  return bytes.slice(1).buffer;\n}\n\nasync function saveFileToFS(imagej, file) {\n  const bytes = await readFile(file);\n  await imagej.saveBytes(cjTypedArrayToJava(bytes), '/files/' + file.name);\n  console.log(await listFiles(imagej, '/files/'));\n}\n\nasync function fixMenu(imagej) {\n  const removes = [\n    \"Show Folder\",\n    \"Update ImageJ...\",\n    \"Compile and Run...\",\n    \"Capture Screen\",\n    \"Capture Delayed...\",\n    \"Capture Image\"\n  ];\n  const items = document.querySelectorAll(\n    \"#cheerpjDisplay>.window:nth-child(2) li > a\"\n  );\n  for (let it of items) {\n    it.text = it.text.trim();\n    if (removes.includes(it.text)) {\n      // remove li\n      const el = it.parentNode;\n      el.parentNode.removeChild(el);\n    }\n    // else if (it.text === \"Open...\") {\n    //   const openNode = it.parentNode;\n    //   const openMenu = openNode.cloneNode(true);\n    //   it.text = \"Open Internal\"\n    //   openMenu.onclick = e => {\n    //     e.stopPropagation();\n    //     openImage(imagej);\n    //   };\n    //   openNode.parentNode.insertBefore(openMenu, openNode)\n    // }\n  }\n\n  // addMenuItem({label: \"Debug\", async callback(){\n  // const bytesIn = new Int8Array(new ArrayBuffer(30));\n  // bytesIn[0] = 33;\n  // bytesIn[2] = 99;\n  // await imagej.saveBytes(cjTypedArrayToJava(bytesIn), \"/files/test.bin\");\n  // const bytesOut = await imagej.openAsBytes('/files/test.bin')\n\n  // }})\n}\n\nfunction setupDragAndDrop(imagej) {\n  const appContainer = document.getElementById(\"imagej-container\");\n  const dragOverlay = document.getElementById(\"drag-overlay\");\n\n  appContainer.addEventListener(\n    \"dragenter\",\n    e => {\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        e.preventDefault();\n        e.stopPropagation();\n        dragOverlay.style.display = \"block\";\n      }\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"dragover\",\n    e => {\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        e.preventDefault();\n        e.stopPropagation();\n        dragOverlay.style.display = \"block\";\n      }\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"dragleave\",\n    e => {\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        e.preventDefault();\n        e.stopPropagation();\n        dragOverlay.style.display = \"none\";\n      }\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"drop\",\n    e => {\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        e.preventDefault();\n        e.stopPropagation();\n        const data = e.dataTransfer,\n          files = data.files;\n        for (let i = 0, len = files.length; i < len; i++) {\n          if (files[i].name.endsWith('.jar') || files[i].name.endsWith('.jar.js')) {\n            saveFileToFS(imagej, files[i]);\n          } else {\n            mountFile(files[i]).then(filepath => {\n              imagej.open(filepath);\n            });\n          }\n\n        }\n        dragOverlay.style.display = \"none\";\n      }\n    },\n    false\n  );\n}\n\nfunction getImageJInstance() {\n  return new Promise(resolve => {\n    async function tryIJ() {\n      const ij = await cjCall(\"ij.IJ\", \"getInstance\");\n      if (!ij) {\n        setTimeout(tryIJ, 500);\n      } else {\n        resolve(ij);\n      }\n    }\n    tryIJ();\n  });\n}\n\nfunction readFile(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onload = function () {\n      const arrayBuffer = reader.result;\n      const bytes = new Uint8Array(arrayBuffer);\n      resolve(bytes);\n    };\n    reader.onerror = function (e) {\n      reject(e);\n    };\n  });\n}\n\nfunction fixHeight() {\n  // fix ios height issue\n  function resetHeight() {\n    // reset the body height to that of the inner browser\n    document.body.style.height = window.innerHeight + \"px\";\n  }\n  // reset the height whenever the window's resized\n  window.addEventListener(\"resize\", resetHeight);\n  // called to initially set the height.\n  resetHeight();\n}\n\nfunction addMenuItem(config) {\n  // find the plugin menu\n  const pluginMenu = document.querySelector(\n    \"#cheerpjDisplay>.window>div.menuBar>.menu>.menuItem:nth-child(6)>ul\"\n  );\n  const newMenu = document.createElement(\"li\");\n  newMenu.classList.add(\"menuItem\");\n  newMenu.classList.add(\"subMenuItem\");\n  const button = document.createElement(\"a\");\n  button.innerHTML = config.label;\n  newMenu.appendChild(button);\n  newMenu.onclick = () => {\n    config.callback();\n  };\n  pluginMenu.appendChild(newMenu);\n}\n\nfunction registerServiceWorker() {\n  if (\"serviceWorker\" in navigator) {\n    window.addEventListener(\"load\", function () {\n      navigator.serviceWorker.register(\"/service-worker.js\").then(\n        function (registration) {\n          // Registration was successful\n          console.log(\n            \"ServiceWorker registration successful with scope: \",\n            registration.scope\n          );\n        },\n        function (err) {\n          // registration failed :(\n          console.log(\"ServiceWorker registration failed: \", err);\n        }\n      );\n    });\n  }\n}\n\nregisterServiceWorker();\nfixHeight();\nstartImageJ().then(imagej => {\n  setupDragAndDrop(imagej);\n  setTimeout(() => {\n    fixMenu(imagej);\n  }, 2000);\n\n  // if inside an iframe, setup ImJoy\n  if (window.self !== window.top) {\n    setupImJoyAPI(imagej, getImageData, javaBytesToArrayBuffer, saveImage, openImage, addMenuItem);\n  }\n});","import { setupRPC } from \"imjoy-rpc\";\n\nimport { version, description } from \"../package.json\";\nimport { imjoyRPC } from \"imjoy-rpc/dist/imjoy-rpc\";\n\nexport async function setupImJoyAPI(\n  imagej,\n  getImageData,\n  javaBytesToArrayBuffer,\n  saveImage,\n  openImage,\n  addMenuItem\n) {\n  const api = await setupRPC({\n    name: \"ImageJS\",\n    version: version,\n    description: description,\n    type: \"rpc-window\"\n  });\n  const service_api = {\n    setup() {\n      api.log(\"ImageJS loaded successfully.\");\n    },\n    async run(ctx) {\n      if (ctx.data && ctx.data.images) {\n        //TODO: load images\n        for (let img of ctx.data.images) {\n          this.viewImage(img);\n        }\n      }\n    },\n    addMenuItem,\n    open(path) {\n      openImage(imagej, path);\n    },\n    save(filename, format, ext) {\n      saveImage(imagej, filename, format, ext);\n    },\n    runMacro(macro, args) {\n      imagej.runMacro(macro, args || \"\");\n    },\n    runPlugIn(className, args) {\n      imagej.runPlugIn(className, args || \"\");\n    },\n    async viewImage(img, options) {\n      options = options || {};\n      options.name = options.name || \"tmp\";\n      const filepath = \"/str/\" + options.name;\n      const formats = {\n        uint8: \"8-bit\",\n        uint16: \"16-bit Unsigned\",\n        int16: \"16-bit Signed\",\n        uint32: \"32-bit Unsigned\",\n        int32: \"32-bit Signed\"\n      };\n      cheerpjAddStringFile(filepath, new Uint8Array(img._rvalue));\n      let format = formats[img._rdtype];\n\n      if (img._rshape.length === 3) {\n        let number = img._rshape[2];\n        if (img._rshape[2] === 3) {\n          format = \"[24-bit RGB]\";\n          number = 1;\n        }\n        return await imagej.run(\n          \"Raw...\",\n          `open=${filepath} image=${format} width=${img._rshape[1]} height=${img._rshape[0]} number=${number}`\n        );\n      } else if (img._rshape.length === 4) {\n        if (img._rshape[3] === 3) {\n          format = \"[24-bit RGB]\";\n        } else {\n          if (img._rshape[3] !== 1) {\n            throw \"channel dimension (last) can only be 1 or 3\";\n          }\n        }\n        return await imagej.run(\n          \"Raw...\",\n          `open=${filepath} image=${format} width=${img._rshape[2]} height=${img._rshape[1]} number=${img._rshape[0]}`\n        );\n      } else if (img._rshape.length === 2) {\n        return await imagej.run(\n          \"Raw...\",\n          `open=${filepath} image=${format} width=${img._rshape[1]} height=${img._rshape[0]}`\n        );\n      }\n    },\n    async getSelection() {\n      const imp = await imagej.getImage();\n      const bytes = javaBytesToArrayBuffer(await imagej.saveAsBytes(imp, \"selection\"));\n      return bytes;\n    },\n    async getImage() {\n      const data = await getImageData(imagej);\n      return {\n        _rtype: \"ndarray\",\n        _rvalue: data.bytes,\n        _rshape: data.shape,\n        _rdtype: data.type\n      };\n    }\n  };\n\n  api.export(service_api);\n}\n"],"sourceRoot":""}