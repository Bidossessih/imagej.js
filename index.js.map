{"version":3,"sources":["webpack://imagej/webpack/universalModuleDefinition","webpack://imagej/webpack/bootstrap","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.js","webpack://imagej/./node_modules/lz-string/libs/lz-string.js","webpack://imagej/./node_modules/imjoy-rpc/index.js","webpack://imagej/./node_modules/a11y-dialog/a11y-dialog.js","webpack://imagej/./node_modules/mobile-drag-drop/index.min.js","webpack://imagej/./node_modules/mobile-drag-drop/scroll-behaviour.js","webpack://imagej/(webpack)/buildin/global.js","webpack://imagej/./node_modules/imjoy-rpc/dist/imjoy-rpc.js","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.css?8f64","webpack://imagej/./node_modules/node-snackbar/dist/snackbar.css","webpack://imagej/./node_modules/css-loader/lib/css-base.js","webpack://imagej/./node_modules/style-loader/lib/addStyles.js","webpack://imagej/./node_modules/style-loader/lib/urls.js","webpack://imagej/./src/imjoyApp.js","webpack://imagej/./src/utils.js","webpack://imagej/./src/index.js","webpack://imagej/./src/imjoyAPI.js"],"names":["root","factory","exports","module","define","amd","window","webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","installedModules","0","__webpack_require__","l","e","promises","installedChunkData","promise","Promise","resolve","reject","onScriptComplete","script","document","createElement","charset","timeout","nc","setAttribute","src","p","jsonpScriptSrc","error","Error","event","onerror","onload","clearTimeout","chunk","errorType","type","realSrc","target","message","name","request","undefined","setTimeout","head","appendChild","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","err","console","jsonpArray","oldJsonpFunction","slice","s","Snackbar","$defaults","text","textColor","width","showAction","actionText","actionTextAria","alertScreenReader","actionTextColor","showSecondButton","secondButtonText","secondButtonAria","secondButtonTextColor","backgroundColor","pos","duration","customClass","onActionClick","element","style","opacity","onSecondButtonClick","onClose","show","$options","options","Extend","current","$parent","this","parentElement","removeChild","snackbar","className","$p","margin","padding","color","fontSize","fontWeight","lineHeight","innerHTML","background","secondButton","addEventListener","actionButton","top","bottom","elapsed","propertyName","body","getComputedStyle","close","extended","deep","arguments","toString","merge","obj","prop","LZString","f","String","fromCharCode","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","charAt","compressToBase64","input","res","_compress","a","decompressFromBase64","_decompress","index","compressToUTF16","decompressFromUTF16","compressed","charCodeAt","compressToUint8Array","uncompressed","compress","buf","Uint8Array","TotalLen","current_value","decompressFromUint8Array","decompress","Array","result","forEach","join","compressToEncodedURIComponent","decompressFromEncodedURIComponent","replace","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","Math","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","val","position","global","focusedBeforeDialog","FOCUSABLE_ELEMENTS","A11yDialog","node","targets","_show","_hide","hide","_maintainFocus","_bindKeypress","container","dialog","querySelector","role","getAttribute","useDialog","nodeName","_listeners","toArray","collection","$$","selector","context","querySelectorAll","setFocusToFirstItem","focusableChildren","getFocusableChildren","focused","focus","filter","child","offsetWidth","offsetHeight","getClientRects","siblings","_targets","NodeList","isPrototypeOf","Element","collect","parentNode","childNodes","nodeType","splice","indexOf","shown","hasAttribute","removeAttribute","_openers","id","opener","_closers","concat","closer","_fire","activeElement","showModal","Event","removeEventListener","destroy","on","handler","off","listener","which","preventDefault","focusedItemIndex","shiftKey","trapTabKey","contains","u","tagName","passive","h","capture","reduce","v","changedTouches","identifier","touches","x","y","g","parseInt","b","set","configurable","freeze","types","effectAllowed","setData","getData","clearData","setDragImage","bubbles","cancelable","dataTransfer","relatedTarget","screenX","screenY","clientX","clientY","pageX","pageY","getBoundingClientRect","offsetX","left","offsetY","defaultView","dispatchEvent","I","j","C","S","k","A","O","D","M","F","N","P","dropEffect","T","dragImageSetup","L","map","zIndex","classList","add","_","dragImageOffset","dragImageCenterOnTouch","marginLeft","marginTop","height","V","setInterval","X","Y","iterationInterval","clearInterval","dragStartConditionOverride","dragImageTranslateOverride","q","visibility","display","parseFloat","transitionDuration","isNaN","scrollLeft","documentElement","scrollTop","transitionDelay","round","B","elementFromPoint","remove","tryFindDraggableTarget","draggable","cloneNode","setProperty","getPropertyValue","getPropertyPriority","pointerEvents","getContext","getImageData","putImageData","hasChildNodes","CustomEvent","holdToDrag","defaultActionOverride","defaultPrevented","polyfill","keys","forceApply","dragEvents","userAgentSupportingNativeDnD","chrome","test","navigator","userAgent","isTopLevelEl","el","getElementViewportOffset","axis","offset","clientLeft","clientTop","bounds","getElementViewportSize","innerWidth","innerHeight","clientWidth","clientHeight","getSetElementScroll","scroll","isTopLevel","isScrollable","cs","scrollHeight","overflowY","scrollWidth","overflowX","determineScrollIntention","currentCoordinate","size","threshold","determineDynamicVelocity","scrollIntention","abs","isScrollEndReached","scrollBounds","currentScrollOffset","_scrollAnimationFrameId","_currentCoordinates","_hoveredElement","_scrollableParent","_translateDragImageFn","_options","velocity","multiplier","_scrollIntentions","horizontal","vertical","_dynamicVelocity","scheduleScrollAnimation","requestAnimationFrame","scrollAnimation","scrollDiffX","scrollDiffY","updateScrollIntentions","currentCoordinates","scrollableParent","scrollIntentions","dynamicVelocity","scrollableParentBounds","scrollX","scrollY","currentCoordinatesOffset","scrollBehaviourDragImageTranslateOverride","hoveredElement","translateDragImageFn","findScrollableParent","cancelAnimationFrame","Function","URL","webkitURL","content","url","blob","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","append","getBlob","Blob","Worker","createObjectURL","encodeURIComponent","JSON","parse","__webpack_exports__","waitForInitialization","setupRPC","_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__","_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default","_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__","_pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__","_utils_js__WEBPACK_IMPORTED_MODULE_3__","_rpc_js__WEBPACK_IMPORTED_MODULE_4__","_package_json__WEBPACK_IMPORTED_MODULE_5__","_inIframe","self","config","targetOrigin","target_origin","credential_required","verify_credential","peer_id","handleEvent","origin","warn","cfg","credential","then","auth","log","parent","postMessage","version","description","allow_execution","enable_service_worker","base_url","cache_requirements","worker","fallbackTimeout","terminate","transferables","assign","location","detail","requirements","__transferables__","debug","setupWebWorker","includes","api","expose_api_globally","connectRPC","_rpc_js__WEBPACK_IMPORTED_MODULE_0__","connection","codecs","rpc","launchConnected","getRemote","export","dispose","registerCodec","disposeObject","_interface","setInterface","onLoad","checkHandler","connected","connectedHandlers","disconnect","WorkerGlobalScope","pop","Connection","setupIframe","_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__","_rpc_js__WEBPACK_IMPORTED_MODULE_1__","_utils_js__WEBPACK_IMPORTED_MODULE_2__","_htmlToElement","html","template","trim","firstChild","_importScript","scriptTag","onreadystatechange","readyState","async","importScripts","args","len","super","emit","code","isArray","link_node","toLowerCase","endsWith","startsWith","rel","href","script_node","attrs","createTextNode","eval","style_node","link_node_","stack","dedicated_thread","lang","api_version","conn","connect","setupWebPython","_pluginIframe__WEBPACK_IMPORTED_MODULE_2__","startup_script","_export_plugin_api","execute_python_code","_api","getattr","pyodide","pyimport","hasattr","getOwnPropertyNames","func","runPython","setupPyodide","languagePluginUrl","iodide","output","div","getElementById","languagePluginLoader","catch","python_packages","loadPackage","API_VERSION","RPC","_utils_js__WEBPACK_IMPORTED_MODULE_0__","ArrayBufferView","getPrototypeOf","constructor","_appendBuffer","buffer1","buffer2","tmp","byteLength","buffer","indexObject","is","split","_connection","_codecs","_object_store","_method_weakmap","WeakMap","_object_weakmap","_local_api","execute","_store","ReferenceStore","_method_refs","onReady","onBusy","_setupMessageHanlders","getStack","_remote_interface","forwarding_functions","func_name","_remote","_encode","objectId","has","once","object_id","init","method","method_this","_unwrap","apply","fetch","_disposeObject","_setRemoteInterface","sendInterface","typedArray","shape","dtype","_dtype","_rtype","_rvalue","_rshape","_rdtype","_decode","intf","_reportRemoteSet","targetId","me","remoteMethod","put","wrapped_resolve","wrapped_reject","encodedPromise","_wrap","__promise_pair","target_id","__remote_method","aObject","asInterface","aType","ArrayBuffer","bObject","_rtarget_id","_rintf","cid","_rname","temp","_transfer","isarray","tp","codec","encoder","encodedObj","tf","Tensor","v_buffer","dataSync","nj","NdArray","selection","File","_rpath","_path","webkitRelativePath","Boolean","Date","RegExp","ImageData","FileList","_rmime","DataView","Set","from","Map","withPromise","decoder","_genRemoteCallback","_genRemoteMethod","array","Uint8","reshape","arraytype","tensor","remoteCallback","_indices","_readyHandler","_busyHandler","readyHandler","busyHandler","_genId","_releaseId","randId","random","substr","getTime","dtypeToTypedArray","typedArrayToDtype","cacheRequirements","setupServiceWorker","urlJoin","MessageEmitter","int8","int16","int32","uint8","uint16","uint32","float32","float64","Int8Array","Int16Array","Int32Array","Uint16Array","Uint32Array","Float32Array","Float64Array","cacheUrlInServiceWorker","command","serviceWorker","register","messageChannel","MessageChannel","port1","onmessage","controller","port2","requirementsm","req","baseUrl","cacheCallback","registration","scope","_event_handlers","_once_handlers","_debug","___event_run_once","idx","transform","locals","useSourceMap","list","item","cssMapping","btoa","sourceMapping","sourceMap","unescape","stringify","sourceURLs","sources","source","sourceRoot","cssWithMappingToString","mediaQuery","alreadyImportedModules","fn","memo","stylesInDom","isOldIE","atob","getElement","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","addStylesToDom","styles","domStyle","refs","parts","addStyle","listToStyles","newStyles","base","part","css","media","insertStyleElement","insertInto","lastStyleElementInsertedAtTop","insertAt","nextSibling","insertBefore","removeStyleElement","createStyleElement","addAttrs","update","styleIndex","applyToSingletonTag","revokeObjectURL","link","createLinkElement","updateLink","applyToTag","newObj","DEBUG","newList","mayRemove","textStore","replaceText","replacement","styleSheet","cssText","cssNode","autoFixUrls","convertToAbsoluteUrls","oldSrc","protocol","host","currentDir","pathname","fullMatch","origUrl","newUrl","unquotedOrigUrl","$1","builtinPlugins","promisify_functions","ret","setupImJoyApp","setAPI","vue","vuejsmodal","imjoyCore","Vue","default","use","elem","insertAdjacentHTML","app","dialogWindows","selected_dialog_window","plugins","fullscreen","imjoy","active_plugin","mounted","VERSION","ImJoy","imjoy_api","getWindow","_plugin","pm","service_api","msg","createWindow","start","event_bus","closeWindow","$forceUpdate","showMenu","windowCount","window_id","standalone","$modal","wm","selectWindow","title","min","screen","ij","createPlugInFrame","xpath","titleBar","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","previousSibling","observer","MutationObserver","mutationsList","mutation","addedNodes","removedNodes","observe","childList","loadPlugin","loadPluginByQuery","runImJoyPlugin","loader","reloadPlugin","load_dependencies","plugin","run","finally","reloadImJoyPlugin","callPlugin","pluginName","functionName","getPlugin","imgData","bytes","cjCall","ip","ndarrayToImagePlus","startImJoy","methods","dm","loadImJoyApp","showDialog","aboutImJoy","showAPIDocs","connectPlugin","ui","showMessage","prompt","reloadPluginRecursively","uri","queryString","search","urlParams","URLSearchParams","showWindow","minimizeWindow","maximizeWindow","runNotebookPlugin","_connectPlugin","_runPluginOnly","protocolAndDomainRE","localhostDomainRE","nonLocalhostDomainRE","laxUrlRegex","githubUrlToObject","repoUrl","opts","shorthand","match","mediumhand","antiquated","user","repo","branch","string","everythingAfterProtocol","isUrl","hostname","enterprise","path","apiHost","tarball_url","clone_url","https_url","travis_url","zip_url","api_url","githubUrlRaw","extFilter","gistId","Response","selected_file","values","files","file","filename","raw_url","ghObj","githubUser","githubRepo","re","convertZenodoFileUrl","exec","fullUrl","depositId","fileName","links","ua","isiPad","isChrome","isFirefox","codeEditors","wait","immediate","insertUrlParam","history","pushState","searchParams","newurl","onEditorResized","textArea","bbox","setSize","onEditorTextChanged","sharingScript","later","callNow","shareViaURL","alert","shareViaGithub","open","_createElement","lastMenus","switchMenu","menu","touchClick","ev","click","stopPropagation","elm","tryReplace","children","innerText","editorDiv","myCodeMirror","CodeMirror","tags","docs","lineNumbers","matchBrackets","refresh","getValue","replaceTextArea","fileDialog","openFileDialogJS","initPath","selectionMode","closed","dialogEl","onclick","fileInput","onchange","mountFile","filepath","saveFileDialogJS","savePath","downloadQueue","onFileOpened","cheerpjRemoveStringFile","openURL","getBytesFromUrl","originalUrl","arrayBuffer","cjTypedArrayToJava","startImageJ","preload","localStorage","getItem","cheerpjInit","preloadResources","enableInputMethods","clipboardMode","enablePreciseClassLoaders","disableErrorReporting","javaProperties","appContainer","cheerpjCreateDisplay","_addEL","items","cdisplay","_appendChild","sortByZIndex","bringToTop","windows","sort","fixWindowOrder","cheerpjRunMain","readFile","cheerpjAddStringFile","showImage","img","imagej","openImage","formats","flaot64","format","number","typeMapping","createImagePlus","imp","channel","frame","channels","1","2","3","4","bytesPerPixelMapping","slices","frames","javaBytesToArrayBuffer","saveAsBytes","value0","getPixels","saveImage","ext","getImage","original_name","cjStringJavaToJs","getString","downloadBytesFile","fileByteArray","msSaveOrOpenBlob","msSaveBlob","download","openAsync","saveFileToFS","saveBytes","listDir","listFiles","reader","FileReader","readAsArrayBuffer","addMenuItem","newMenu","button","label","callback","Edit","Image","Process","Analyze","Plugins","Window","Help","group","targetMenu","ch","fixStyle","platform","ref","mount","cheerpjGetFSMountForPath","assert","CheerpJDataFolder","mountPoint","loadContentFromUrl","updateViewPort","mvp","onImageJInitialized","_cheerpjCloseAsync","cheerpjCloseAsync","fds","fd","fdObj","fileData","chunks","byteCount","removeFile","cjResolveCall","showStatus","runPlugIn","runMacro","installMacro","installTool","installPlugin","getPlugins","getPlugInsPath","save","getDimensions","openAsBytes","core_api","defaults","setup","ctx","images","viewImage","macro","runMacroAsync","tool","setupImJoyAPI","onMacroResolve","onMacroReject","onOpenResolve","dragOverlay","processDataTransfer","processed","kind","getAsString","getAsFile","clipboardData","pasteFromSystem","clipboard","read","clipboardItem","clipboardItems","getType","copyToSystem","ClipboardItem","write","setupDragDropPaste","removes","it","fixMenu","menus","fixTouch","urls","getAll","decompressed","processUrlParameters","setItem","cjGetRuntimeResources","timeEnd","resetHeight","fixHeight","time"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"imagej\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"imagej\"] = factory();\n\telse\n\t\troot[\"imagej\"] = factory();\n})(window, function() {\nreturn "," \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t};\n\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"\" + chunkId + \".index.js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonpimagej\"] = window[\"webpackJsonpimagej\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n","/*!\r\n * Snackbar v0.1.14\r\n * http://polonel.com/Snackbar\r\n *\r\n * Copyright 2018 Chris Brame and other contributors\r\n * Released under the MIT license\r\n * https://github.com/polonel/Snackbar/blob/master/LICENSE\r\n */\r\n\r\n(function(root, factory) {\r\n    'use strict';\r\n\r\n    if (typeof define === 'function' && define.amd) {\r\n        define([], function() {\r\n            return (root.Snackbar = factory());\r\n        });\r\n    } else if (typeof module === 'object' && module.exports) {\r\n        module.exports = root.Snackbar = factory();\r\n    } else {\r\n        root.Snackbar = factory();\r\n    }\r\n})(this, function() {\r\n    var Snackbar = {};\r\n\r\n    Snackbar.current = null;\r\n    var $defaults = {\r\n        text: 'Default Text',\r\n        textColor: '#FFFFFF',\r\n        width: 'auto',\r\n        showAction: true,\r\n        actionText: 'Dismiss',\r\n        actionTextAria: 'Dismiss, Description for Screen Readers',\r\n        alertScreenReader: false,\r\n        actionTextColor: '#4CAF50',\r\n        showSecondButton: false,\r\n        secondButtonText: '',\r\n        secondButtonAria: 'Description for Screen Readers',\r\n        secondButtonTextColor: '#4CAF50',\r\n        backgroundColor: '#323232',\r\n        pos: 'bottom-left',\r\n        duration: 5000,\r\n        customClass: '',\r\n        onActionClick: function(element) {\r\n            element.style.opacity = 0;\r\n        },\r\n        onSecondButtonClick: function(element) {},\r\n        onClose: function(element) {}\r\n    };\r\n\r\n    Snackbar.show = function($options) {\r\n        var options = Extend(true, $defaults, $options);\r\n\r\n        if (Snackbar.current) {\r\n            Snackbar.current.style.opacity = 0;\r\n            setTimeout(\r\n                function() {\r\n                    var $parent = this.parentElement;\r\n                    if ($parent)\r\n                    // possible null if too many/fast Snackbars\r\n                        $parent.removeChild(this);\r\n                }.bind(Snackbar.current),\r\n                500\r\n            );\r\n        }\r\n\r\n        Snackbar.snackbar = document.createElement('div');\r\n        Snackbar.snackbar.className = 'snackbar-container ' + options.customClass;\r\n        Snackbar.snackbar.style.width = options.width;\r\n        var $p = document.createElement('p');\r\n        $p.style.margin = 0;\r\n        $p.style.padding = 0;\r\n        $p.style.color = options.textColor;\r\n        $p.style.fontSize = '14px';\r\n        $p.style.fontWeight = 300;\r\n        $p.style.lineHeight = '1em';\r\n        $p.innerHTML = options.text;\r\n        Snackbar.snackbar.appendChild($p);\r\n        Snackbar.snackbar.style.background = options.backgroundColor;\r\n\r\n        if (options.showSecondButton) {\r\n            var secondButton = document.createElement('button');\r\n            secondButton.className = 'action';\r\n            secondButton.innerHTML = options.secondButtonText;\r\n            secondButton.setAttribute('aria-label', options.secondButtonAria);\r\n            secondButton.style.color = options.secondButtonTextColor;\r\n            secondButton.addEventListener('click', function() {\r\n                options.onSecondButtonClick(Snackbar.snackbar);\r\n            });\r\n            Snackbar.snackbar.appendChild(secondButton);\r\n        }\r\n\r\n        if (options.showAction) {\r\n            var actionButton = document.createElement('button');\r\n            actionButton.className = 'action';\r\n            actionButton.innerHTML = options.actionText;\r\n            actionButton.setAttribute('aria-label', options.actionTextAria);\r\n            actionButton.style.color = options.actionTextColor;\r\n            actionButton.addEventListener('click', function() {\r\n                options.onActionClick(Snackbar.snackbar);\r\n            });\r\n            Snackbar.snackbar.appendChild(actionButton);\r\n        }\r\n\r\n        if (options.duration) {\r\n            setTimeout(\r\n                function() {\r\n                    if (Snackbar.current === this) {\r\n                        Snackbar.current.style.opacity = 0;\r\n                        // When natural remove event occurs let's move the snackbar to its origins\r\n                        Snackbar.current.style.top = '-100px';\r\n                        Snackbar.current.style.bottom = '-100px';\r\n                    }\r\n                }.bind(Snackbar.snackbar),\r\n                options.duration\r\n            );\r\n        }\r\n\r\n        if (options.alertScreenReader) {\r\n           Snackbar.snackbar.setAttribute('role', 'alert');\r\n        }\r\n\r\n        Snackbar.snackbar.addEventListener(\r\n            'transitionend',\r\n            function(event, elapsed) {\r\n                if (event.propertyName === 'opacity' && this.style.opacity === '0') {\r\n                    if (typeof(options.onClose) === 'function')\r\n                        options.onClose(this);\r\n\r\n                    this.parentElement.removeChild(this);\r\n                    if (Snackbar.current === this) {\r\n                        Snackbar.current = null;\r\n                    }\r\n                }\r\n            }.bind(Snackbar.snackbar)\r\n        );\r\n\r\n        Snackbar.current = Snackbar.snackbar;\r\n\r\n        document.body.appendChild(Snackbar.snackbar);\r\n        var $bottom = getComputedStyle(Snackbar.snackbar).bottom;\r\n        var $top = getComputedStyle(Snackbar.snackbar).top;\r\n        Snackbar.snackbar.style.opacity = 1;\r\n        Snackbar.snackbar.className =\r\n            'snackbar-container ' + options.customClass + ' snackbar-pos ' + options.pos;\r\n    };\r\n\r\n    Snackbar.close = function() {\r\n        if (Snackbar.current) {\r\n            Snackbar.current.style.opacity = 0;\r\n        }\r\n    };\r\n\r\n    // Pure JS Extend\r\n    // http://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n    var Extend = function() {\r\n        var extended = {};\r\n        var deep = false;\r\n        var i = 0;\r\n        var length = arguments.length;\r\n\r\n        if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n            deep = arguments[0];\r\n            i++;\r\n        }\r\n\r\n        var merge = function(obj) {\r\n            for (var prop in obj) {\r\n                if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n                    if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n                        extended[prop] = Extend(true, extended[prop], obj[prop]);\r\n                    } else {\r\n                        extended[prop] = obj[prop];\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        for (; i < length; i++) {\r\n            var obj = arguments[i];\r\n            merge(obj);\r\n        }\r\n\r\n        return extended;\r\n    };\r\n\r\n    return Snackbar;\r\n});\r\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n}\n","module.exports = require('./dist/imjoy-rpc.js');","/* global NodeList, Element, Event, define */\n\n(function(global) {\n  'use strict';\n\n  var FOCUSABLE_ELEMENTS = [\n    'a[href]:not([tabindex^=\"-\"]):not([inert])',\n    'area[href]:not([tabindex^=\"-\"]):not([inert])',\n    'input:not([disabled]):not([inert])',\n    'select:not([disabled]):not([inert])',\n    'textarea:not([disabled]):not([inert])',\n    'button:not([disabled]):not([inert])',\n    'iframe:not([tabindex^=\"-\"]):not([inert])',\n    'audio:not([tabindex^=\"-\"]):not([inert])',\n    'video:not([tabindex^=\"-\"]):not([inert])',\n    '[contenteditable]:not([tabindex^=\"-\"]):not([inert])',\n    '[tabindex]:not([tabindex^=\"-\"]):not([inert])'\n  ];\n  var TAB_KEY = 9;\n  var ESCAPE_KEY = 27;\n  var focusedBeforeDialog;\n\n  /**\n   * Define the constructor to instantiate a dialog\n   *\n   * @constructor\n   * @param {Element} node\n   * @param {(NodeList | Element | string)} targets\n   */\n  function A11yDialog(node, targets) {\n    // Prebind the functions that will be bound in addEventListener and\n    // removeEventListener to avoid losing references\n    this._show = this.show.bind(this);\n    this._hide = this.hide.bind(this);\n    this._maintainFocus = this._maintainFocus.bind(this);\n    this._bindKeypress = this._bindKeypress.bind(this);\n\n    // Keep a reference of the node and the actual dialog on the instance\n    this.container = node;\n    this.dialog = node.querySelector('dialog, [role=\"dialog\"], [role=\"alertdialog\"]');\n    this.role = this.dialog.getAttribute('role') || 'dialog';\n    this.useDialog = (\n      'show' in document.createElement('dialog') &&\n      this.dialog.nodeName === 'DIALOG'\n    );\n\n    // Keep an object of listener types mapped to callback functions\n    this._listeners = {};\n\n    // Initialise everything needed for the dialog to work properly\n    this.create(targets);\n  }\n\n  /**\n   * Set up everything necessary for the dialog to be functioning\n   *\n   * @param {(NodeList | Element | string)} targets\n   * @return {this}\n   */\n  A11yDialog.prototype.create = function(targets) {\n    // Keep a collection of nodes to disable/enable when toggling the dialog\n    this._targets =\n      this._targets || collect(targets) || getSiblings(this.container);\n\n    // Set the `shown` property to match the status from the DOM\n    this.shown = this.dialog.hasAttribute('open');\n\n    // Despite using a `<dialog>` element, `role=\"dialog\"` is not necessarily\n    // implied by all screen-readers (yet)\n    // See: https://github.com/edenspiekermann/a11y-dialog/commit/6ba711a777aed0dbda0719a18a02f742098c64d9#commitcomment-28694166\n    this.dialog.setAttribute('role', this.role);\n\n    if (!this.useDialog) {\n      if (this.shown) {\n        this.container.removeAttribute('aria-hidden');\n      } else {\n        this.container.setAttribute('aria-hidden', true);\n      }\n    } else {\n      this.container.setAttribute('data-a11y-dialog-native', '');\n    }\n\n    // Keep a collection of dialog openers, each of which will be bound a click\n    // event listener to open the dialog\n    this._openers = $$('[data-a11y-dialog-show=\"' + this.container.id + '\"]');\n    this._openers.forEach(\n      function(opener) {\n        opener.addEventListener('click', this._show);\n      }.bind(this)\n    );\n\n    // Keep a collection of dialog closers, each of which will be bound a click\n    // event listener to close the dialog\n    this._closers = $$('[data-a11y-dialog-hide]', this.container).concat(\n      $$('[data-a11y-dialog-hide=\"' + this.container.id + '\"]')\n    );\n    this._closers.forEach(\n      function(closer) {\n        closer.addEventListener('click', this._hide);\n      }.bind(this)\n    );\n\n    // Execute all callbacks registered for the `create` event\n    this._fire('create');\n\n    return this;\n  };\n\n  /**\n   * Show the dialog element, disable all the targets (siblings), trap the\n   * current focus within it, listen for some specific key presses and fire all\n   * registered callbacks for `show` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\n  A11yDialog.prototype.show = function(event) {\n    // If the dialog is already open, abort\n    if (this.shown) {\n      return this;\n    }\n\n    this.shown = true;\n\n    // Keep a reference to the currently focused element to be able to restore\n    // it later\n    focusedBeforeDialog = document.activeElement;\n\n    if (this.useDialog) {\n      this.dialog.showModal(event instanceof Event ? void 0 : event);\n    } else {\n      this.dialog.setAttribute('open', '');\n      this.container.removeAttribute('aria-hidden');\n\n      // Iterate over the targets to disable them by setting their `aria-hidden`\n      // attribute to `true`\n      this._targets.forEach(function(target) {\n        target.setAttribute('aria-hidden', 'true');\n      });\n    }\n\n    // Set the focus to the first focusable child of the dialog element\n    setFocusToFirstItem(this.dialog);\n\n    // Bind a focus event listener to the body element to make sure the focus\n    // stays trapped inside the dialog while open, and start listening for some\n    // specific key presses (TAB and ESC)\n    document.body.addEventListener('focus', this._maintainFocus, true);\n    document.addEventListener('keydown', this._bindKeypress);\n\n    // Execute all callbacks registered for the `show` event\n    this._fire('show', event);\n\n    return this;\n  };\n\n  /**\n   * Hide the dialog element, enable all the targets (siblings), restore the\n   * focus to the previously active element, stop listening for some specific\n   * key presses and fire all registered callbacks for `hide` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\n  A11yDialog.prototype.hide = function(event) {\n    // If the dialog is already closed, abort\n    if (!this.shown) {\n      return this;\n    }\n\n    this.shown = false;\n\n    if (this.useDialog) {\n      this.dialog.close(event instanceof Event ? void 0 : event);\n    } else {\n      this.dialog.removeAttribute('open');\n      this.container.setAttribute('aria-hidden', 'true');\n\n      // Iterate over the targets to enable them by removing their `aria-hidden`\n      // attribute\n      this._targets.forEach(function(target) {\n        target.removeAttribute('aria-hidden');\n      });\n    }\n\n    // If there was a focused element before the dialog was opened (and it has a\n    // `focus` method), restore the focus back to it\n    // See: https://github.com/edenspiekermann/a11y-dialog/issues/108\n    if (focusedBeforeDialog && focusedBeforeDialog.focus) {\n      focusedBeforeDialog.focus();\n    }\n\n    // Remove the focus event listener to the body element and stop listening\n    // for specific key presses\n    document.body.removeEventListener('focus', this._maintainFocus, true);\n    document.removeEventListener('keydown', this._bindKeypress);\n\n    // Execute all callbacks registered for the `hide` event\n    this._fire('hide', event);\n\n    return this;\n  };\n\n  /**\n   * Destroy the current instance (after making sure the dialog has been hidden)\n   * and remove all associated listeners from dialog openers and closers\n   *\n   * @return {this}\n   */\n  A11yDialog.prototype.destroy = function() {\n    // Hide the dialog to avoid destroying an open instance\n    this.hide();\n\n    // Remove the click event listener from all dialog openers\n    this._openers.forEach(\n      function(opener) {\n        opener.removeEventListener('click', this._show);\n      }.bind(this)\n    );\n\n    // Remove the click event listener from all dialog closers\n    this._closers.forEach(\n      function(closer) {\n        closer.removeEventListener('click', this._hide);\n      }.bind(this)\n    );\n\n    // Execute all callbacks registered for the `destroy` event\n    this._fire('destroy');\n\n    // Keep an object of listener types mapped to callback functions\n    this._listeners = {};\n\n    return this;\n  };\n\n  /**\n   * Register a new callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\n  A11yDialog.prototype.on = function(type, handler) {\n    if (typeof this._listeners[type] === 'undefined') {\n      this._listeners[type] = [];\n    }\n\n    this._listeners[type].push(handler);\n\n    return this;\n  };\n\n  /**\n   * Unregister an existing callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\n  A11yDialog.prototype.off = function(type, handler) {\n    var index = this._listeners[type].indexOf(handler);\n\n    if (index > -1) {\n      this._listeners[type].splice(index, 1);\n    }\n\n    return this;\n  };\n\n  /**\n   * Iterate over all registered handlers for given type and call them all with\n   * the dialog element as first argument, event as second argument (if any).\n   *\n   * @access private\n   * @param {string} type\n   * @param {Event} event\n   */\n  A11yDialog.prototype._fire = function(type, event) {\n    var listeners = this._listeners[type] || [];\n\n    listeners.forEach(\n      function(listener) {\n        listener(this.container, event);\n      }.bind(this)\n    );\n  };\n\n  /**\n   * Private event handler used when listening to some specific key presses\n   * (namely ESCAPE and TAB)\n   *\n   * @access private\n   * @param {Event} event\n   */\n  A11yDialog.prototype._bindKeypress = function(event) {\n    // If the dialog is shown and the ESCAPE key is being pressed, prevent any\n    // further effects from the ESCAPE key and hide the dialog, unless its role\n    // is 'alertdialog', which should be modal\n    if (this.shown && event.which === ESCAPE_KEY && this.role !== 'alertdialog') {\n      event.preventDefault();\n      this.hide(event);\n    }\n\n    // If the dialog is shown and the TAB key is being pressed, make sure the\n    // focus stays trapped within the dialog element\n    if (this.shown && event.which === TAB_KEY) {\n      trapTabKey(this.dialog, event);\n    }\n  };\n\n  /**\n   * Private event handler used when making sure the focus stays within the\n   * currently open dialog\n   *\n   * @access private\n   * @param {Event} event\n   */\n  A11yDialog.prototype._maintainFocus = function(event) {\n    // If the dialog is shown and the focus is not within the dialog element,\n    // move it back to its first focusable child\n    if (this.shown && !this.container.contains(event.target)) {\n      setFocusToFirstItem(this.dialog);\n    }\n  };\n\n  /**\n   * Convert a NodeList into an array\n   *\n   * @param {NodeList} collection\n   * @return {Array<Element>}\n   */\n  function toArray(collection) {\n    return Array.prototype.slice.call(collection);\n  }\n\n  /**\n   * Query the DOM for nodes matching the given selector, scoped to context (or\n   * the whole document)\n   *\n   * @param {String} selector\n   * @param {Element} [context = document]\n   * @return {Array<Element>}\n   */\n  function $$(selector, context) {\n    return toArray((context || document).querySelectorAll(selector));\n  }\n\n  /**\n   * Return an array of Element based on given argument (NodeList, Element or\n   * string representing a selector)\n   *\n   * @param {(NodeList | Element | string)} target\n   * @return {Array<Element>}\n   */\n  function collect(target) {\n    if (NodeList.prototype.isPrototypeOf(target)) {\n      return toArray(target);\n    }\n\n    if (Element.prototype.isPrototypeOf(target)) {\n      return [target];\n    }\n\n    if (typeof target === 'string') {\n      return $$(target);\n    }\n  }\n\n  /**\n   * Set the focus to the first element with `autofocus` or the first focusable\n   * child of the given element\n   *\n   * @param {Element} node\n   */\n  function setFocusToFirstItem(node) {\n    var focusableChildren = getFocusableChildren(node);\n    var focused = node.querySelector('[autofocus]') || focusableChildren[0];\n\n    if (focused) {\n      focused.focus();\n    }\n  }\n\n  /**\n   * Get the focusable children of the given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\n  function getFocusableChildren(node) {\n    return $$(FOCUSABLE_ELEMENTS.join(','), node).filter(function(child) {\n      return !!(\n        child.offsetWidth ||\n        child.offsetHeight ||\n        child.getClientRects().length\n      );\n    });\n  }\n\n  /**\n   * Trap the focus inside the given element\n   *\n   * @param {Element} node\n   * @param {Event} event\n   */\n  function trapTabKey(node, event) {\n    var focusableChildren = getFocusableChildren(node);\n    var focusedItemIndex = focusableChildren.indexOf(document.activeElement);\n\n    // If the SHIFT key is being pressed while tabbing (moving backwards) and\n    // the currently focused item is the first one, move the focus to the last\n    // focusable item from the dialog element\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableChildren[focusableChildren.length - 1].focus();\n      event.preventDefault();\n      // If the SHIFT key is not being pressed (moving forwards) and the currently\n      // focused item is the last one, move the focus to the first focusable item\n      // from the dialog element\n    } else if (\n      !event.shiftKey &&\n      focusedItemIndex === focusableChildren.length - 1\n    ) {\n      focusableChildren[0].focus();\n      event.preventDefault();\n    }\n  }\n\n  /**\n   * Retrieve siblings from given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\n  function getSiblings(node) {\n    var nodes = toArray(node.parentNode.childNodes);\n    var siblings = nodes.filter(function(node) {\n      return node.nodeType === 1;\n    });\n\n    siblings.splice(siblings.indexOf(node), 1);\n\n    return siblings;\n  }\n\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = A11yDialog;\n  } else if (typeof define === 'function' && define.amd) {\n    define('A11yDialog', [], function() {\n      return A11yDialog;\n    });\n  } else if (typeof global === 'object') {\n    global.A11yDialog = A11yDialog;\n  }\n})(typeof global !== 'undefined' ? global : window);\n","/*! mobile-drag-drop 2.3.0-rc.1 | Copyright (c) 2019 Tim Ruffles | MIT License */\n!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?i(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],i):i(t.MobileDragDrop=t.MobileDragDrop||{})}(this,function(t){\"use strict\";var i=\"dnd-poly-\",s=i+\"snapback\",n=\"dnd-poly-\",h=n+\"dragstart-pending\",e=n+\"dragstart-cancel\",r=[\"none\",\"copy\",\"copyLink\",\"copyMove\",\"link\",\"linkMove\",\"move\",\"all\"],o=[\"none\",\"copy\",\"move\",\"link\"];var u=function(){var t=!1;try{var i=Object.defineProperty({},\"passive\",{get:function(){t=!0}});window.addEventListener(\"test\",null,i)}catch(t){}return t}();function a(t){return t&&t.tagName}function c(t,i,s){void 0===s&&(s=!0),document.addEventListener(t,i,!!u&&{passive:s})}function f(t,i){document.removeEventListener(t,i)}function l(t,i,s,n){void 0===n&&(n=!1);var h=u?{passive:!0,capture:n}:n;return t.addEventListener(i,s,h),{off:function(){t.removeEventListener(i,s,h)}}}function d(t){return 0===t.length?0:t.reduce(function(t,i){return i+t},0)/t.length}function v(t,i){for(var s=0;s<t.changedTouches.length;s++){if(t.changedTouches[s].identifier===i)return!0}return!1}function p(t,i,s){for(var n=[],h=[],e=0;e<i.touches.length;e++){var r=i.touches[e];n.push(r[t+\"X\"]),h.push(r[t+\"Y\"])}s.x=d(n),s.y=d(h)}var g=[\"\",\"-webkit-\"];function m(t,i,s,n,h){void 0===h&&(h=!0);var e=i.x,r=i.y;n&&(e+=n.x,r+=n.y),h&&(e-=parseInt(t.offsetWidth,10)/2,r-=parseInt(t.offsetHeight,10)/2);for(var o=\"translate3d(\"+e+\"px,\"+r+\"px, 0)\",u=0;u<g.length;u++){var a=g[u]+\"transform\";t.style[a]=o+\" \"+s[u]}}var b=function(){function t(t,i){this.t=t,this.i=i,this.s=o[0]}return Object.defineProperty(t.prototype,\"dropEffect\",{get:function(){return this.s},set:function(t){0!==this.t.mode&&r.indexOf(t)>-1&&(this.s=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"types\",{get:function(){if(0!==this.t.mode)return Object.freeze(this.t.types)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"effectAllowed\",{get:function(){return this.t.effectAllowed},set:function(t){2===this.t.mode&&r.indexOf(t)>-1&&(this.t.effectAllowed=t)},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,i){if(2===this.t.mode){if(t.indexOf(\" \")>-1)throw new Error(\"illegal arg: type contains space\");this.t.data[t]=i,-1===this.t.types.indexOf(t)&&this.t.types.push(t)}},t.prototype.getData=function(t){if(1===this.t.mode||2===this.t.mode)return this.t.data[t]||\"\"},t.prototype.clearData=function(t){if(2===this.t.mode){if(t&&this.t.data[t]){delete this.t.data[t];var i=this.t.types.indexOf(t);return void(i>-1&&this.t.types.splice(i,1))}this.t.data={},this.t.types=[]}},t.prototype.setDragImage=function(t,i,s){2===this.t.mode&&this.i(t,i,s)},t}();function y(t,i){return t?t===r[0]?o[0]:0===t.indexOf(r[1])||t===r[7]?o[1]:0===t.indexOf(r[4])?o[3]:t===r[6]?o[2]:o[1]:3===i.nodeType&&\"A\"===i.tagName?o[3]:o[1]}function w(t,i,s,n,h,e,r){void 0===e&&(e=!0),void 0===r&&(r=null);var o=function(t,i,s,n,h,e,r){void 0===r&&(r=null);var o=i.changedTouches[0],u=new Event(s,{bubbles:!0,cancelable:n});u.dataTransfer=e,u.relatedTarget=r,u.screenX=o.screenX,u.screenY=o.screenY,u.clientX=o.clientX,u.clientY=o.clientY,u.pageX=o.pageX,u.pageY=o.pageY;var a=t.getBoundingClientRect();return u.offsetX=u.clientX-a.left,u.offsetY=u.clientY-a.top,u}(i,s,t,e,document.defaultView,h,r),u=!i.dispatchEvent(o);return n.mode=0,u}function x(t,i){if(!t||t===r[7])return i;if(i===o[1]){if(0===t.indexOf(o[1]))return o[1]}else if(i===o[3]){if(0===t.indexOf(o[3])||t.indexOf(\"Link\")>-1)return o[3]}else if(i===o[2]&&(0===t.indexOf(o[2])||t.indexOf(\"Move\")>-1))return o[2];return o[0]}var I,j=function(){function t(t,i,s,n){this.h=t,this.o=i,this.u=s,this.l=n,this.v=0,this.p=null,this.g=null,this.m=t,this.I=t.changedTouches[0],this.j=this.C.bind(this),this.S=this.k.bind(this),c(\"touchmove\",this.j,!1),c(\"touchend\",this.S,!1),c(\"touchcancel\",this.S,!1)}return t.prototype.A=function(){var t=this;this.v=1,this.O=o[0],this.D={data:{},effectAllowed:void 0,mode:3,types:[]},this.M={x:null,y:null},this.F={x:null,y:null};var i=this.u;if(this.N=new b(this.D,function(s,n,h){i=s,\"number\"!=typeof n&&\"number\"!=typeof h||(t.P={x:n||0,y:h||0})}),this.D.mode=2,this.N.dropEffect=o[0],w(\"dragstart\",this.u,this.m,this.D,this.N))return this.v=3,this.T(),!1;p(\"page\",this.m,this.F);var s,n=this.o.dragImageSetup(i);if(this.L=(s=n,g.map(function(t){var i=s.style[t+\"transform\"];return i&&\"none\"!==i?i.replace(/translate\\(\\D*\\d+[^,]*,\\D*\\d+[^,]*\\)\\s*/g,\"\"):\"\"})),n.style.position=\"absolute\",n.style.left=\"0px\",n.style.top=\"0px\",n.style.zIndex=\"999999\",n.classList.add(\"dnd-poly-drag-image\"),n.classList.add(\"dnd-poly-icon\"),this._=n,!this.P)if(this.o.dragImageOffset)this.P={x:this.o.dragImageOffset.x,y:this.o.dragImageOffset.y};else if(this.o.dragImageCenterOnTouch){var h=getComputedStyle(i);this.P={x:0-parseInt(h.marginLeft,10),y:0-parseInt(h.marginTop,10)}}else{var e=i.getBoundingClientRect();h=getComputedStyle(i);this.P={x:e.left-this.I.clientX-parseInt(h.marginLeft,10)+e.width/2,y:e.top-this.I.clientY-parseInt(h.marginTop,10)+e.height/2}}return m(this._,this.F,this.L,this.P,this.o.dragImageCenterOnTouch),document.body.appendChild(this._),this.V=window.setInterval(function(){t.X||(t.X=!0,t.Y(),t.X=!1)},this.o.iterationInterval),!0},t.prototype.T=function(){this.V&&(clearInterval(this.V),this.V=null),f(\"touchmove\",this.j),f(\"touchend\",this.S),f(\"touchcancel\",this.S),this._&&(this._.parentNode.removeChild(this._),this._=null),this.l(this.o,this.m,this.v)},t.prototype.C=function(t){var i=this;if(!1!==v(t,this.I.identifier)){if(this.m=t,0===this.v){var s=void 0;if(this.o.dragStartConditionOverride)try{s=this.o.dragStartConditionOverride(t)}catch(t){s=!1}else s=1===t.touches.length;return s?void(!0===this.A()&&(this.h.preventDefault(),t.preventDefault())):void this.T()}if(t.preventDefault(),p(\"client\",t,this.M),p(\"page\",t,this.F),this.o.dragImageTranslateOverride)try{var n=!1;if(this.o.dragImageTranslateOverride(t,{x:this.M.x,y:this.M.y},this.p,function(t,s){i._&&(n=!0,i.M.x+=t,i.M.y+=s,i.F.x+=t,i.F.y+=s,m(i._,i.F,i.L,i.P,i.o.dragImageCenterOnTouch))}),n)return}catch(t){}m(this._,this.F,this.L,this.P,this.o.dragImageCenterOnTouch)}},t.prototype.k=function(t){if(!1!==v(t,this.I.identifier)){if(this.o.dragImageTranslateOverride)try{this.o.dragImageTranslateOverride(void 0,void 0,void 0,function(){})}catch(t){}0!==this.v?(t.preventDefault(),this.v=\"touchcancel\"===t.type?3:2):this.T()}},t.prototype.Y=function(){var t=this,n=this.O;this.D.mode=3,this.N.dropEffect=o[0];var h=w(\"drag\",this.u,this.m,this.D,this.N);if(h&&(this.O=o[0]),h||2===this.v||3===this.v)return this.q(this.v)?void function(t,i,n,h){var e=getComputedStyle(t);if(\"hidden\"!==e.visibility&&\"none\"!==e.display){i.classList.add(s);var r=getComputedStyle(i),o=parseFloat(r.transitionDuration);if(isNaN(o)||0===o)h();else{var u=t.getBoundingClientRect(),a={x:u.left,y:u.top};a.x+=document.body.scrollLeft||document.documentElement.scrollLeft,a.y+=document.body.scrollTop||document.documentElement.scrollTop,a.x-=parseInt(e.marginLeft,10),a.y-=parseInt(e.marginTop,10);var c=parseFloat(r.transitionDelay),f=Math.round(1e3*(o+c));m(i,a,n,void 0,!1),setTimeout(h,f)}}else h()}(this.u,this._,this.L,function(){t.B()}):void this.B();var e=this.o.elementFromPoint(this.M.x,this.M.y),r=this.g;e!==this.p&&e!==this.g&&(this.p=e,null!==this.g&&(this.D.mode=3,this.N.dropEffect=o[0],w(\"dragexit\",this.g,this.m,this.D,this.N,!1)),null===this.p?this.g=this.p:(this.D.mode=3,this.N.dropEffect=y(this.D.effectAllowed,this.u),w(\"dragenter\",this.p,this.m,this.D,this.N)?(this.g=this.p,this.O=x(this.N.effectAllowed,this.N.dropEffect)):this.p!==document.body&&(this.g=document.body))),r!==this.g&&a(r)&&(this.D.mode=3,this.N.dropEffect=o[0],w(\"dragleave\",r,this.m,this.D,this.N,!1,this.g)),a(this.g)&&(this.D.mode=3,this.N.dropEffect=y(this.D.effectAllowed,this.u),!1===w(\"dragover\",this.g,this.m,this.D,this.N)?this.O=o[0]:this.O=x(this.N.effectAllowed,this.N.dropEffect)),n!==this.O&&this._.classList.remove(i+n);var u=i+this.O;this._.classList.add(u)},t.prototype.q=function(t){var i=this.O===o[0]||null===this.g||3===t;return i?a(this.g)&&(this.D.mode=3,this.N.dropEffect=o[0],w(\"dragleave\",this.g,this.m,this.D,this.N,!1)):a(this.g)&&(this.D.mode=1,this.N.dropEffect=this.O,!0===w(\"drop\",this.g,this.m,this.D,this.N)?this.O=this.N.dropEffect:this.O=o[0]),i},t.prototype.B=function(){this.D.mode=3,this.N.dropEffect=this.O,w(\"dragend\",this.u,this.m,this.D,this.N,!1),this.v=2,this.T()},t}(),C={iterationInterval:150,tryFindDraggableTarget:function(t){var i=t.target;do{if(!1!==i.draggable){if(!0===i.draggable)return i;if(i.getAttribute&&\"true\"===i.getAttribute(\"draggable\"))return i}}while((i=i.parentNode)&&i!==document.body)},dragImageSetup:function(t){var i=t.cloneNode(!0);return function t(i,s){if(1===i.nodeType){for(var n=getComputedStyle(i),h=0;h<n.length;h++){var e=n[h];s.style.setProperty(e,n.getPropertyValue(e),n.getPropertyPriority(e))}if(s.style.pointerEvents=\"none\",s.removeAttribute(\"id\"),s.removeAttribute(\"class\"),s.removeAttribute(\"draggable\"),\"CANVAS\"===s.nodeName){var r=i,o=s,u=r.getContext(\"2d\").getImageData(0,0,r.width,r.height);o.getContext(\"2d\").putImageData(u,0,0)}}if(i.hasChildNodes())for(h=0;h<i.childNodes.length;h++)t(i.childNodes[h],s.childNodes[h])}(t,i),i},elementFromPoint:function(t,i){return document.elementFromPoint(t,i)}};function S(t){if(!I){var i=C.tryFindDraggableTarget(t);if(i)try{I=new j(t,C,i,A)}catch(i){throw A(C,t,3),i}}}function k(t){var i=t.target,s=function(t){r.off(),o.off(),u.off(),a.off(),i&&i.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0})),clearTimeout(n)};i&&i.dispatchEvent(new CustomEvent(h,{bubbles:!0,cancelable:!0}));var n=window.setTimeout(function(){r.off(),o.off(),u.off(),a.off(),S(t)},C.holdToDrag),r=l(i,\"touchend\",s),o=l(i,\"touchcancel\",s),u=l(i,\"touchmove\",s),a=l(window,\"scroll\",s,!0)}function A(t,i,s){if(0===s&&t.defaultActionOverride)try{t.defaultActionOverride(i),i.defaultPrevented}catch(t){}I=null}t.polyfill=function(t){if(t&&Object.keys(t).forEach(function(i){C[i]=t[i]}),!C.forceApply){var i=(s={dragEvents:\"ondragstart\"in document.documentElement,draggable:\"draggable\"in document.documentElement,userAgentSupportingNativeDnD:void 0},n=!!window.chrome||/chrome/i.test(navigator.userAgent),s.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||n&&\"ontouchstart\"in document.documentElement),s);if(i.userAgentSupportingNativeDnD&&i.draggable&&i.dragEvents)return!1}var s,n;return C.holdToDrag?c(\"touchstart\",k,!1):c(\"touchstart\",S,!1),!0},Object.defineProperty(t,\"__esModule\",{value:!0})});\n//# sourceMappingURL=index.min.js.map","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.MobileDragDrop = global.MobileDragDrop || {})));\n}(this, (function (exports) { 'use strict';\n\nfunction isTopLevelEl(el) {\n    return (el === document.body || el === document.documentElement);\n}\nfunction getElementViewportOffset(el, axis) {\n    var offset;\n    if (isTopLevelEl(el)) {\n        offset = (axis === 0) ? el.clientLeft : el.clientTop;\n    }\n    else {\n        var bounds = el.getBoundingClientRect();\n        offset = (axis === 0) ? bounds.left : bounds.top;\n    }\n    return offset;\n}\nfunction getElementViewportSize(el, axis) {\n    var size;\n    if (isTopLevelEl(el)) {\n        size = (axis === 0) ? window.innerWidth : window.innerHeight;\n    }\n    else {\n        size = (axis === 0) ? el.clientWidth : el.clientHeight;\n    }\n    return size;\n}\nfunction getSetElementScroll(el, axis, scroll) {\n    var prop = (axis === 0) ? \"scrollLeft\" : \"scrollTop\";\n    var isTopLevel = isTopLevelEl(el);\n    if (arguments.length === 2) {\n        if (isTopLevel) {\n            return document.body[prop] || document.documentElement[prop];\n        }\n        return el[prop];\n    }\n    if (isTopLevel) {\n        document.documentElement[prop] += scroll;\n        document.body[prop] += scroll;\n    }\n    else {\n        el[prop] += scroll;\n    }\n}\nfunction isScrollable(el) {\n    var cs = getComputedStyle(el);\n    if (el.scrollHeight > el.clientHeight && (cs.overflowY === \"scroll\" || cs.overflowY === \"auto\")) {\n        return true;\n    }\n    if (el.scrollWidth > el.clientWidth && (cs.overflowX === \"scroll\" || cs.overflowX === \"auto\")) {\n        return true;\n    }\n    return false;\n}\nfunction findScrollableParent(el) {\n    do {\n        if (!el) {\n            return undefined;\n        }\n        if (isScrollable(el)) {\n            return el;\n        }\n        if (el === document.documentElement) {\n            return null;\n        }\n    } while (el = el.parentNode);\n    return null;\n}\nfunction determineScrollIntention(currentCoordinate, size, threshold) {\n    if (currentCoordinate < threshold) {\n        return -1;\n    }\n    else if (size - currentCoordinate < threshold) {\n        return 1;\n    }\n    return 0;\n}\nfunction determineDynamicVelocity(scrollIntention, currentCoordinate, size, threshold) {\n    if (scrollIntention === -1) {\n        return Math.abs(currentCoordinate - threshold);\n    }\n    else if (scrollIntention === 1) {\n        return Math.abs(size - currentCoordinate - threshold);\n    }\n    return 0;\n}\nfunction isScrollEndReached(axis, scrollIntention, scrollBounds) {\n    var currentScrollOffset = (axis === 0) ? (scrollBounds.scrollX) : (scrollBounds.scrollY);\n    if (scrollIntention === 1) {\n        var maxScrollOffset = (axis === 0) ? (scrollBounds.scrollWidth - scrollBounds.width) : (scrollBounds.scrollHeight -\n            scrollBounds.height);\n        return currentScrollOffset >= maxScrollOffset;\n    }\n    else if (scrollIntention === -1) {\n        return (currentScrollOffset <= 0);\n    }\n    return true;\n}\nvar _options = {\n    threshold: 75,\n    velocityFn: function (velocity, threshold) {\n        var multiplier = velocity / threshold;\n        var easeInCubic = multiplier * multiplier * multiplier;\n        return easeInCubic * threshold;\n    }\n};\nvar _scrollIntentions = {\n    horizontal: 0,\n    vertical: 0\n};\nvar _dynamicVelocity = {\n    x: 0,\n    y: 0\n};\nvar _scrollAnimationFrameId;\nvar _currentCoordinates;\nvar _hoveredElement;\nvar _scrollableParent;\nvar _translateDragImageFn;\nfunction handleDragImageTranslateOverride(event, currentCoordinates, hoveredElement, translateDragImageFn) {\n    _currentCoordinates = currentCoordinates;\n    _translateDragImageFn = translateDragImageFn;\n    if (_hoveredElement !== hoveredElement) {\n        _hoveredElement = hoveredElement;\n        _scrollableParent = findScrollableParent(_hoveredElement);\n    }\n    var performScrollAnimation = updateScrollIntentions(_currentCoordinates, _scrollableParent, _options.threshold, _scrollIntentions, _dynamicVelocity);\n    if (performScrollAnimation) {\n        scheduleScrollAnimation();\n    }\n    else if (!!_scrollAnimationFrameId) {\n        window.cancelAnimationFrame(_scrollAnimationFrameId);\n        _scrollAnimationFrameId = null;\n    }\n}\nfunction scheduleScrollAnimation() {\n    if (!!_scrollAnimationFrameId) {\n        return;\n    }\n    _scrollAnimationFrameId = window.requestAnimationFrame(scrollAnimation);\n}\nfunction scrollAnimation() {\n    var scrollDiffX = 0, scrollDiffY = 0, isTopLevel = isTopLevelEl(_scrollableParent);\n    if (_scrollIntentions.horizontal !== 0) {\n        scrollDiffX = Math.round(_options.velocityFn(_dynamicVelocity.x, _options.threshold) * _scrollIntentions.horizontal);\n        getSetElementScroll(_scrollableParent, 0, scrollDiffX);\n    }\n    if (_scrollIntentions.vertical !== 0) {\n        scrollDiffY = Math.round(_options.velocityFn(_dynamicVelocity.y, _options.threshold) * _scrollIntentions.vertical);\n        getSetElementScroll(_scrollableParent, 1, scrollDiffY);\n    }\n    if (isTopLevel) {\n        _translateDragImageFn(scrollDiffX, scrollDiffY);\n    }\n    else {\n        _translateDragImageFn(0, 0);\n    }\n    _scrollAnimationFrameId = null;\n    if (updateScrollIntentions(_currentCoordinates, _scrollableParent, _options.threshold, _scrollIntentions, _dynamicVelocity)) {\n        scheduleScrollAnimation();\n    }\n}\nfunction updateScrollIntentions(currentCoordinates, scrollableParent, threshold, scrollIntentions, dynamicVelocity) {\n    if (!currentCoordinates || !scrollableParent) {\n        return false;\n    }\n    var scrollableParentBounds = {\n        x: getElementViewportOffset(scrollableParent, 0),\n        y: getElementViewportOffset(scrollableParent, 1),\n        width: getElementViewportSize(scrollableParent, 0),\n        height: getElementViewportSize(scrollableParent, 1),\n        scrollX: getSetElementScroll(scrollableParent, 0),\n        scrollY: getSetElementScroll(scrollableParent, 1),\n        scrollWidth: scrollableParent.scrollWidth,\n        scrollHeight: scrollableParent.scrollHeight\n    };\n    var currentCoordinatesOffset = {\n        x: currentCoordinates.x - scrollableParentBounds.x,\n        y: currentCoordinates.y - scrollableParentBounds.y\n    };\n    scrollIntentions.horizontal = determineScrollIntention(currentCoordinatesOffset.x, scrollableParentBounds.width, threshold);\n    scrollIntentions.vertical = determineScrollIntention(currentCoordinatesOffset.y, scrollableParentBounds.height, threshold);\n    if (scrollIntentions.horizontal && isScrollEndReached(0, scrollIntentions.horizontal, scrollableParentBounds)) {\n        scrollIntentions.horizontal = 0;\n    }\n    else if (scrollIntentions.horizontal) {\n        dynamicVelocity.x = determineDynamicVelocity(scrollIntentions.horizontal, currentCoordinatesOffset.x, scrollableParentBounds.width, threshold);\n    }\n    if (scrollIntentions.vertical && isScrollEndReached(1, scrollIntentions.vertical, scrollableParentBounds)) {\n        scrollIntentions.vertical = 0;\n    }\n    else if (scrollIntentions.vertical) {\n        dynamicVelocity.y = determineDynamicVelocity(scrollIntentions.vertical, currentCoordinatesOffset.y, scrollableParentBounds.height, threshold);\n    }\n    return !!(scrollIntentions.horizontal || scrollIntentions.vertical);\n}\nvar scrollBehaviourDragImageTranslateOverride = handleDragImageTranslateOverride;\n\nexports.scrollBehaviourDragImageTranslateOverride = scrollBehaviourDragImageTranslateOverride;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=scroll-behaviour.js.map\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"imjoyRPC\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"imjoyRPC\"] = factory();\n\telse\n\t\troot[\"imjoyRPC\"] = factory();\n})(window, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/main.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./node_modules/worker-loader/dist/workers/InlineWorker.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/worker-loader/dist/workers/InlineWorker.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\nvar URL = window.URL || window.webkitURL;\n\nmodule.exports = function (content, url) {\n  try {\n    try {\n      var blob;\n\n      try {\n        // BlobBuilder = Deprecated, but widely implemented\n        var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n\n        blob = new BlobBuilder();\n\n        blob.append(content);\n\n        blob = blob.getBlob();\n      } catch (e) {\n        // The proposed API\n        blob = new Blob([content]);\n      }\n\n      return new Worker(URL.createObjectURL(blob));\n    } catch (e) {\n      return new Worker('data:application/javascript,' + encodeURIComponent(content));\n    }\n  } catch (e) {\n    if (!url) {\n      throw Error('Inline worker is not supported');\n    }\n\n    return new Worker(url);\n  }\n};\n\n/***/ }),\n\n/***/ \"./package.json\":\n/*!**********************!*\\\n  !*** ./package.json ***!\n  \\**********************/\n/*! exports provided: name, version, description, module, scripts, repository, keywords, author, license, bugs, homepage, dependencies, devDependencies, eslintConfig, default */\n/***/ (function(module) {\n\nmodule.exports = JSON.parse(\"{\\\"name\\\":\\\"imjoy-rpc\\\",\\\"version\\\":\\\"0.2.22\\\",\\\"description\\\":\\\"Remote procedure calls for ImJoy.\\\",\\\"module\\\":\\\"index.js\\\",\\\"scripts\\\":{\\\"build\\\":\\\"rm -rf dist && npm run build-umd\\\",\\\"build-umd\\\":\\\"webpack --config webpack.config.js --mode development && NODE_ENV=production webpack --config webpack.config.js --mode production --devtool source-map \\\",\\\"watch\\\":\\\"NODE_ENV=production webpack --watch --progress --config webpack.config.js --mode production --devtool source-map\\\",\\\"publish-npm\\\":\\\"npm install && npm run build && npm publish\\\",\\\"serve\\\":\\\"webpack-dev-server\\\",\\\"stats\\\":\\\"webpack --profile --json > stats.json\\\",\\\"stats-prod\\\":\\\"webpack --profile --json --mode production > stats-prod.json\\\",\\\"analyze\\\":\\\"webpack-bundle-analyzer -p 9999 stats.json\\\",\\\"analyze-prod\\\":\\\"webpack-bundle-analyzer -p 9999 stats-prod.json\\\",\\\"clean\\\":\\\"rimraf dist/*\\\",\\\"deploy\\\":\\\"npm run build && node deploy-site.js\\\",\\\"format\\\":\\\"prettier --write \\\\\\\"{src,tests}/**/**\\\\\\\"\\\",\\\"check-format\\\":\\\"prettier --check \\\\\\\"{src,tests}/**/**\\\\\\\"\\\",\\\"test\\\":\\\"karma start --single-run --browsers ChromeHeadless,FirefoxHeadless karma.conf.js\\\",\\\"test-watch\\\":\\\"karma start --auto-watch --browsers Chrome,FirefoxHeadless karma.conf.js --debug\\\"},\\\"repository\\\":{\\\"type\\\":\\\"git\\\",\\\"url\\\":\\\"git+https://github.com/imjoy-team/imjoy-rpc.git\\\"},\\\"keywords\\\":[\\\"imjoy\\\",\\\"rpc\\\"],\\\"author\\\":\\\"imjoy-team <imjoy.team@gmail.com>\\\",\\\"license\\\":\\\"MIT\\\",\\\"bugs\\\":{\\\"url\\\":\\\"https://github.com/imjoy-team/imjoy-rpc/issues\\\"},\\\"homepage\\\":\\\"https://github.com/imjoy-team/imjoy-rpc\\\",\\\"dependencies\\\":{},\\\"devDependencies\\\":{\\\"@babel/core\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/plugin-syntax-dynamic-import\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/polyfill\\\":\\\"^7.0.0-beta.39\\\",\\\"@babel/preset-env\\\":\\\"^7.0.0-beta.39\\\",\\\"@types/requirejs\\\":\\\"^2.1.28\\\",\\\"babel-core\\\":\\\"^6.26.0\\\",\\\"babel-eslint\\\":\\\"^10.1.0\\\",\\\"babel-loader\\\":\\\"^8.1.0\\\",\\\"babel-runtime\\\":\\\"^6.26.0\\\",\\\"chai\\\":\\\"^4.2.0\\\",\\\"clean-webpack-plugin\\\":\\\"^0.1.19\\\",\\\"copy-webpack-plugin\\\":\\\"^5.0.5\\\",\\\"eslint\\\":\\\"^6.8.0\\\",\\\"eslint-config-prettier\\\":\\\"^4.2.0\\\",\\\"eslint-loader\\\":\\\"^4.0.2\\\",\\\"file-loader\\\":\\\"^0.11.2\\\",\\\"fs-extra\\\":\\\"^0.30.0\\\",\\\"gh-pages\\\":\\\"^2.0.1\\\",\\\"html-loader\\\":\\\"^0.5.5\\\",\\\"html-webpack-plugin\\\":\\\"^3.2.0\\\",\\\"json-loader\\\":\\\"^0.5.4\\\",\\\"karma\\\":\\\"^4.4.1\\\",\\\"karma-chrome-launcher\\\":\\\"^3.1.0\\\",\\\"karma-firefox-launcher\\\":\\\"^1.3.0\\\",\\\"karma-mocha\\\":\\\"^1.3.0\\\",\\\"karma-spec-reporter\\\":\\\"0.0.32\\\",\\\"karma-webpack\\\":\\\"^4.0.2\\\",\\\"lerna\\\":\\\"^3.8.0\\\",\\\"lodash.debounce\\\":\\\"^4.0.8\\\",\\\"mocha\\\":\\\"^7.1.2\\\",\\\"postcss\\\":\\\"^6.0.2\\\",\\\"prettier\\\":\\\"^1.6.1\\\",\\\"rimraf\\\":\\\"^2.6.2\\\",\\\"schema-utils\\\":\\\"^0.4.3\\\",\\\"socket.io-client\\\":\\\"^2.3.0\\\",\\\"style-loader\\\":\\\"^0.18.1\\\",\\\"url-loader\\\":\\\"^0.5.9\\\",\\\"webpack\\\":\\\"^4.0.0\\\",\\\"webpack-bundle-analyzer\\\":\\\"^3.3.2\\\",\\\"webpack-cli\\\":\\\"^3.1.2\\\",\\\"webpack-dev-server\\\":\\\"^3.1.1\\\",\\\"webpack-merge\\\":\\\"^4.1.1\\\",\\\"workbox-webpack-plugin\\\":\\\"^4.3.1\\\",\\\"worker-loader\\\":\\\"^2.0.0\\\",\\\"write-file-webpack-plugin\\\":\\\"^4.5.1\\\"},\\\"eslintConfig\\\":{\\\"globals\\\":{\\\"document\\\":true,\\\"window\\\":true}}}\");\n\n/***/ }),\n\n/***/ \"./src/main.js\":\n/*!*********************!*\\\n  !*** ./src/main.js ***!\n  \\*********************/\n/*! exports provided: RPC, API_VERSION, VERSION, waitForInitialization, setupRPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"waitForInitialization\", function() { return waitForInitialization; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setupRPC\", function() { return setupRPC; });\n/* harmony import */ var _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./plugin.webworker.js */ \"./src/plugin.webworker.js\");\n/* harmony import */ var _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pluginIframe.js */ \"./src/pluginIframe.js\");\n/* harmony import */ var _pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pluginWebPython.js */ \"./src/pluginWebPython.js\");\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"RPC\", function() { return _rpc_js__WEBPACK_IMPORTED_MODULE_4__[\"RPC\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"API_VERSION\", function() { return _rpc_js__WEBPACK_IMPORTED_MODULE_4__[\"API_VERSION\"]; });\n\n/* harmony import */ var _package_json__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../package.json */ \"./package.json\");\nvar _package_json__WEBPACK_IMPORTED_MODULE_5___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../package.json */ \"./package.json\", 1);\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"VERSION\", function() { return _package_json__WEBPACK_IMPORTED_MODULE_5__[\"version\"]; });\n\n/**\n * Contains the code executed in the sandboxed frame under web-browser\n *\n * Tries to create a Web-Worker inside the frame and set up the\n * communication between the worker and the parent window. Some\n * browsers restrict creating a worker inside a sandboxed iframe - if\n * this happens, the plugin initialized right inside the frame (in the\n * same thread)\n */\n\n\n\n\n\n\n\nfunction _inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n/**\n * Initializes the plugin inside a web worker. May throw an exception\n * in case this was not permitted by the browser.\n */\n\n\nfunction setupWebWorker(config) {\n  if (!config.allow_execution) throw new Error(\"web-worker plugin can only work with allow_execution=true\");\n  const worker = new _plugin_webworker_js__WEBPACK_IMPORTED_MODULE_0___default.a(); // mixed content warning in Chrome silently skips worker\n  // initialization without exception, handling this with timeout\n\n  const fallbackTimeout = setTimeout(function () {\n    worker.terminate();\n    console.warn(`Plugin failed to start as a web-worker, running in an iframe instead.`);\n    Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n  }, 2000);\n  const peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])(); // forwarding messages between the worker and parent window\n\n  worker.addEventListener(\"message\", function (e) {\n    let transferables = undefined;\n    const m = e.data;\n\n    if (m.type === \"worker-ready\") {\n      // send config to the worker\n      worker.postMessage({\n        type: \"connectRPC\",\n        config: config\n      });\n      clearTimeout(fallbackTimeout);\n      return;\n    } else if (m.type === \"initialized\") {\n      // complete the missing fields\n      m.config = Object.assign({}, config, m.config);\n      m.origin = window.location.origin;\n      m.peer_id = peer_id;\n    } else if (m.type === \"imjoy_remote_api_ready\") {\n      // if it's a webworker, there will be no api object returned\n      window.dispatchEvent(new CustomEvent(\"imjoy_remote_api_ready\", {\n        detail: null\n      }));\n    } else if (m.type === \"cacheRequirements\" && typeof cache_requirements === \"function\") {\n      cache_requirements(m.requirements);\n    } else if (m.type === \"disconnect\") {\n      worker.terminate();\n    } else {\n      if (m.__transferables__) {\n        transferables = m.__transferables__;\n        delete m.__transferables__;\n      }\n    }\n\n    parent.postMessage(m, config.target_origin || \"*\", transferables);\n  });\n  window.addEventListener(\"message\", function (e) {\n    let transferables = undefined;\n    const m = e.data;\n\n    if (m.__transferables__) {\n      transferables = m.__transferables__;\n      delete m.__transferables__;\n    }\n\n    if (m.peer_id === peer_id) {\n      worker.postMessage(m, transferables);\n    } else if (config.debug) {\n      console.log(`connection peer id mismatch ${m.peer_id} !== ${peer_id}`);\n    }\n  });\n}\n\nfunction waitForInitialization(config) {\n  if (!_inIframe()) {\n    throw new Error(\"waitForInitialization (imjoy-rpc) should only run inside an iframe.\");\n  }\n\n  config = config || {};\n  const targetOrigin = config.target_origin || \"*\";\n\n  if (config.credential_required && typeof config.verify_credential !== \"function\") {\n    throw new Error(\"Please also provide the `verify_credential` function with `credential_required`.\");\n  }\n\n  if (config.credential_required && targetOrigin === \"*\") {\n    throw new Error(\"`target_origin` was set to `*` with `credential_required=true`, there is a security risk that you may leak the credential to website from other origin. Please specify the `target_origin` explicitly.\");\n  }\n\n  const done = () => {\n    window.removeEventListener(\"message\", handleEvent);\n  };\n\n  const peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])();\n\n  const handleEvent = e => {\n    if (e.type === \"message\" && (targetOrigin === \"*\" || e.origin === targetOrigin)) {\n      if (e.data.type === \"initialize\") {\n        done();\n\n        if (e.data.peer_id !== peer_id) {\n          // TODO: throw an error when we are sure all the peers will send the peer_id\n          console.warn(`${e.data.config && e.data.config.name}: connection peer id mismatch ${e.data.peer_id} !== ${peer_id}`);\n        }\n\n        const cfg = e.data.config; // override the target_origin setting if it's configured by the rpc client\n        // otherwise take the setting from the core\n\n        if (targetOrigin !== \"*\") {\n          cfg.target_origin = targetOrigin;\n        }\n\n        if (config.credential_required) {\n          config.verify_credential(cfg.credential).then(result => {\n            if (result && result.auth && !result.error) {\n              // pass the authentication information with tokens\n              cfg.auth = result.auth;\n              setupRPC(cfg).then(() => {\n                console.log(\"ImJoy RPC loaded successfully!\");\n              });\n            } else {\n              throw new Error(\"Failed to verify the credentail:\" + (result && result.error));\n            }\n          });\n        } else {\n          setupRPC(cfg).then(() => {\n            console.log(\"ImJoy RPC loaded successfully!\");\n          });\n        }\n      } else {\n        throw new Error(`unrecognized message: ${e.data}`);\n      }\n    }\n  };\n\n  window.addEventListener(\"message\", handleEvent);\n  parent.postMessage({\n    type: \"imjoyRPCReady\",\n    config: config,\n    peer_id: peer_id\n  }, \"*\");\n}\nfunction setupRPC(config) {\n  config = config || {};\n  if (!config.name) throw new Error(\"Please specify a name for your app.\");\n  config.version = config.version || \"0.1.0\";\n  config.description = config.description || `[TODO: add description for ${config.name} ]`;\n  config.type = config.type || \"rpc-window\";\n  config.id = config.id || Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"randId\"])();\n  config.allow_execution = config.allow_execution || false;\n\n  if (config.enable_service_worker) {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__[\"setupServiceWorker\"])(config.base_url, config.target_origin, config.cache_requirements);\n  }\n\n  if (config.cache_requirements) {\n    delete config.cache_requirements;\n  } // remove functions\n\n\n  config = Object.keys(config).reduce((p, c) => {\n    if (typeof config[c] !== \"function\") p[c] = config[c];\n    return p;\n  }, {});\n  return new Promise((resolve, reject) => {\n    if (_inIframe()) {\n      if (config.type === \"web-worker\") {\n        try {\n          setupWebWorker(config);\n        } catch (e) {\n          // fallback to iframe\n          Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n        }\n      } else if (config.type === \"web-python\" || config.type === \"web-python-window\") {\n        Object(_pluginWebPython_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(config);\n      } else if ([\"rpc-window\", \"rpc-worker\", \"iframe\", \"window\"].includes(config.type)) {\n        Object(_pluginIframe_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(config);\n      } else {\n        console.error(\"Unsupported plugin type: \" + config.type);\n        reject(\"Unsupported plugin type: \" + config.type);\n      }\n\n      try {\n        const handleEvent = e => {\n          const api = e.detail;\n\n          if (config.expose_api_globally) {\n            window.api = api;\n          } // imjoy plugin api\n\n\n          resolve(api);\n          window.removeEventListener(\"imjoy_remote_api_ready\", handleEvent);\n        };\n\n        window.addEventListener(\"imjoy_remote_api_ready\", handleEvent);\n      } catch (e) {\n        reject(e);\n      }\n    } else {\n      reject(new Error(\"imjoy-rpc should only run inside an iframe.\"));\n    }\n  });\n}\n\n/***/ }),\n\n/***/ \"./src/plugin.webworker.js\":\n/*!*********************************!*\\\n  !*** ./src/plugin.webworker.js ***!\n  \\*********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = function() {\n  return __webpack_require__(/*! !./node_modules/worker-loader/dist/workers/InlineWorker.js */ \"./node_modules/worker-loader/dist/workers/InlineWorker.js\")(\"/******/ (function(modules) { // webpackBootstrap\\n/******/ \\t// The module cache\\n/******/ \\tvar installedModules = {};\\n/******/\\n/******/ \\t// The require function\\n/******/ \\tfunction __webpack_require__(moduleId) {\\n/******/\\n/******/ \\t\\t// Check if module is in cache\\n/******/ \\t\\tif(installedModules[moduleId]) {\\n/******/ \\t\\t\\treturn installedModules[moduleId].exports;\\n/******/ \\t\\t}\\n/******/ \\t\\t// Create a new module (and put it into the cache)\\n/******/ \\t\\tvar module = installedModules[moduleId] = {\\n/******/ \\t\\t\\ti: moduleId,\\n/******/ \\t\\t\\tl: false,\\n/******/ \\t\\t\\texports: {}\\n/******/ \\t\\t};\\n/******/\\n/******/ \\t\\t// Execute the module function\\n/******/ \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n/******/\\n/******/ \\t\\t// Flag the module as loaded\\n/******/ \\t\\tmodule.l = true;\\n/******/\\n/******/ \\t\\t// Return the exports of the module\\n/******/ \\t\\treturn module.exports;\\n/******/ \\t}\\n/******/\\n/******/\\n/******/ \\t// expose the modules object (__webpack_modules__)\\n/******/ \\t__webpack_require__.m = modules;\\n/******/\\n/******/ \\t// expose the module cache\\n/******/ \\t__webpack_require__.c = installedModules;\\n/******/\\n/******/ \\t// define getter function for harmony exports\\n/******/ \\t__webpack_require__.d = function(exports, name, getter) {\\n/******/ \\t\\tif(!__webpack_require__.o(exports, name)) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n/******/ \\t\\t}\\n/******/ \\t};\\n/******/\\n/******/ \\t// define __esModule on exports\\n/******/ \\t__webpack_require__.r = function(exports) {\\n/******/ \\t\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n/******/ \\t\\t}\\n/******/ \\t\\tObject.defineProperty(exports, '__esModule', { value: true });\\n/******/ \\t};\\n/******/\\n/******/ \\t// create a fake namespace object\\n/******/ \\t// mode & 1: value is a module id, require it\\n/******/ \\t// mode & 2: merge all properties of value into the ns\\n/******/ \\t// mode & 4: return value when already ns object\\n/******/ \\t// mode & 8|1: behave like require\\n/******/ \\t__webpack_require__.t = function(value, mode) {\\n/******/ \\t\\tif(mode & 1) value = __webpack_require__(value);\\n/******/ \\t\\tif(mode & 8) return value;\\n/******/ \\t\\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\\n/******/ \\t\\tvar ns = Object.create(null);\\n/******/ \\t\\t__webpack_require__.r(ns);\\n/******/ \\t\\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\\n/******/ \\t\\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n/******/ \\t\\treturn ns;\\n/******/ \\t};\\n/******/\\n/******/ \\t// getDefaultExport function for compatibility with non-harmony modules\\n/******/ \\t__webpack_require__.n = function(module) {\\n/******/ \\t\\tvar getter = module && module.__esModule ?\\n/******/ \\t\\t\\tfunction getDefault() { return module['default']; } :\\n/******/ \\t\\t\\tfunction getModuleExports() { return module; };\\n/******/ \\t\\t__webpack_require__.d(getter, 'a', getter);\\n/******/ \\t\\treturn getter;\\n/******/ \\t};\\n/******/\\n/******/ \\t// Object.prototype.hasOwnProperty.call\\n/******/ \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n/******/\\n/******/ \\t// __webpack_public_path__\\n/******/ \\t__webpack_require__.p = \\\"\\\";\\n/******/\\n/******/\\n/******/ \\t// Load entry module and return exports\\n/******/ \\treturn __webpack_require__(__webpack_require__.s = \\\"./src/plugin.webworker.js\\\");\\n/******/ })\\n/************************************************************************/\\n/******/ ({\\n\\n/***/ \\\"./src/plugin.webworker.js\\\":\\n/*!*********************************!*\\\\\\n  !*** ./src/plugin.webworker.js ***!\\n  \\\\*********************************/\\n/*! no exports provided */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \\\"./src/pluginCore.js\\\");\\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \\\"./src/rpc.js\\\");\\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils.js */ \\\"./src/utils.js\\\");\\n/**\\n * Contains the routines loaded by the plugin Worker under web-browser.\\n *\\n * Initializes the web environment version of the platform-dependent\\n * connection object for the plugin site\\n */\\n\\n\\n\\n\\n(function() {\\n  // make sure this runs inside a webworker\\n  if (\\n    typeof WorkerGlobalScope === \\\"undefined\\\" ||\\n    !self ||\\n    !(self instanceof WorkerGlobalScope)\\n  ) {\\n    throw new Error(\\\"This script can only loaded in a webworker\\\");\\n  }\\n  /**\\n   * Connection object provided to the RPC constructor,\\n   * plugin site implementation for the web-based environment.\\n   * Global will be then cleared to prevent exposure into the\\n   * Worker, so we put this local connection object into a closure\\n   */\\n  class Connection extends _utils_js__WEBPACK_IMPORTED_MODULE_2__[\\\"MessageEmitter\\\"] {\\n    constructor(config) {\\n      super(config && config.debug);\\n      this.config = config || {};\\n    }\\n    connect() {\\n      self.addEventListener(\\\"message\\\", e => {\\n        this._fire(e.data.type, e.data);\\n      });\\n      this.emit({\\n        type: \\\"initialized\\\",\\n        config: this.config\\n      });\\n    }\\n    disconnect() {\\n      this._fire(\\\"beforeDisconnect\\\");\\n      self.close();\\n      this._fire(\\\"disconnected\\\");\\n    }\\n    emit(data) {\\n      let transferables = undefined;\\n      if (data.__transferables__) {\\n        transferables = data.__transferables__;\\n        delete data.__transferables__;\\n      }\\n      self.postMessage(data, transferables);\\n    }\\n    async execute(code) {\\n      if (code.type === \\\"requirements\\\") {\\n        try {\\n          if (\\n            code.requirements &&\\n            (Array.isArray(code.requirements) ||\\n              typeof code.requirements === \\\"string\\\")\\n          ) {\\n            try {\\n              if (!Array.isArray(code.requirements)) {\\n                code.requirements = [code.requirements];\\n              }\\n              for (var i = 0; i < code.requirements.length; i++) {\\n                if (\\n                  code.requirements[i].toLowerCase().endsWith(\\\".css\\\") ||\\n                  code.requirements[i].startsWith(\\\"css:\\\")\\n                ) {\\n                  throw \\\"unable to import css in a webworker\\\";\\n                } else if (\\n                  code.requirements[i].toLowerCase().endsWith(\\\".js\\\") ||\\n                  code.requirements[i].startsWith(\\\"js:\\\")\\n                ) {\\n                  if (code.requirements[i].startsWith(\\\"js:\\\")) {\\n                    code.requirements[i] = code.requirements[i].slice(3);\\n                  }\\n                  importScripts(code.requirements[i]);\\n                } else if (code.requirements[i].startsWith(\\\"http\\\")) {\\n                  importScripts(code.requirements[i]);\\n                } else if (code.requirements[i].startsWith(\\\"cache:\\\")) {\\n                  //ignore cache\\n                } else {\\n                  console.log(\\n                    \\\"Unprocessed requirements url: \\\" + code.requirements[i]\\n                  );\\n                }\\n              }\\n            } catch (e) {\\n              throw \\\"failed to import required scripts: \\\" +\\n                code.requirements.toString();\\n            }\\n          }\\n        } catch (e) {\\n          throw e;\\n        }\\n      } else if (code.type === \\\"script\\\") {\\n        try {\\n          if (\\n            code.requirements &&\\n            (Array.isArray(code.requirements) ||\\n              typeof code.requirements === \\\"string\\\")\\n          ) {\\n            try {\\n              if (Array.isArray(code.requirements)) {\\n                for (let i = 0; i < code.requirements.length; i++) {\\n                  importScripts(code.requirements[i]);\\n                }\\n              } else {\\n                importScripts(code.requirements);\\n              }\\n            } catch (e) {\\n              throw \\\"failed to import required scripts: \\\" +\\n                code.requirements.toString();\\n            }\\n          }\\n          eval(code.content);\\n        } catch (e) {\\n          console.error(e.message, e.stack);\\n          throw e;\\n        }\\n      } else {\\n        throw \\\"unsupported code type.\\\";\\n      }\\n      if (code.type === \\\"requirements\\\") {\\n        self.postMessage({\\n          type: \\\"cacheRequirements\\\",\\n          requirements: code.requirements\\n        });\\n      }\\n    }\\n  }\\n  const config = {\\n    type: \\\"web-worker\\\",\\n    dedicated_thread: true,\\n    allow_execution: true,\\n    lang: \\\"javascript\\\",\\n    api_version: _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\\\"API_VERSION\\\"]\\n  };\\n  const conn = new Connection(config);\\n  conn.on(\\\"connectRPC\\\", data => {\\n    Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\\\"connectRPC\\\"])(conn, Object.assign(data.config, config));\\n  });\\n  conn.connect();\\n  self.postMessage({\\n    type: \\\"worker-ready\\\"\\n  });\\n})();\\n\\n\\n/***/ }),\\n\\n/***/ \\\"./src/pluginCore.js\\\":\\n/*!***************************!*\\\\\\n  !*** ./src/pluginCore.js ***!\\n  \\\\***************************/\\n/*! exports provided: connectRPC */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"connectRPC\\\", function() { return connectRPC; });\\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rpc.js */ \\\"./src/rpc.js\\\");\\n/**\\n * Core plugin script loaded into the plugin process/thread.\\n *\\n * Initializes the plugin-site API global methods.\\n */\\n\\nfunction connectRPC(connection, config) {\\n  config = config || {};\\n  const codecs = {};\\n  const rpc = new _rpc_js__WEBPACK_IMPORTED_MODULE_0__[\\\"RPC\\\"](connection, config, codecs);\\n  rpc.on(\\\"getInterface\\\", function () {\\n    launchConnected();\\n  });\\n  rpc.on(\\\"remoteReady\\\", function () {\\n    const api = rpc.getRemote() || {};\\n\\n    if (api.export) {\\n      throw new Error(\\\"`export` is a reserved function name\\\");\\n    }\\n\\n    if (api.onload) {\\n      throw new Error(\\\"`onload` is a reserved function name\\\");\\n    }\\n\\n    if (api.dispose) {\\n      throw new Error(\\\"`dispose` is a reserved function name\\\");\\n    }\\n\\n    api.registerCodec = function (config) {\\n      if (!config[\\\"name\\\"] || !config[\\\"encoder\\\"] && !config[\\\"decoder\\\"]) {\\n        throw new Error(\\\"Invalid codec format, please make sure you provide a name, type, encoder and decoder.\\\");\\n      } else {\\n        if (config.type) {\\n          for (let k of Object.keys(codecs)) {\\n            if (codecs[k].type === config.type || k === config.name) {\\n              delete codecs[k];\\n              console.warn(\\\"Remove duplicated codec: \\\" + k);\\n            }\\n          }\\n        }\\n\\n        codecs[config[\\\"name\\\"]] = config;\\n      }\\n    };\\n\\n    api.disposeObject = function (obj) {\\n      rpc.disposeObject(obj);\\n    };\\n\\n    api.export = function (_interface, config) {\\n      rpc.setInterface(_interface, config);\\n    };\\n\\n    api.onLoad = function (handler) {\\n      handler = checkHandler(handler);\\n\\n      if (connected) {\\n        handler();\\n      } else {\\n        connectedHandlers.push(handler);\\n      }\\n    };\\n\\n    api.dispose = function (_interface) {\\n      rpc.disconnect();\\n    };\\n\\n    if (typeof WorkerGlobalScope !== \\\"undefined\\\" && self instanceof WorkerGlobalScope) {\\n      self.api = api;\\n      self.postMessage({\\n        type: \\\"imjoy_remote_api_ready\\\"\\n      });\\n    } else if (typeof window) {\\n      window.dispatchEvent(new CustomEvent(\\\"imjoy_remote_api_ready\\\", {\\n        detail: api\\n      }));\\n    }\\n  });\\n  let connected = false;\\n  const connectedHandlers = [];\\n\\n  const launchConnected = function () {\\n    if (!connected) {\\n      connected = true;\\n      let handler;\\n\\n      while (handler = connectedHandlers.pop()) {\\n        handler();\\n      }\\n    }\\n  };\\n\\n  const checkHandler = function (handler) {\\n    const type = typeof handler;\\n\\n    if (type !== \\\"function\\\") {\\n      const msg = \\\"A function may only be subsribed to the event, \\\" + type + \\\" was provided instead\\\";\\n      throw new Error(msg);\\n    }\\n\\n    return handler;\\n  };\\n\\n  return rpc;\\n}\\n\\n/***/ }),\\n\\n/***/ \\\"./src/rpc.js\\\":\\n/*!********************!*\\\\\\n  !*** ./src/rpc.js ***!\\n  \\\\********************/\\n/*! exports provided: API_VERSION, RPC */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"API_VERSION\\\", function() { return API_VERSION; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"RPC\\\", function() { return RPC; });\\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \\\"./src/utils.js\\\");\\n/**\\n * Contains the RPC object used both by the application\\n * site, and by each plugin\\n */\\n\\nconst API_VERSION = \\\"0.2.3\\\";\\nconst ArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor;\\n\\nfunction _appendBuffer(buffer1, buffer2) {\\n  const tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\\n  tmp.set(new Uint8Array(buffer1), 0);\\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\\n  return tmp.buffer;\\n}\\n\\nfunction indexObject(obj, is) {\\n  if (!is) throw new Error(\\\"undefined index\\\");\\n  if (typeof is === \\\"string\\\") return indexObject(obj, is.split(\\\".\\\"));else if (is.length === 0) return obj;else return indexObject(obj[is[0]], is.slice(1));\\n}\\n/**\\n * RPC object represents a single site in the\\n * communication protocol between the application and the plugin\\n *\\n * @param {Object} connection a special object allowing to send\\n * and receive messages from the opposite site (basically it\\n * should only provide send() and onMessage() methods)\\n */\\n\\n\\nclass RPC extends _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"MessageEmitter\\\"] {\\n  constructor(connection, config, codecs) {\\n    super(config && config.debug);\\n    this._connection = connection;\\n    this.config = config || {};\\n    this._codecs = codecs || {};\\n    this._object_store = {};\\n    this._method_weakmap = new WeakMap();\\n    this._object_weakmap = new WeakMap();\\n    this._local_api = null; // make sure there is an execute function\\n\\n    const name = this.config.name;\\n\\n    this._connection.execute = this._connection.execute || function () {\\n      throw new Error(`connection.execute not implemented (in \\\"${name}\\\")`);\\n    };\\n\\n    this._store = new ReferenceStore();\\n    this._method_refs = new ReferenceStore();\\n\\n    this._method_refs.onReady(() => {\\n      this._fire(\\\"remoteIdle\\\");\\n    });\\n\\n    this._method_refs.onBusy(() => {\\n      this._fire(\\\"remoteBusy\\\");\\n    });\\n\\n    this._setupMessageHanlders();\\n  }\\n\\n  init() {\\n    this._connection.emit({\\n      type: \\\"initialized\\\",\\n      config: this.config,\\n      peer_id: this._connection.peer_id\\n    });\\n  }\\n  /**\\n   * Set a handler to be called when received a responce from the\\n   * remote site reporting that the previously provided interface\\n   * has been successfully set as remote for that site\\n   *\\n   * @param {Function} handler\\n   */\\n\\n\\n  getRemoteCallStack() {\\n    return this._method_refs.getStack();\\n  }\\n  /**\\n   * @returns {Object} set of remote interface methods\\n   */\\n\\n\\n  getRemote() {\\n    return this._remote_interface;\\n  }\\n  /**\\n   * Sets the interface of this site making it available to the\\n   * remote site by sending a message with a set of methods names\\n   *\\n   * @param {Object} _interface to set\\n   */\\n\\n\\n  setInterface(_interface, config) {\\n    config = config || {};\\n    this.config.name = config.name || this.config.name;\\n    this.config.description = config.description || this.config.description;\\n\\n    if (this.config.forwarding_functions) {\\n      for (let func_name of this.config.forwarding_functions) {\\n        const _remote = this._remote_interface;\\n\\n        if (_remote[func_name]) {\\n          if (_interface.constructor === Object) {\\n            if (!_interface[func_name]) {\\n              _interface[func_name] = (...args) => {\\n                _remote[func_name](...args);\\n              };\\n            }\\n          } else if (_interface.constructor.constructor === Function) {\\n            if (!_interface.constructor.prototype[func_name]) {\\n              _interface.constructor.prototype[func_name] = (...args) => {\\n                _remote[func_name](...args);\\n              };\\n            }\\n          }\\n        }\\n      }\\n    }\\n\\n    this._local_api = _interface;\\n\\n    this._fire(\\\"interfaceAvailable\\\");\\n  }\\n  /**\\n   * Sends the actual interface to the remote site upon it was\\n   * updated or by a special request of the remote site\\n   */\\n\\n\\n  sendInterface() {\\n    if (!this._local_api) {\\n      throw new Error(\\\"interface is not set.\\\");\\n    }\\n\\n    this._encode(this._local_api, true).then(api => {\\n      this._connection.emit({\\n        type: \\\"setInterface\\\",\\n        api: api\\n      });\\n    });\\n  }\\n\\n  _disposeObject(objectId) {\\n    if (this._object_store[objectId]) {\\n      delete this._object_store[objectId];\\n    } else {\\n      throw new Error(`Object (id=${objectId}) not found.`);\\n    }\\n  }\\n\\n  disposeObject(obj) {\\n    return new Promise((resolve, reject) => {\\n      if (this._object_weakmap.has(obj)) {\\n        const objectId = this._object_weakmap.get(obj);\\n\\n        this._connection.once(\\\"disposed\\\", data => {\\n          if (data.error) reject(new Error(data.error));else resolve();\\n        });\\n\\n        this._connection.emit({\\n          type: \\\"disposeObject\\\",\\n          object_id: objectId\\n        });\\n      } else {\\n        throw new Error(\\\"Invalid object\\\");\\n      }\\n    });\\n  }\\n  /**\\n   * Handles a message from the remote site\\n   */\\n\\n\\n  _setupMessageHanlders() {\\n    this._connection.on(\\\"init\\\", this.init);\\n\\n    this._connection.on(\\\"execute\\\", data => {\\n      Promise.resolve(this._connection.execute(data.code)).then(() => {\\n        this._connection.emit({\\n          type: \\\"executed\\\"\\n        });\\n      }).catch(e => {\\n        console.error(e);\\n\\n        this._connection.emit({\\n          type: \\\"executed\\\",\\n          error: String(e)\\n        });\\n      });\\n    });\\n\\n    this._connection.on(\\\"method\\\", async data => {\\n      let resolve, reject, method, method_this, args, result;\\n\\n      try {\\n        if (data.promise) {\\n          [resolve, reject] = await this._unwrap(data.promise, false);\\n        }\\n\\n        const _interface = this._object_store[data.object_id];\\n        method = indexObject(_interface, data.name);\\n\\n        if (data.name.includes(\\\".\\\")) {\\n          const tmp = data.name.split(\\\".\\\");\\n          const intf_index = tmp.slice(0, tmp.length - 1).join(\\\".\\\");\\n          method_this = indexObject(_interface, intf_index);\\n        } else {\\n          method_this = _interface;\\n        }\\n\\n        args = await this._unwrap(data.args, true);\\n\\n        if (data.promise) {\\n          result = method.apply(method_this, args);\\n\\n          if (result instanceof Promise || method.constructor && method.constructor.name === \\\"AsyncFunction\\\") {\\n            result.then(resolve).catch(reject);\\n          } else {\\n            resolve(result);\\n          }\\n        } else {\\n          method.apply(method_this, args);\\n        }\\n      } catch (err) {\\n        console.error(this.config.name, err);\\n\\n        if (reject) {\\n          reject(err);\\n        }\\n      }\\n    });\\n\\n    this._connection.on(\\\"callback\\\", async data => {\\n      let resolve, reject, method, args, result;\\n\\n      try {\\n        if (data.promise) {\\n          [resolve, reject] = await this._unwrap(data.promise, false);\\n        }\\n\\n        if (data.promise) {\\n          method = this._store.fetch(data.id);\\n          args = await this._unwrap(data.args, true);\\n\\n          if (!method) {\\n            throw new Error(\\\"Callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\\\");\\n          }\\n\\n          result = method.apply(null, args);\\n\\n          if (result instanceof Promise || method.constructor && method.constructor.name === \\\"AsyncFunction\\\") {\\n            result.then(resolve).catch(reject);\\n          } else {\\n            resolve(result);\\n          }\\n        } else {\\n          method = this._store.fetch(data.id);\\n          args = await this._unwrap(data.args, true);\\n\\n          if (!method) {\\n            throw new Error(\\\"Please notice that callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\\\");\\n          }\\n\\n          method.apply(null, args);\\n        }\\n      } catch (err) {\\n        console.error(this.config.name, err);\\n\\n        if (reject) {\\n          reject(err);\\n        }\\n      }\\n    });\\n\\n    this._connection.on(\\\"disposeObject\\\", data => {\\n      try {\\n        this._disposeObject(data.object_id);\\n\\n        this._connection.emit({\\n          type: \\\"disposed\\\"\\n        });\\n      } catch (e) {\\n        console.error(e);\\n\\n        this._connection.emit({\\n          type: \\\"disposed\\\",\\n          error: String(e)\\n        });\\n      }\\n    });\\n\\n    this._connection.on(\\\"setInterface\\\", data => {\\n      this._setRemoteInterface(data.api);\\n    });\\n\\n    this._connection.on(\\\"getInterface\\\", () => {\\n      this._fire(\\\"getInterface\\\");\\n\\n      if (this._local_api) {\\n        this.sendInterface();\\n      } else {\\n        this.once(\\\"interfaceAvailable\\\", () => {\\n          this.sendInterface();\\n        });\\n      }\\n    });\\n\\n    this._connection.on(\\\"interfaceSetAsRemote\\\", () => {\\n      this._fire(\\\"interfaceSetAsRemote\\\");\\n    });\\n\\n    this._connection.on(\\\"disconnect\\\", () => {\\n      this._fire(\\\"beforeDisconnect\\\");\\n\\n      this._connection.disconnect();\\n\\n      this._fire(\\\"disconnected\\\");\\n    });\\n  }\\n  /**\\n   * Sends a requests to the remote site asking it to provide its\\n   * current interface\\n   */\\n\\n\\n  requestRemote() {\\n    this._connection.emit({\\n      type: \\\"getInterface\\\"\\n    });\\n  }\\n\\n  _ndarray(typedArray, shape, dtype) {\\n    const _dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][typedArray.constructor.name];\\n\\n    if (dtype && dtype !== _dtype) {\\n      throw \\\"dtype doesn't match the type of the array: \\\" + _dtype + \\\" != \\\" + dtype;\\n    }\\n\\n    shape = shape || [typedArray.length];\\n    return {\\n      _rtype: \\\"ndarray\\\",\\n      _rvalue: typedArray.buffer,\\n      _rshape: shape,\\n      _rdtype: _dtype\\n    };\\n  }\\n  /**\\n   * Sets the new remote interface provided by the other site\\n   *\\n   * @param {Array} names list of function names\\n   */\\n\\n\\n  _setRemoteInterface(api) {\\n    this._decode(api).then(intf => {\\n      this._remote_interface = intf;\\n\\n      this._fire(\\\"remoteReady\\\");\\n\\n      this._reportRemoteSet();\\n    });\\n  }\\n  /**\\n   * Generates the wrapped function corresponding to a single remote\\n   * method. When the generated function is called, it will send the\\n   * corresponding message to the remote site asking it to execute\\n   * the particular method of its interface\\n   *\\n   * @param {String} name of the remote method\\n   *\\n   * @returns {Function} wrapped remote method\\n   */\\n\\n\\n  _genRemoteMethod(targetId, name, objectId) {\\n    const me = this;\\n\\n    const remoteMethod = function () {\\n      return new Promise(async (resolve, reject) => {\\n        let id = null;\\n\\n        try {\\n          id = me._method_refs.put(objectId ? objectId + \\\"/\\\" + name : name);\\n\\n          const wrapped_resolve = function () {\\n            if (id !== null) me._method_refs.fetch(id);\\n            return resolve.apply(this, arguments);\\n          };\\n\\n          const wrapped_reject = function () {\\n            if (id !== null) me._method_refs.fetch(id);\\n            return reject.apply(this, arguments);\\n          };\\n\\n          const encodedPromise = await me._wrap([wrapped_resolve, wrapped_reject]); // store the key id for removing them from the reference store together\\n\\n          wrapped_resolve.__promise_pair = encodedPromise[1]._rvalue;\\n          wrapped_reject.__promise_pair = encodedPromise[0]._rvalue;\\n          let args = Array.prototype.slice.call(arguments);\\n\\n          if (name === \\\"register\\\" || name === \\\"export\\\" || name === \\\"on\\\") {\\n            args = await me._wrap(args, true);\\n          } else {\\n            args = await me._wrap(args);\\n          }\\n\\n          const transferables = args.__transferables__;\\n          if (transferables) delete args.__transferables__;\\n\\n          me._connection.emit({\\n            type: \\\"method\\\",\\n            target_id: targetId,\\n            name: name,\\n            object_id: objectId,\\n            args: args,\\n            promise: encodedPromise\\n          }, transferables);\\n        } catch (e) {\\n          if (id) me._method_refs.fetch(id);\\n          reject(`Failed to exectue remote method (interface: ${objectId || me.id}, method: ${name}), error: ${e}`);\\n        }\\n      });\\n    };\\n\\n    remoteMethod.__remote_method = true;\\n    return remoteMethod;\\n  }\\n  /**\\n   * Sends a responce reporting that interface just provided by the\\n   * remote site was successfully set by this site as remote\\n   */\\n\\n\\n  _reportRemoteSet() {\\n    this._connection.emit({\\n      type: \\\"interfaceSetAsRemote\\\"\\n    });\\n  }\\n  /**\\n   * Prepares the provided set of remote method arguments for\\n   * sending to the remote site, replaces all the callbacks with\\n   * identifiers\\n   *\\n   * @param {Array} args to wrap\\n   *\\n   * @returns {Array} wrapped arguments\\n   */\\n\\n\\n  async _encode(aObject, asInterface, objectId) {\\n    const aType = typeof aObject;\\n\\n    if (aType === \\\"number\\\" || aType === \\\"string\\\" || aType === \\\"boolean\\\" || aObject === null || aObject === undefined || aObject instanceof ArrayBuffer) {\\n      return aObject;\\n    }\\n\\n    let bObject;\\n\\n    if (typeof aObject === \\\"function\\\") {\\n      if (asInterface) {\\n        if (!objectId) throw new Error(\\\"objectId is not specified.\\\");\\n        bObject = {\\n          _rtype: \\\"interface\\\",\\n          _rtarget_id: this._connection.peer_id,\\n          _rintf: objectId,\\n          _rvalue: asInterface\\n        };\\n\\n        this._method_weakmap.set(aObject, bObject);\\n      } else if (this._method_weakmap.has(aObject)) {\\n        bObject = this._method_weakmap.get(aObject);\\n      } else {\\n        const cid = this._store.put(aObject);\\n\\n        bObject = {\\n          _rtype: \\\"callback\\\",\\n          _rtarget_id: this._connection.peer_id,\\n          _rname: aObject.constructor && aObject.constructor.name || cid,\\n          _rvalue: cid\\n        };\\n      }\\n\\n      return bObject;\\n    } // skip if already encoded\\n\\n\\n    if (aObject.constructor instanceof Object && aObject._rtype) {\\n      // make sure the interface functions are encoded\\n      if (aObject._rintf) {\\n        const temp = aObject._rtype;\\n        delete aObject._rtype;\\n        bObject = await this._encode(aObject, asInterface, objectId);\\n        bObject._rtype = temp;\\n      } else {\\n        bObject = aObject;\\n      }\\n\\n      return bObject;\\n    }\\n\\n    const transferables = [];\\n    const _transfer = aObject._transfer;\\n    const isarray = Array.isArray(aObject);\\n\\n    for (let tp of Object.keys(this._codecs)) {\\n      const codec = this._codecs[tp];\\n\\n      if (codec.encoder && aObject instanceof codec.type) {\\n        // TODO: what if multiple encoders found\\n        let encodedObj = await Promise.resolve(codec.encoder(aObject));\\n        if (encodedObj && !encodedObj._rtype) encodedObj._rtype = codec.name; // encode the functions in the interface object\\n\\n        if (encodedObj && encodedObj._rintf) {\\n          const temp = encodedObj._rtype;\\n          delete encodedObj._rtype;\\n          encodedObj = await this._encode(encodedObj, asInterface, objectId);\\n          encodedObj._rtype = temp;\\n        }\\n\\n        bObject = encodedObj;\\n        return bObject;\\n      }\\n    }\\n\\n    if (\\n    /*global tf*/\\n    typeof tf !== \\\"undefined\\\" && tf.Tensor && aObject instanceof tf.Tensor) {\\n      const v_buffer = aObject.dataSync();\\n\\n      if (aObject._transfer || _transfer) {\\n        transferables.push(v_buffer.buffer);\\n        delete aObject._transfer;\\n      }\\n\\n      bObject = {\\n        _rtype: \\\"ndarray\\\",\\n        _rvalue: v_buffer.buffer,\\n        _rshape: aObject.shape,\\n        _rdtype: aObject.dtype\\n      };\\n    } else if (\\n    /*global nj*/\\n    typeof nj !== \\\"undefined\\\" && nj.NdArray && aObject instanceof nj.NdArray) {\\n      const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][aObject.selection.data.constructor.name];\\n\\n      if (aObject._transfer || _transfer) {\\n        transferables.push(aObject.selection.data.buffer);\\n        delete aObject._transfer;\\n      }\\n\\n      bObject = {\\n        _rtype: \\\"ndarray\\\",\\n        _rvalue: aObject.selection.data.buffer,\\n        _rshape: aObject.shape,\\n        _rdtype: dtype\\n      };\\n    } else if (aObject instanceof Error) {\\n      console.error(aObject);\\n      bObject = {\\n        _rtype: \\\"error\\\",\\n        _rvalue: aObject.toString()\\n      };\\n    } else if (typeof File !== \\\"undefined\\\" && aObject instanceof File) {\\n      bObject = {\\n        _rtype: \\\"file\\\",\\n        _rvalue: aObject,\\n        _rpath: aObject._path || aObject.webkitRelativePath\\n      };\\n    } // send objects supported by structure clone algorithm\\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\\n    else if (aObject !== Object(aObject) || aObject instanceof Boolean || aObject instanceof String || aObject instanceof Date || aObject instanceof RegExp || aObject instanceof ImageData || typeof FileList !== \\\"undefined\\\" && aObject instanceof FileList) {\\n        bObject = aObject; // TODO: avoid object such as DynamicPlugin instance.\\n      } else if (typeof File !== \\\"undefined\\\" && aObject instanceof File) {\\n        bObject = {\\n          _rtype: \\\"file\\\",\\n          _rname: aObject.name,\\n          _rmime: aObject.type,\\n          _rvalue: aObject,\\n          _rpath: aObject._path || aObject.webkitRelativePath\\n        };\\n      } else if (aObject instanceof Blob) {\\n        bObject = {\\n          _rtype: \\\"blob\\\",\\n          _rvalue: aObject\\n        };\\n      } else if (aObject instanceof ArrayBufferView) {\\n        if (aObject._transfer || _transfer) {\\n          transferables.push(aObject.buffer);\\n          delete aObject._transfer;\\n        }\\n\\n        const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"typedArrayToDtype\\\"][aObject.constructor.name];\\n        bObject = {\\n          _rtype: \\\"typedarray\\\",\\n          _rvalue: aObject.buffer,\\n          _rdtype: dtype\\n        };\\n      } else if (aObject instanceof DataView) {\\n        if (aObject._transfer || _transfer) {\\n          transferables.push(aObject.buffer);\\n          delete aObject._transfer;\\n        }\\n\\n        bObject = {\\n          _rtype: \\\"memoryview\\\",\\n          _rvalue: aObject.buffer\\n        };\\n      } else if (aObject instanceof Set) {\\n        bObject = {\\n          _rtype: \\\"set\\\",\\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\\n        };\\n      } else if (aObject instanceof Map) {\\n        bObject = {\\n          _rtype: \\\"orderedmap\\\",\\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\\n        };\\n      } else if (aObject.constructor instanceof Object || Array.isArray(aObject)) {\\n        bObject = isarray ? [] : {};\\n        let keys; // an object/array\\n\\n        if (aObject.constructor === Object || Array.isArray(aObject)) {\\n          keys = Object.keys(aObject);\\n        } // a class\\n        else if (aObject.constructor === Function) {\\n            throw new Error(\\\"Please instantiate the class before exportting it.\\\");\\n          } // instance of a class\\n          else if (aObject.constructor.constructor === Function) {\\n              keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject)); // TODO: use a proxy object to represent the actual object\\n              // always encode class instance as interface\\n\\n              asInterface = true;\\n            } else {\\n              throw Error(\\\"Unsupported interface type\\\");\\n            } // encode interfaces\\n\\n\\n        if (aObject._rintf || asInterface) {\\n          if (!objectId) {\\n            objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"randId\\\"])();\\n            this._object_store[objectId] = aObject;\\n          }\\n\\n          for (let k of keys) {\\n            if (k === \\\"constructor\\\") continue;\\n\\n            if (k.startsWith(\\\"_\\\")) {\\n              continue;\\n            }\\n\\n            bObject[k] = await this._encode(aObject[k], typeof asInterface === \\\"string\\\" ? asInterface + \\\".\\\" + k : k, objectId);\\n          } // object id for dispose the object remotely\\n\\n\\n          bObject._rintf = objectId; // remove interface when closed\\n\\n          if (aObject.on && typeof aObject.on === \\\"function\\\") {\\n            aObject.on(\\\"close\\\", () => {\\n              delete this._object_store[objectId];\\n            });\\n          }\\n        } else {\\n          for (let k of keys) {\\n            if ([\\\"hasOwnProperty\\\", \\\"constructor\\\"].includes(k)) continue;\\n            bObject[k] = await this._encode(aObject[k]);\\n          }\\n        } // for example, browserFS object\\n\\n      } else if (typeof aObject === \\\"object\\\") {\\n        const keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject));\\n        const objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"randId\\\"])();\\n\\n        for (let k of keys) {\\n          if ([\\\"hasOwnProperty\\\", \\\"constructor\\\"].includes(k)) continue; // encode as interface\\n\\n          bObject[k] = await this._encode(aObject[k], k, bObject);\\n        } // object id, used for dispose the object\\n\\n\\n        bObject._rintf = objectId;\\n      } else {\\n        throw \\\"imjoy-rpc: Unsupported data type:\\\" + aObject;\\n      }\\n\\n    if (transferables.length > 0) {\\n      bObject.__transferables__ = transferables;\\n    }\\n\\n    if (!bObject) {\\n      throw new Error(\\\"Failed to encode object\\\");\\n    }\\n\\n    return bObject;\\n  }\\n\\n  async _decode(aObject, withPromise) {\\n    if (!aObject) {\\n      return aObject;\\n    }\\n\\n    let bObject;\\n\\n    if (aObject[\\\"_rtype\\\"]) {\\n      if (this._codecs[aObject._rtype] && this._codecs[aObject._rtype].decoder) {\\n        if (aObject._rintf) {\\n          const temp = aObject._rtype;\\n          delete aObject._rtype;\\n          aObject = await this._decode(aObject, withPromise);\\n          aObject._rtype = temp;\\n        }\\n\\n        bObject = await Promise.resolve(this._codecs[aObject._rtype].decoder(aObject));\\n      } else if (aObject._rtype === \\\"callback\\\") {\\n        bObject = this._genRemoteCallback(aObject._rtarget_id, aObject._rvalue, withPromise);\\n      } else if (aObject._rtype === \\\"interface\\\") {\\n        bObject = this._genRemoteMethod(aObject._rtarget_id, aObject._rvalue, aObject._rintf);\\n      } else if (aObject._rtype === \\\"ndarray\\\") {\\n        /*global nj tf*/\\n        //create build array/tensor if used in the plugin\\n        if (typeof nj !== \\\"undefined\\\" && nj.array) {\\n          if (Array.isArray(aObject._rvalue)) {\\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\\n          }\\n\\n          bObject = nj.array(new Uint8(aObject._rvalue), aObject._rdtype).reshape(aObject._rshape);\\n        } else if (typeof tf !== \\\"undefined\\\" && tf.Tensor) {\\n          if (Array.isArray(aObject._rvalue)) {\\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\\n          }\\n\\n          const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"dtypeToTypedArray\\\"][aObject._rdtype]);\\n          bObject = tf.tensor(new arraytype(aObject._rvalue), aObject._rshape, aObject._rdtype);\\n        } else {\\n          //keep it as regular if transfered to the main app\\n          bObject = aObject;\\n        }\\n      } else if (aObject._rtype === \\\"error\\\") {\\n        bObject = new Error(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"file\\\") {\\n        if (aObject._rvalue instanceof File) {\\n          bObject = aObject._rvalue; //patch _path\\n\\n          bObject._path = aObject._rpath;\\n        } else {\\n          bObject = new File([aObject._rvalue], aObject._rname, {\\n            type: aObject._rmime\\n          });\\n          bObject._path = aObject._rpath;\\n        }\\n      } else if (aObject._rtype === \\\"typedarray\\\") {\\n        const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\\\"dtypeToTypedArray\\\"][aObject._rdtype]);\\n        if (!arraytype) throw new Error(\\\"unsupported dtype: \\\" + aObject._rdtype);\\n        bObject = new arraytype(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"memoryview\\\") {\\n        bObject = new DataView(aObject._rvalue);\\n      } else if (aObject._rtype === \\\"blob\\\") {\\n        if (aObject._rvalue instanceof Blob) {\\n          bObject = aObject._rvalue;\\n        } else {\\n          bObject = new Blob([aObject._rvalue], {\\n            type: aObject._rmime\\n          });\\n        }\\n      } else if (aObject._rtype === \\\"orderedmap\\\") {\\n        bObject = new Map((await this._decode(aObject._rvalue, withPromise)));\\n      } else if (aObject._rtype === \\\"set\\\") {\\n        bObject = new Set((await this._decode(aObject._rvalue, withPromise)));\\n      } else {\\n        // make sure all the interface functions are decoded\\n        if (aObject._rintf) {\\n          const temp = aObject._rtype;\\n          delete aObject._rtype;\\n          aObject = await this._decode(aObject, withPromise);\\n          aObject._rtype = temp;\\n        }\\n\\n        bObject = aObject;\\n      }\\n    } else if (aObject.constructor === Object || Array.isArray(aObject)) {\\n      const isarray = Array.isArray(aObject);\\n      bObject = isarray ? [] : {};\\n\\n      for (let k of Object.keys(aObject)) {\\n        if (isarray || aObject.hasOwnProperty(k)) {\\n          const v = aObject[k];\\n          bObject[k] = await this._decode(v, withPromise);\\n        }\\n      }\\n    } else {\\n      bObject = aObject;\\n    }\\n\\n    if (bObject === undefined) {\\n      throw new Error(\\\"Failed to decode object\\\");\\n    } // store the object id for dispose\\n\\n\\n    if (aObject._rintf) {\\n      this._object_weakmap.set(bObject, aObject._rintf);\\n    }\\n\\n    return bObject;\\n  }\\n\\n  async _wrap(args, asInterface) {\\n    return await this._encode(args, asInterface);\\n  }\\n  /**\\n   * Unwraps the set of arguments delivered from the remote site,\\n   * replaces all callback identifiers with a function which will\\n   * initiate sending that callback identifier back to other site\\n   *\\n   * @param {Object} args to unwrap\\n   *\\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\\n   *\\n   * @returns {Array} unwrapped args\\n   */\\n\\n\\n  async _unwrap(args, withPromise) {\\n    return await this._decode(args, withPromise);\\n  }\\n  /**\\n   * Generates the wrapped function corresponding to a single remote\\n   * callback. When the generated function is called, it will send\\n   * the corresponding message to the remote site asking it to\\n   * execute the particular callback previously saved during a call\\n   * by the remote site a method from the interface of this site\\n   *\\n   * @param {Number} id of the remote callback to execute\\n   * @param {Number} argNum argument index of the callback\\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\\n   *\\n   * @returns {Function} wrapped remote callback\\n   */\\n\\n\\n  _genRemoteCallback(targetId, cid, withPromise) {\\n    const me = this;\\n    let remoteCallback;\\n\\n    if (withPromise) {\\n      remoteCallback = function () {\\n        return new Promise(async (resolve, reject) => {\\n          const args = await me._wrap(Array.prototype.slice.call(arguments));\\n          const transferables = args.__transferables__;\\n          if (transferables) delete args.__transferables__;\\n          const encodedPromise = await me._wrap([resolve, reject]); // store the key id for removing them from the reference store together\\n\\n          resolve.__promise_pair = encodedPromise[1]._rvalue;\\n          reject.__promise_pair = encodedPromise[0]._rvalue;\\n\\n          try {\\n            me._connection.emit({\\n              type: \\\"callback\\\",\\n              target_id: targetId,\\n              id: cid,\\n              args: args,\\n              promise: encodedPromise\\n            }, transferables);\\n          } catch (e) {\\n            reject(`Failed to exectue remote callback ( id: ${cid}).`);\\n          }\\n        });\\n      };\\n\\n      return remoteCallback;\\n    } else {\\n      remoteCallback = async function () {\\n        const args = await me._wrap(Array.prototype.slice.call(arguments));\\n        const transferables = args.__transferables__;\\n        if (transferables) delete args.__transferables__;\\n        return me._connection.emit({\\n          type: \\\"callback\\\",\\n          target_id: targetId,\\n          id: cid,\\n          args: args\\n        }, transferables);\\n      };\\n\\n      return remoteCallback;\\n    }\\n  }\\n  /**\\n   * Sends the notification message and breaks the connection\\n   */\\n\\n\\n  disconnect() {\\n    this._connection.emit({\\n      type: \\\"disconnect\\\"\\n    });\\n\\n    setTimeout(() => {\\n      this._connection.disconnect();\\n    }, 2000);\\n  }\\n\\n}\\n/**\\n * ReferenceStore is a special object which stores other objects\\n * and provides the references (number) instead. This reference\\n * may then be sent over a json-based communication channel (IPC\\n * to another Node.js process or a message to the Worker). Other\\n * site may then provide the reference in the responce message\\n * implying the given object should be activated.\\n *\\n * Primary usage for the ReferenceStore is a storage for the\\n * callbacks, which therefore makes it possible to initiate a\\n * callback execution by the opposite site (which normally cannot\\n * directly execute functions over the communication channel).\\n *\\n * Each stored object can only be fetched once and is not\\n * available for the second time. Each stored object must be\\n * fetched, since otherwise it will remain stored forever and\\n * consume memory.\\n *\\n * Stored object indeces are simply the numbers, which are however\\n * released along with the objects, and are later reused again (in\\n * order to postpone the overflow, which should not likely happen,\\n * but anyway).\\n */\\n\\nclass ReferenceStore {\\n  constructor() {\\n    this._store = {}; // stored object\\n\\n    this._indices = [0]; // smallest available indices\\n\\n    this._readyHandler = function () {};\\n\\n    this._busyHandler = function () {};\\n\\n    this._readyHandler();\\n  }\\n  /**\\n   * call handler when the store is empty\\n   *\\n   * @param {FUNCTION} id of a handler\\n   */\\n\\n\\n  onReady(readyHandler) {\\n    this._readyHandler = readyHandler || function () {};\\n  }\\n  /**\\n   * call handler when the store is not empty\\n   *\\n   * @param {FUNCTION} id of a handler\\n   */\\n\\n\\n  onBusy(busyHandler) {\\n    this._busyHandler = busyHandler || function () {};\\n  }\\n  /**\\n   * get the length of the store\\n   *\\n   */\\n\\n\\n  getStack() {\\n    return Object.keys(this._store).length;\\n  }\\n  /**\\n   * @function _genId() generates the new reference id\\n   *\\n   * @returns {Number} smallest available id and reserves it\\n   */\\n\\n\\n  _genId() {\\n    let id;\\n\\n    if (this._indices.length === 1) {\\n      id = this._indices[0]++;\\n    } else {\\n      id = this._indices.shift();\\n    }\\n\\n    return id;\\n  }\\n  /**\\n   * Releases the given reference id so that it will be available by\\n   * another object stored\\n   *\\n   * @param {Number} id to release\\n   */\\n\\n\\n  _releaseId(id) {\\n    for (let i = 0; i < this._indices.length; i++) {\\n      if (id < this._indices[i]) {\\n        this._indices.splice(i, 0, id);\\n\\n        break;\\n      }\\n    } // cleaning-up the sequence tail\\n\\n\\n    for (let i = this._indices.length - 1; i >= 0; i--) {\\n      if (this._indices[i] - 1 === this._indices[i - 1]) {\\n        this._indices.pop();\\n      } else {\\n        break;\\n      }\\n    }\\n  }\\n  /**\\n   * Stores the given object and returns the refernce id instead\\n   *\\n   * @param {Object} obj to store\\n   *\\n   * @returns {Number} reference id of the stored object\\n   */\\n\\n\\n  put(obj) {\\n    if (this._busyHandler && Object.keys(this._store).length === 0) {\\n      this._busyHandler();\\n    }\\n\\n    const id = this._genId();\\n\\n    this._store[id] = obj;\\n    return id;\\n  }\\n  /**\\n   * Retrieves previously stored object and releases its reference\\n   *\\n   * @param {Number} id of an object to retrieve\\n   */\\n\\n\\n  fetch(id) {\\n    const obj = this._store[id];\\n\\n    if (obj && !obj.__remote_method) {\\n      delete this._store[id];\\n\\n      this._releaseId(id);\\n\\n      if (this._readyHandler && Object.keys(this._store).length === 0) {\\n        this._readyHandler();\\n      }\\n    }\\n\\n    if (obj && obj.__promise_pair) {\\n      this.fetch(obj.__promise_pair);\\n    }\\n\\n    return obj;\\n  }\\n\\n}\\n\\n/***/ }),\\n\\n/***/ \\\"./src/utils.js\\\":\\n/*!**********************!*\\\\\\n  !*** ./src/utils.js ***!\\n  \\\\**********************/\\n/*! exports provided: randId, dtypeToTypedArray, typedArrayToDtype, cacheRequirements, setupServiceWorker, urlJoin, MessageEmitter */\\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\\n\\n\\\"use strict\\\";\\n__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"randId\\\", function() { return randId; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"dtypeToTypedArray\\\", function() { return dtypeToTypedArray; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"typedArrayToDtype\\\", function() { return typedArrayToDtype; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"cacheRequirements\\\", function() { return cacheRequirements; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"setupServiceWorker\\\", function() { return setupServiceWorker; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"urlJoin\\\", function() { return urlJoin; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"MessageEmitter\\\", function() { return MessageEmitter; });\\nfunction randId() {\\n  return Math.random().toString(36).substr(2, 10) + new Date().getTime();\\n}\\nconst dtypeToTypedArray = {\\n  int8: \\\"Int8Array\\\",\\n  int16: \\\"Int16Array\\\",\\n  int32: \\\"Int32Array\\\",\\n  uint8: \\\"Uint8Array\\\",\\n  uint16: \\\"Uint16Array\\\",\\n  uint32: \\\"Uint32Array\\\",\\n  float32: \\\"Float32Array\\\",\\n  float64: \\\"Float64Array\\\",\\n  array: \\\"Array\\\"\\n};\\nconst typedArrayToDtype = {\\n  Int8Array: \\\"int8\\\",\\n  Int16Array: \\\"int16\\\",\\n  Int32Array: \\\"int32\\\",\\n  Uint8Array: \\\"uint8\\\",\\n  Uint16Array: \\\"uint16\\\",\\n  Uint32Array: \\\"uint32\\\",\\n  Float32Array: \\\"float32\\\",\\n  Float64Array: \\\"float64\\\",\\n  Array: \\\"array\\\"\\n};\\n\\nfunction cacheUrlInServiceWorker(url) {\\n  return new Promise(function (resolve, reject) {\\n    const message = {\\n      command: \\\"add\\\",\\n      url: url\\n    };\\n\\n    if (!navigator.serviceWorker || !navigator.serviceWorker.register) {\\n      reject(\\\"Service worker is not supported.\\\");\\n      return;\\n    }\\n\\n    const messageChannel = new MessageChannel();\\n\\n    messageChannel.port1.onmessage = function (event) {\\n      if (event.data && event.data.error) {\\n        reject(event.data.error);\\n      } else {\\n        resolve(event.data && event.data.result);\\n      }\\n    };\\n\\n    if (navigator.serviceWorker && navigator.serviceWorker.controller) {\\n      navigator.serviceWorker.controller.postMessage(message, [messageChannel.port2]);\\n    } else {\\n      reject(\\\"Service worker controller is not available\\\");\\n    }\\n  });\\n}\\n\\nasync function cacheRequirements(requirements) {\\n  if (!Array.isArray(requirements)) {\\n    requirementsm.code.requirements = [requirements];\\n  }\\n\\n  if (requirements && requirements.length > 0) {\\n    for (let req of requirements) {\\n      //remove prefix\\n      if (req.startsWith(\\\"js:\\\")) req = req.slice(3);\\n      if (req.startsWith(\\\"css:\\\")) req = req.slice(4);\\n      if (req.startsWith(\\\"cache:\\\")) req = req.slice(6);\\n      if (!req.startsWith(\\\"http\\\")) continue;\\n      await cacheUrlInServiceWorker(req).catch(e => {\\n        console.error(e);\\n      });\\n    }\\n  }\\n}\\nfunction setupServiceWorker(baseUrl, targetOrigin, cacheCallback) {\\n  // register service worker for offline access\\n  if (\\\"serviceWorker\\\" in navigator) {\\n    baseUrl = baseUrl || \\\"/\\\";\\n    navigator.serviceWorker.register(baseUrl + \\\"plugin-service-worker.js\\\").then(function (registration) {\\n      // Registration was successful\\n      console.log(\\\"ServiceWorker registration successful with scope: \\\", registration.scope);\\n    }, function (err) {\\n      // registration failed :(\\n      console.log(\\\"ServiceWorker registration failed: \\\", err);\\n    });\\n    targetOrigin = targetOrigin || \\\"*\\\";\\n    cacheCallback = cacheCallback || cacheRequirements;\\n\\n    if (cacheCallback && typeof cacheCallback !== \\\"function\\\") {\\n      throw new Error(\\\"config.cache_requirements must be a function\\\");\\n    }\\n\\n    window.addEventListener(\\\"message\\\", function (e) {\\n      if (targetOrigin === \\\"*\\\" || e.origin === targetOrigin) {\\n        const m = e.data;\\n\\n        if (m.type === \\\"cacheRequirements\\\") {\\n          cacheCallback(m.requirements);\\n        }\\n      }\\n    });\\n  }\\n} //#Source https://bit.ly/2neWfJ2\\n\\nfunction urlJoin(...args) {\\n  return args.join(\\\"/\\\").replace(/[\\\\/]+/g, \\\"/\\\").replace(/^(.+):\\\\//, \\\"$1://\\\").replace(/^file:/, \\\"file:/\\\").replace(/\\\\/(\\\\?|&|#[^!])/g, \\\"$1\\\").replace(/\\\\?/g, \\\"&\\\").replace(\\\"&\\\", \\\"?\\\");\\n}\\nclass MessageEmitter {\\n  constructor(debug) {\\n    this._event_handlers = {};\\n    this._once_handlers = {};\\n    this._debug = debug;\\n  }\\n\\n  emit() {\\n    throw new Error(\\\"emit is not implemented\\\");\\n  }\\n\\n  on(event, handler) {\\n    if (!this._event_handlers[event]) {\\n      this._event_handlers[event] = [];\\n    }\\n\\n    this._event_handlers[event].push(handler);\\n  }\\n\\n  once(event, handler) {\\n    handler.___event_run_once = true;\\n    this.on(event, handler);\\n  }\\n\\n  off(event, handler) {\\n    if (!event && !handler) {\\n      // remove all events handlers\\n      this._event_handlers = {};\\n    } else if (event && !handler) {\\n      // remove all hanlders for the event\\n      if (this._event_handlers[event]) this._event_handlers[event] = [];\\n    } else {\\n      // remove a specific handler\\n      if (this._event_handlers[event]) {\\n        const idx = this._event_handlers[event].indexOf(handler);\\n\\n        if (idx >= 0) {\\n          this._event_handlers[event].splice(idx, 1);\\n        }\\n      }\\n    }\\n  }\\n\\n  _fire(event, data) {\\n    if (this._event_handlers[event]) {\\n      var i = this._event_handlers[event].length;\\n\\n      while (i--) {\\n        const handler = this._event_handlers[event][i];\\n\\n        try {\\n          handler(data);\\n        } catch (e) {\\n          console.error(e);\\n        } finally {\\n          if (handler.___event_run_once) {\\n            this._event_handlers[event].splice(i, 1);\\n          }\\n        }\\n      }\\n    } else {\\n      if (this._debug) {\\n        console.warn(\\\"unhandled event\\\", event, data);\\n      }\\n    }\\n  }\\n\\n}\\n\\n/***/ })\\n\\n/******/ });\\n//# sourceMappingURL=plugin.webworker.js.map\", null);\n};\n\n/***/ }),\n\n/***/ \"./src/pluginCore.js\":\n/*!***************************!*\\\n  !*** ./src/pluginCore.js ***!\n  \\***************************/\n/*! exports provided: connectRPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"connectRPC\", function() { return connectRPC; });\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/**\n * Core plugin script loaded into the plugin process/thread.\n *\n * Initializes the plugin-site API global methods.\n */\n\nfunction connectRPC(connection, config) {\n  config = config || {};\n  const codecs = {};\n  const rpc = new _rpc_js__WEBPACK_IMPORTED_MODULE_0__[\"RPC\"](connection, config, codecs);\n  rpc.on(\"getInterface\", function () {\n    launchConnected();\n  });\n  rpc.on(\"remoteReady\", function () {\n    const api = rpc.getRemote() || {};\n\n    if (api.export) {\n      throw new Error(\"`export` is a reserved function name\");\n    }\n\n    if (api.onload) {\n      throw new Error(\"`onload` is a reserved function name\");\n    }\n\n    if (api.dispose) {\n      throw new Error(\"`dispose` is a reserved function name\");\n    }\n\n    api.registerCodec = function (config) {\n      if (!config[\"name\"] || !config[\"encoder\"] && !config[\"decoder\"]) {\n        throw new Error(\"Invalid codec format, please make sure you provide a name, type, encoder and decoder.\");\n      } else {\n        if (config.type) {\n          for (let k of Object.keys(codecs)) {\n            if (codecs[k].type === config.type || k === config.name) {\n              delete codecs[k];\n              console.warn(\"Remove duplicated codec: \" + k);\n            }\n          }\n        }\n\n        codecs[config[\"name\"]] = config;\n      }\n    };\n\n    api.disposeObject = function (obj) {\n      rpc.disposeObject(obj);\n    };\n\n    api.export = function (_interface, config) {\n      rpc.setInterface(_interface, config);\n    };\n\n    api.onLoad = function (handler) {\n      handler = checkHandler(handler);\n\n      if (connected) {\n        handler();\n      } else {\n        connectedHandlers.push(handler);\n      }\n    };\n\n    api.dispose = function (_interface) {\n      rpc.disconnect();\n    };\n\n    if (typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope) {\n      self.api = api;\n      self.postMessage({\n        type: \"imjoy_remote_api_ready\"\n      });\n    } else if (typeof window) {\n      window.dispatchEvent(new CustomEvent(\"imjoy_remote_api_ready\", {\n        detail: api\n      }));\n    }\n  });\n  let connected = false;\n  const connectedHandlers = [];\n\n  const launchConnected = function () {\n    if (!connected) {\n      connected = true;\n      let handler;\n\n      while (handler = connectedHandlers.pop()) {\n        handler();\n      }\n    }\n  };\n\n  const checkHandler = function (handler) {\n    const type = typeof handler;\n\n    if (type !== \"function\") {\n      const msg = \"A function may only be subsribed to the event, \" + type + \" was provided instead\";\n      throw new Error(msg);\n    }\n\n    return handler;\n  };\n\n  return rpc;\n}\n\n/***/ }),\n\n/***/ \"./src/pluginIframe.js\":\n/*!*****************************!*\\\n  !*** ./src/pluginIframe.js ***!\n  \\*****************************/\n/*! exports provided: Connection, default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Connection\", function() { return Connection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return setupIframe; });\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \"./src/pluginCore.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/**\n * Contains the routines loaded by the plugin iframe under web-browser\n * in case when worker failed to initialize\n *\n * Initializes the web environment version of the platform-dependent\n * connection object for the plugin site\n */\n\n\n // Create a new, plain <span> element\n\nfunction _htmlToElement(html) {\n  var template = document.createElement(\"template\");\n  html = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = html;\n  return template.content.firstChild;\n}\n\nvar _importScript = function (url) {\n  //url is URL of external file, implementationCode is the code\n  //to be called from the file, location is the location to\n  //insert the <script> element\n  return new Promise((resolve, reject) => {\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n    scriptTag.type = \"text/javascript\";\n    scriptTag.onload = resolve;\n\n    scriptTag.onreadystatechange = function () {\n      if (this.readyState === \"loaded\" || this.readyState === \"complete\") {\n        resolve();\n      }\n    };\n\n    scriptTag.onerror = reject;\n    document.head.appendChild(scriptTag);\n  });\n}; // support importScripts outside web worker\n\n\nasync function importScripts() {\n  var args = Array.prototype.slice.call(arguments),\n      len = args.length,\n      i = 0;\n\n  for (; i < len; i++) {\n    await _importScript(args[i]);\n  }\n}\n\nclass Connection extends _utils_js__WEBPACK_IMPORTED_MODULE_2__[\"MessageEmitter\"] {\n  constructor(config) {\n    super(config && config.debug);\n    this.config = config || {};\n    this.peer_id = Object(_utils_js__WEBPACK_IMPORTED_MODULE_2__[\"randId\"])();\n  }\n\n  connect() {\n    this.config.target_origin = this.config.target_origin || \"*\"; // this will call handleEvent function\n\n    window.addEventListener(\"message\", this);\n    this.emit({\n      type: \"initialized\",\n      config: this.config,\n      origin: window.location.origin,\n      peer_id: this.peer_id\n    });\n\n    this._fire(\"connected\");\n  }\n\n  handleEvent(e) {\n    if (e.type === \"message\" && (this.config.target_origin === \"*\" || e.origin === this.config.target_origin)) {\n      if (e.data.peer_id === this.peer_id) {\n        this._fire(e.data.type, e.data);\n      } else if (this.config.debug) {\n        console.log(`connection peer id mismatch ${e.data.peer_id} !== ${this.peer_id}`);\n      }\n    }\n  }\n\n  disconnect() {\n    this._fire(\"beforeDisconnect\");\n\n    window.removeEventListener(\"message\", this);\n\n    this._fire(\"disconnected\");\n  }\n\n  emit(data) {\n    let transferables;\n\n    if (data.__transferables__) {\n      transferables = data.__transferables__;\n      delete data.__transferables__;\n    }\n\n    parent.postMessage(data, this.config.target_origin, transferables);\n  }\n\n  async execute(code) {\n    try {\n      if (code.type === \"requirements\") {\n        if (code.requirements && (Array.isArray(code.requirements) || typeof code.requirements === \"string\")) {\n          try {\n            var link_node;\n            code.requirements = typeof code.requirements === \"string\" ? [code.requirements] : code.requirements;\n\n            if (Array.isArray(code.requirements)) {\n              for (var i = 0; i < code.requirements.length; i++) {\n                if (code.requirements[i].toLowerCase().endsWith(\".css\") || code.requirements[i].startsWith(\"css:\")) {\n                  if (code.requirements[i].startsWith(\"css:\")) {\n                    code.requirements[i] = code.requirements[i].slice(4);\n                  }\n\n                  link_node = document.createElement(\"link\");\n                  link_node.rel = \"stylesheet\";\n                  link_node.href = code.requirements[i];\n                  document.head.appendChild(link_node);\n                } else if (code.requirements[i].toLowerCase().endsWith(\".js\") || code.requirements[i].startsWith(\"js:\")) {\n                  if (code.requirements[i].startsWith(\"js:\")) {\n                    code.requirements[i] = code.requirements[i].slice(3);\n                  }\n\n                  await importScripts(code.requirements[i]);\n                } else if (code.requirements[i].startsWith(\"http\")) {\n                  await importScripts(code.requirements[i]);\n                } else if (code.requirements[i].startsWith(\"cache:\")) {//ignore cache\n                } else {\n                  console.log(\"Unprocessed requirements url: \" + code.requirements[i]);\n                }\n              }\n            } else {\n              throw \"unsupported requirements definition\";\n            }\n          } catch (e) {\n            throw \"failed to import required scripts: \" + code.requirements.toString();\n          }\n        }\n      } else if (code.type === \"script\") {\n        if (code.src) {\n          var script_node = document.createElement(\"script\");\n          script_node.setAttribute(\"type\", code.attrs.type);\n          script_node.setAttribute(\"src\", code.src);\n          document.head.appendChild(script_node);\n        } else {\n          if (code.content && (!code.attrs.type || code.attrs.type === \"text/javascript\")) {\n            // document.addEventListener(\"DOMContentLoaded\", function(){\n            eval(code.content); // });\n          } else {\n            var node = document.createElement(\"script\");\n            node.setAttribute(\"type\", code.attrs.type);\n            node.appendChild(document.createTextNode(code.content));\n            document.body.appendChild(node);\n          }\n        }\n      } else if (code.type === \"style\") {\n        const style_node = document.createElement(\"style\");\n\n        if (code.src) {\n          style_node.src = code.src;\n        }\n\n        style_node.innerHTML = code.content;\n        document.head.appendChild(style_node);\n      } else if (code.type === \"link\") {\n        const link_node_ = document.createElement(\"link\");\n\n        if (code.rel) {\n          link_node_.rel = code.rel;\n        }\n\n        if (code.href) {\n          link_node_.href = code.href;\n        }\n\n        if (code.attrs && code.attrs.type) {\n          link_node_.type = code.attrs.type;\n        }\n\n        document.head.appendChild(link_node_);\n      } else if (code.type === \"html\") {\n        document.body.appendChild(_htmlToElement(code.content));\n      } else {\n        throw \"unsupported code type.\";\n      }\n\n      parent.postMessage({\n        type: \"executed\"\n      }, this.config.target_origin);\n    } catch (e) {\n      console.error(\"failed to execute scripts: \", code, e);\n      parent.postMessage({\n        type: \"executed\",\n        error: e.stack || String(e)\n      }, this.config.target_origin);\n    }\n  }\n\n}\nfunction setupIframe(config) {\n  config = config || {};\n  config.dedicated_thread = false;\n  config.lang = \"javascript\";\n  config.api_version = _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\"API_VERSION\"];\n  const conn = new Connection(config);\n  Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\"connectRPC\"])(conn, config);\n  conn.connect();\n}\n\n/***/ }),\n\n/***/ \"./src/pluginWebPython.js\":\n/*!********************************!*\\\n  !*** ./src/pluginWebPython.js ***!\n  \\********************************/\n/*! exports provided: default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return setupWebPython; });\n/* harmony import */ var _pluginCore_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pluginCore.js */ \"./src/pluginCore.js\");\n/* harmony import */ var _rpc_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rpc.js */ \"./src/rpc.js\");\n/* harmony import */ var _pluginIframe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pluginIframe */ \"./src/pluginIframe.js\");\n/**\n * Contains the routines loaded by the plugin iframe under web-browser\n * in case when worker failed to initialize\n *\n * Initializes the web environment version of the platform-dependent\n * connection object for the plugin site\n */\n\n\n // Create a new, plain <span> element\n\nfunction _htmlToElement(html) {\n  var template = document.createElement(\"template\");\n  html = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = html;\n  return template.content.firstChild;\n}\n\nconst _importScript = function (url) {\n  //url is URL of external file, implementationCode is the code\n  //to be called from the file, location is the location to\n  //insert the <script> element\n  return new Promise((resolve, reject) => {\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n    scriptTag.onload = resolve;\n\n    scriptTag.onreadystatechange = function () {\n      if (this.readyState === \"loaded\" || this.readyState === \"complete\") {\n        resolve();\n      }\n    };\n\n    scriptTag.onerror = reject;\n    document.head.appendChild(scriptTag);\n  });\n}; // support importScripts outside web worker\n\n\nasync function importScripts() {\n  var args = Array.prototype.slice.call(arguments),\n      len = args.length,\n      i = 0;\n\n  for (; i < len; i++) {\n    await _importScript(args[i]);\n  }\n}\n\nconst startup_script = `\nfrom js import api\nimport sys\nfrom types import ModuleType\nm = ModuleType(\"imjoy\")\nsys.modules[m.__name__] = m\nm.__file__ = m.__name__ + \".py\"\nm.api = api\n`;\nlet _export_plugin_api = null;\n\nconst execute_python_code = function (code) {\n  try {\n    if (!_export_plugin_api) {\n      _export_plugin_api = window.api.export;\n\n      window.api.export = function (p) {\n        if (typeof p === \"object\") {\n          const _api = {};\n\n          for (let k in p) {\n            if (!k.startsWith(\"_\")) {\n              _api[k] = p[k];\n            }\n          }\n\n          _export_plugin_api(_api);\n        } else if (typeof p === \"function\") {\n          const _api = {};\n          const getattr = window.pyodide.pyimport(\"getattr\");\n          const hasattr = window.pyodide.pyimport(\"hasattr\");\n\n          for (let k of Object.getOwnPropertyNames(p)) {\n            if (!k.startsWith(\"_\") && hasattr(p, k)) {\n              const func = getattr(p, k);\n\n              _api[k] = function () {\n                return func(...Array.prototype.slice.call(arguments));\n              };\n            }\n          }\n\n          _export_plugin_api(_api);\n        } else {\n          throw \"unsupported api export\";\n        }\n      };\n    }\n\n    window.pyodide.runPython(startup_script);\n    window.pyodide.runPython(code.content);\n  } catch (e) {\n    throw e;\n  }\n};\n\nfunction setupPyodide() {\n  return new Promise((resolve, reject) => {\n    window.languagePluginUrl = \"https://static.imjoy.io/pyodide/\";\n    importScripts(\"https://static.imjoy.io/pyodide/pyodide.js\").then(() => {\n      // hack for matplotlib etc.\n      window.iodide = {\n        output: {\n          element: function element(type) {\n            const div = document.createElement(type);\n            const output = document.getElementById(\"output\") || document.body;\n            output.appendChild(div);\n            return div;\n          }\n        }\n      };\n      window.languagePluginLoader.then(() => {\n        // pyodide is now ready to use...\n        console.log(window.pyodide.runPython(\"import sys\\nsys.version\"));\n        resolve();\n      }).catch(reject);\n    });\n  });\n} // connection object for the RPC constructor\n\n\nclass Connection extends _pluginIframe__WEBPACK_IMPORTED_MODULE_2__[\"Connection\"] {\n  constructor(config) {\n    super(config);\n  }\n\n  async execute(code) {\n    if (code.type === \"requirements\") {\n      if (code.requirements) {\n        code.requirements = typeof code.requirements === \"string\" ? [code.requirements] : code.requirements;\n\n        if (Array.isArray(code.requirements)) {\n          const python_packages = [];\n\n          for (var i = 0; i < code.requirements.length; i++) {\n            if (code.requirements[i].toLowerCase().endsWith(\".css\") || code.requirements[i].startsWith(\"css:\")) {\n              if (code.requirements[i].startsWith(\"css:\")) {\n                code.requirements[i] = code.requirements[i].slice(4);\n              }\n\n              link_node = document.createElement(\"link\");\n              link_node.rel = \"stylesheet\";\n              link_node.href = code.requirements[i];\n              document.head.appendChild(link_node);\n            } else if ( // code.requirements[i].toLowerCase().endsWith(\".js\") ||\n            code.requirements[i].startsWith(\"js:\")) {\n              if (code.requirements[i].startsWith(\"js:\")) {\n                code.requirements[i] = code.requirements[i].slice(3);\n              }\n\n              await importScripts(code.requirements[i]);\n            } else if (code.requirements[i].startsWith(\"cache:\")) {//ignore cache\n            } else if (code.requirements[i].toLowerCase().endsWith(\".js\") || code.requirements[i].startsWith(\"package:\")) {\n              if (code.requirements[i].startsWith(\"package:\")) {\n                code.requirements[i] = code.requirements[i].slice(8);\n              }\n\n              python_packages.push(code.requirements[i]);\n            } else if (code.requirements[i].startsWith(\"http:\") || code.requirements[i].startsWith(\"https:\")) {\n              console.log(\"Unprocessed requirements url: \" + code.requirements[i]);\n            } else {\n              python_packages.push(code.requirements[i]);\n            }\n          }\n\n          await window.pyodide.loadPackage(python_packages);\n        } else {\n          throw \"unsupported requirements definition\";\n        }\n      }\n    } else if (code.type === \"script\") {\n      if (code.src) {\n        var script_node = document.createElement(\"script\");\n        script_node.setAttribute(\"type\", code.attrs.type);\n        script_node.setAttribute(\"src\", code.src);\n        document.head.appendChild(script_node);\n      } else {\n        if (code.content && code.lang === \"python\") {\n          execute_python_code(code);\n        } else if (code.content && code.lang === \"javascript\") {\n          try {\n            eval(code.content);\n          } catch (e) {\n            console.error(e.message, e.stack);\n            throw e;\n          }\n        } else {\n          const node = document.createElement(\"script\");\n          node.setAttribute(\"type\", code.attrs.type);\n          node.appendChild(document.createTextNode(code.content));\n          document.body.appendChild(node);\n        }\n      }\n    } else if (code.type === \"style\") {\n      const style_node = document.createElement(\"style\");\n\n      if (code.src) {\n        style_node.src = code.src;\n      }\n\n      style_node.innerHTML = code.content;\n      document.head.appendChild(style_node);\n    } else if (code.type === \"link\") {\n      const link_node = document.createElement(\"link\");\n\n      if (code.rel) {\n        link_node.rel = code.rel;\n      }\n\n      if (code.href) {\n        link_node.href = code.href;\n      }\n\n      if (code.attrs && code.attrs.type) {\n        link_node.type = code.attrs.type;\n      }\n\n      document.head.appendChild(link_node);\n    } else if (code.type === \"html\") {\n      document.body.appendChild(_htmlToElement(code.content));\n    } else {\n      throw \"unsupported code type.\";\n    }\n  }\n\n}\n\nfunction setupWebPython(config) {\n  config = config || {};\n  config.debug = true;\n  config.dedicated_thread = false;\n  config.lang = \"python\";\n  config.api_version = _rpc_js__WEBPACK_IMPORTED_MODULE_1__[\"API_VERSION\"];\n  const conn = new Connection(config);\n  setupPyodide().then(() => {\n    Object(_pluginCore_js__WEBPACK_IMPORTED_MODULE_0__[\"connectRPC\"])(conn, config);\n    conn.connect();\n  });\n}\n\n/***/ }),\n\n/***/ \"./src/rpc.js\":\n/*!********************!*\\\n  !*** ./src/rpc.js ***!\n  \\********************/\n/*! exports provided: API_VERSION, RPC */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"API_VERSION\", function() { return API_VERSION; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RPC\", function() { return RPC; });\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./src/utils.js\");\n/**\n * Contains the RPC object used both by the application\n * site, and by each plugin\n */\n\nconst API_VERSION = \"0.2.3\";\nconst ArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor;\n\nfunction _appendBuffer(buffer1, buffer2) {\n  const tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n  tmp.set(new Uint8Array(buffer1), 0);\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n  return tmp.buffer;\n}\n\nfunction indexObject(obj, is) {\n  if (!is) throw new Error(\"undefined index\");\n  if (typeof is === \"string\") return indexObject(obj, is.split(\".\"));else if (is.length === 0) return obj;else return indexObject(obj[is[0]], is.slice(1));\n}\n/**\n * RPC object represents a single site in the\n * communication protocol between the application and the plugin\n *\n * @param {Object} connection a special object allowing to send\n * and receive messages from the opposite site (basically it\n * should only provide send() and onMessage() methods)\n */\n\n\nclass RPC extends _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"MessageEmitter\"] {\n  constructor(connection, config, codecs) {\n    super(config && config.debug);\n    this._connection = connection;\n    this.config = config || {};\n    this._codecs = codecs || {};\n    this._object_store = {};\n    this._method_weakmap = new WeakMap();\n    this._object_weakmap = new WeakMap();\n    this._local_api = null; // make sure there is an execute function\n\n    const name = this.config.name;\n\n    this._connection.execute = this._connection.execute || function () {\n      throw new Error(`connection.execute not implemented (in \"${name}\")`);\n    };\n\n    this._store = new ReferenceStore();\n    this._method_refs = new ReferenceStore();\n\n    this._method_refs.onReady(() => {\n      this._fire(\"remoteIdle\");\n    });\n\n    this._method_refs.onBusy(() => {\n      this._fire(\"remoteBusy\");\n    });\n\n    this._setupMessageHanlders();\n  }\n\n  init() {\n    this._connection.emit({\n      type: \"initialized\",\n      config: this.config,\n      peer_id: this._connection.peer_id\n    });\n  }\n  /**\n   * Set a handler to be called when received a responce from the\n   * remote site reporting that the previously provided interface\n   * has been successfully set as remote for that site\n   *\n   * @param {Function} handler\n   */\n\n\n  getRemoteCallStack() {\n    return this._method_refs.getStack();\n  }\n  /**\n   * @returns {Object} set of remote interface methods\n   */\n\n\n  getRemote() {\n    return this._remote_interface;\n  }\n  /**\n   * Sets the interface of this site making it available to the\n   * remote site by sending a message with a set of methods names\n   *\n   * @param {Object} _interface to set\n   */\n\n\n  setInterface(_interface, config) {\n    config = config || {};\n    this.config.name = config.name || this.config.name;\n    this.config.description = config.description || this.config.description;\n\n    if (this.config.forwarding_functions) {\n      for (let func_name of this.config.forwarding_functions) {\n        const _remote = this._remote_interface;\n\n        if (_remote[func_name]) {\n          if (_interface.constructor === Object) {\n            if (!_interface[func_name]) {\n              _interface[func_name] = (...args) => {\n                _remote[func_name](...args);\n              };\n            }\n          } else if (_interface.constructor.constructor === Function) {\n            if (!_interface.constructor.prototype[func_name]) {\n              _interface.constructor.prototype[func_name] = (...args) => {\n                _remote[func_name](...args);\n              };\n            }\n          }\n        }\n      }\n    }\n\n    this._local_api = _interface;\n\n    this._fire(\"interfaceAvailable\");\n  }\n  /**\n   * Sends the actual interface to the remote site upon it was\n   * updated or by a special request of the remote site\n   */\n\n\n  sendInterface() {\n    if (!this._local_api) {\n      throw new Error(\"interface is not set.\");\n    }\n\n    this._encode(this._local_api, true).then(api => {\n      this._connection.emit({\n        type: \"setInterface\",\n        api: api\n      });\n    });\n  }\n\n  _disposeObject(objectId) {\n    if (this._object_store[objectId]) {\n      delete this._object_store[objectId];\n    } else {\n      throw new Error(`Object (id=${objectId}) not found.`);\n    }\n  }\n\n  disposeObject(obj) {\n    return new Promise((resolve, reject) => {\n      if (this._object_weakmap.has(obj)) {\n        const objectId = this._object_weakmap.get(obj);\n\n        this._connection.once(\"disposed\", data => {\n          if (data.error) reject(new Error(data.error));else resolve();\n        });\n\n        this._connection.emit({\n          type: \"disposeObject\",\n          object_id: objectId\n        });\n      } else {\n        throw new Error(\"Invalid object\");\n      }\n    });\n  }\n  /**\n   * Handles a message from the remote site\n   */\n\n\n  _setupMessageHanlders() {\n    this._connection.on(\"init\", this.init);\n\n    this._connection.on(\"execute\", data => {\n      Promise.resolve(this._connection.execute(data.code)).then(() => {\n        this._connection.emit({\n          type: \"executed\"\n        });\n      }).catch(e => {\n        console.error(e);\n\n        this._connection.emit({\n          type: \"executed\",\n          error: String(e)\n        });\n      });\n    });\n\n    this._connection.on(\"method\", async data => {\n      let resolve, reject, method, method_this, args, result;\n\n      try {\n        if (data.promise) {\n          [resolve, reject] = await this._unwrap(data.promise, false);\n        }\n\n        const _interface = this._object_store[data.object_id];\n        method = indexObject(_interface, data.name);\n\n        if (data.name.includes(\".\")) {\n          const tmp = data.name.split(\".\");\n          const intf_index = tmp.slice(0, tmp.length - 1).join(\".\");\n          method_this = indexObject(_interface, intf_index);\n        } else {\n          method_this = _interface;\n        }\n\n        args = await this._unwrap(data.args, true);\n\n        if (data.promise) {\n          result = method.apply(method_this, args);\n\n          if (result instanceof Promise || method.constructor && method.constructor.name === \"AsyncFunction\") {\n            result.then(resolve).catch(reject);\n          } else {\n            resolve(result);\n          }\n        } else {\n          method.apply(method_this, args);\n        }\n      } catch (err) {\n        console.error(this.config.name, err);\n\n        if (reject) {\n          reject(err);\n        }\n      }\n    });\n\n    this._connection.on(\"callback\", async data => {\n      let resolve, reject, method, args, result;\n\n      try {\n        if (data.promise) {\n          [resolve, reject] = await this._unwrap(data.promise, false);\n        }\n\n        if (data.promise) {\n          method = this._store.fetch(data.id);\n          args = await this._unwrap(data.args, true);\n\n          if (!method) {\n            throw new Error(\"Callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\");\n          }\n\n          result = method.apply(null, args);\n\n          if (result instanceof Promise || method.constructor && method.constructor.name === \"AsyncFunction\") {\n            result.then(resolve).catch(reject);\n          } else {\n            resolve(result);\n          }\n        } else {\n          method = this._store.fetch(data.id);\n          args = await this._unwrap(data.args, true);\n\n          if (!method) {\n            throw new Error(\"Please notice that callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function. See https://imjoy.io/docs for more details.\");\n          }\n\n          method.apply(null, args);\n        }\n      } catch (err) {\n        console.error(this.config.name, err);\n\n        if (reject) {\n          reject(err);\n        }\n      }\n    });\n\n    this._connection.on(\"disposeObject\", data => {\n      try {\n        this._disposeObject(data.object_id);\n\n        this._connection.emit({\n          type: \"disposed\"\n        });\n      } catch (e) {\n        console.error(e);\n\n        this._connection.emit({\n          type: \"disposed\",\n          error: String(e)\n        });\n      }\n    });\n\n    this._connection.on(\"setInterface\", data => {\n      this._setRemoteInterface(data.api);\n    });\n\n    this._connection.on(\"getInterface\", () => {\n      this._fire(\"getInterface\");\n\n      if (this._local_api) {\n        this.sendInterface();\n      } else {\n        this.once(\"interfaceAvailable\", () => {\n          this.sendInterface();\n        });\n      }\n    });\n\n    this._connection.on(\"interfaceSetAsRemote\", () => {\n      this._fire(\"interfaceSetAsRemote\");\n    });\n\n    this._connection.on(\"disconnect\", () => {\n      this._fire(\"beforeDisconnect\");\n\n      this._connection.disconnect();\n\n      this._fire(\"disconnected\");\n    });\n  }\n  /**\n   * Sends a requests to the remote site asking it to provide its\n   * current interface\n   */\n\n\n  requestRemote() {\n    this._connection.emit({\n      type: \"getInterface\"\n    });\n  }\n\n  _ndarray(typedArray, shape, dtype) {\n    const _dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][typedArray.constructor.name];\n\n    if (dtype && dtype !== _dtype) {\n      throw \"dtype doesn't match the type of the array: \" + _dtype + \" != \" + dtype;\n    }\n\n    shape = shape || [typedArray.length];\n    return {\n      _rtype: \"ndarray\",\n      _rvalue: typedArray.buffer,\n      _rshape: shape,\n      _rdtype: _dtype\n    };\n  }\n  /**\n   * Sets the new remote interface provided by the other site\n   *\n   * @param {Array} names list of function names\n   */\n\n\n  _setRemoteInterface(api) {\n    this._decode(api).then(intf => {\n      this._remote_interface = intf;\n\n      this._fire(\"remoteReady\");\n\n      this._reportRemoteSet();\n    });\n  }\n  /**\n   * Generates the wrapped function corresponding to a single remote\n   * method. When the generated function is called, it will send the\n   * corresponding message to the remote site asking it to execute\n   * the particular method of its interface\n   *\n   * @param {String} name of the remote method\n   *\n   * @returns {Function} wrapped remote method\n   */\n\n\n  _genRemoteMethod(targetId, name, objectId) {\n    const me = this;\n\n    const remoteMethod = function () {\n      return new Promise(async (resolve, reject) => {\n        let id = null;\n\n        try {\n          id = me._method_refs.put(objectId ? objectId + \"/\" + name : name);\n\n          const wrapped_resolve = function () {\n            if (id !== null) me._method_refs.fetch(id);\n            return resolve.apply(this, arguments);\n          };\n\n          const wrapped_reject = function () {\n            if (id !== null) me._method_refs.fetch(id);\n            return reject.apply(this, arguments);\n          };\n\n          const encodedPromise = await me._wrap([wrapped_resolve, wrapped_reject]); // store the key id for removing them from the reference store together\n\n          wrapped_resolve.__promise_pair = encodedPromise[1]._rvalue;\n          wrapped_reject.__promise_pair = encodedPromise[0]._rvalue;\n          let args = Array.prototype.slice.call(arguments);\n\n          if (name === \"register\" || name === \"export\" || name === \"on\") {\n            args = await me._wrap(args, true);\n          } else {\n            args = await me._wrap(args);\n          }\n\n          const transferables = args.__transferables__;\n          if (transferables) delete args.__transferables__;\n\n          me._connection.emit({\n            type: \"method\",\n            target_id: targetId,\n            name: name,\n            object_id: objectId,\n            args: args,\n            promise: encodedPromise\n          }, transferables);\n        } catch (e) {\n          if (id) me._method_refs.fetch(id);\n          reject(`Failed to exectue remote method (interface: ${objectId || me.id}, method: ${name}), error: ${e}`);\n        }\n      });\n    };\n\n    remoteMethod.__remote_method = true;\n    return remoteMethod;\n  }\n  /**\n   * Sends a responce reporting that interface just provided by the\n   * remote site was successfully set by this site as remote\n   */\n\n\n  _reportRemoteSet() {\n    this._connection.emit({\n      type: \"interfaceSetAsRemote\"\n    });\n  }\n  /**\n   * Prepares the provided set of remote method arguments for\n   * sending to the remote site, replaces all the callbacks with\n   * identifiers\n   *\n   * @param {Array} args to wrap\n   *\n   * @returns {Array} wrapped arguments\n   */\n\n\n  async _encode(aObject, asInterface, objectId) {\n    const aType = typeof aObject;\n\n    if (aType === \"number\" || aType === \"string\" || aType === \"boolean\" || aObject === null || aObject === undefined || aObject instanceof ArrayBuffer) {\n      return aObject;\n    }\n\n    let bObject;\n\n    if (typeof aObject === \"function\") {\n      if (asInterface) {\n        if (!objectId) throw new Error(\"objectId is not specified.\");\n        bObject = {\n          _rtype: \"interface\",\n          _rtarget_id: this._connection.peer_id,\n          _rintf: objectId,\n          _rvalue: asInterface\n        };\n\n        this._method_weakmap.set(aObject, bObject);\n      } else if (this._method_weakmap.has(aObject)) {\n        bObject = this._method_weakmap.get(aObject);\n      } else {\n        const cid = this._store.put(aObject);\n\n        bObject = {\n          _rtype: \"callback\",\n          _rtarget_id: this._connection.peer_id,\n          _rname: aObject.constructor && aObject.constructor.name || cid,\n          _rvalue: cid\n        };\n      }\n\n      return bObject;\n    } // skip if already encoded\n\n\n    if (aObject.constructor instanceof Object && aObject._rtype) {\n      // make sure the interface functions are encoded\n      if (aObject._rintf) {\n        const temp = aObject._rtype;\n        delete aObject._rtype;\n        bObject = await this._encode(aObject, asInterface, objectId);\n        bObject._rtype = temp;\n      } else {\n        bObject = aObject;\n      }\n\n      return bObject;\n    }\n\n    const transferables = [];\n    const _transfer = aObject._transfer;\n    const isarray = Array.isArray(aObject);\n\n    for (let tp of Object.keys(this._codecs)) {\n      const codec = this._codecs[tp];\n\n      if (codec.encoder && aObject instanceof codec.type) {\n        // TODO: what if multiple encoders found\n        let encodedObj = await Promise.resolve(codec.encoder(aObject));\n        if (encodedObj && !encodedObj._rtype) encodedObj._rtype = codec.name; // encode the functions in the interface object\n\n        if (encodedObj && encodedObj._rintf) {\n          const temp = encodedObj._rtype;\n          delete encodedObj._rtype;\n          encodedObj = await this._encode(encodedObj, asInterface, objectId);\n          encodedObj._rtype = temp;\n        }\n\n        bObject = encodedObj;\n        return bObject;\n      }\n    }\n\n    if (\n    /*global tf*/\n    typeof tf !== \"undefined\" && tf.Tensor && aObject instanceof tf.Tensor) {\n      const v_buffer = aObject.dataSync();\n\n      if (aObject._transfer || _transfer) {\n        transferables.push(v_buffer.buffer);\n        delete aObject._transfer;\n      }\n\n      bObject = {\n        _rtype: \"ndarray\",\n        _rvalue: v_buffer.buffer,\n        _rshape: aObject.shape,\n        _rdtype: aObject.dtype\n      };\n    } else if (\n    /*global nj*/\n    typeof nj !== \"undefined\" && nj.NdArray && aObject instanceof nj.NdArray) {\n      const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][aObject.selection.data.constructor.name];\n\n      if (aObject._transfer || _transfer) {\n        transferables.push(aObject.selection.data.buffer);\n        delete aObject._transfer;\n      }\n\n      bObject = {\n        _rtype: \"ndarray\",\n        _rvalue: aObject.selection.data.buffer,\n        _rshape: aObject.shape,\n        _rdtype: dtype\n      };\n    } else if (aObject instanceof Error) {\n      console.error(aObject);\n      bObject = {\n        _rtype: \"error\",\n        _rvalue: aObject.toString()\n      };\n    } else if (typeof File !== \"undefined\" && aObject instanceof File) {\n      bObject = {\n        _rtype: \"file\",\n        _rvalue: aObject,\n        _rpath: aObject._path || aObject.webkitRelativePath\n      };\n    } // send objects supported by structure clone algorithm\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\n    else if (aObject !== Object(aObject) || aObject instanceof Boolean || aObject instanceof String || aObject instanceof Date || aObject instanceof RegExp || aObject instanceof ImageData || typeof FileList !== \"undefined\" && aObject instanceof FileList) {\n        bObject = aObject; // TODO: avoid object such as DynamicPlugin instance.\n      } else if (typeof File !== \"undefined\" && aObject instanceof File) {\n        bObject = {\n          _rtype: \"file\",\n          _rname: aObject.name,\n          _rmime: aObject.type,\n          _rvalue: aObject,\n          _rpath: aObject._path || aObject.webkitRelativePath\n        };\n      } else if (aObject instanceof Blob) {\n        bObject = {\n          _rtype: \"blob\",\n          _rvalue: aObject\n        };\n      } else if (aObject instanceof ArrayBufferView) {\n        if (aObject._transfer || _transfer) {\n          transferables.push(aObject.buffer);\n          delete aObject._transfer;\n        }\n\n        const dtype = _utils_js__WEBPACK_IMPORTED_MODULE_0__[\"typedArrayToDtype\"][aObject.constructor.name];\n        bObject = {\n          _rtype: \"typedarray\",\n          _rvalue: aObject.buffer,\n          _rdtype: dtype\n        };\n      } else if (aObject instanceof DataView) {\n        if (aObject._transfer || _transfer) {\n          transferables.push(aObject.buffer);\n          delete aObject._transfer;\n        }\n\n        bObject = {\n          _rtype: \"memoryview\",\n          _rvalue: aObject.buffer\n        };\n      } else if (aObject instanceof Set) {\n        bObject = {\n          _rtype: \"set\",\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\n        };\n      } else if (aObject instanceof Map) {\n        bObject = {\n          _rtype: \"orderedmap\",\n          _rvalue: await this._encode(Array.from(aObject), asInterface)\n        };\n      } else if (aObject.constructor instanceof Object || Array.isArray(aObject)) {\n        bObject = isarray ? [] : {};\n        let keys; // an object/array\n\n        if (aObject.constructor === Object || Array.isArray(aObject)) {\n          keys = Object.keys(aObject);\n        } // a class\n        else if (aObject.constructor === Function) {\n            throw new Error(\"Please instantiate the class before exportting it.\");\n          } // instance of a class\n          else if (aObject.constructor.constructor === Function) {\n              keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject)); // TODO: use a proxy object to represent the actual object\n              // always encode class instance as interface\n\n              asInterface = true;\n            } else {\n              throw Error(\"Unsupported interface type\");\n            } // encode interfaces\n\n\n        if (aObject._rintf || asInterface) {\n          if (!objectId) {\n            objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"randId\"])();\n            this._object_store[objectId] = aObject;\n          }\n\n          for (let k of keys) {\n            if (k === \"constructor\") continue;\n\n            if (k.startsWith(\"_\")) {\n              continue;\n            }\n\n            bObject[k] = await this._encode(aObject[k], typeof asInterface === \"string\" ? asInterface + \".\" + k : k, objectId);\n          } // object id for dispose the object remotely\n\n\n          bObject._rintf = objectId; // remove interface when closed\n\n          if (aObject.on && typeof aObject.on === \"function\") {\n            aObject.on(\"close\", () => {\n              delete this._object_store[objectId];\n            });\n          }\n        } else {\n          for (let k of keys) {\n            if ([\"hasOwnProperty\", \"constructor\"].includes(k)) continue;\n            bObject[k] = await this._encode(aObject[k]);\n          }\n        } // for example, browserFS object\n\n      } else if (typeof aObject === \"object\") {\n        const keys = Object.getOwnPropertyNames(Object.getPrototypeOf(aObject)).concat(Object.keys(aObject));\n        const objectId = Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"randId\"])();\n\n        for (let k of keys) {\n          if ([\"hasOwnProperty\", \"constructor\"].includes(k)) continue; // encode as interface\n\n          bObject[k] = await this._encode(aObject[k], k, bObject);\n        } // object id, used for dispose the object\n\n\n        bObject._rintf = objectId;\n      } else {\n        throw \"imjoy-rpc: Unsupported data type:\" + aObject;\n      }\n\n    if (transferables.length > 0) {\n      bObject.__transferables__ = transferables;\n    }\n\n    if (!bObject) {\n      throw new Error(\"Failed to encode object\");\n    }\n\n    return bObject;\n  }\n\n  async _decode(aObject, withPromise) {\n    if (!aObject) {\n      return aObject;\n    }\n\n    let bObject;\n\n    if (aObject[\"_rtype\"]) {\n      if (this._codecs[aObject._rtype] && this._codecs[aObject._rtype].decoder) {\n        if (aObject._rintf) {\n          const temp = aObject._rtype;\n          delete aObject._rtype;\n          aObject = await this._decode(aObject, withPromise);\n          aObject._rtype = temp;\n        }\n\n        bObject = await Promise.resolve(this._codecs[aObject._rtype].decoder(aObject));\n      } else if (aObject._rtype === \"callback\") {\n        bObject = this._genRemoteCallback(aObject._rtarget_id, aObject._rvalue, withPromise);\n      } else if (aObject._rtype === \"interface\") {\n        bObject = this._genRemoteMethod(aObject._rtarget_id, aObject._rvalue, aObject._rintf);\n      } else if (aObject._rtype === \"ndarray\") {\n        /*global nj tf*/\n        //create build array/tensor if used in the plugin\n        if (typeof nj !== \"undefined\" && nj.array) {\n          if (Array.isArray(aObject._rvalue)) {\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\n          }\n\n          bObject = nj.array(new Uint8(aObject._rvalue), aObject._rdtype).reshape(aObject._rshape);\n        } else if (typeof tf !== \"undefined\" && tf.Tensor) {\n          if (Array.isArray(aObject._rvalue)) {\n            aObject._rvalue = aObject._rvalue.reduce(_appendBuffer);\n          }\n\n          const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"dtypeToTypedArray\"][aObject._rdtype]);\n          bObject = tf.tensor(new arraytype(aObject._rvalue), aObject._rshape, aObject._rdtype);\n        } else {\n          //keep it as regular if transfered to the main app\n          bObject = aObject;\n        }\n      } else if (aObject._rtype === \"error\") {\n        bObject = new Error(aObject._rvalue);\n      } else if (aObject._rtype === \"file\") {\n        if (aObject._rvalue instanceof File) {\n          bObject = aObject._rvalue; //patch _path\n\n          bObject._path = aObject._rpath;\n        } else {\n          bObject = new File([aObject._rvalue], aObject._rname, {\n            type: aObject._rmime\n          });\n          bObject._path = aObject._rpath;\n        }\n      } else if (aObject._rtype === \"typedarray\") {\n        const arraytype = eval(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"dtypeToTypedArray\"][aObject._rdtype]);\n        if (!arraytype) throw new Error(\"unsupported dtype: \" + aObject._rdtype);\n        bObject = new arraytype(aObject._rvalue);\n      } else if (aObject._rtype === \"memoryview\") {\n        bObject = new DataView(aObject._rvalue);\n      } else if (aObject._rtype === \"blob\") {\n        if (aObject._rvalue instanceof Blob) {\n          bObject = aObject._rvalue;\n        } else {\n          bObject = new Blob([aObject._rvalue], {\n            type: aObject._rmime\n          });\n        }\n      } else if (aObject._rtype === \"orderedmap\") {\n        bObject = new Map((await this._decode(aObject._rvalue, withPromise)));\n      } else if (aObject._rtype === \"set\") {\n        bObject = new Set((await this._decode(aObject._rvalue, withPromise)));\n      } else {\n        // make sure all the interface functions are decoded\n        if (aObject._rintf) {\n          const temp = aObject._rtype;\n          delete aObject._rtype;\n          aObject = await this._decode(aObject, withPromise);\n          aObject._rtype = temp;\n        }\n\n        bObject = aObject;\n      }\n    } else if (aObject.constructor === Object || Array.isArray(aObject)) {\n      const isarray = Array.isArray(aObject);\n      bObject = isarray ? [] : {};\n\n      for (let k of Object.keys(aObject)) {\n        if (isarray || aObject.hasOwnProperty(k)) {\n          const v = aObject[k];\n          bObject[k] = await this._decode(v, withPromise);\n        }\n      }\n    } else {\n      bObject = aObject;\n    }\n\n    if (bObject === undefined) {\n      throw new Error(\"Failed to decode object\");\n    } // store the object id for dispose\n\n\n    if (aObject._rintf) {\n      this._object_weakmap.set(bObject, aObject._rintf);\n    }\n\n    return bObject;\n  }\n\n  async _wrap(args, asInterface) {\n    return await this._encode(args, asInterface);\n  }\n  /**\n   * Unwraps the set of arguments delivered from the remote site,\n   * replaces all callback identifiers with a function which will\n   * initiate sending that callback identifier back to other site\n   *\n   * @param {Object} args to unwrap\n   *\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\n   *\n   * @returns {Array} unwrapped args\n   */\n\n\n  async _unwrap(args, withPromise) {\n    return await this._decode(args, withPromise);\n  }\n  /**\n   * Generates the wrapped function corresponding to a single remote\n   * callback. When the generated function is called, it will send\n   * the corresponding message to the remote site asking it to\n   * execute the particular callback previously saved during a call\n   * by the remote site a method from the interface of this site\n   *\n   * @param {Number} id of the remote callback to execute\n   * @param {Number} argNum argument index of the callback\n   * @param {Boolean} withPromise is true means this the callback should contain a promise\n   *\n   * @returns {Function} wrapped remote callback\n   */\n\n\n  _genRemoteCallback(targetId, cid, withPromise) {\n    const me = this;\n    let remoteCallback;\n\n    if (withPromise) {\n      remoteCallback = function () {\n        return new Promise(async (resolve, reject) => {\n          const args = await me._wrap(Array.prototype.slice.call(arguments));\n          const transferables = args.__transferables__;\n          if (transferables) delete args.__transferables__;\n          const encodedPromise = await me._wrap([resolve, reject]); // store the key id for removing them from the reference store together\n\n          resolve.__promise_pair = encodedPromise[1]._rvalue;\n          reject.__promise_pair = encodedPromise[0]._rvalue;\n\n          try {\n            me._connection.emit({\n              type: \"callback\",\n              target_id: targetId,\n              id: cid,\n              args: args,\n              promise: encodedPromise\n            }, transferables);\n          } catch (e) {\n            reject(`Failed to exectue remote callback ( id: ${cid}).`);\n          }\n        });\n      };\n\n      return remoteCallback;\n    } else {\n      remoteCallback = async function () {\n        const args = await me._wrap(Array.prototype.slice.call(arguments));\n        const transferables = args.__transferables__;\n        if (transferables) delete args.__transferables__;\n        return me._connection.emit({\n          type: \"callback\",\n          target_id: targetId,\n          id: cid,\n          args: args\n        }, transferables);\n      };\n\n      return remoteCallback;\n    }\n  }\n  /**\n   * Sends the notification message and breaks the connection\n   */\n\n\n  disconnect() {\n    this._connection.emit({\n      type: \"disconnect\"\n    });\n\n    setTimeout(() => {\n      this._connection.disconnect();\n    }, 2000);\n  }\n\n}\n/**\n * ReferenceStore is a special object which stores other objects\n * and provides the references (number) instead. This reference\n * may then be sent over a json-based communication channel (IPC\n * to another Node.js process or a message to the Worker). Other\n * site may then provide the reference in the responce message\n * implying the given object should be activated.\n *\n * Primary usage for the ReferenceStore is a storage for the\n * callbacks, which therefore makes it possible to initiate a\n * callback execution by the opposite site (which normally cannot\n * directly execute functions over the communication channel).\n *\n * Each stored object can only be fetched once and is not\n * available for the second time. Each stored object must be\n * fetched, since otherwise it will remain stored forever and\n * consume memory.\n *\n * Stored object indeces are simply the numbers, which are however\n * released along with the objects, and are later reused again (in\n * order to postpone the overflow, which should not likely happen,\n * but anyway).\n */\n\nclass ReferenceStore {\n  constructor() {\n    this._store = {}; // stored object\n\n    this._indices = [0]; // smallest available indices\n\n    this._readyHandler = function () {};\n\n    this._busyHandler = function () {};\n\n    this._readyHandler();\n  }\n  /**\n   * call handler when the store is empty\n   *\n   * @param {FUNCTION} id of a handler\n   */\n\n\n  onReady(readyHandler) {\n    this._readyHandler = readyHandler || function () {};\n  }\n  /**\n   * call handler when the store is not empty\n   *\n   * @param {FUNCTION} id of a handler\n   */\n\n\n  onBusy(busyHandler) {\n    this._busyHandler = busyHandler || function () {};\n  }\n  /**\n   * get the length of the store\n   *\n   */\n\n\n  getStack() {\n    return Object.keys(this._store).length;\n  }\n  /**\n   * @function _genId() generates the new reference id\n   *\n   * @returns {Number} smallest available id and reserves it\n   */\n\n\n  _genId() {\n    let id;\n\n    if (this._indices.length === 1) {\n      id = this._indices[0]++;\n    } else {\n      id = this._indices.shift();\n    }\n\n    return id;\n  }\n  /**\n   * Releases the given reference id so that it will be available by\n   * another object stored\n   *\n   * @param {Number} id to release\n   */\n\n\n  _releaseId(id) {\n    for (let i = 0; i < this._indices.length; i++) {\n      if (id < this._indices[i]) {\n        this._indices.splice(i, 0, id);\n\n        break;\n      }\n    } // cleaning-up the sequence tail\n\n\n    for (let i = this._indices.length - 1; i >= 0; i--) {\n      if (this._indices[i] - 1 === this._indices[i - 1]) {\n        this._indices.pop();\n      } else {\n        break;\n      }\n    }\n  }\n  /**\n   * Stores the given object and returns the refernce id instead\n   *\n   * @param {Object} obj to store\n   *\n   * @returns {Number} reference id of the stored object\n   */\n\n\n  put(obj) {\n    if (this._busyHandler && Object.keys(this._store).length === 0) {\n      this._busyHandler();\n    }\n\n    const id = this._genId();\n\n    this._store[id] = obj;\n    return id;\n  }\n  /**\n   * Retrieves previously stored object and releases its reference\n   *\n   * @param {Number} id of an object to retrieve\n   */\n\n\n  fetch(id) {\n    const obj = this._store[id];\n\n    if (obj && !obj.__remote_method) {\n      delete this._store[id];\n\n      this._releaseId(id);\n\n      if (this._readyHandler && Object.keys(this._store).length === 0) {\n        this._readyHandler();\n      }\n    }\n\n    if (obj && obj.__promise_pair) {\n      this.fetch(obj.__promise_pair);\n    }\n\n    return obj;\n  }\n\n}\n\n/***/ }),\n\n/***/ \"./src/utils.js\":\n/*!**********************!*\\\n  !*** ./src/utils.js ***!\n  \\**********************/\n/*! exports provided: randId, dtypeToTypedArray, typedArrayToDtype, cacheRequirements, setupServiceWorker, urlJoin, MessageEmitter */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"randId\", function() { return randId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"dtypeToTypedArray\", function() { return dtypeToTypedArray; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"typedArrayToDtype\", function() { return typedArrayToDtype; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"cacheRequirements\", function() { return cacheRequirements; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setupServiceWorker\", function() { return setupServiceWorker; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"urlJoin\", function() { return urlJoin; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MessageEmitter\", function() { return MessageEmitter; });\nfunction randId() {\n  return Math.random().toString(36).substr(2, 10) + new Date().getTime();\n}\nconst dtypeToTypedArray = {\n  int8: \"Int8Array\",\n  int16: \"Int16Array\",\n  int32: \"Int32Array\",\n  uint8: \"Uint8Array\",\n  uint16: \"Uint16Array\",\n  uint32: \"Uint32Array\",\n  float32: \"Float32Array\",\n  float64: \"Float64Array\",\n  array: \"Array\"\n};\nconst typedArrayToDtype = {\n  Int8Array: \"int8\",\n  Int16Array: \"int16\",\n  Int32Array: \"int32\",\n  Uint8Array: \"uint8\",\n  Uint16Array: \"uint16\",\n  Uint32Array: \"uint32\",\n  Float32Array: \"float32\",\n  Float64Array: \"float64\",\n  Array: \"array\"\n};\n\nfunction cacheUrlInServiceWorker(url) {\n  return new Promise(function (resolve, reject) {\n    const message = {\n      command: \"add\",\n      url: url\n    };\n\n    if (!navigator.serviceWorker || !navigator.serviceWorker.register) {\n      reject(\"Service worker is not supported.\");\n      return;\n    }\n\n    const messageChannel = new MessageChannel();\n\n    messageChannel.port1.onmessage = function (event) {\n      if (event.data && event.data.error) {\n        reject(event.data.error);\n      } else {\n        resolve(event.data && event.data.result);\n      }\n    };\n\n    if (navigator.serviceWorker && navigator.serviceWorker.controller) {\n      navigator.serviceWorker.controller.postMessage(message, [messageChannel.port2]);\n    } else {\n      reject(\"Service worker controller is not available\");\n    }\n  });\n}\n\nasync function cacheRequirements(requirements) {\n  if (!Array.isArray(requirements)) {\n    requirementsm.code.requirements = [requirements];\n  }\n\n  if (requirements && requirements.length > 0) {\n    for (let req of requirements) {\n      //remove prefix\n      if (req.startsWith(\"js:\")) req = req.slice(3);\n      if (req.startsWith(\"css:\")) req = req.slice(4);\n      if (req.startsWith(\"cache:\")) req = req.slice(6);\n      if (!req.startsWith(\"http\")) continue;\n      await cacheUrlInServiceWorker(req).catch(e => {\n        console.error(e);\n      });\n    }\n  }\n}\nfunction setupServiceWorker(baseUrl, targetOrigin, cacheCallback) {\n  // register service worker for offline access\n  if (\"serviceWorker\" in navigator) {\n    baseUrl = baseUrl || \"/\";\n    navigator.serviceWorker.register(baseUrl + \"plugin-service-worker.js\").then(function (registration) {\n      // Registration was successful\n      console.log(\"ServiceWorker registration successful with scope: \", registration.scope);\n    }, function (err) {\n      // registration failed :(\n      console.log(\"ServiceWorker registration failed: \", err);\n    });\n    targetOrigin = targetOrigin || \"*\";\n    cacheCallback = cacheCallback || cacheRequirements;\n\n    if (cacheCallback && typeof cacheCallback !== \"function\") {\n      throw new Error(\"config.cache_requirements must be a function\");\n    }\n\n    window.addEventListener(\"message\", function (e) {\n      if (targetOrigin === \"*\" || e.origin === targetOrigin) {\n        const m = e.data;\n\n        if (m.type === \"cacheRequirements\") {\n          cacheCallback(m.requirements);\n        }\n      }\n    });\n  }\n} //#Source https://bit.ly/2neWfJ2\n\nfunction urlJoin(...args) {\n  return args.join(\"/\").replace(/[\\/]+/g, \"/\").replace(/^(.+):\\//, \"$1://\").replace(/^file:/, \"file:/\").replace(/\\/(\\?|&|#[^!])/g, \"$1\").replace(/\\?/g, \"&\").replace(\"&\", \"?\");\n}\nclass MessageEmitter {\n  constructor(debug) {\n    this._event_handlers = {};\n    this._once_handlers = {};\n    this._debug = debug;\n  }\n\n  emit() {\n    throw new Error(\"emit is not implemented\");\n  }\n\n  on(event, handler) {\n    if (!this._event_handlers[event]) {\n      this._event_handlers[event] = [];\n    }\n\n    this._event_handlers[event].push(handler);\n  }\n\n  once(event, handler) {\n    handler.___event_run_once = true;\n    this.on(event, handler);\n  }\n\n  off(event, handler) {\n    if (!event && !handler) {\n      // remove all events handlers\n      this._event_handlers = {};\n    } else if (event && !handler) {\n      // remove all hanlders for the event\n      if (this._event_handlers[event]) this._event_handlers[event] = [];\n    } else {\n      // remove a specific handler\n      if (this._event_handlers[event]) {\n        const idx = this._event_handlers[event].indexOf(handler);\n\n        if (idx >= 0) {\n          this._event_handlers[event].splice(idx, 1);\n        }\n      }\n    }\n  }\n\n  _fire(event, data) {\n    if (this._event_handlers[event]) {\n      var i = this._event_handlers[event].length;\n\n      while (i--) {\n        const handler = this._event_handlers[event][i];\n\n        try {\n          handler(data);\n        } catch (e) {\n          console.error(e);\n        } finally {\n          if (handler.___event_run_once) {\n            this._event_handlers[event].splice(i, 1);\n          }\n        }\n      }\n    } else {\n      if (this._debug) {\n        console.warn(\"unhandled event\", event, data);\n      }\n    }\n  }\n\n}\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=imjoy-rpc.js.map","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../css-loader/index.js!./snackbar.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../css-loader/index.js!./snackbar.css\", function() {\n\t\t\tvar newContent = require(\"!!../../css-loader/index.js!./snackbar.css\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".snackbar-container {\\n  transition: all 500ms ease;\\n  transition-property: top, right, bottom, left, opacity;\\n  font-family: Roboto, sans-serif;\\n  font-size: 14px;\\n  min-height: 14px;\\n  background-color: #070b0e;\\n  position: fixed;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  color: white;\\n  line-height: 22px;\\n  padding: 18px 24px;\\n  bottom: -100px;\\n  top: -100px;\\n  opacity: 0;\\n  z-index: 9999; }\\n  .snackbar-container .action {\\n    background: inherit;\\n    display: inline-block;\\n    border: none;\\n    font-size: inherit;\\n    text-transform: uppercase;\\n    color: #4caf50;\\n    margin: 0 0 0 24px;\\n    padding: 0;\\n    min-width: min-content;\\n    cursor: pointer; }\\n\\n@media (min-width: 640px) {\\n  .snackbar-container {\\n    min-width: 288px;\\n    max-width: 568px;\\n    display: inline-flex;\\n    border-radius: 2px;\\n    margin: 24px; } }\\n\\n@media (max-width: 640px) {\\n  .snackbar-container {\\n    left: 0;\\n    right: 0;\\n    width: 100%; } }\\n\\n.snackbar-pos.bottom-center {\\n  top: auto !important;\\n  bottom: 0;\\n  left: 50%;\\n  transform: translate(-50%, 0); }\\n\\n.snackbar-pos.bottom-left {\\n  top: auto !important;\\n  bottom: 0;\\n  left: 0; }\\n\\n.snackbar-pos.bottom-right {\\n  top: auto !important;\\n  bottom: 0;\\n  right: 0; }\\n\\n.snackbar-pos.top-left {\\n  bottom: auto !important;\\n  top: 0;\\n  left: 0; }\\n\\n.snackbar-pos.top-center {\\n  bottom: auto !important;\\n  top: 0;\\n  left: 50%;\\n  transform: translate(-50%, 0); }\\n\\n.snackbar-pos.top-right {\\n  bottom: auto !important;\\n  top: 0;\\n  right: 0; }\\n\\n@media (max-width: 640px) {\\n  .snackbar-pos.bottom-center, .snackbar-pos.top-center {\\n    left: 0;\\n    transform: none; } }\\n\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(selector) {\n\t\tif (typeof memo[selector] === \"undefined\") {\n\t\t\tmemo[selector] = fn.call(this, selector);\n\t\t}\n\n\t\treturn memo[selector]\n\t};\n})(function (target) {\n\treturn document.querySelector(target)\n});\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton) options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n\tif (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else {\n\t\tthrow new Error(\"Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\toptions.attrs.type = \"text/css\";\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\toptions.attrs.type = \"text/css\";\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = options.transform(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","import Snackbar from \"node-snackbar/dist/snackbar\";\n\nconst builtinPlugins = [\n  \"https://gist.githubusercontent.com/oeway/c9592f23c7ee147085f0504d2f3e993a/raw/CellPose-ImageJ.imjoy.html\",\n  \"https://gist.githubusercontent.com/oeway/e5c980fbf6582f25fde795262a7e33ec/raw/itk-vtk-viewer-imagej.imjoy.html\"\n];\nasync function startImJoy(app, imjoy) {\n  await imjoy.start();\n  imjoy.event_bus.on(\"show_message\", msg => {\n    Snackbar.show({\n      text: msg,\n      pos: \"bottom-left\"\n    });\n  });\n  imjoy.event_bus.on(\"close_window\", w => {\n    app.closeWindow(w);\n    app.$forceUpdate();\n  });\n  imjoy.event_bus.on(\"plugin_loaded\", p => {\n    if (\n      !builtinPlugins.includes(p.config.origin) &&\n      p.type !== \"window\" &&\n      p.type !== \"rpc-window\"\n    )\n      app.showMenu();\n  });\n  let windowCount = 0;\n  imjoy.event_bus.on(\"add_window\", async w => {\n    windowCount++;\n    if (document.getElementById(w.window_id)) return;\n    if (w.dialog) {\n      app.dialogWindows.push(w);\n      app.selected_dialog_window = w;\n      if (w.fullscreen || w.standalone) app.fullscreen = true;\n      else app.fullscreen = false;\n      app.$modal.show(\"window-modal-dialog\");\n      app.$forceUpdate();\n      w.api.show = w.show = () => {\n        app.selected_dialog_window = w;\n        app.$modal.show(\"window-modal-dialog\");\n        imjoy.wm.selectWindow(w);\n        w.api.emit(\"show\");\n      };\n\n      w.api.hide = w.hide = () => {\n        if (app.selected_dialog_window === w) {\n          app.$modal.hide(\"window-modal-dialog\");\n        }\n        w.api.emit(\"hide\");\n      };\n\n      setTimeout(() => {\n        try {\n          w.show();\n        } catch (e) {\n          console.error(e);\n        }\n      }, 500);\n    } else {\n      const title = `${w.name}(#${windowCount})`;\n      let width, height;\n      if (w.fullscreen || w.standalone) {\n        width = -1;\n        height = -1;\n      } else {\n        width = Math.min(w.w * 30, window.screen.width);\n        height = Math.min(w.h * 30, window.screen.height);\n      }\n      await window.ij.createPlugInFrame(title, 0, 100, width, height);\n      // find the window element by the title\n      const xpath = `//a[text()='${title}']`;\n      const matchingElement = document.evaluate(\n        xpath,\n        document,\n        null,\n        XPathResult.FIRST_ORDERED_NODE_TYPE,\n        null\n      ).singleNodeValue;\n      const titleBar = matchingElement.parentNode;\n      const container = titleBar.previousSibling;\n      const elem = document.createElement(\"div\");\n      elem.id = w.window_id;\n      elem.style.marginTop = \"20px\";\n      elem.style.height = \"100%\";\n      container.appendChild(elem);\n      titleBar.addEventListener(\"dragstart\", () => {\n        elem.style.pointerEvents = \"none\";\n      });\n      titleBar.addEventListener(\"dragend\", () => {\n        elem.style.pointerEvents = \"auto\";\n      });\n      const observer = new MutationObserver(mutationsList => {\n        for (const mutation of mutationsList) {\n          if (mutation.type === \"childList\") {\n            // resizerBord div added during resizing\n            if (mutation.addedNodes.length === 1)\n              elem.style.pointerEvents = \"none\";\n            // resizerBord div removed after resizing\n            else if (mutation.removedNodes.length === 1)\n              elem.style.pointerEvents = \"auto\";\n            break;\n          }\n        }\n      });\n      // observe after the initialization\n      setTimeout(() => {\n        observer.observe(container.parentNode, { childList: true });\n      }, 2000);\n    }\n  });\n  // load built-in plugins\n  for (const p of builtinPlugins) {\n    app.loadPlugin(p);\n  }\n  app.loadPluginByQuery();\n  window.runImJoyPlugin = code => {\n    loader.style.display = \"block\";\n    imjoy.pm\n      .reloadPlugin({ code: code, load_dependencies: true })\n      .then(plugin => {\n        Snackbar.show({\n          text: `Plugin \"${plugin.name}\" loaded successfully.`,\n          pos: \"bottom-left\"\n        });\n        app.plugins[plugin.name] = plugin;\n        app.$forceUpdate();\n        if (plugin.api && plugin.api.run) {\n          plugin.api.run({});\n        } else {\n          Snackbar.show({\n            text: `No \"run\" function defined in Plugin \"${plugin.name}\".`,\n            pos: \"bottom-left\"\n          });\n        }\n      })\n      .finally(() => {\n        loader.style.display = \"none\";\n      });\n  };\n\n  window.reloadImJoyPlugin = code => {\n    loader.style.display = \"block\";\n    imjoy.pm\n      .reloadPlugin({ code: code, load_dependencies: true })\n      .then(plugin => {\n        Snackbar.show({\n          text: `Plugin \"${plugin.name}\" loaded successfully.`,\n          pos: \"bottom-left\"\n        });\n        app.plugins[plugin.name] = plugin;\n        app.$forceUpdate();\n      })\n      .finally(() => {\n        loader.style.display = \"none\";\n      });\n  };\n\n  window.callPlugin = async function(pluginName, functionName) {\n    let args = Array.prototype.slice.call(arguments).slice(2);\n    let promise = null;\n    if (args.length > 0) {\n      promise = args[args.length - 1];\n      args = args.slice(0, args.length - 1);\n    }\n    const plugin = await imjoy.pm.imjoy_api.getPlugin(null, pluginName);\n    try {\n      loader.style.display = \"block\";\n      for (let i = 0; i < args.length; i++) {\n        // convert ImagePlus to numpy array\n        if (args[i].constructor.name.endsWith(\"ImagePlus\")) {\n          const imgData = await window.ij.getImageData(\n            window.ij,\n            args[i],\n            false\n          );\n          args[i] = {\n            _rtype: \"ndarray\",\n            _rshape: imgData.shape,\n            _rdtype: imgData.type,\n            _rvalue: imgData.bytes\n          };\n        }\n      }\n\n      const result = await plugin[functionName].apply(plugin, args);\n      if (promise) {\n        if (typeof result === \"string\") {\n          await cjCall(promise, \"resolveString\", result);\n        } else if (result._rtype === \"ndarray\") {\n          const ip = await ij.ndarrayToImagePlus(result);\n          await cjCall(promise, \"resolveImagePlus\", ip);\n        } else {\n          if (promise)\n            await cjCall(promise, \"reject\", \"unsupported result type\");\n          else {\n            console.error(\"Unsupported result type:\", result);\n          }\n        }\n      }\n    } catch (e) {\n      if (promise) await cjCall(promise, \"reject\", e.toString());\n      else {\n        console.error(e);\n      }\n    } finally {\n      loader.style.display = \"none\";\n    }\n  };\n}\n\nconst CSStyle = `\n<style>\n.vm--modal{\n  max-height: 100%!important;\n  max-width: 100%!important;\n}\n.imjoy-inline-window{\n  width: 100%;\n  height: 600px;\n}\n.noselect {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n.dialog-control{\n  font-family: monospace;\n  margin-left: 2px;\n  width: 18px!important;\n  height: 16px;\n  border:0px;\n  font-size:1rem;\n  position: relative;\n  color:white;\n  top:1px;\n}\n.dialog-control:focus {\n  outline: none;\n}\n</style>`;\n\nconst APP_TEMPLATE = `\n<div style=\"padding-left: 1px;padding-top: 1px;\">\n<div class=\"dropdown\">\n  <img class=\"dropbtn\" src=\"https://imjoy.io/static/img/imjoy-icon-white.svg\">\n  <span class=\"dropbtn dropbtn-ext\">ImJoy</span>\n  <div class=\"dropdown-content\">\n    <a href=\"#\" v-for=\"(p, name) in plugins\" :key=\"p.id\" :title=\"p.config.description\" :style=\"{color: p.api.run?'#0456ef':'gray'}\" @click=\"run(p)\">{{p.name}}</a>\n    <hr class=\"solid\"  v-if=\"plugins&&Object.keys(plugins).length>0\">\n    <a href=\"#\" title=\"Load a new plugin\" @click=\"loadPlugin()\"><i class=\"fa-plus fa\"></i>&nbsp;ImJoy Plugin</a>\n    <a href=\"#\" title=\"Show ImJoy API documentation\" @click=\"loadImJoyApp()\"><i class=\"fa-rocket fa\"></i>&nbsp;ImJoy App</a>\n    <a title=\"Show ImJoy API documentation\" href=\"#\" @click=\"showAPIDocs()\"><i class=\"fa-book fa\"></i>&nbsp;ImJoy Docs</a>\n    <a title=\"About ImJoy\" href=\"#\" @click=\"aboutImJoy()\"><i class=\"fa-info-circle fa\"></i>&nbsp;About ImJoy</a>\n    <a v-for=\"wdialog in dialogWindows\" :title=\"wdialog.name\" class=\"btn btn-default\" @click=\"showWindow(wdialog)\">{{wdialog.name}}</a>\n    <hr class=\"solid\">\n    <a class=\"badge\" href=\"https://github.com/imjoy-team/imagej.js\" target=\"_blank\"><img src=\"https://img.shields.io/badge/Github-ImageJ.JS-blue\" alt=\"Github\"></img></a>\n  </div>\n</div>\n\n<modal name=\"window-modal-dialog\" height=\"500px\" style=\"max-height: 100%; max-width: 100%\" :fullscreen=\"fullscreen\" :resizable=\"true\" draggable=\".drag-handle\" :scrollable=\"true\">\n    <div v-if=\"selected_dialog_window\" @dblclick=\"maximizeWindow()\" class=\"navbar-collapse collapse drag-handle\" style=\"cursor:move; background-color: #448aff; color: white; text-align: center;\">\n    <div class=\"dialog-ctrl\" style=\"position: absolute; left:2px; margin-top: -1px;\">\n      <button @click=\"closeWindow(selected_dialog_window)\" class=\"noselect dialog-control\" style=\"background:#ff0000c4;\">\n        X\n      </button>\n      <button @click=\"minimizeWindow()\"  class=\"noselect dialog-control\" style=\"background:#00cdff61;\">\n        -\n      </button>\n      <button @click=\"maximizeWindow()\" class=\"noselect dialog-control\" style=\"background:#00cdff61;\">\n        {{fullscreen?'=': '+'}}\n      </button>\n    </div>\n      <span class=\"noselect\">{{ selected_dialog_window.name}}</span>\n      \n    </div>\n  <template v-for=\"wdialog in dialogWindows\">\n    <div\n      :key=\"wdialog.window_id\"\n      v-show=\"wdialog === selected_dialog_window\"\n      style=\"height: calc(100% - 18px);\"\n    >\n      <div :id=\"wdialog.window_id\" style=\"width: 100%;height: 100%;\"></div>\n    </div>\n  </template>\n</modal>\n</div>\n`;\n\nfunction promisify_functions(obj, bind) {\n  const ret = {};\n  for (let k in obj) {\n    if (typeof obj[k] === \"function\") {\n      // make sure it returns a promise\n      let func = obj[k];\n      if (bind) func = func.bind(null, bind);\n      if (func.constructor.name !== \"AsyncFunction\") {\n        ret[k] = function(...args) {\n          return Promise.resolve(func(...args));\n        };\n      } else {\n        ret[k] = func;\n      }\n    } else {\n      ret[k] = obj[k];\n    }\n  }\n  ret._rintf = true;\n  return ret;\n}\n\nexport async function setupImJoyApp(setAPI) {\n  const vue = await import(\"vue/dist/vue.common\");\n  const vuejsmodal = await import(\"vue-js-modal\");\n  const imjoyCore = await import(\"imjoy-core\");\n  const Vue = vue.default;\n  Vue.use(vuejsmodal.default);\n  var elem = document.createElement(\"div\");\n  elem.id = \"imjoy-menu\";\n  elem.innerHTML = APP_TEMPLATE;\n  document.body.appendChild(elem);\n\n  // const titleBar = document.querySelector(\".titleBar\");\n  // const updateImJoyIconPos = () => {\n  //   const bbox = titleBar.getBoundingClientRect();\n  //   const elem = document.getElementById(\"imjoy-menu\");\n  //   elem.style.left = bbox.left - 4 + \"px\";\n  //   elem.style.top = bbox.top + 1 + \"px\";\n  // };\n  // titleBar.addEventListener(\"drag\", updateImJoyIconPos);\n  document.head.insertAdjacentHTML(\"beforeend\", CSStyle);\n\n  const app = new Vue({\n    el: \"#imjoy-menu\",\n    data: {\n      dialogWindows: [],\n      selected_dialog_window: null,\n      plugins: {},\n      fullscreen: false,\n      imjoy: null,\n      active_plugin: null\n    },\n    mounted() {\n      console.log(`ImJoy Core (v${imjoyCore.VERSION}) loaded.`);\n      const imjoy = new imjoyCore.ImJoy({\n        imjoy_api: {\n          getWindow(_plugin, config) {\n            return new Promise((resolve, reject) => {\n              if (\n                config === \"ImageJ.JS\" ||\n                config.name === \"ImageJ.JS\" ||\n                config.type === \"ImageJ.JS\"\n              ) {\n                if (config === \"ImageJ.JS\") {\n                  config = { name: \"ImageJ.JS\", type: \"ImageJ.JS\" };\n                }\n                const api = Object.assign({}, imjoy.pm.imjoy_api);\n                api.export = (_plugin, service_api) => {\n                  resolve(promisify_functions(service_api));\n                };\n                api.registerCodec = () => {\n                  throw \"register codec is not implemented yet.\";\n                };\n                // we need to pass the Plugin object as second argument\n                // use config for now\n                // TODO: pass the actual plugin object\n                setAPI(promisify_functions(api, config));\n              } else {\n                imjoy.pm\n                  .getWindow(_plugin, config)\n                  .then(resolve)\n                  .catch(reject);\n              }\n            });\n          },\n          async showMessage(_plugin, msg, duration) {\n            duration = duration || 5;\n            Snackbar.show({\n              text: msg,\n              pos: \"bottom-left\"\n            });\n          },\n          async showDialog(_plugin, config) {\n            config.dialog = true;\n            return await imjoy.pm.createWindow(_plugin, config);\n          }\n        }\n      });\n      this.imjoy = imjoy;\n      startImJoy(this, this.imjoy);\n    },\n    methods: {\n      showMenu() {\n        const dm = document.querySelector(\n          \"#imjoy-menu>div>.dropdown>.dropdown-content\"\n        );\n        dm.style.display = \"block\";\n        setTimeout(() => {\n          dm.style.display = \"\";\n        }, 3000);\n      },\n      loadImJoyApp() {\n        this.imjoy.pm.imjoy_api.showDialog(null, {\n          src: \"https://imjoy.io/#/app\",\n          fullscreen: true,\n          passive: true\n        });\n      },\n      aboutImJoy() {\n        this.imjoy.pm.imjoy_api.showDialog(null, {\n          src: \"https://imjoy.io/#/about\",\n          passive: true\n        });\n      },\n      showAPIDocs() {\n        this.imjoy.pm.imjoy_api.createWindow(null, {\n          src: \"https://imjoy.io/docs/#/api\",\n          passive: true\n        });\n      },\n      async connectPlugin() {\n        const plugin = await this.imjoy.pm.connectPlugin(new Connection());\n        this.plugins[plugin.name] = plugin;\n        this.active_plugin = plugin;\n        this.$forceUpdate();\n      },\n      async runNotebookPlugin() {\n        try {\n          const plugin = this.active_plugin;\n          if (plugin.api.run) {\n            let config = {};\n            if (plugin.config.ui && plugin.config.ui.indexOf(\"{\") > -1) {\n              config = await this.imjoy.pm.imjoy_api.showDialog(\n                plugin,\n                plugin.config\n              );\n            }\n            await plugin.api.run({\n              config: config,\n              data: {}\n            });\n          }\n        } catch (e) {\n          console.error(e);\n          this.showMessage(`Failed to load the plugin, error: ${e}`);\n        }\n      },\n      async run(plugin) {\n        let config = {};\n        if (plugin.config.ui && plugin.config.ui.indexOf(\"{\") > -1) {\n          config = await this.imjoy.pm.imjoy_api.showDialog(\n            plugin,\n            plugin.config\n          );\n        }\n        await plugin.api.run({\n          config: config,\n          data: {}\n        });\n      },\n      showMessage(msg, duration) {\n        duration = duration || 5;\n        Snackbar.show({\n          text: msg,\n          pos: \"bottom-left\"\n        });\n      },\n      loadPlugin(p) {\n        if (!p) {\n          p = prompt(\n            `Please type a ImJoy plugin URL`,\n            \"https://github.com/imjoy-team/imjoy-plugins/blob/master/repository/ImageAnnotator.imjoy.html\"\n          );\n        }\n        this.imjoy.pm\n          .reloadPluginRecursively({\n            uri: p\n          })\n          .then(async plugin => {\n            this.plugins[plugin.name] = plugin;\n            if (!builtinPlugins.includes(plugin.config.origin))\n              this.showMessage(\n                `Plugin ${plugin.name} successfully loaded, you can now run it from the ImJoy plugin menu.`\n              );\n            this.$forceUpdate();\n          })\n          .catch(e => {\n            console.error(e);\n            this.showMessage(`Failed to load the plugin, error: ${e}`);\n          });\n      },\n      loadPluginByQuery() {\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        if (urlParams.has(\"plugin\") || urlParams.has(\"p\")) {\n          const p = urlParams.get(\"plugin\") || urlParams.get(\"p\");\n          this.loadPlugin(p);\n        }\n      },\n      showWindow(w) {\n        if (w.fullscreen || w.standalone) this.fullscreen = true;\n        else this.fullscreen = false;\n        if (w) this.selected_dialog_window = w;\n        this.$modal.show(\"window-modal-dialog\");\n      },\n      closeWindow(w) {\n        if (this.selected_dialog_window === w) {\n          this.selected_dialog_window = null;\n          this.$modal.hide(\"window-modal-dialog\");\n        }\n        const idx = this.dialogWindows.indexOf(w);\n        if (idx >= 0) this.dialogWindows.splice(idx, 1);\n      },\n      minimizeWindow() {\n        this.$modal.hide(\"window-modal-dialog\");\n      },\n      maximizeWindow() {\n        this.fullscreen = !this.fullscreen;\n      }\n    }\n  });\n  window.connectPlugin = async function() {\n    await app.connectPlugin();\n    await app.runNotebookPlugin();\n  };\n  window._connectPlugin = async function() {\n    await app.connectPlugin();\n  };\n  window._runPluginOnly = async function() {\n    await app.runNotebookPlugin();\n  };\n}\n","// from https://github.com/segmentio/is-url\n/**\n * RegExps.\n * A URL must match #1 and then at least one of #2/#3.\n * Use two levels of REs to avoid REDOS.\n */\n\nconst protocolAndDomainRE = /^(?:\\w+:)?\\/\\/([\\s\\S]+)$/;\n\nconst localhostDomainRE = /^localhost[\\:?\\d]*(?:[^\\:?\\d][\\s\\S]*)?$/;\nconst nonLocalhostDomainRE = /^[^\\s\\.]+\\.[\\s\\S]{2,}$/;\n\n/**\n * Loosely validate a URL `string`.\n *\n * @param {String} string\n * @return {Boolean}\n */\n\nexport function isUrl(string) {\n  if (typeof string !== \"string\") {\n    return false;\n  }\n\n  var match = string.match(protocolAndDomainRE);\n  if (!match) {\n    return false;\n  }\n\n  var everythingAfterProtocol = match[1];\n  if (!everythingAfterProtocol) {\n    return false;\n  }\n\n  if (\n    localhostDomainRE.test(everythingAfterProtocol) ||\n    nonLocalhostDomainRE.test(everythingAfterProtocol)\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\n//from: https://github.com/github-modules/github-url-to-object/blob/master/index.js\nconst laxUrlRegex = /(?:(?:[^:]+:)?[/][/])?(?:.+@)?([^/]+)([/][^?#]+)/;\n\nexport function githubUrlToObject(repoUrl, opts) {\n  var obj = {};\n  opts = opts || {};\n\n  if (!repoUrl) return null;\n\n  // Allow an object with nested `url` string\n  // (common practice in package.json files)\n  if (repoUrl.url) repoUrl = repoUrl.url;\n\n  if (typeof repoUrl !== \"string\") return null;\n\n  var shorthand = repoUrl.match(/^([\\w-_]+)\\/([\\w-_\\.]+)(?:#([\\w-_\\.]+))?$/);\n  var mediumhand = repoUrl.match(\n    /^github:([\\w-_]+)\\/([\\w-_\\.]+)(?:#([\\w-_\\.]+))?$/\n  );\n  var antiquated = repoUrl.match(/^git@[\\w-_\\.]+:([\\w-_]+)\\/([\\w-_\\.]+)$/);\n\n  if (shorthand) {\n    obj.user = shorthand[1];\n    obj.repo = shorthand[2];\n    obj.branch = shorthand[3] || \"master\";\n    obj.host = \"github.com\";\n  } else if (mediumhand) {\n    obj.user = mediumhand[1];\n    obj.repo = mediumhand[2];\n    obj.branch = mediumhand[3] || \"master\";\n    obj.host = \"github.com\";\n  } else if (antiquated) {\n    obj.user = antiquated[1];\n    obj.repo = antiquated[2].replace(/\\.git$/i, \"\");\n    obj.branch = \"master\";\n    obj.host = \"github.com\";\n  } else {\n    // Turn git+http URLs into http URLs\n    repoUrl = repoUrl.replace(/^git\\+/, \"\");\n\n    if (!isUrl(repoUrl)) return null;\n\n    const [, hostname, pathname] = repoUrl.match(laxUrlRegex) || [];\n    if (!hostname) return null;\n    if (\n      hostname !== \"github.com\" &&\n      hostname !== \"www.github.com\" &&\n      !opts.enterprise\n    )\n      return null;\n\n    var parts = pathname.match(\n      /^\\/([\\w-_]+)\\/([\\w-_\\.]+)(\\/tree\\/[\\w-_\\.\\/]+)?(\\/blob\\/[\\s\\w-_\\.\\/]+)?/\n    );\n    // ([\\w-_\\.]+)\n    if (!parts) return null;\n    obj.user = parts[1];\n    obj.repo = parts[2].replace(/\\.git$/i, \"\");\n\n    obj.host = hostname || \"github.com\";\n\n    if (parts[3] && /^\\/tree\\/master\\//.test(parts[3])) {\n      obj.branch = \"master\";\n      obj.path = parts[3].replace(/\\/$/, \"\");\n    } else if (parts[3]) {\n      obj.branch = parts[3]\n        .replace(/^\\/tree\\//, \"\")\n        .match(/[\\w-_.]+\\/{0,1}[\\w-_]+/)[0];\n    } else if (parts[4]) {\n      obj.branch = parts[4]\n        .replace(/^\\/blob\\//, \"\")\n        .match(/[\\w-_.]+\\/{0,1}[\\w-_]+/)[0];\n    } else {\n      obj.branch = \"master\";\n    }\n  }\n\n  if (obj.host === \"github.com\") {\n    obj.apiHost = \"api.github.com\";\n  } else {\n    obj.apiHost = `${obj.host}/api/v3`;\n  }\n\n  obj.tarball_url = `https://${obj.apiHost}/repos/${obj.user}/${obj.repo}/tarball/${obj.branch}`;\n  obj.clone_url = `https://${obj.host}/${obj.user}/${obj.repo}`;\n\n  if (obj.branch === \"master\") {\n    obj.https_url = `https://${obj.host}/${obj.user}/${obj.repo}`;\n    obj.travis_url = `https://travis-ci.org/${obj.user}/${obj.repo}`;\n    obj.zip_url = `https://${obj.host}/${obj.user}/${obj.repo}/archive/master.zip`;\n  } else {\n    obj.https_url = `https://${obj.host}/${obj.user}/${obj.repo}/blob/${obj.branch}`;\n    obj.travis_url = `https://travis-ci.org/${obj.user}/${obj.repo}?branch=${obj.branch}`;\n    obj.zip_url = `https://${obj.host}/${obj.user}/${obj.repo}/archive/${obj.branch}.zip`;\n  }\n\n  // Support deep paths (like lerna-style repos)\n  if (obj.path) {\n    obj.https_url += obj.path;\n  }\n\n  obj.api_url = `https://${obj.apiHost}/repos/${obj.user}/${obj.repo}`;\n\n  return obj;\n}\n\n// from: https://github.com/Elixirdoc/github-url-raw\nexport async function githubUrlRaw(url, extFilter) {\n  if (url.includes(\"gist.github.com\")) {\n    const gistId = url.split(\"/\").slice(-1)[0];\n    const blob = await fetch(\"https://api.github.com/gists/\" + gistId).then(r =>\n      r.blob()\n    );\n    const data = JSON.parse(await new Response(blob).text());\n    // TODO: handle multiple files, e.g.: display them all\n    if (extFilter) {\n      const selected_file = Object.values(data.files).filter(file => {\n        return file.filename.endsWith(extFilter);\n      })[0];\n      return selected_file && selected_file.raw_url;\n    } else return data.files[Object.values(data.files)[0]].raw_url;\n  }\n  if (!url.includes(\"blob\") || !url.includes(\"github\")) {\n    return null;\n  }\n  var ghObj = githubUrlToObject(url);\n  var githubUser = ghObj.user;\n  var githubRepo = ghObj.repo;\n  // var githubBranch = ghObj.branch;\n  var re = new RegExp(\n    \"^https://github.com/\" + githubUser + \"/\" + githubRepo + \"/blob/\",\n    \"g\"\n  );\n  var regStr = url.replace(re, \"\");\n\n  return (\n    \"https://raw.githubusercontent.com/\" +\n    githubUser +\n    \"/\" +\n    githubRepo +\n    \"/\" +\n    regStr\n  );\n}\n\nexport async function convertZenodoFileUrl(url) {\n  const myRegexp = /https?:\\/\\/zenodo.org\\/record\\/([a-zA-Z0-9-]+)\\/files\\/(.*)/g;\n  const match = myRegexp.exec(url);\n  if (!match || match.length !== 3) {\n    throw new Error(\"Invalid zenodo url\");\n  }\n  const [fullUrl, depositId, fileName] = match;\n  const blob = await fetch(\n    `https://zenodo.org/api/records/${depositId}`\n  ).then(r => r.blob());\n  const data = JSON.parse(await new Response(blob).text());\n  const fn = fileName.split(\"?\")[0];\n  const fileObj = data.files.filter(file => {\n    return file.key === fn;\n  })[0];\n  return fileObj.links.self;\n}\n","import { setupImJoyApp } from \"./imjoyApp.js\";\nimport { setupImJoyAPI } from \"./imjoyAPI.js\";\nimport { githubUrlRaw, convertZenodoFileUrl } from \"./utils.js\";\nimport LZString from \"lz-string\";\nimport Snackbar from \"node-snackbar/dist/snackbar\";\nimport \"node-snackbar/dist/snackbar.css\";\nimport A11yDialog from \"a11y-dialog\";\nimport { polyfill } from \"mobile-drag-drop\";\n\n// optional import of scroll behaviour\nimport { scrollBehaviourDragImageTranslateOverride } from \"mobile-drag-drop/scroll-behaviour\";\n\nconst ua = window.navigator.userAgent.toLowerCase();\nconst isiPad =\n  ua.indexOf(\"ipad\") > -1 ||\n  (ua.indexOf(\"macintosh\") > -1 && \"ontouchend\" in document);\nconst usePolyfill = polyfill({\n  forceApply: isiPad, // force apply for ipad\n  dragImageTranslateOverride:\n    scrollBehaviourDragImageTranslateOverride || isiPad\n});\n\n// https://github.com/timruffles/mobile-drag-drop/issues/152\nif (usePolyfill) {\n  document.addEventListener(\"dragenter\", event => event.preventDefault());\n  window.addEventListener(\"touchmove\", () => {}, { passive: false });\n}\n\nconst isChrome = !!window.chrome;\nconst isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nif (!isChrome && !isFirefox) {\n  Snackbar.show({\n    text:\n      \"Note: ImageJ.JS is only tested with Chrome or Firefox, other browsers may not work properly.\",\n    pos: \"bottom-left\"\n  });\n}\n\nconst codeEditors = {};\nwindow.onEditorResized = () => {\n  setTimeout(() => {\n    for (let id in codeEditors) {\n      const textArea = document.getElementById(id);\n      if (textArea) {\n        const bbox = textArea.getBoundingClientRect();\n        codeEditors[id].setSize(bbox.width - 8, bbox.height - 7);\n      } else {\n        delete codeEditors[id];\n      }\n    }\n  }, 1);\n};\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\nfunction debounce(func, wait, immediate) {\n  var timeout;\n  return function() {\n    var context = this,\n      args = arguments;\n    var later = function() {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    var callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n}\n\nwindow.onEditorTextChanged = debounce((name, content) => {\n  // update the sharing url\n  if (sharingScript && name === sharingScript.name) {\n    const compressed = LZString.compressToEncodedURIComponent(\n      JSON.stringify({ name, content })\n    );\n    insertUrlParam(\"open\", compressed);\n  }\n}, 1000);\n\nfunction insertUrlParam(key, value) {\n  if (history.pushState) {\n    let searchParams = new URLSearchParams(window.location.search);\n    searchParams.set(key, value);\n    let newurl =\n      window.location.protocol +\n      \"//\" +\n      window.location.host +\n      window.location.pathname +\n      \"?\" +\n      searchParams.toString();\n    window.history.pushState({ path: newurl }, \"\", newurl);\n  }\n}\n\nlet sharingScript = null;\nwindow.shareViaURL = (name, content) => {\n  const compressed = LZString.compressToEncodedURIComponent(\n    JSON.stringify({ name, content })\n  );\n  insertUrlParam(\"open\", compressed);\n  sharingScript = { name, content };\n  let message = `The script is encoded as URL, you can now copy and share the URL in the address bar!`;\n  if (compressed.length > 8192 - 100) {\n    message =\n      message +\n      \"\\nWARNING: the generated URL might be too long for some browser, you may want to share it via Github or Gist instead.\";\n  }\n  alert(message);\n};\n\nwindow.shareViaGithub = () => {\n  window.open(\n    \"https://github.com/imjoy-team/imagej.js#sharing-images-macro-or-plugins-with-url-parameters\"\n  );\n};\n\n// setup a hook for fixing mobile touch event\nconst _createElement = document.createElement;\n\nlet lastMenus = [];\nfunction switchMenu(menu) {\n  if (menu) {\n    menu.classList.add(\"active\");\n    if (lastMenus.length > 0) {\n      let i = lastMenus.length;\n      while (i--) {\n        if (!lastMenus[i].contains(menu)) {\n          lastMenus[i].classList.remove(\"active\");\n          lastMenus.splice(i, 1);\n        }\n      }\n    }\n    lastMenus.push(menu);\n  } else {\n    if (lastMenus.length > 0) {\n      for (let m of lastMenus) {\n        m.classList.remove(\"active\");\n      }\n      lastMenus = [];\n    }\n  }\n}\n\nfunction touchClick(ev) {\n  ev.target.focus();\n  ev.target.click();\n  ev.preventDefault();\n  if ([\"UL\", \"LI\", \"BUTTON\", \"INPUT\", \"A\"].includes(ev.target.tagName)) {\n    ev.stopPropagation();\n    switchMenu(null);\n  } else if (ev.target.tagName === \"LABEL\") {\n    const menu = ev.target.parentNode.parentNode;\n    if (menu && menu.classList.contains(\"subMenuItem\")) {\n      switchMenu(menu);\n    } else {\n      switchMenu(null);\n    }\n    ev.stopPropagation();\n  } else {\n    switchMenu(null);\n  }\n}\n\nfunction replaceTextArea(elm) {\n  const editorDiv = _createElement.call(document, \"DIV\");\n  editorDiv.setAttribute(\"style\", elm.getAttribute(\"style\"));\n  editorDiv.style[\"z-index\"] = 0;\n  const myCodeMirror = CodeMirror(editorDiv, {\n    value: elm.value,\n    mode: {\n      name: \"htmlmixed\",\n      tags: {\n        docs: [[null, null, \"markdown\"]],\n        config: [\n          [\"lang\", /^json$/, \"javascript\"],\n          [\"lang\", /^yaml$/, \"yaml\"],\n          [null, null, \"javascript\"]\n        ],\n        script: [\n          [\"lang\", /^python$/, \"python\"],\n          [null, null, \"javascript\"]\n        ]\n      }\n    },\n    lineNumbers: false,\n    matchBrackets: true\n    // lint: true,\n    // gutters: [\"CodeMirror-lint-markers\"],\n  });\n  const bbox = elm.getBoundingClientRect();\n  myCodeMirror.setSize(bbox.width - 8, bbox.height - 7);\n  setTimeout(function() {\n    myCodeMirror.refresh();\n  }, 1);\n  elm.parentNode.appendChild(editorDiv);\n  elm.id =\n    \"_\" +\n    Math.random()\n      .toString(36)\n      .substr(2, 9);\n  codeEditors[elm.id] = myCodeMirror;\n  myCodeMirror.on(\"change\", () => {\n    elm.value = myCodeMirror.getValue();\n    const event = new Event(\"input\", {\n      bubbles: true,\n      cancelable: true\n    });\n    elm.dispatchEvent(event);\n  });\n}\n\ndocument.createElement = function(type) {\n  const elm = _createElement.call(document, type);\n  elm.addEventListener(\"touchstart\", touchClick, false);\n  if (elm.nodeName === \"TEXTAREA\") {\n    function tryReplace() {\n      if (!document.contains(elm)) {\n        setTimeout(tryReplace, 200);\n        return;\n      }\n      // only apply to textarea in a window\n      if (\n        elm.parentNode.nextSibling &&\n        elm.parentNode.nextSibling.classList[0] === \"titleBar\"\n      ) {\n        if (elm.style.display === \"none\") setTimeout(tryReplace, 200);\n        else if (\n          elm.parentNode.nextSibling.children[0].innerText.endsWith(\".html\")\n        )\n          replaceTextArea(elm);\n      }\n    }\n    setTimeout(tryReplace, 200);\n  }\n  return elm;\n};\n\nwindow.debug = async message => {\n  console.log(message);\n  debugger;\n};\n\n// Get the dialog element (with the accessor method you want)\nconst el = document.getElementById(\"open-file-dialog\");\n\n// Instantiate a new A11yDialog module\nconst fileDialog = new A11yDialog(el);\n\nwindow.openFileDialogJS = async (title, initPath, selectionMode, promise) => {\n  document.getElementById(\"dialogTitle\").innerHTML = title || \"Open File\";\n  fileDialog.show();\n  let closed = false;\n  fileDialog.on(\"hide\", function(dialogEl, event) {\n    if (!closed) {\n      closed = true;\n      cjCall(promise, \"reject\", \"cancelled\");\n    }\n  });\n  document.getElementById(\"open-file-modal-select\").onclick = () => {\n    if (!closed) {\n      const fileInput = document.getElementById(\"open-file\");\n      fileInput.onchange = () => {\n        const files = fileInput.files;\n        // TODO: when do we remove this file?\n        mountFile(files[0])\n          .then(filepath => {\n            cjCall(promise, \"resolve\", filepath);\n          })\n          .catch(e => {\n            cjCall(promise, \"reject\", String(e));\n          });\n        fileInput.value = \"\";\n        closed = true;\n        fileDialog.hide();\n      };\n      fileInput.click();\n    }\n  };\n  document.getElementById(\"open-file-modal-internal\").onclick = () => {\n    if (!closed) {\n      closed = true;\n      cjCall(promise, \"resolve\", \"\");\n    }\n    fileDialog.hide();\n  };\n};\n\nwindow.saveFileDialogJS = async (title, initPath, selectionMode, promise) => {\n  // by pass the selection\n  const savePath = prompt(title || \"Saving file as \", initPath);\n  if (savePath) {\n    downloadQueue[savePath] = 1;\n    loader.style.display = \"block\";\n    await cjCall(promise, \"resolve\", \"/files/\" + savePath);\n  } else {\n    await cjCall(promise, \"reject\", \"cancelled\");\n  }\n};\n\nwindow.onFileOpened = (path, error) => {\n  if (error) {\n    Snackbar.show({\n      text: \"Failed to load file from \" + path,\n      pos: \"bottom-left\"\n    });\n  }\n  cheerpjRemoveStringFile(path);\n};\n\nwindow.openURL = async url => {\n  window.open(url);\n};\n\nconst loader = document.getElementById(\"loader\");\nloader.style.display = \"none\";\nwindow.getBytesFromUrl = async (originalUrl, promise) => {\n  try {\n    loader.style.display = \"block\";\n    let url = originalUrl.replace(\"http://\", \"https://\");\n    Snackbar.show({\n      text: \"Fetching data from: \" + originalUrl,\n      pos: \"bottom-left\"\n    });\n    const blob = await fetch(url).then(r => r.blob());\n    const buffer = await new Response(blob).arrayBuffer();\n    await cjCall(\n      promise,\n      \"resolve\",\n      cjTypedArrayToJava(new Uint8Array(buffer))\n    );\n  } catch (e) {\n    console.error(\"Failed to get data from \" + originalUrl, e);\n    Snackbar.show({\n      text: \"Failed to fetch data from: \" + originalUrl + \": \" + e.toString(),\n      pos: \"bottom-left\"\n    });\n    await cjCall(promise, \"reject\", e.toString());\n  } finally {\n    loader.style.display = \"none\";\n  }\n};\n\nconst downloadQueue = {};\n\nasync function startImageJ() {\n  loader.style.display = \"block\";\n  let preload = localStorage.getItem(\"cheepjPreload\");\n  if (preload) preload = JSON.parse(preload);\n  else preload = [];\n  cheerpjInit({\n    preloadResources: preload,\n    enableInputMethods: true,\n    clipboardMode: \"java\",\n    enablePreciseClassLoaders: true,\n    disableErrorReporting: true,\n    javaProperties: [\"user.dir=/files\", \"plugins.dir=/app/ij153/plugins\"]\n  });\n  const appContainer = document.getElementById(\"imagej-container\");\n  const elm = cheerpjCreateDisplay(-1, -1, appContainer);\n  const _addEL = elm.addEventListener;\n  elm.addEventListener = (event, handler, options) => {\n    if (\n      event === \"dblclick\" ||\n      event.startsWith(\"mouse\") ||\n      event === \"wheel\" ||\n      event === \"contextmenu\"\n    ) {\n      _addEL.apply(elm, [\n        event,\n        e => {\n          // skip handling mouse events for the cheerpj display and textarea elements\n          if (\n            e.target !== elm &&\n            e.target.nodeName !== \"TEXTAREA\" &&\n            e.target.getAttribute(\"role\") !== \"presentation\"\n          ) {\n            handler.apply(null, [e]);\n          } else {\n            switchMenu(null);\n          }\n        }\n      ]);\n    } else if (event.startsWith(\"drag\")) {\n      _addEL.apply(elm, [\n        event,\n        e => {\n          // fix for mobile\n          if (e.dataTransfer && !e.dataTransfer.items)\n            e.dataTransfer.items = [];\n          handler.apply(null, [e]);\n        },\n        options\n      ]);\n    } else if (event.startsWith(\"touch\")) {\n      _addEL.apply(elm, [\n        event,\n        e => {\n          // skip for menubar\n          if (\n            !e.target.classList.contains(\"titleBar\") &&\n            !(\n              e.target.parentNode &&\n              e.target.parentNode.classList.contains(\"titleBar\")\n            )\n          ) {\n            handler.apply(null, [e]);\n          } else if (\n            e.target.parentNode &&\n            e.target.parentNode.classList.contains(\"titleBar\")\n          ) {\n            e.target.style.display = \"none\";\n            setTimeout(() => {\n              e.target.style.display = \"inline-block\";\n            }, 2000);\n            handler.apply(null, [e]);\n          }\n        },\n        options\n      ]);\n    } else {\n      _addEL.apply(elm, [event, handler, options]);\n    }\n  };\n  fixWindowOrder();\n  cheerpjRunMain(\"ij.ImageJ\", \"/app/ij153/ij-1.53f.jar\");\n}\n\nasync function listFiles(imagej, path) {\n  const files = await imagej.listDir(path);\n  return files.map(cjStringJavaToJs);\n}\n\nasync function mountFile(file) {\n  const filepath = \"/str/\" + file.name;\n  const bytes = await readFile(file);\n  cheerpjAddStringFile(filepath, bytes);\n  return filepath;\n}\n\nasync function showImage(img, options) {\n  const imagej = window.ij;\n  options = options || {};\n  options.name = options.name || \"tmp\";\n  const filepath = \"/str/\" + options.name;\n  if (img instanceof ArrayBuffer) {\n    cheerpjAddStringFile(filepath, new Uint8Array(img));\n    return await openImage(imagej, filepath);\n  } else {\n    const formats = {\n      uint8: \"8-bit\",\n      uint16: \"16-bit Unsigned\",\n      int16: \"16-bit Signed\",\n      uint32: \"32-bit Unsigned\",\n      int32: \"32-bit Signed\",\n      float32: \"32-bit Real\",\n      flaot64: \"64-bit Real\"\n    };\n    cheerpjAddStringFile(filepath, new Uint8Array(img._rvalue));\n    let format = formats[img._rdtype];\n\n    if (img._rshape.length === 3) {\n      let number = img._rshape[2];\n      if (img._rshape[2] === 3) {\n        format = \"24-bit RGB\";\n        number = 1;\n      }\n      return await imagej.run(\n        \"Raw...\",\n        `open=${filepath} image=[${format}] width=${img._rshape[1]} height=${img._rshape[0]} number=${number} little-endian`\n      );\n    } else if (img._rshape.length === 4) {\n      if (img._rshape[3] === 3) {\n        format = \"24-bit RGB\";\n      } else {\n        if (img._rshape[3] !== 1) {\n          throw \"channel dimension (last) can only be 1 or 3\";\n        }\n      }\n      return await imagej.run(\n        \"Raw...\",\n        `open=${filepath} image=[${format}] width=${img._rshape[2]} height=${img._rshape[1]} number=${img._rshape[0]} little-endian`\n      );\n    } else if (img._rshape.length === 2) {\n      return await imagej.run(\n        \"Raw...\",\n        `open=${filepath} image=[${format}] width=${img._rshape[1]} height=${img._rshape[0]} little-endian`\n      );\n    }\n  }\n}\n\nconst typeMapping = {\n  uint8: 0, //GRAY8 8-bit grayscale (unsigned)\n  uint16: 1, //GRAY16 16-bit grayscale (unsigned)\n  float32: 2 //\tGRAY32 32-bit floating-point grayscale\n};\n\n//convert numpy array to ImagePlus\nasync function ndarrayToImagePlus(array) {\n  if (!typeMapping[array._rdtype]) {\n    if (promise)\n      await cjCall(\n        promise,\n        \"reject\",\n        \"unsupported array dtype: \" +\n          array._rdtype +\n          \", valid dtypes: uint8, uint16, flat32\"\n      );\n    else {\n      console.error(\n        \"unsupported array dtype: \" +\n          array._rdtype +\n          \", valid dtypes: uint8, uint16, flat32\"\n      );\n    }\n  }\n  const shape = Int16Array.from([1, 1, 1, 1, 1]);\n  if (array._rshape.length === 2) {\n    shape[3] = array._rshape[0]; // height\n    shape[4] = array._rshape[1]; // width\n  } else if (array._rshape.length === 3) {\n    shape[2] = array._rshape[0]; // channel\n    shape[3] = array._rshape[1]; // height\n    shape[4] = array._rshape[2]; // width\n  } else if (array._rshape.length === 4) {\n    shape[1] = array._rshape[0]; // stack\n    shape[2] = array._rshape[1]; // channel\n    shape[3] = array._rshape[2]; // height\n    shape[4] = array._rshape[3]; // width\n  } else if (array._rshape.length === 5) {\n    shape[0] = array._rshape[0]; // frame\n    shape[1] = array._rshape[1]; // stack\n    shape[2] = array._rshape[2]; // channel\n    shape[3] = array._rshape[3]; // height\n    shape[4] = array._rshape[4]; // width\n  } else {\n    if (promise)\n      await cjCall(\n        promise,\n        \"reject\",\n        \"unsupported array shape: \" +\n          array._rshape +\n          \", allowed dimensions: 2-5\"\n      );\n    else {\n      console.error(\n        \"unsupported array shape: \" +\n          array._rshape +\n          \", allowed dimensions: 2-5\"\n      );\n    }\n  }\n  const ip = await ij.createImagePlus(\n    cjTypedArrayToJava(new Uint8Array(array._rvalue)),\n    typeMapping[array._rdtype],\n    cjTypedArrayToJava(shape),\n    array.title || \"untitiled image\"\n  );\n  return ip;\n}\n// Note: 'channel', 'slice' and 'frame' are one-based indexes\nasync function getImageData(imagej, imp, all, channel, slice, frame) {\n  // const name = cjStringJavaToJs(await cjCall(imp, \"getTitle\"));\n  const width = await cjCall(imp, \"getWidth\");\n  const height = await cjCall(imp, \"getHeight\");\n  const channels = await cjCall(imp, \"getNChannels\");\n  const type = await cjCall(imp, \"getType\");\n  const typeMapping = {\n    0: \"uint8\", //GRAY8 8-bit grayscale (unsigned)\n    1: \"uint16\", //GRAY16 16-bit grayscale (unsigned)\n    2: \"float32\", //\tGRAY32 32-bit floating-point grayscale\n    3: \"uint8\", // COLOR_256 8-bit indexed color\n    4: \"uint8\" // COLOR_RGB 24-bit RGB color\n  };\n  const bytesPerPixelMapping = {\n    0: 1, //GRAY8 8-bit grayscale (unsigned)\n    1: 2, //GRAY16 16-bit grayscale (unsigned)\n    2: 4, //\tGRAY32 32-bit floating-point grayscale\n    3: 1, // COLOR_256 8-bit indexed color\n    4: 1 // COLOR_RGB 24-bit RGB color\n  };\n\n  if (all) {\n    const slices = await cjCall(imp, \"getNSlices\");\n    const frames = await cjCall(imp, \"getNFrames\");\n    const bytes = javaBytesToArrayBuffer(await imagej.saveAsBytes(imp, \"raw\"));\n    const shape = [height.value0, width.value0, channels.value0];\n    // calculate the actual channel number, e.g. for RGB image\n    shape[2] =\n      bytes.byteLength /\n      (shape[0] * shape[1] * (slices.value0 || 1) * (frames.value0 || 1)) /\n      bytesPerPixelMapping[type.value0];\n    if (slices.value0 && slices.value0 !== 1) {\n      // insert to the begining\n      shape.splice(0, 0, slices.value0);\n    }\n    if (frames.value0 && frames.value0 !== 1) {\n      // insert to the begining\n      shape.splice(0, 0, frames.value0);\n    }\n    return {\n      type: typeMapping[type.value0],\n      shape: shape,\n      bytes\n    };\n  } else {\n    if (channel === undefined) channel = 0; // 0 means current channel\n    if (slice === undefined) slice = 0; // 0 means current slice\n    if (frame === undefined) frame = 0; // 0 means current frame\n    const bytes = javaBytesToArrayBuffer(\n      await imagej.getPixels(imp, channel, slice, frame)\n    );\n    const shape = [height.value0, width.value0, channels.value0];\n    // calculate the actual channel number, e.g. for RGB image\n    shape[2] =\n      bytes.byteLength /\n      (shape[0] * shape[1] * (shape[3] || 1) * (shape[4] || 1)) /\n      bytesPerPixelMapping[type.value0];\n\n    return {\n      type: typeMapping[type.value0],\n      shape: shape,\n      bytes\n    };\n  }\n}\n\nasync function saveImage(imagej, filename, format, ext) {\n  format = format || \"tiff\";\n\n  const imp = await imagej.getImage();\n  const original_name = cjStringJavaToJs(await cjCall(imp, \"getTitle\"));\n  filename =\n    filename ||\n    cjStringJavaToJs(\n      await imagej.getString(\n        \"Saving file as \",\n        original_name.split(\".\")[0] + (ext || \".\" + format)\n      )\n    );\n  if (filename) {\n    const fileBytes = javaBytesToArrayBuffer(\n      await imagej.saveAsBytes(imp, format)\n    );\n    downloadBytesFile([fileBytes.buffer], filename);\n  }\n}\n\nfunction downloadBytesFile(fileByteArray, filename) {\n  const blob = new Blob(fileByteArray, {\n    type: \"application/octet-stream\"\n  });\n\n  if (window.navigator.msSaveOrOpenBlob) {\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    const elem = window.document.createElement(\"a\");\n    elem.href = window.URL.createObjectURL(blob);\n    elem.download = filename;\n    document.body.appendChild(elem);\n    elem.click();\n    document.body.removeChild(elem);\n  }\n}\n\nfunction openImage(imagej, path) {\n  if (path) {\n    return imagej.openAsync(path);\n  }\n  return new Promise((resolve, reject) => {\n    const fileInput = document.getElementById(\"open-file\");\n    fileInput.onchange = () => {\n      const files = fileInput.files;\n      for (let i = 0, len = files.length; i < len; i++) {\n        if (\n          files[i].name.endsWith(\".jar\") ||\n          files[i].name.endsWith(\".jar.js\")\n        ) {\n          saveFileToFS(imagej, files[i])\n            .then(resolve)\n            .catch(reject);\n        } else {\n          mountFile(files[i])\n            .then(filepath => {\n              imagej\n                .openAsync(filepath)\n                .then(resolve)\n                .catch(reject)\n                .finally(() => {\n                  cheerpjRemoveStringFile(filepath);\n                });\n            })\n            .catch(reject);\n        }\n      }\n      fileInput.value = \"\";\n    };\n    fileInput.click();\n  });\n}\n\nfunction javaBytesToArrayBuffer(bytes) {\n  return bytes.slice(1).buffer;\n}\n\nasync function saveFileToFS(imagej, file) {\n  const bytes = await readFile(file);\n  await imagej.saveBytes(cjTypedArrayToJava(bytes), \"/files/\" + file.name);\n  console.log(await listFiles(imagej, \"/files/\"));\n}\n\nfunction fixWindowOrder() {\n  const cdisplay = document.getElementById(\"cheerpjDisplay\");\n  const _appendChild = cdisplay.appendChild;\n  const sortByZIndex = function(a, b) {\n    return a.style.zIndex - b.style.zIndex;\n  };\n  function bringToTop(elm) {\n    const windows = Array.from(cdisplay.querySelectorAll(\".window.bordered\"));\n    let index = 0;\n    for (const w of windows.sort(sortByZIndex)) {\n      if (w === elm) {\n        w.style[\"z-index\"] = windows.length + 1;\n      } else {\n        w.style[\"z-index\"] = index;\n      }\n      index += 1;\n    }\n  }\n  cdisplay.appendChild = elm => {\n    try {\n      if (\n        elm.classList.contains(\"window\") &&\n        elm.classList.contains(\"bordered\")\n      ) {\n        bringToTop(bringToTop);\n        return;\n      }\n      elm.addEventListener(\"click\", () => {\n        if (\n          elm.classList.contains(\"window\") &&\n          elm.classList.contains(\"bordered\")\n        ) {\n          bringToTop(elm);\n        }\n      });\n      setTimeout(() => {\n        if (\n          elm.classList.contains(\"window\") &&\n          elm.classList.contains(\"bordered\")\n        ) {\n          bringToTop(elm);\n        }\n      }, 100);\n      return _appendChild.apply(cdisplay, [elm]);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n}\n\nasync function fixMenu() {\n  const removes = [\n    \"Open Recent\",\n    \"Install... \",\n    \"Show Folder\",\n    \"Update ImageJ...\",\n    \"Compile and Run...\",\n    \"Capture Screen\",\n    \"Capture Delayed...\",\n    \"Capture Image\"\n  ];\n  const items = document.querySelectorAll(\n    \"#cheerpjDisplay>.window:nth-child(2) li > a\"\n  );\n  for (let it of items) {\n    if (removes.includes(it.text)) {\n      // remove li\n      const el = it.parentNode;\n      el.parentNode.removeChild(el);\n    }\n    // else if (it.text === \"Open...\") {\n    //   const openNode = it.parentNode;\n    //   const openMenu = openNode.cloneNode(true);\n    //   it.text = \"Open Internal\"\n    //   openMenu.onclick = e => {\n    //     e.stopPropagation();\n    //     openImage(imagej);\n    //   };\n    //   openNode.parentNode.insertBefore(openMenu, openNode)\n    // }\n  }\n\n  // addMenuItem({\n  //   label: \"Debug\",\n  //   async callback() {\n  //     const bytes = new ArrayBuffer(100*100*2);\n  //     const pixels = new Uint16Array(bytes);\n  //     for(let i=0;i<1000;i++){\n  //       pixels[i] = i;\n  //     }\n  //     const shape = Int16Array.from([1, 1, 1, 100, 100]);\n  //     await ij.createImagePlus(cjTypedArrayToJava(new Uint8Array(bytes)), 1, cjTypedArrayToJava(shape), \"test image\");\n  //   }\n  // });\n}\n\nfunction setupDragDropPaste(imagej) {\n  const appContainer = document.getElementById(\"imagej-container\");\n  const dragOverlay = document.getElementById(\"drag-overlay\");\n  function processDataTransfer(items) {\n    if (!items) return;\n    const processed = [];\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      if (item.type.startsWith(\"event/\")) continue;\n      if (\n        item.kind === \"string\" &&\n        [\"text/plain\", \"text/uri-list\"].includes(item.type)\n      ) {\n        item.getAsString(function(data) {\n          if (processed.includes(data)) return;\n          if (data.startsWith(\"http\")) {\n            loadContentFromUrl(imagej, data);\n            processed.push(data);\n          } else {\n            const blob = new Blob([data]);\n            const file = new File([blob], \"clipboard.txt\", {\n              type: \"text/plain\"\n            });\n            mountFile(file).then(filepath => {\n              imagej.openAsync(filepath).finally(() => {\n                cheerpjRemoveStringFile(filepath);\n              });\n            });\n          }\n        });\n      } else if (item.kind === \"file\") {\n        const file = item.getAsFile();\n        if (file.name.endsWith(\".jar\") || file.name.endsWith(\".jar.js\")) {\n          saveFileToFS(imagej, file);\n        } else {\n          mountFile(file).then(filepath => {\n            imagej.openAsync(filepath).finally(() => {\n              cheerpjRemoveStringFile(filepath);\n            });\n          });\n        }\n      }\n    }\n  }\n  appContainer.addEventListener(\n    \"dragenter\",\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        dragOverlay.style.display = \"block\";\n      }\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"dragover\",\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (e.dataTransfer.types.includes(\"Files\")) {\n        dragOverlay.style.display = \"block\";\n      }\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"dragleave\",\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      dragOverlay.style.display = \"none\";\n    },\n    false\n  );\n  appContainer.addEventListener(\n    \"drop\",\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      processDataTransfer(e.dataTransfer.items);\n      dragOverlay.style.display = \"none\";\n    },\n    false\n  );\n\n  const cdisplay = document.getElementById(\"cheerpjDisplay\");\n  document.body.addEventListener(\"paste\", event => {\n    if (\n      event.target === cdisplay.firstChild ||\n      !cdisplay.contains(event.target)\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n      const paste = event.clipboardData || window.clipboardData;\n      processDataTransfer(paste.items);\n    }\n  });\n\n  window.pasteFromSystem = () => {\n    navigator.clipboard\n      .read()\n      .then(async clipboardItems => {\n        for (const clipboardItem of clipboardItems) {\n          try {\n            for (const type of clipboardItem.types) {\n              const blob = await clipboardItem.getType(type);\n              const file = new File(\n                [blob],\n                blob.name ||\n                  \"clipboard\" + (blob.type === \"text/plain\" ? \".txt\" : \"\"),\n                { type: blob.type || type }\n              );\n              mountFile(file).then(filepath => {\n                imagej.openAsync(filepath).finally(() => {\n                  cheerpjRemoveStringFile(filepath);\n                });\n              });\n            }\n          } catch (e) {\n            console.error(e, e.message);\n          }\n        }\n      })\n      .catch(e => {\n        window.ij.showStatus(\"Failed to paste from system: \" + e.toString());\n      });\n  };\n\n  window.copyToSystem = async imp => {\n    try {\n      await window.ij.showStatus(\"Copying to system clipboard...\");\n      loader.style.display = \"block\";\n      const name = cjStringJavaToJs(await cjCall(imp, \"getTitle\"));\n      const blob = new Blob([\n        javaBytesToArrayBuffer(await window.ij.saveAsBytes(imp, \"png\"))\n      ]);\n      const file = new File([blob], name, { type: \"image/png\" });\n      let data = [new ClipboardItem({ [file.type]: file })];\n\n      await navigator.clipboard.write(data);\n      await window.ij.showStatus(\"Image copied to system clipboard\");\n    } catch (e) {\n      await window.ij.showStatus(\"Failed to copy, error: \" + e.toString());\n    } finally {\n      loader.style.display = \"none\";\n    }\n  };\n}\n\nfunction readFile(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onload = function() {\n      const arrayBuffer = reader.result;\n      const bytes = new Uint8Array(arrayBuffer);\n      resolve(bytes);\n    };\n    reader.onerror = function(e) {\n      reject(e);\n    };\n  });\n}\n\nfunction fixHeight() {\n  // fix ios height issue\n  function resetHeight() {\n    // reset the body height to that of the inner browser\n    document.body.style.height = window.innerHeight + \"px\";\n  }\n  // reset the height whenever the window's resized\n  window.addEventListener(\"resize\", resetHeight);\n  // called to initially set the height.\n  resetHeight();\n}\n\nfunction addMenuItem(config) {\n  const newMenu = document.createElement(\"li\");\n  newMenu.classList.add(\"menuItem\");\n  newMenu.classList.add(\"subMenuItem\");\n  const button = document.createElement(\"a\");\n  button.innerHTML = config.label;\n  newMenu.appendChild(button);\n  newMenu.onclick = () => {\n    config.callback();\n  };\n  const menuIndexs = {\n    File: 1,\n    Edit: 2,\n    Image: 3,\n    Process: 4,\n    Analyze: 5,\n    Plugins: 6,\n    Window: 7,\n    Help: 8\n  };\n  const index = menuIndexs[config.group || \"Plugins\"];\n\n  const targetMenu = document.querySelector(\n    `#cheerpjDisplay>.window>div.menuBar>.menu>.menuItem:nth-child(${index})>ul`\n  );\n  for (let ch of targetMenu.children) {\n    if (ch.children[0].innerHTML === config.label) {\n      targetMenu.removeChild(ch);\n    }\n  }\n  if (config.position) {\n    targetMenu.insertBefore(newMenu, targetMenu.children[config.position]);\n  } else {\n    targetMenu.appendChild(newMenu);\n  }\n}\n\nfunction registerServiceWorker() {\n  if (\"serviceWorker\" in navigator) {\n    window.addEventListener(\"load\", function() {\n      navigator.serviceWorker.register(\"/service-worker.js\").then(\n        function(registration) {\n          // Registration was successful\n          console.log(\n            \"ServiceWorker registration successful with scope: \",\n            registration.scope\n          );\n        },\n        function(err) {\n          // registration failed :(\n          console.log(\"ServiceWorker registration failed: \", err);\n        }\n      );\n    });\n  }\n}\n\nfunction iOS() {\n  return (\n    [\n      \"iPad Simulator\",\n      \"iPhone Simulator\",\n      \"iPod Simulator\",\n      \"iPad\",\n      \"iPhone\",\n      \"iPod\"\n    ].includes(navigator.platform) ||\n    // iPad on iOS 13 detection\n    (navigator.userAgent.includes(\"Mac\") && \"ontouchend\" in document)\n  );\n}\n\nfunction getCSSRule(search) {\n  return [].map\n    .call(document.styleSheets, function(item) {\n      return [].slice.call(item.cssRules);\n    })\n    .reduce(function(a, b) {\n      return b.concat(a);\n    })\n    .filter(function(rule) {\n      return (\n        rule.cssText.lastIndexOf(search) === rule.cssText.length - search.length\n      );\n    })[0];\n}\n\nfunction fixStyle() {\n  if (iOS()) {\n    // Create our stylesheet\n    var style = document.createElement(\"style\");\n    style.innerHTML = `.titleBar>.controls {\n      margin-top: -5px;\n      color: white !important;\n    }\n    .dialog-ctrl{\n      margin-top: -14px!important;\n    }\n    #imjoy-menu {\n      margin-top: -2px;\n    }\n    `;\n    // Get the first script tag\n    var ref = document.querySelector(\"script\");\n\n    // Insert our new styles before the first script tag\n    ref.parentNode.insertBefore(style, ref);\n  }\n}\n\nfunction touchHandler(event) {\n  var touches = event.changedTouches,\n    first = touches[0],\n    type = \"\";\n  switch (event.type) {\n    case \"touchstart\":\n      type = \"mousedown\";\n      break;\n    case \"touchmove\":\n      type = \"mousemove\";\n      break;\n    case \"touchend\":\n      type = \"mouseup\";\n      break;\n    default:\n      return;\n  }\n\n  // initMouseEvent(type, canBubble, cancelable, view, clickCount,\n  //                screenX, screenY, clientX, clientY, ctrlKey,\n  //                altKey, shiftKey, metaKey, button, relatedTarget);\n\n  var simulatedEvent = document.createEvent(\"MouseEvent\");\n  simulatedEvent.initMouseEvent(\n    type,\n    true,\n    true,\n    window,\n    1,\n    first.screenX,\n    first.screenY,\n    first.clientX,\n    first.clientY,\n    false,\n    false,\n    false,\n    false,\n    0 /*left*/,\n    null\n  );\n\n  first.target.dispatchEvent(simulatedEvent);\n  event.preventDefault();\n}\n\nfunction fixTouch() {\n  const menus = document.querySelectorAll(\".subMenuItem\");\n  for (let menu of menus) {\n    menu.removeEventListener(\"touchstart\", touchClick);\n  }\n}\n\nfunction cheerpjRemoveStringFile(name) {\n  var mount = cheerpjGetFSMountForPath(name);\n  assert(mount instanceof CheerpJDataFolder);\n  const path = name.substr(mount.mountPoint.length - 1);\n  delete mount.files[path];\n}\n\nasync function loadContentFromUrl(imagej, url) {\n  try {\n    Snackbar.show({\n      text: \"Opening \" + url,\n      pos: \"bottom-left\"\n    });\n    // convert to raw if we can\n    if (url.includes(\"//zenodo.org/record\")) {\n      url = await convertZenodoFileUrl(url);\n    } else {\n      const tmp =\n        (await githubUrlRaw(url, \".ijm\")) ||\n        (await githubUrlRaw(url, \".imjoy.html\"));\n      url = tmp || url;\n    }\n\n    await imagej.openAsync(url);\n    Snackbar.show({\n      text: \"Successfully opened \" + url,\n      pos: \"bottom-left\"\n    });\n  } catch (e) {\n    console.error(e);\n    Snackbar.show({\n      text: \"Failed to open \" + url,\n      pos: \"bottom-left\"\n    });\n  }\n}\n\nasync function processUrlParameters(imagej) {\n  const queryString = window.location.search;\n  const urlParams = new URLSearchParams(queryString);\n  if (urlParams.has(\"open\")) {\n    const urls = urlParams.getAll(\"open\");\n    for (let url of urls) {\n      if (url.startsWith(\"http\")) await loadContentFromUrl(imagej, url);\n      else {\n        const decompressed = LZString.decompressFromEncodedURIComponent(url);\n        if (decompressed) {\n          const data = JSON.parse(decompressed);\n          sharingScript = data;\n          const blob = new Blob([data.content]);\n          const file = new File([blob], data.name, {\n            type: \"text/plain\"\n          });\n          mountFile(file).then(filepath => {\n            imagej.openAsync(filepath).finally(() => {\n              cheerpjRemoveStringFile(filepath);\n            });\n          });\n          Snackbar.show({\n            text: \"Script loaded from URL\",\n            pos: \"bottom-left\"\n          });\n        } else {\n          console.error(\"Failed to decompress url: \", url);\n        }\n      }\n    }\n  }\n  if (urlParams.has(\"run\")) {\n    const urls = urlParams.getAll(\"run\");\n    for (let url of urls) {\n      try {\n        if (url.startsWith(\"http\")) {\n          Snackbar.show({\n            text: \"Fetching and running macro from: \" + url,\n            pos: \"bottom-left\"\n          });\n          if (url.includes(\"//zenodo.org/record\")) {\n            url = await convertZenodoFileUrl(url);\n            if (!url.endsWith(\".ijm\")) throw new Error(\"not an imagej macro\");\n          } else {\n            // convert to raw if we can\n            const tmp = await githubUrlRaw(url, \".ijm\");\n            url = tmp || url;\n          }\n\n          const blob = await fetch(url).then(r => r.blob());\n          const macro = await new Response(blob).text();\n          await imagej.runMacroAsync(macro, \"\");\n        } else {\n          const decompressed = LZString.decompressFromEncodedURIComponent(url);\n          if (decompressed) {\n            const data = JSON.parse(decompressed);\n            await imagej.runMacroAsync(data.content, \"\");\n            Snackbar.show({\n              text: \"Executed script from URL\",\n              pos: \"bottom-left\"\n            });\n          } else {\n            console.error(\"Failed to decompress url: \", url);\n          }\n        }\n      } catch (e) {\n        Snackbar.show({\n          text: \"Failed to run macro: \" + e.toString(),\n          pos: \"bottom-left\"\n        });\n      }\n    }\n  }\n}\n\nwindow.onImageJInitialized = async () => {\n  const _cheerpjCloseAsync = window.cheerpjCloseAsync;\n  window.cheerpjCloseAsync = function(fds, fd, p) {\n    const fdObj = fds[fd];\n    const fileData = fdObj.fileData;\n    const tmp = fileData.path.split(\"/\");\n    const filename = tmp[tmp.length - 1];\n    if (downloadQueue[filename]) {\n      delete downloadQueue[filename];\n      //TODO: support file system other than indexeddb\n      //TODO: support streaming for large files\n      const chunks = [];\n      let byteCount = 0;\n      // copy the chunks\n      for (let c of fileData.chunks) {\n        if (byteCount + c.length > fileData.length) {\n          chunks.push(c.slice(0, fileData.length - byteCount));\n          break;\n        } else chunks.push(c);\n        byteCount += c.length;\n      }\n      _cheerpjCloseAsync.apply(null, arguments);\n      downloadBytesFile(chunks, filename);\n      // remove the file after downloading\n      window.ij.removeFile(\"/files/\" + filename);\n      loader.style.display = \"none\";\n    } else {\n      _cheerpjCloseAsync.apply(null, arguments);\n    }\n  };\n  const imagej = {\n    run: await cjResolveCall(\"ij.IJ\", \"run\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    showStatus: await cjResolveCall(\"ij.IJ\", \"showStatus\", [\n      \"java.lang.String\"\n    ]),\n    showMessage: await cjResolveCall(\"ij.IJ\", \"showMessage\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    runPlugIn: await cjResolveCall(\"ij.IJ\", \"runPlugIn\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    runMacro: await cjResolveCall(\"ij.IJ\", \"runMacro\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    installMacro: await cjResolveCall(\"ij.IJ\", \"installMacro\", [\n      \"java.lang.String\"\n    ]),\n    installTool: await cjResolveCall(\"ij.IJ\", \"installTool\", [\n      \"java.lang.String\"\n    ]),\n    open: await cjResolveCall(\"ij.IJ\", \"open\", [\"java.lang.String\"]),\n    installPlugin: await cjResolveCall(\"ij.Menus\", \"installPlugin\", null),\n    getPlugins: await cjResolveCall(\"ij.Menus\", \"getPlugins\", []),\n    getPlugInsPath: await cjResolveCall(\"ij.Menus\", \"getPlugInsPath\", []),\n    getImage: await cjResolveCall(\"ij.IJ\", \"getImage\", []),\n    createImagePlus: await cjResolveCall(\"ij.IJ\", \"createImagePlus\", null),\n    save: await cjResolveCall(\"ij.IJ\", \"save\", [\n      \"ij.ImagePlus\",\n      \"java.lang.String\"\n    ]),\n    saveAsBytes: await cjResolveCall(\"ij.IJ\", \"saveAsBytes\", [\n      \"ij.ImagePlus\",\n      \"java.lang.String\"\n    ]),\n    getPixels: await cjResolveCall(\"ij.IJ\", \"getPixels\", [\n      \"ij.ImagePlus\",\n      \"int\",\n      \"int\",\n      \"int\"\n    ]),\n    selectWindow: await cjResolveCall(\"ij.IJ\", \"selectWindow\", [\n      \"java.lang.String\"\n    ]),\n    createPlugInFrame: await cjResolveCall(\"ij.IJ\", \"createPlugInFrame\", [\n      \"java.lang.String\",\n      \"int\",\n      \"int\",\n      \"int\",\n      \"int\"\n    ]),\n    getDimensions: await cjResolveCall(\"ij.IJ\", \"getDimensions\", [\n      \"ij.ImagePlus\"\n    ]),\n    getString: await cjResolveCall(\"ij.IJ\", \"getString\", [\n      \"java.lang.String\",\n      \"java.lang.String\"\n    ]),\n    listDir: await cjResolveCall(\"ij.IJ\", \"listDir\", [\"java.lang.String\"]),\n    removeFile: await cjResolveCall(\"ij.IJ\", \"removeFile\", [\n      \"java.lang.String\"\n    ]),\n    openAsBytes: await cjResolveCall(\"ij.IJ\", \"openAsBytes\", [\n      \"java.lang.String\"\n    ]),\n    saveBytes: await cjResolveCall(\"ij.IJ\", \"saveBytes\", null),\n    // updateImageJMenus: await cjResolveCall(\"ij.Menus\", \"updateImageJMenus\", null),\n    // getPrefsDir: await cjResolveCall(\"ij.Prefs\", \"getPrefsDir\", null),\n    getImageData,\n    showImage,\n    ndarrayToImagePlus\n  };\n\n  imagej.runMacroAsync = function(macro, args) {\n    return new Promise(resolve => {\n      window.onMacroResolve = resolve;\n      // TODO: handle reject\n      window.onMacroReject = resolve;\n      imagej.runMacro(macro, args);\n    });\n  };\n  imagej.openAsync = function(url) {\n    return new Promise(resolve => {\n      window.onOpenResolve = resolve;\n      imagej.open(url);\n    });\n  };\n  window.ij = imagej;\n  setupDragDropPaste(imagej);\n  fixMenu();\n  fixTouch();\n\n  function setAPI(core_api) {\n    setupImJoyAPI(\n      core_api,\n      imagej,\n      loader,\n      javaBytesToArrayBuffer,\n      saveImage,\n      openImage,\n      addMenuItem\n    );\n  }\n  // if inside an iframe, setup ImJoy\n  if (window.self !== window.top) {\n    setAPI(null);\n  } else {\n    await setupImJoyApp(setAPI);\n    const titleBar = document.querySelector(\".titleBar\");\n    const elem = document.getElementById(\"imjoy-menu\");\n    titleBar.parentNode.insertBefore(elem, titleBar.nextSibling);\n  }\n\n  processUrlParameters(imagej);\n\n  loader.style.display = \"none\";\n\n  setTimeout(() => {\n    localStorage.setItem(\"cheepjPreload\", cjGetRuntimeResources());\n  }, 1000);\n  console.timeEnd(\"Loading ImageJ.JS\");\n};\n\nfunction updateViewPort() {\n  const mvp = document.getElementById(\"index-viewport\");\n  if (screen.width < 400) {\n    mvp.setAttribute(\"content\", \"user-scalable=no,width=400\");\n  } else {\n    mvp.setAttribute(\n      \"content\",\n      \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\n    );\n  }\n}\n\ndocument.addEventListener(\n  \"DOMContentLoaded\",\n  function() {\n    updateViewPort();\n    window.addEventListener(\"resize\", updateViewPort);\n    registerServiceWorker();\n    fixHeight();\n    fixStyle();\n    console.time(\"Loading ImageJ.JS\");\n    startImageJ();\n  },\n  false\n);\n","import { setupRPC } from \"imjoy-rpc\";\nimport { version, description } from \"../package.json\";\n\nexport async function setupImJoyAPI(\n  api,\n  imagej,\n  loader,\n  javaBytesToArrayBuffer,\n  saveImage,\n  openImage,\n  addMenuItem\n) {\n  if (!api)\n    api = await setupRPC({\n      name: \"ImageJ.JS\",\n      version: version,\n      description: description,\n      type: \"rpc-window\",\n      defaults: { fullscreen: true }\n    });\n  const service_api = {\n    setup() {\n      api.log(\"ImageJ.JS loaded successfully.\");\n    },\n    async run(ctx) {\n      if (ctx.data && ctx.data.images) {\n        //TODO: load images\n        for (let img of ctx.data.images) {\n          this.viewImage(img);\n        }\n      }\n    },\n    addMenuItem,\n    async open(path) {\n      loader.style.display = \"block\";\n      try {\n        await openImage(imagej, path);\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    async save(filename, format, ext) {\n      loader.style.display = \"block\";\n      try {\n        await saveImage(imagej, filename, format, ext);\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    async runMacro(macro, args) {\n      try {\n        return await imagej.runMacroAsync(macro, args || \"\");\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    async installMacro(macro) {\n      try {\n        await imagej.installMacro(macro);\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    async installTool(tool) {\n      try {\n        await imagej.installTool(tool);\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    runPlugIn(className, args) {\n      imagej.runPlugIn(className, args || \"\");\n    },\n    async viewImage(img, options) {\n      loader.style.display = \"block\";\n      try {\n        imagej.showImage(img, options);\n      } catch (e) {\n        throw e;\n      } finally {\n        loader.style.display = \"none\";\n      }\n    },\n    async getSelection() {\n      const imp = await imagej.getImage();\n      const bytes = javaBytesToArrayBuffer(\n        await imagej.saveAsBytes(imp, \"selection\")\n      );\n      return bytes;\n    },\n    async getDimensions() {\n      const imp = await imagej.getImage();\n      // d[0] = width;\td[1] = height; d[2] = nChannels;\td[3] = nSlices; d[4] = nFrames;\n      return Array.from((await imagej.getDimensions(imp)).slice(1));\n    },\n    async selectWindow(title) {\n      await imagej.selectWindow(title);\n    },\n    async getImage(format) {\n      loader.style.display = \"block\";\n      try {\n        if (!format || format === \"ndarray\" || typeof format !== \"string\") {\n          const imp = await imagej.getImage();\n          format = format || {};\n          const data = await imagej.getImageData(\n            imagej,\n            imp,\n            format.all || false,\n            format.channel || 0,\n            format.slice || 0,\n            format.frame || 0\n          );\n          return {\n            _rtype: \"ndarray\",\n            _rvalue: data.bytes,\n            _rshape: data.shape,\n            _rdtype: data.type\n          };\n        } else {\n          const imp = await imagej.getImage();\n          return javaBytesToArrayBuffer(await imagej.saveAsBytes(imp, format));\n        }\n      } finally {\n        loader.style.display = \"none\";\n      }\n    }\n  };\n\n  api.export(service_api);\n}\n"],"sourceRoot":""}